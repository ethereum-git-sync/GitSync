{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1464",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1464/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1464/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1464/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/1464",
  "id": 516959150,
  "node_id": "MDU6SXNzdWU1MTY5NTkxNTA=",
  "number": 1464,
  "title": "Eth1 data voting exception",
  "user": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-11-04T04:57:16Z",
  "updated_at": "2019-11-08T18:16:33Z",
  "closed_at": "2019-11-08T18:16:32Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Part of the description for [Eth1 Data](https://github.com/ethereum/eth2.0-specs/blob/v0.9.0/specs/validator/0_beacon-chain-validator.md#eth1-data) voting is as follows:\r\n\r\n> Let `get_eth1_data(distance: uint64) -> Eth1Data` be the (subjective) function that returns the Eth1 data at distance distance relative to the Eth1 head at the start of the current Eth1 voting period. Let `previous_eth1_distance` be the distance relative to the Eth1 block corresponding to `state.eth1_data.block_hash` at the start of the current Eth1 voting period. An honest block proposer sets `block.eth1_data = get_eth1_vote(state, previous_eth1_distance)` where ...\r\n\r\nThis text uses the `state` variable twice:\r\n\r\n1. `state.eth1_data.block_hash` when determining `previous_eth1_distance`.\r\n1. ` get_eth1_vote(state, previous_eth1_distance)` when setting `block.eth1_data`.\r\n\r\nI claim that these two `state` variables must be distinct, otherwise, in the best-case voting scenario, an exception is raised (see \"_Empty `all_eth1_data` exception_\") .\r\n\r\nI think it comes down to the following line being unclear (imo):\r\n\r\n> Let `previous_eth1_distance` be the distance relative to the Eth1 block corresponding to `state.eth1_data.block_hash` at the start of the current Eth1 voting period.\r\n\r\nAnd to prevent the exception, it should become:\r\n\r\n> Let `prev_state` be the state at the start of the current Eth1 voting period. Let `previous_eth1_distance` be the distance between the Eth1 head at the start of the current Eth1 voting period and the Eth1 block corresponding to `prev_state.eth1_data.block_hash`\r\n\r\nHowever, what I suggested is still somewhat overwhelming to read. It's my opinion that the second paragraph of [Eth1 Data](https://github.com/ethereum/eth2.0-specs/blob/v0.9.0/specs/validator/0_beacon-chain-validator.md#eth1-data) should really be executable code instead of English.\r\n\r\n#### _Empty `all_eth1_data` exception_\r\n\r\nThis describes an exception that is raised when using the `state` at the current slot (i.e., the `state` for the block being produced) as inputs to both `get_eth1_vote(..)` and `previous_eth1_distance`:\r\n\r\n1. The first block proposer in the eth1 voting period chooses `get_eth1_data(ETH1_FOLLOW_DISTANCE)`.\r\n1. All subsequent block proposers select the same eth1 block.\r\n1. After ~`SLOTS_PER_ETH1_VOTING_PERIOD / 2` slots, `state.eth1_data` is set to  `get_eth1_data(ETH1_FOLLOW_DISTANCE)` (as per [`process_eth1_data`](https://github.com/ethereum/eth2.0-specs/blob/v0.9.0/specs/core/0_beacon-chain.md#eth1-data)).\r\n1. Next time `get_eth1_vote` is called, `len(all_eth1_data) == 0` because `previous_eth1_distance == ETH1_FOLLOW_DISTANCE`.\r\n1. The `lambda` in the `max` function raises a `ValueError` because `v` is not in `all_eth1_data`.",
  "closed_by": {
    "login": "djrtwo",
    "id": 1433595,
    "node_id": "MDQ6VXNlcjE0MzM1OTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/djrtwo",
    "html_url": "https://github.com/djrtwo",
    "followers_url": "https://api.github.com/users/djrtwo/followers",
    "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
    "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
    "organizations_url": "https://api.github.com/users/djrtwo/orgs",
    "repos_url": "https://api.github.com/users/djrtwo/repos",
    "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/djrtwo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1464/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1464/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/549224899",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/1464#issuecomment-549224899",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1464",
    "id": 549224899,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0OTIyNDg5OQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-04T04:57:51Z",
    "updated_at": "2019-11-04T05:26:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "~~This was an accidental submission, please give me some time finish it (and perhaps realize it's invalid).~~",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/549224899/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/549227880",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/1464#issuecomment-549227880",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1464",
    "id": 549227880,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0OTIyNzg4MA==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-04T05:25:52Z",
    "updated_at": "2019-11-04T05:25:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Alrighty, I'm finished with this and would still like to raise it as an issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/549227880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/550000963",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/1464#issuecomment-550000963",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1464",
    "id": 550000963,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MDAwMDk2Mw==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-05T20:16:53Z",
    "updated_at": "2019-11-05T20:16:53Z",
    "author_association": "MEMBER",
    "body": "You are correct. The current language was assuming that eth1data wasn't updated in state until the end of the period. Because we opportunistically update eth1data in the middle of the voting period if enough votes, we can't rely on it being stable.\r\n\r\nI agree that some more executable code and some more consensus tests would be useful, but for now I'm going to expedite the change in language through to get it out immediately with `v0.9.1`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/550000963/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/551935007",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/1464#issuecomment-551935007",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1464",
    "id": 551935007,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MTkzNTAwNw==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-08T18:16:32Z",
    "updated_at": "2019-11-08T18:16:32Z",
    "author_association": "MEMBER",
    "body": "addressed via clarification in the text in #1469 \r\nClosing for now. We can address further executability and testing in subsequent issues/prs",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/551935007/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
