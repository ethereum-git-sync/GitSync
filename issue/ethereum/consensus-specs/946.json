{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/946",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/946/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/946/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/946/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/946",
  "id": 433935546,
  "node_id": "MDU6SXNzdWU0MzM5MzU1NDY=",
  "number": 946,
  "title": "Clarify \"per-epoch processing\"",
  "user": {
    "login": "dankrad",
    "id": 6130607,
    "node_id": "MDQ6VXNlcjYxMzA2MDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6130607?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dankrad",
    "html_url": "https://github.com/dankrad",
    "followers_url": "https://api.github.com/users/dankrad/followers",
    "following_url": "https://api.github.com/users/dankrad/following{/other_user}",
    "gists_url": "https://api.github.com/users/dankrad/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dankrad/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dankrad/subscriptions",
    "organizations_url": "https://api.github.com/users/dankrad/orgs",
    "repos_url": "https://api.github.com/users/dankrad/repos",
    "events_url": "https://api.github.com/users/dankrad/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dankrad/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1137720193,
      "node_id": "MDU6TGFiZWwxMTM3NzIwMTkz",
      "url": "https://api.github.com/repos/ethereum/consensus-specs/labels/general:discussion",
      "name": "general:discussion",
      "color": "F17C67",
      "default": false,
      "description": ""
    },
    {
      "id": 1244734333,
      "node_id": "MDU6TGFiZWwxMjQ0NzM0MzMz",
      "url": "https://api.github.com/repos/ethereum/consensus-specs/labels/general:presentation",
      "name": "general:presentation",
      "color": "2EA9DF",
      "default": false,
      "description": "Presentation (as opposed to content)"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-04-16T18:57:08Z",
  "updated_at": "2019-05-07T07:12:18Z",
  "closed_at": "2019-05-07T07:12:17Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "When reading through the spec, I noticed that during epoch processing, the \"current epoch\" actually refers to the previous epoch, whereas in the block processing, the \"current slot\" corresponds to the slot of the given block.\r\n\r\nTo make this less confusing, I suggest renaming it to \"end of epoch processing\"?",
  "closed_by": {
    "login": "JustinDrake",
    "id": 731743,
    "node_id": "MDQ6VXNlcjczMTc0Mw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/731743?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/JustinDrake",
    "html_url": "https://github.com/JustinDrake",
    "followers_url": "https://api.github.com/users/JustinDrake/followers",
    "following_url": "https://api.github.com/users/JustinDrake/following{/other_user}",
    "gists_url": "https://api.github.com/users/JustinDrake/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/JustinDrake/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/JustinDrake/subscriptions",
    "organizations_url": "https://api.github.com/users/JustinDrake/orgs",
    "repos_url": "https://api.github.com/users/JustinDrake/repos",
    "events_url": "https://api.github.com/users/JustinDrake/events{/privacy}",
    "received_events_url": "https://api.github.com/users/JustinDrake/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/946/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/946/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/484477299",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/946#issuecomment-484477299",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/946",
    "id": 484477299,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NDQ3NzI5OQ==",
    "user": {
      "login": "JustinDrake",
      "id": 731743,
      "node_id": "MDQ6VXNlcjczMTc0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/731743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JustinDrake",
      "html_url": "https://github.com/JustinDrake",
      "followers_url": "https://api.github.com/users/JustinDrake/followers",
      "following_url": "https://api.github.com/users/JustinDrake/following{/other_user}",
      "gists_url": "https://api.github.com/users/JustinDrake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JustinDrake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JustinDrake/subscriptions",
      "organizations_url": "https://api.github.com/users/JustinDrake/orgs",
      "repos_url": "https://api.github.com/users/JustinDrake/repos",
      "events_url": "https://api.github.com/users/JustinDrake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JustinDrake/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-18T12:06:53Z",
    "updated_at": "2019-04-18T12:08:15Z",
    "author_association": "MEMBER",
    "body": "We have\r\n\r\n```python\r\ndef get_current_epoch(state: BeaconState) -> Epoch:\r\n    return state.slot // SLOTS_PER_EPOCH\r\n```\r\n\r\nand (see [state_transition.py](https://github.com/ethereum/eth2.0-specs/blob/dev/test_libs/pyspec/eth2spec/phase0/state_transition.py))\r\n\r\n```python\r\ndef state_transition_to(state: BeaconState, up_to: Slot) -> BeaconState:\r\n    while state.slot < up_to:\r\n        spec.cache_state(state)\r\n        if (state.slot + 1) % spec.SLOTS_PER_EPOCH == 0:\r\n            process_epoch_transition(state)\r\n        spec.advance_slot(state)\r\n```\r\n\r\nIn other words, `process_epoch_transition` happens at `transition_slot(k) = SLOTS_PER_EPOCH * k + SLOTS_PER_EPOCH - 1` for `k = 0, 1, 2, ...`, where `get_current_epoch(transition_slot(k)) == k`.\r\n\r\nThis does seem to contradict this sentence in the spec:\r\n\r\n> The per-epoch transitions, which happens at the start of the first slot of every epoch.\"\r\n\r\n@djrtwo: Should it say \"The per-epoch transitions, which happens at the start of the last slot of every epoch.\"?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/484477299/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/484832992",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/946#issuecomment-484832992",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/946",
    "id": 484832992,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NDgzMjk5Mg==",
    "user": {
      "login": "dankrad",
      "id": 6130607,
      "node_id": "MDQ6VXNlcjYxMzA2MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6130607?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dankrad",
      "html_url": "https://github.com/dankrad",
      "followers_url": "https://api.github.com/users/dankrad/followers",
      "following_url": "https://api.github.com/users/dankrad/following{/other_user}",
      "gists_url": "https://api.github.com/users/dankrad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dankrad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dankrad/subscriptions",
      "organizations_url": "https://api.github.com/users/dankrad/orgs",
      "repos_url": "https://api.github.com/users/dankrad/repos",
      "events_url": "https://api.github.com/users/dankrad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dankrad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-19T09:50:28Z",
    "updated_at": "2019-04-19T09:50:28Z",
    "author_association": "MEMBER",
    "body": "> @djrtwo: Should it say \"The per-epoch transitions, which happens at the start of the last slot of every epoch.\"?\r\n\r\nI think it should actually be\r\n\r\n- after the last slot of every epoch\r\n- before the first slot of every epoch\r\n\r\n(I prefer the first variant and suggest, to make it clearer, to call them \"end of epoch\" transition, because the epoch number at the time of the transition is the old epoch rather than the new one)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/484832992/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/489837104",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/946#issuecomment-489837104",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/946",
    "id": 489837104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTgzNzEwNA==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-07T00:15:18Z",
    "updated_at": "2019-05-07T00:15:18Z",
    "author_association": "MEMBER",
    "body": "> The per-epoch transitions, which happens at the start of the first slot of every epoch.\"\r\n\r\nAt the start of the state transition of the first slot of every epoch.\r\n\r\nyes, the slot isn't incremented yet at that point in the state transition but it is certainly during the state transition of the 1st slot of the epoch.\r\n\r\nThat said, the debate really seems to be in #1043 ðŸ˜‚ ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/489837104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/489962134",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/946#issuecomment-489962134",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/946",
    "id": 489962134,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTk2MjEzNA==",
    "user": {
      "login": "JustinDrake",
      "id": 731743,
      "node_id": "MDQ6VXNlcjczMTc0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/731743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JustinDrake",
      "html_url": "https://github.com/JustinDrake",
      "followers_url": "https://api.github.com/users/JustinDrake/followers",
      "following_url": "https://api.github.com/users/JustinDrake/following{/other_user}",
      "gists_url": "https://api.github.com/users/JustinDrake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JustinDrake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JustinDrake/subscriptions",
      "organizations_url": "https://api.github.com/users/JustinDrake/orgs",
      "repos_url": "https://api.github.com/users/JustinDrake/repos",
      "events_url": "https://api.github.com/users/JustinDrake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JustinDrake/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-07T07:12:17Z",
    "updated_at": "2019-05-07T07:12:17Z",
    "author_association": "MEMBER",
    "body": "Closing in favour of #1043 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/489962134/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
