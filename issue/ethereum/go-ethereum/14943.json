{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/14943",
  "id": 248879907,
  "node_id": "MDU6SXNzdWUyNDg4Nzk5MDc=",
  "number": 14943,
  "title": "consensus/ethash: segfault race",
  "user": {
    "login": "immesys",
    "id": 4234131,
    "node_id": "MDQ6VXNlcjQyMzQxMzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/immesys",
    "html_url": "https://github.com/immesys",
    "followers_url": "https://api.github.com/users/immesys/followers",
    "following_url": "https://api.github.com/users/immesys/following{/other_user}",
    "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
    "organizations_url": "https://api.github.com/users/immesys/orgs",
    "repos_url": "https://api.github.com/users/immesys/repos",
    "events_url": "https://api.github.com/users/immesys/events{/privacy}",
    "received_events_url": "https://api.github.com/users/immesys/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2017-08-08T23:56:43Z",
  "updated_at": "2018-09-30T12:49:28Z",
  "closed_at": "2018-09-30T12:49:28Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth version`\r\nCommit  ab5646c53 (1.6.7) embedded into a different program\r\n\r\nOS & Version: Linux, Ubuntu 16.04\r\n\r\n#### Expected behaviour\r\nPrivate chain syncs ok\r\n\r\n#### Actual behaviour\r\nA few seconds into fast sync, it crashes with sigsegv, backtrace below.\r\n\r\nI think it might have something to do with concurrency. If I put a lock around VerifySeal so that only one call happens at a time, the problem goes away (and I lose all of the performance). Is VerifySeal expected to be threadsafe? I would expect so. Does anyone have any ideas on how to debug this?\r\n\r\n```\r\nunexpected fault address 0x7f87eafe6d08\r\nfatal error: fault\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x7f87eafe6d08 pc=0x92159f]\r\n\r\ngoroutine 3017 [running]:\r\nruntime.throw(0x11e4127, 0x5)\r\n\t/usr/local/go/src/runtime/panic.go:596 +0x95 fp=0xc429d457d0 sp=0xc429d457b0\r\nruntime.sigpanic()\r\n\t/usr/local/go/src/runtime/signal_unix.go:297 +0x28c fp=0xc429d45820 sp=0xc429d457d0\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.fnvHash(0xc429d45880, 0x10, 0x10, 0x7f87eafe6d08, 0x4064b0, 0x4064b0)\r\n\t/home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/algorithm.go:183 +0x2f fp=0xc429d45830 sp=0xc429d45820\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.generateDatasetItem(0x7f87eafc0008, 0x40fff0, 0x40fff0, 0xc4006fb18a, 0xc423df30c0, 0x10, 0x40, 0x40)\r\n\t/home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/algorithm.go:210 +0x2dd fp=0xc429d458d8 sp=0xc429d45830\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.hashimotoLight.func1(0xc4006fb18a, 0x20, 0x20, 0xc421281280)\r\n\t/home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/algorithm.go:336 +0x51 fp=0xc429d45940 sp=0xc429d458d8\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.hashimoto(0xc429d45c00, 0x20, 0x20, 0x8bd27dbedc1a4441, 0x40ffef80, 0xc423e02030, 0x9dbabc8e5d2e7bbf, 0x1b79c118f127ffe2, 0x3a8aadddeea0cc5a, 0x21575580ec58deed, ...)\r\n\t/home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/algorithm.go:312 +0x30d fp=0xc429d45ad8 sp=0xc429d45940\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.hashimotoLight(0x40ffef80, 0x7f87eafc0008, 0x40fff0, 0x40fff0, 0xc429d45c00, 0x20, 0x20, 0x8bd27dbedc1a4441, 0xc423e02000, 0x20, ...)\r\n\t/home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/algorithm.go:344 +0x131 fp=0xc429d45b58 sp=0xc429d45ad8\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).VerifySeal(0xc4202f6600, 0x1a62da0, 0xc4202ca900, 0xc42137c240, 0x1, 0x5)\r\n\t/home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:456 +0x1e2 fp=0xc429d45c88 sp=0xc429d45b58\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).verifyHeader(0xc4202f6600, 0x1a62da0, 0xc4202ca900, 0xc42137c240, 0xc42137c000, 0x10100, 0x0, 0xc42119a980)\r\n\t/home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:271 +0x6fd fp=0xc429d45e48 sp=0xc429d45c88\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).verifyHeaderWorker(0xc4202f6600, 0x1a62da0, 0xc4202ca900, 0xc4248fa000, 0x780, 0x780, 0xc43027c800, 0x780, 0x780, 0x38, ...)\r\n\t/home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:164 +0x20c fp=0xc429d45ee8 sp=0xc429d45e48\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).VerifyHeaders.func1(0xc42ecf9f80, 0xc42c388000, 0x780, 0x780, 0xc4202f6600, 0x1a62da0, 0xc4202ca900, 0xc4248fa000, 0x780, 0x780, ...)\r\n\t/home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:115 +0xe9 fp=0xc429d45f70 sp=0xc429d45ee8\r\nruntime.goexit()\r\n\t/usr/local/go/src/runtime/asm_amd64.s:2197 +0x1 fp=0xc429d45f78 sp=0xc429d45f70\r\ncreated by github.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).VerifyHeaders\r\n\t/home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:118 +0x320\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321315113",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14943#issuecomment-321315113",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943",
    "id": 321315113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTMxNTExMw==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-09T16:52:53Z",
    "updated_at": "2017-08-09T16:53:43Z",
    "author_association": "NONE",
    "body": "I can elucidate a bit more. In [VerifySeal in ethash's consensus.go](https://github.com/ethereum/go-ethereum/blob/8c313eed2614990089114bfe5fea7540f4298752/consensus/ethash/consensus.go#L471), there is this line:\r\n\r\n```\r\ncache := ethash.cache(number)\r\n```\r\n\r\ncache is a `[]uint32`. Now you would agree that doing this should change nothing right?\r\n\r\n```\r\norigcache := ethash.cache(number)\r\ncache := make([]uint32,len(origcache))\r\nfor i, v := range origcache {\r\n   cache[i] = v\r\n}\r\n```\r\nWell if I do this (essentially \"verifying\" that the cache array is valid memory by touching every element) then the segfault happens inside the for loop rather than happening later inside fnvHash. There is definitely something fishy about the way this cache array is handled and it is 100% reproducible on one of my machines (but not the other, which perplexes me)\r\n\r\nEDIT: both machines are go1.8.3 amd64",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321315113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321316673",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14943#issuecomment-321316673",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943",
    "id": 321316673,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTMxNjY3Mw==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-09T16:58:40Z",
    "updated_at": "2017-08-09T16:58:40Z",
    "author_association": "NONE",
    "body": "Also if I build with race detection, I get a race report a few milliseconds before the segfault:\r\n\r\n```\r\nWARNING: DATA RACE\r\nRead at 0x00c428e6f4d0 by goroutine 209:\r\n  runtime.convT2E()\r\n      /usr/local/go/src/runtime/iface.go:191 +0x0\r\n  github.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).cache()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/ethash.go:449 +0x4d1\r\n  github.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).VerifySeal()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:455 +0x343\r\n  github.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).verifyHeader()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:272 +0x8ef\r\n  github.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).verifyHeaderWorker()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:165 +0x375\r\n  github.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).VerifyHeaders.func1()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:116 +0x104\r\n\r\nPrevious write at 0x00c428e6f4d0 by goroutine 236:\r\n  [failed to restore the stack]\r\n\r\nGoroutine 209 (running) created at:\r\n  github.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).VerifyHeaders()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:119 +0x355\r\n  github.com/ethereum/go-ethereum/core.(*HeaderChain).ValidateHeaderChain()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/core/headerchain.go:228 +0x4d4\r\n  github.com/ethereum/go-ethereum/core.(*BlockChain).InsertHeaderChain()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/core/blockchain.go:1306 +0xec\r\n  github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).processHeaders()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:1268 +0x733\r\n  github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).syncWithPeer.func6()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:477 +0x5b\r\n  github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync.func1()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:500 +0x5e\r\n\r\nGoroutine 236 (running) created at:\r\n  github.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).VerifyHeaders()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/consensus/ethash/consensus.go:119 +0x355\r\n  github.com/ethereum/go-ethereum/core.(*HeaderChain).ValidateHeaderChain()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/core/headerchain.go:228 +0x4d4\r\n0x7f232f796000  github.com/ethereum/go-ethereum/core.(*BlockChain).InsertHeaderChain()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/core/blockchain.go:1306 +0xec\r\n\r\n  github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).processHeaders()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:1268 +0x733\r\n  github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).syncWithPeer.func6()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:477 +0x5b\r\n  github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync.func1()\r\n      /home/michael/go/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:500 +0x5e\r\n==================\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321316673/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321495590",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14943#issuecomment-321495590",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943",
    "id": 321495590,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTQ5NTU5MA==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-10T09:07:27Z",
    "updated_at": "2017-08-10T09:07:27Z",
    "author_association": "MEMBER",
    "body": "The cache slice is memory-mapped. It's nice that you can reproduce the crasher (we can't). The issue could be related to memory alignment. Can you check the memory address of the slice for a case where it crashes?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321495590/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321610085",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14943#issuecomment-321610085",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943",
    "id": 321610085,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTYxMDA4NQ==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-10T16:52:35Z",
    "updated_at": "2017-08-10T16:52:35Z",
    "author_association": "NONE",
    "body": "The memory addresses are all aligned. I added this code:\r\n\r\n```go\r\n        ocache := ethash.cache(number)\r\n\tfmt.Printf(\"XXX cache pointer is %p\\n\", ocache)\r\n\tcache := make([]uint32, len(ocache))\r\n\tfor i, v := range ocache {\r\n\t\tcache[i] = v\r\n\t}\r\n\tfmt.Printf(\"cache was ok\\n\")\r\n```\r\nAnd this is what I got\r\n```\r\nINFO [08-10|09:47:23] Imported new state entries               count=34 flushed=4 elapsed=232.651ms processed=68 pending=347 retry=0 duplicate=0 unexpected=0\r\nINFO [08-10|09:47:24] Imported new block receipts              count=0  elapsed=20.282ms  number=989209 hash=4aa34fâ€¦c6fbbf ignored=749\r\nXXX cache pointer is 0x7fabf8bfc008\r\nXXX cache pointer is 0x7fabf8bfc008\r\nXXX cache pointer is 0x7fabf8bfc008\r\ncache was ok\r\ncache was ok\r\nXXX cache pointer is 0x7fabeebe0008\r\nunexpected fault address 0x7fabf8bfc008\r\nfatal error: fault\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x7fabf8bfc008 pc=0x925c7b]\r\n... same segfault ...\r\n```\r\n\r\nInteresting to see that the cache address was fine for two of the iterations through it, the third faulted. My guess is that it is being unmapped while it is still in use. I'll try some sysdig and see if I can catch the unmap syscall",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321610085/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321613632",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14943#issuecomment-321613632",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943",
    "id": 321613632,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTYxMzYzMg==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-10T17:06:00Z",
    "updated_at": "2017-08-10T17:06:00Z",
    "author_association": "NONE",
    "body": "Yeah take a look at this:\r\n\r\n```\r\n198250 09:58:01.421664062 1  (19642) < write res=162 data=INFO [08-10|09:58:01] Imported new state entries               count=310 flushed \r\n210092 09:58:01.451059040 3  (19633) > write fd=2 size=135 \r\n210100 09:58:01.451068741 3  (19633) < write res=135 data=INFO [08-10|09:58:01] Imported new block receipts              count=280 elapsed \r\n224810 09:58:01.498264793 13  (19633) > write fd=1 size=51 \r\n224815 09:58:01.498276182 13  (19633) < write res=51 data=XXX cache pointer is  0x7f360c7fb008. \r\n225229 09:58:01.499680120 7  (19636) > munmap addr=7F360C7FB000 length=16776904 \r\n225241 09:58:01.499729258 7  (19636) < munmap res=0 vm_size=1336836 vm_rss=139296 vm_swap=0 \r\n225246 09:58:01.499745667 13  (19633) > write fd=2 size=25 \r\n225247 09:58:01.499748942 7  (19636) > write fd=1 size=51 \r\n225248 09:58:01.499751563 13  (19633) < write res=25 data=unexpected fault address  \r\n225249 09:58:01.499752842 13  (19633) > write fd=2 size=14 \r\n225250 09:58:01.499753076 7  (19636) < write res=51 data=XXX cache pointer is  0x7f35eefe0008. \r\n225252 09:58:01.499757122 13  (19633) < write res=14 data=0x7f360c9f0000 \r\n```\r\n\r\nThis is a sysdig trace, you can see it writes the \"XXX cache pointer...\" line to stdout (but not yet the \"ok\" line, so it is still using that array). A short while later, a munmap syscall with that address is executed. The rest of the sysdig trace is just the panic",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321613632/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321616984",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14943#issuecomment-321616984",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943",
    "id": 321616984,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTYxNjk4NA==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-10T17:18:44Z",
    "updated_at": "2017-08-10T17:18:44Z",
    "author_association": "NONE",
    "body": "@fjl this is an embedded geth, so it's possible that the way I am using the API is different to how it is used in geth standalone (I never see this just running geth console even on the same private chain), but I figured it would be important to report anyway because this shouldn't be possible, no matter how I interact with the API.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321616984/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321623999",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14943#issuecomment-321623999",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943",
    "id": 321623999,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMTYyMzk5OQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-10T17:45:57Z",
    "updated_at": "2017-08-10T17:45:57Z",
    "author_association": "MEMBER",
    "body": "It's a real bug and affects geth too. Thanks for digging! In my comment earlier I meant we should look at the data pointer of the slice header (the slice is created using unsafe) but munmap while the cache is in use sounds like a probably cause. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/321623999/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/323333661",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14943#issuecomment-323333661",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943",
    "id": 323333661,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMzMzMzY2MQ==",
    "user": {
      "login": "ralmeida",
      "id": 167082,
      "node_id": "MDQ6VXNlcjE2NzA4Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/167082?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ralmeida",
      "html_url": "https://github.com/ralmeida",
      "followers_url": "https://api.github.com/users/ralmeida/followers",
      "following_url": "https://api.github.com/users/ralmeida/following{/other_user}",
      "gists_url": "https://api.github.com/users/ralmeida/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ralmeida/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ralmeida/subscriptions",
      "organizations_url": "https://api.github.com/users/ralmeida/orgs",
      "repos_url": "https://api.github.com/users/ralmeida/repos",
      "events_url": "https://api.github.com/users/ralmeida/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ralmeida/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-18T11:52:05Z",
    "updated_at": "2017-08-18T11:52:05Z",
    "author_association": "NONE",
    "body": "I am also experiencing this issue, I can provide output if needed",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/323333661/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/414124149",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14943#issuecomment-414124149",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14943",
    "id": 414124149,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNDEyNDE0OQ==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-08-19T12:21:57Z",
    "updated_at": "2018-08-19T12:21:57Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/414124149/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
