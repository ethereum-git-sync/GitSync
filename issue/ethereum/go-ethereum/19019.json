{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19019",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19019/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19019/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19019/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19019",
  "id": 408133341,
  "node_id": "MDU6SXNzdWU0MDgxMzMzNDE=",
  "number": 19019,
  "title": "debug_traceTransaction returns wrong gasCost on CALL opcode",
  "user": {
    "login": "jangko",
    "id": 2784755,
    "node_id": "MDQ6VXNlcjI3ODQ3NTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2784755?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jangko",
    "html_url": "https://github.com/jangko",
    "followers_url": "https://api.github.com/users/jangko/followers",
    "following_url": "https://api.github.com/users/jangko/following{/other_user}",
    "gists_url": "https://api.github.com/users/jangko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jangko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jangko/subscriptions",
    "organizations_url": "https://api.github.com/users/jangko/orgs",
    "repos_url": "https://api.github.com/users/jangko/repos",
    "events_url": "https://api.github.com/users/jangko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jangko/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-02-08T12:33:11Z",
  "updated_at": "2019-02-22T08:07:00Z",
  "closed_at": "2019-02-08T13:17:22Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n```text\r\nGeth\r\nVersion: 1.8.18-unstable\r\nArchitecture: amd64\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.10.3\r\nOperating System: windows\r\nGOPATH=C:\\Users\\Jangko\\go\r\nGOROOT=E:\\go\\\r\n```\r\n\r\n```text\r\nGeth\r\nVersion: 1.8.22-stable\r\nGit Commit: 7fa3509e2eaf1a4ebc12344590e5699406690f15\r\nArchitecture: 386\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.11.5\r\nOperating System: windows\r\nGOPATH=C:\\Users\\Jangko\\go\r\nGOROOT=E:\\go\\\r\n```\r\n\r\n#### Expected behaviour\r\n```js\r\n{\"pc\":423,\"op\":\"DUP4\",\"gas\":317741,\"gasCost\":3,\"depth\":1},\r\n{\"pc\":424,\"op\":\"CALL\",\"gas\":317738,\"gasCost\":6740,\"depth\":1}, // <-- should be 6740\r\n{\"pc\":425,\"op\":\"POP\",\"gas\":310998,\"gasCost\":2,\"depth\":1}\r\n```\r\n#### Actual behaviour\r\n```js\r\n{\"pc\":423,\"op\":\"DUP4\",\"gas\":317741,\"gasCost\":3,\"depth\":1},\r\n{\"pc\":424,\"op\":\"CALL\",\"gas\":317738,\"gasCost\":9040,\"depth\":1}, // <-- wrong\r\n{\"pc\":425,\"op\":\"POP\",\"gas\":310998,\"gasCost\":2,\"depth\":1} // <-- funny, the next gas is correct\r\n```\r\n#### Steps to reproduce the behaviour\r\n\r\n```text\r\ncurl localhost:8545 -H \"Content-Type:application/json\" --data \"{\\\"jsonrpc\\\":\\\"2.0\\\",\\\"method\\\":\\\"debug_traceTransaction\\\",\\\"params\\\":[\\\"0x22591c7aadb705df30a13e97f73496b529f208573a231c7eb389766d29b421d1\\\", {\\\"disableStorage\\\":true, \\\"disableMemory\\\":true, \\\"disableStack\\\":true}],\\\"id\\\":1}\"\r\n```\r\n\r\nwe are developing EVM debugging tools that depend on geth's debugging caps, but turn out we also found bug in geth `debug_traceTransaction`.",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19019/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19019/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/461799563",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19019#issuecomment-461799563",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19019",
    "id": 461799563,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTc5OTU2Mw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-08T13:17:22Z",
    "updated_at": "2019-02-08T13:17:22Z",
    "author_association": "MEMBER",
    "body": "This is a transaction from a very early block, this was fixed in #18503. It's not in the 1.8-branch, IIRC, but it is fixed on master and will appear in the 1.9 release.\r\nI don't believe it's scheduled for backporting into 1.8, but if it's very important to you we can consider it.... (?) ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/461799563/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/461800109",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19019#issuecomment-461800109",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19019",
    "id": 461800109,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTgwMDEwOQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-08T13:19:35Z",
    "updated_at": "2019-02-08T13:19:35Z",
    "author_association": "MEMBER",
    "body": "Addiionally, I'd recommed you to use the functionality introduced in https://github.com/ethereum/go-ethereum/pull/17914. The output is \r\n- less quirky (always get the opcode integer, not only textual representation)\r\n- less memory intense, since it flushes every op instead of saving up to a gigantic json response.   ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/461800109/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/466310080",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19019#issuecomment-466310080",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19019",
    "id": 466310080,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NjMxMDA4MA==",
    "user": {
      "login": "jangko",
      "id": 2784755,
      "node_id": "MDQ6VXNlcjI3ODQ3NTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2784755?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jangko",
      "html_url": "https://github.com/jangko",
      "followers_url": "https://api.github.com/users/jangko/followers",
      "following_url": "https://api.github.com/users/jangko/following{/other_user}",
      "gists_url": "https://api.github.com/users/jangko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jangko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jangko/subscriptions",
      "organizations_url": "https://api.github.com/users/jangko/orgs",
      "repos_url": "https://api.github.com/users/jangko/repos",
      "events_url": "https://api.github.com/users/jangko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jangko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-22T08:07:00Z",
    "updated_at": "2019-02-22T08:07:00Z",
    "author_association": "NONE",
    "body": "Thanks for the reply.\r\nI already download and compile master branch of upcoming 1.9.x.\r\nI observed this issue is not addressed yet.\r\n\r\nbugfix #18503 only touch the fork choice problem.\r\nI believe #17914 enhancement also infected by this issue because the problem lies in the EVM, not in the tracer.\r\n\r\nin opcode CALL, CALLCODE, STATICCALL, DELEGATECALL, and CREATE, the tracer seems ignoring `returnGas` and only take into account gasCost before opcode execution.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/466310080/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
