{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19346",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19346/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19346/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19346/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19346",
  "id": 426241584,
  "node_id": "MDU6SXNzdWU0MjYyNDE1ODQ=",
  "number": 19346,
  "title": "`debug_setHead` causes Clique to hang when period is 0",
  "user": {
    "login": "albrow",
    "id": 800857,
    "node_id": "MDQ6VXNlcjgwMDg1Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/800857?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/albrow",
    "html_url": "https://github.com/albrow",
    "followers_url": "https://api.github.com/users/albrow/followers",
    "following_url": "https://api.github.com/users/albrow/following{/other_user}",
    "gists_url": "https://api.github.com/users/albrow/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/albrow/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/albrow/subscriptions",
    "organizations_url": "https://api.github.com/users/albrow/orgs",
    "repos_url": "https://api.github.com/users/albrow/repos",
    "events_url": "https://api.github.com/users/albrow/events{/privacy}",
    "received_events_url": "https://api.github.com/users/albrow/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 526312713,
      "node_id": "MDU6TGFiZWw1MjYzMTI3MTM=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/up-for-grabs",
      "name": "up-for-grabs",
      "color": "0e8a16",
      "default": false,
      "description": null
    },
    {
      "id": 1269313112,
      "node_id": "MDU6TGFiZWwxMjY5MzEzMTEy",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:backlog",
      "name": "status:backlog",
      "color": "29ceb3",
      "default": false,
      "description": ""
    },
    {
      "id": 1269332912,
      "node_id": "MDU6TGFiZWwxMjY5MzMyOTEy",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:clique",
      "name": "area:clique",
      "color": "e590e1",
      "default": false,
      "description": ""
    },
    {
      "id": 1380056442,
      "node_id": "MDU6TGFiZWwxMzgwMDU2NDQy",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:mining",
      "name": "area:mining",
      "color": "ca4ff7",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-03-28T00:34:44Z",
  "updated_at": "2022-06-15T15:54:36Z",
  "closed_at": "2021-02-03T10:02:35Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "See https://github.com/ethereum/go-ethereum/pull/16713 and https://github.com/ethereum/go-ethereum/pull/19308 for some background.\r\n\r\nMy PR was closed in favor of a different solution. While I agree that the solution that was merged is cleaner, unfortunately it does not fully address the problem. On the latest commit (at least at the time I opened this issue) `debug_setHead` causes Clique to stop mining new blocks if it has a period of 0.\r\n\r\nI decided to open a new issue because what's happening now is not the same thing as what I originally reported in https://github.com/ethereum/go-ethereum/pull/16713.\r\n\r\n#### System information\r\n\r\nGeth version:\r\n```\r\nGeth\r\nVersion: 1.9.0-unstable\r\nGit Commit: 67fc0377e13416d9a1f8ea32e7d1b0ca89374bf3\r\n```\r\nOS & Version: MacOS version 10.14.3\r\nCommit hash : 67fc0377e13416d9a1f8ea32e7d1b0ca89374bf3\r\n\r\n#### Expected behaviour\r\n\r\n`debug_setHead` should work when using Clique with a period of 0.\r\n\r\n#### Actual behaviour\r\n\r\n`debug_setHead` causes Clique to stop mining new blocks.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n1. Run `build/bin/geth  --dev --dev.period 0`.\r\n2. In a separate terminal session, run `build/bin/geth attach /tmp/geth.ipc`.\r\n3. Run the following commands in the console (output included here for convenience):\r\n```\r\n> eth.blockNumber\r\n0\r\n> eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[0], value: \"0x0\"});\r\n\"0x88a1168223a1153ec1cda3fdbb0adeb7e8c3110a6c5d7d937a55460be5768500\"\r\n> eth.blockNumber // Sending the transaction resulted in a new block being mined.\r\n1\r\n> eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[0], value: \"0x0\"});\r\n\"0x106ccc6c088f29e3a40dc1b4d90d4570d25eb3f1eb680c190a00774b7f5756c6\"\r\n> eth.blockNumber // A second block is mined if we send another transaction\r\n2\r\n> debug.setHead(web3.toHex(1)); // Use debug.setHead to reset to block number 1.\r\nnull\r\n> eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[0], value: \"0x0\"});\r\n\"0xb67c83f11784d517080926a05c33b0c991945ec5d835f434ee80dbdee3061a7c\"\r\n> eth.blockNumber // Now when we send a transaction it is not mined :/\r\n1\r\n> eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[0], value: \"0x0\"});\r\n\"0x244c753974a1bc8fbd4281aea77a3d2e668d4d1f827c58cf354002258c546b07\"\r\n> eth.blockNumber\r\n1\r\n```\r\n\r\n#### Log output\r\n\r\nHere's the full log output during the commands above:\r\n\r\n````\r\nINFO [03-27|17:19:16.079] Maximum peer count                       ETH=25 LES=0 total=25\r\nINFO [03-27|17:19:17.957] Using developer account                  address=0x38c884Aa8CC82596087714E23D046Fe08b2B32b0\r\nINFO [03-27|17:19:17.973] Starting peer-to-peer node               instance=Geth/v1.9.0-unstable-67fc0377/darwin-amd64/go1.12\r\nINFO [03-27|17:19:17.973] Allocated trie memory caches             clean=256.00MiB dirty=256.00MiB\r\nINFO [03-27|17:19:17.973] Allocated cache and file handles         database=/tmp/geth/geth/chaindata cache=512.00MiB handles=5120\r\nINFO [03-27|17:19:18.008] Writing custom genesis block\r\nINFO [03-27|17:19:18.009] Persisted trie from memory database      nodes=13 size=1.81KiB time=205.941Âµs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [03-27|17:19:18.009] Initialised chain configuration          config=\"{ChainID: 1337 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: 0 EIP155: 0 EIP158: 0 Byzantium: 0 Constantinople: 0  ConstantinopleFix: 0 Engine: clique}\"\r\nINFO [03-27|17:19:18.009] Initialising Ethereum protocol           versions=\"[63 62]\" network=1337 dbversion=<nil>\r\nWARN [03-27|17:19:18.009] Upgrade blockchain database version      from=<nil> to=4\r\nINFO [03-27|17:19:18.069] Loaded most recent local header          number=0 hash=603369â€¦c4ffb5 td=1 age=49y11mo1w\r\nINFO [03-27|17:19:18.069] Loaded most recent local full block      number=0 hash=603369â€¦c4ffb5 td=1 age=49y11mo1w\r\nINFO [03-27|17:19:18.069] Loaded most recent local fast block      number=0 hash=603369â€¦c4ffb5 td=1 age=49y11mo1w\r\nINFO [03-27|17:19:18.069] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [03-27|17:19:18.070] Stored checkpoint snapshot to disk       number=0 hash=603369â€¦c4ffb5\r\nINFO [03-27|17:19:18.091] started whisper v.6.0\r\nINFO [03-27|17:19:18.091] New local node record                    seq=1 id=c604ffb45fdc7e84 ip=127.0.0.1 udp=0 tcp=58546\r\nINFO [03-27|17:19:18.091] Started P2P networking                   self=\"enode://6e68cf3051635c565dd22856ef5c87f8e78127555995243163cac9ef6104b8a09c1612e705ea48d89edd0c72d0400b93250e201ecc512f4b0995f04174217f08@127.0.0.1:58546?discport=0\"\r\nINFO [03-27|17:19:18.092] IPC endpoint opened                      url=/tmp/geth/geth.ipc\r\nINFO [03-27|17:19:18.092] Transaction pool price threshold updated price=1000000000\r\nINFO [03-27|17:19:18.092] Transaction pool price threshold updated price=1\r\nINFO [03-27|17:19:18.092] Etherbase automatically configured       address=0x38c884Aa8CC82596087714E23D046Fe08b2B32b0\r\nINFO [03-27|17:19:18.092] Commit new mining work                   number=1 sealhash=ae4accâ€¦d2f826 uncles=0 txs=0 gas=0 fees=0 elapsed=104.384Âµs\r\nINFO [03-27|17:19:18.092] Sealing paused, waiting for transactions\r\nINFO [03-27|17:19:33.074] Setting new local account                address=0x38c884Aa8CC82596087714E23D046Fe08b2B32b0\r\nINFO [03-27|17:19:33.074] Submitted transaction                    fullhash=0x88a1168223a1153ec1cda3fdbb0adeb7e8c3110a6c5d7d937a55460be5768500 recipient=0x38c884Aa8CC82596087714E23D046Fe08b2B32b0\r\nINFO [03-27|17:19:33.074] Commit new mining work                   number=1 sealhash=98ba2fâ€¦1b80a5 uncles=0 txs=0 gas=0 fees=0 elapsed=102.27Âµs\r\nINFO [03-27|17:19:33.074] Sealing paused, waiting for transactions\r\nINFO [03-27|17:19:33.075] Commit new mining work                   number=1 sealhash=f90415â€¦c9200d uncles=0 txs=1 gas=21000 fees=2.1e-14 elapsed=382.561Âµs\r\nINFO [03-27|17:19:33.075] Successfully sealed new block            number=1 sealhash=f90415â€¦c9200d hash=dce724â€¦4061f8 elapsed=502.166Âµs\r\nINFO [03-27|17:19:33.075] ðŸ”¨ mined potential block                  number=1 hash=dce724â€¦4061f8\r\nINFO [03-27|17:19:33.076] Commit new mining work                   number=2 sealhash=9673daâ€¦0fbcb4 uncles=0 txs=0 gas=0     fees=0       elapsed=316.474Âµs\r\nINFO [03-27|17:19:33.076] Sealing paused, waiting for transactions\r\nINFO [03-27|17:19:38.101] Submitted transaction                    fullhash=0x106ccc6c088f29e3a40dc1b4d90d4570d25eb3f1eb680c190a00774b7f5756c6 recipient=0x38c884Aa8CC82596087714E23D046Fe08b2B32b0\r\nINFO [03-27|17:19:38.101] Commit new mining work                   number=2 sealhash=1fac9eâ€¦ba2095 uncles=0 txs=0 gas=0     fees=0       elapsed=70.478Âµs\r\nINFO [03-27|17:19:38.101] Sealing paused, waiting for transactions\r\nINFO [03-27|17:19:38.101] Commit new mining work                   number=2 sealhash=b9d636â€¦cf1949 uncles=0 txs=1 gas=21000 fees=2.1e-14 elapsed=325.822Âµs\r\nINFO [03-27|17:19:38.102] Successfully sealed new block            number=2 sealhash=b9d636â€¦cf1949 hash=5447efâ€¦0e7f36 elapsed=527.485Âµs\r\nINFO [03-27|17:19:38.102] ðŸ”¨ mined potential block                  number=2 hash=5447efâ€¦0e7f36\r\nINFO [03-27|17:19:38.102] Commit new mining work                   number=3 sealhash=fe3260â€¦93db86 uncles=0 txs=0 gas=0     fees=0       elapsed=383.433Âµs\r\nINFO [03-27|17:19:38.102] Sealing paused, waiting for transactions\r\nWARN [03-27|17:19:59.167] Rewinding blockchain                     target=1\r\nINFO [03-27|17:19:59.168] Loaded most recent local header          number=1 hash=dce724â€¦4061f8 td=3 age=26s\r\nINFO [03-27|17:19:59.168] Loaded most recent local full block      number=1 hash=dce724â€¦4061f8 td=3 age=26s\r\nINFO [03-27|17:19:59.168] Loaded most recent local fast block      number=1 hash=dce724â€¦4061f8 td=3 age=26s\r\nINFO [03-27|17:20:03.086] Submitted transaction                    fullhash=0xb67c83f11784d517080926a05c33b0c991945ec5d835f434ee80dbdee3061a7c recipient=0x38c884Aa8CC82596087714E23D046Fe08b2B32b0\r\nINFO [03-27|17:20:03.086] Commit new mining work                   number=2 sealhash=a9cd51â€¦d4c212 uncles=0 txs=0 gas=0     fees=0       elapsed=141.281Âµs\r\nINFO [03-27|17:20:03.086] Sealing paused, waiting for transactions\r\nINFO [03-27|17:20:03.086] Commit new mining work                   number=2 sealhash=a9cd51â€¦d4c212 uncles=0 txs=0 gas=0     fees=0       elapsed=332.186Âµs\r\nINFO [03-27|17:20:09.455] Submitted transaction                    fullhash=0x244c753974a1bc8fbd4281aea77a3d2e668d4d1f827c58cf354002258c546b07 recipient=0x38c884Aa8CC82596087714E23D046Fe08b2B32b0\r\nINFO [03-27|17:20:09.455] Commit new mining work                   number=2 sealhash=014960â€¦be5f24 uncles=0 txs=0 gas=0     fees=0       elapsed=81.396Âµs\r\nINFO [03-27|17:20:09.455] Sealing paused, waiting for transactions\r\nINFO [03-27|17:20:09.455] Commit new mining work                   number=2 sealhash=014960â€¦be5f24 uncles=0 txs=0 gas=0     fees=0       elapsed=279.504Âµs\r\n````\r\n\r\nNote that for the first two transactions, we see the message `ðŸ”¨ mined potential block`. However, for the last two transactions (after we called `debug.setHead`) that message no longer appears.",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19346/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19346/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/479903135",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19346#issuecomment-479903135",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19346",
    "id": 479903135,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTkwMzEzNQ==",
    "user": {
      "login": "LogvinovLeon",
      "id": 6204356,
      "node_id": "MDQ6VXNlcjYyMDQzNTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6204356?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LogvinovLeon",
      "html_url": "https://github.com/LogvinovLeon",
      "followers_url": "https://api.github.com/users/LogvinovLeon/followers",
      "following_url": "https://api.github.com/users/LogvinovLeon/following{/other_user}",
      "gists_url": "https://api.github.com/users/LogvinovLeon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LogvinovLeon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LogvinovLeon/subscriptions",
      "organizations_url": "https://api.github.com/users/LogvinovLeon/orgs",
      "repos_url": "https://api.github.com/users/LogvinovLeon/repos",
      "events_url": "https://api.github.com/users/LogvinovLeon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LogvinovLeon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-04T13:45:18Z",
    "updated_at": "2019-04-04T13:45:18Z",
    "author_association": "NONE",
    "body": "@holiman ^\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/479903135/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/751247337",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19346#issuecomment-751247337",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19346",
    "id": 751247337,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MTI0NzMzNw==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2020-12-25T13:10:11Z",
    "updated_at": "2020-12-25T13:10:11Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/751247337/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/769061257",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19346#issuecomment-769061257",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19346",
    "id": 769061257,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTA2MTI1Nw==",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-28T13:43:37Z",
    "updated_at": "2021-01-28T13:43:37Z",
    "author_association": "MEMBER",
    "body": "Yep, I can still repro this. Calling `debug_setHead` forks the second transaction away. If we try to resend the same transaction an error `already known` is thrown. \r\n```\r\n> eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[0], value: \"0x1\", Nonce: \"0x2\"});\r\nError: already known\r\n\tat web3.js:6347:37(47)\r\n\tat web3.js:5081:62(37)\r\n\tat <eval>:1:20(18)\r\n```\r\n\r\n```\r\n>txpool.status\r\n{\r\n  pending: 0,\r\n  queued: 0\r\n}\r\n```\r\n\r\nThe suggested workaround allows anyone to skip nonces which would be fatal for the network. Since the transactions are not in the txpool anymore they should be commited to the miner on resubmission but aren't as resubmission produces a `nonce too low` error even though it isn't in the canonical chain nor in the txpool. This was due to the txpool not properly reseting the statedb when a sethead occured.\r\n\r\nI think there are two ways to solve it: resubmit all transactions that have been invalidated by `debug_setHead` or better allow the user to resubmit transactions that are not part of the canonical chain anymore. \r\n\r\nI created a fix here: https://github.com/ethereum/go-ethereum/pull/22247",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/769061257/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
