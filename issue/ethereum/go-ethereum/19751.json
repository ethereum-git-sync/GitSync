{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19751",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19751/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19751/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19751/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19751",
  "id": 459664019,
  "node_id": "MDU6SXNzdWU0NTk2NjQwMTk=",
  "number": 19751,
  "title": "Inconsistent usage of V values in signatures",
  "user": {
    "login": "stevenlcf",
    "id": 11813034,
    "node_id": "MDQ6VXNlcjExODEzMDM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/11813034?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stevenlcf",
    "html_url": "https://github.com/stevenlcf",
    "followers_url": "https://api.github.com/users/stevenlcf/followers",
    "following_url": "https://api.github.com/users/stevenlcf/following{/other_user}",
    "gists_url": "https://api.github.com/users/stevenlcf/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stevenlcf/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stevenlcf/subscriptions",
    "organizations_url": "https://api.github.com/users/stevenlcf/orgs",
    "repos_url": "https://api.github.com/users/stevenlcf/repos",
    "events_url": "https://api.github.com/users/stevenlcf/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stevenlcf/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-06-24T02:55:12Z",
  "updated_at": "2019-06-24T07:54:07Z",
  "closed_at": "2019-06-24T07:54:07Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi, I found some inconsistent usage (code and comments) of V values (namely using 0/1 or 27/28) in signature related functions (sign and recover), which might lead to misunderstandings and misoperations for developers.\r\n\r\nFor example, this PR, https://github.com/OpenZeppelin/openzeppelin-solidity/pull/1622, would make the contracts using this popular library deny signatures with 0/1 V values, which are generated by go-ethereum's [secp256k1.Sign()](https://github.com/ethereum/go-ethereum/blob/v1.8.27/crypto/secp256k1/secp256.go#L58) function.\r\n\r\nHere are some of the inconsistent code and comments:\r\n#### code using 27/28 for V values:\r\n* [ethapi.EcRecover()](https://github.com/ethereum/go-ethereum/blob/4bcc0a37ab70cb79b16893556cffdaad6974e7d8/internal/ethapi/api.go#L461): in its comment, it says\r\n> Note, the signature must conform to the secp256k1 curve R, S and V values, where the V value must be 27 or 28 for legacy reasons.\r\n\r\n#### code using 0/1 for V values:\r\n* [secp256k1.Sign()](https://github.com/ethereum/go-ethereum/blob/v1.8.27/crypto/secp256k1/secp256.go#L58), which is used by [crypto.Sign()](https://github.com/ethereum/go-ethereum/blob/v1.8.27/crypto/signature_cgo.go#L54) and further used by [types.SignTx()](https://github.com/ethereum/go-ethereum/blob/v1.8.27/core/types/transaction_signing.go#L56):\r\n> The produced signature is in the 65-byte [R || S || V] format where V is 0 or 1.\r\n* [types.SignatureValues()](https://github.com/ethereum/go-ethereum/blob/v1.8.27/core/types/transaction_signing.go#L141):\r\n> SignatureValues returns signature values. This signature needs to be in the [R || S || V] format where V is 0 or 1.",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19751/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19751/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/504900739",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19751#issuecomment-504900739",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19751",
    "id": 504900739,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwNDkwMDczOQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-24T07:54:07Z",
    "updated_at": "2019-06-24T07:54:07Z",
    "author_association": "MEMBER",
    "body": "Originally Ethereum used `27` / `28` (which internally is just `0` / `1`, just some weird bitcoin legacy to add 27). Later when we needed to support chain IDs in the signatures, the V as changed to `ID*2 + 35` / `ID*2 + 35`. However, both V's are still supported on mainnet (Homestead vs. EIP155).  The code was messy to pass V's around from low level crypto primitives in 27/28 notation, and then later for EIP155 to subtract 27, then do the whole x2+35 magic.\r\n\r\nThe current logic is that the low level crypto operations returns 0/1 (because that **is** the canonical V value), and the higher level signers (Frontier, Homestead, EIP155) convert that V to whatever Ethereum specs on top of secp256k1.\r\n\r\nTL;DR: Use the high level signers, don't use the secp256k1 library directly. If you use the low level crypto library directly, you need to be aware of how generic ECC relates to Ethereum signatures.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/504900739/reactions",
      "total_count": 3,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 3,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
