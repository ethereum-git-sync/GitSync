{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/20045",
  "id": 491437209,
  "node_id": "MDU6SXNzdWU0OTE0MzcyMDk=",
  "number": 20045,
  "title": "Higher CPU usage with Geth 1.19.x",
  "user": {
    "login": "peterlayke",
    "id": 47314267,
    "node_id": "MDQ6VXNlcjQ3MzE0MjY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/47314267?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/peterlayke",
    "html_url": "https://github.com/peterlayke",
    "followers_url": "https://api.github.com/users/peterlayke/followers",
    "following_url": "https://api.github.com/users/peterlayke/following{/other_user}",
    "gists_url": "https://api.github.com/users/peterlayke/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/peterlayke/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/peterlayke/subscriptions",
    "organizations_url": "https://api.github.com/users/peterlayke/orgs",
    "repos_url": "https://api.github.com/users/peterlayke/repos",
    "events_url": "https://api.github.com/users/peterlayke/events{/privacy}",
    "received_events_url": "https://api.github.com/users/peterlayke/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1141538240,
      "node_id": "MDU6TGFiZWwxMTQxNTM4MjQw",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/need:documentation",
      "name": "need:documentation",
      "color": "b4fcae",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2019-09-10T04:02:16Z",
  "updated_at": "2022-01-29T14:17:43Z",
  "closed_at": "2019-12-11T11:10:07Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "G'day,\r\n\r\nJust trying to see what the normal CPU usage is for a fast synced node. I've spun a new v1.9.2 node and I notice after sync the VM runs on roughly 60-80% CPU (Azure D4s v3 - 4vCPU, 16GiB mem) \r\n\r\nPrevious version (1.8.x) sat on 40-60%, is anyone else getting this or is it by design? \r\n\r\nThanks.",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/529827698",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20045#issuecomment-529827698",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045",
    "id": 529827698,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTgyNzY5OA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-10T08:20:36Z",
    "updated_at": "2019-09-10T08:20:36Z",
    "author_association": "MEMBER",
    "body": "So, in 1.9 we raised the default number of peers from 25 to 50. My bet is that the bump is caused by more network traffic and more network crypto. You could try running with `--maxpeers=25` to verify the old behavior.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/529827698/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/530192431",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20045#issuecomment-530192431",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045",
    "id": 530192431,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMDE5MjQzMQ==",
    "user": {
      "login": "play0",
      "id": 34048474,
      "node_id": "MDQ6VXNlcjM0MDQ4NDc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/34048474?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/play0",
      "html_url": "https://github.com/play0",
      "followers_url": "https://api.github.com/users/play0/followers",
      "following_url": "https://api.github.com/users/play0/following{/other_user}",
      "gists_url": "https://api.github.com/users/play0/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/play0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/play0/subscriptions",
      "organizations_url": "https://api.github.com/users/play0/orgs",
      "repos_url": "https://api.github.com/users/play0/repos",
      "events_url": "https://api.github.com/users/play0/events{/privacy}",
      "received_events_url": "https://api.github.com/users/play0/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-11T02:24:04Z",
    "updated_at": "2019-09-11T02:24:04Z",
    "author_association": "NONE",
    "body": "Thanks, for the suggestion. I've lowered maxpeers back to 25 and will leave soak for 24 hours. I will report back on my findings then.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/530192431/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/530208195",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20045#issuecomment-530208195",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045",
    "id": 530208195,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMDIwODE5NQ==",
    "user": {
      "login": "play0",
      "id": 34048474,
      "node_id": "MDQ6VXNlcjM0MDQ4NDc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/34048474?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/play0",
      "html_url": "https://github.com/play0",
      "followers_url": "https://api.github.com/users/play0/followers",
      "following_url": "https://api.github.com/users/play0/following{/other_user}",
      "gists_url": "https://api.github.com/users/play0/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/play0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/play0/subscriptions",
      "organizations_url": "https://api.github.com/users/play0/orgs",
      "repos_url": "https://api.github.com/users/play0/repos",
      "events_url": "https://api.github.com/users/play0/events{/privacy}",
      "received_events_url": "https://api.github.com/users/play0/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-11T03:51:42Z",
    "updated_at": "2019-09-11T03:51:42Z",
    "author_association": "NONE",
    "body": "On initial look it seems CPU usage has dropped to 30/40% on idle. Good guess @karalabe  ;)\r\n\r\nI remember reading (and forgive me if I get this wrong as it's been a long time) somewhere that Maxpeers had no effect on CPU just bandwidth, obviously this is not the case.\r\n\r\n![image](https://user-images.githubusercontent.com/34048474/64666768-c5cb5500-d49a-11e9-8279-932aab5fa288.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/530208195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/530662915",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20045#issuecomment-530662915",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045",
    "id": 530662915,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMDY2MjkxNQ==",
    "user": {
      "login": "play0",
      "id": 34048474,
      "node_id": "MDQ6VXNlcjM0MDQ4NDc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/34048474?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/play0",
      "html_url": "https://github.com/play0",
      "followers_url": "https://api.github.com/users/play0/followers",
      "following_url": "https://api.github.com/users/play0/following{/other_user}",
      "gists_url": "https://api.github.com/users/play0/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/play0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/play0/subscriptions",
      "organizations_url": "https://api.github.com/users/play0/orgs",
      "repos_url": "https://api.github.com/users/play0/repos",
      "events_url": "https://api.github.com/users/play0/events{/privacy}",
      "received_events_url": "https://api.github.com/users/play0/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-12T04:46:14Z",
    "updated_at": "2019-09-12T04:46:14Z",
    "author_association": "NONE",
    "body": "As you can see this has definately helped a lot as the server now bunces between 20 to 60%. \r\n\r\nThanks for you help, this issue can be closed off.\r\n\r\n![image](https://user-images.githubusercontent.com/34048474/64754550-20cc7d00-d56b-11e9-9c89-38b2c90c5ef7.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/530662915/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/530677710",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20045#issuecomment-530677710",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045",
    "id": 530677710,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMDY3NzcxMA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-12T05:58:45Z",
    "updated_at": "2019-09-12T05:58:45Z",
    "author_association": "MEMBER",
    "body": "Let's leave it open for now. CPU shouldn't be hit to hard, so I think it's\nstill a valuable issue (the root cause that is).\n\nOn Thu, Sep 12, 2019, 07:46 play0 <notifications@github.com> wrote:\n\n> As you can see this has definately helped a lot as the server now bunces\n> between 20 to 60%.\n>\n> Thanks for you help, this issue can be closed off.\n>\n> [image: image]\n> <https://user-images.githubusercontent.com/34048474/64754550-20cc7d00-d56b-11e9-9c89-38b2c90c5ef7.png>\n>\n> â€”\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/ethereum/go-ethereum/issues/20045?email_source=notifications&email_token=AAA7UGKFWIEOIVIH2QC4ELDQJHCRVA5CNFSM4IVCTWF2YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOD6QUMAY#issuecomment-530662915>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAA7UGK2SXEKBS436KQTFY3QJHCRVANCNFSM4IVCTWFQ>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/530677710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/552531990",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20045#issuecomment-552531990",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045",
    "id": 552531990,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MjUzMTk5MA==",
    "user": {
      "login": "AusIV",
      "id": 977954,
      "node_id": "MDQ6VXNlcjk3Nzk1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/977954?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AusIV",
      "html_url": "https://github.com/AusIV",
      "followers_url": "https://api.github.com/users/AusIV/followers",
      "following_url": "https://api.github.com/users/AusIV/following{/other_user}",
      "gists_url": "https://api.github.com/users/AusIV/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AusIV/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AusIV/subscriptions",
      "organizations_url": "https://api.github.com/users/AusIV/orgs",
      "repos_url": "https://api.github.com/users/AusIV/repos",
      "events_url": "https://api.github.com/users/AusIV/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AusIV/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-11T17:13:58Z",
    "updated_at": "2019-11-11T17:13:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "I may have some insight into this.\r\n\r\nAt Rivet we manage several nodes, and found a number of issues relating to bad peers. We often see peers that are way behind on syncing, and aren't making any forward progress on syncing the blockchain. We have a script set up that will drop any peers that are more than a certain number of blocks behind *and* don't have their TD increase over a 5 minute period.\r\n\r\nWhen we implemented this peer management script, we saw a significant decrease in the CPU utilization. It seems that these peers that are way behind and not making forward process are causing an uptick in CPU usage.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/552531990/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/692871592",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20045#issuecomment-692871592",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045",
    "id": 692871592,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5Mjg3MTU5Mg==",
    "user": {
      "login": "offerm",
      "id": 9712754,
      "node_id": "MDQ6VXNlcjk3MTI3NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9712754?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/offerm",
      "html_url": "https://github.com/offerm",
      "followers_url": "https://api.github.com/users/offerm/followers",
      "following_url": "https://api.github.com/users/offerm/following{/other_user}",
      "gists_url": "https://api.github.com/users/offerm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/offerm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/offerm/subscriptions",
      "organizations_url": "https://api.github.com/users/offerm/orgs",
      "repos_url": "https://api.github.com/users/offerm/repos",
      "events_url": "https://api.github.com/users/offerm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/offerm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-15T17:44:04Z",
    "updated_at": "2020-09-15T17:44:04Z",
    "author_association": "NONE",
    "body": "@AusIV can you share more information (or maybe the script itself?)?\r\n\r\nHow do you detect if the peer is behind and not making progress?\r\nWhat does it mean to drop it? How do you  prevent it from reconnecting back?\r\nWhat is TD?\r\n\r\nLooks like this is exactly the problem I'm facting.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/692871592/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1024920417",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20045#issuecomment-1024920417",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20045",
    "id": 1024920417,
    "node_id": "IC_kwDOAOvK9849Fwth",
    "user": {
      "login": "soulmachine",
      "id": 620768,
      "node_id": "MDQ6VXNlcjYyMDc2OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620768?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/soulmachine",
      "html_url": "https://github.com/soulmachine",
      "followers_url": "https://api.github.com/users/soulmachine/followers",
      "following_url": "https://api.github.com/users/soulmachine/following{/other_user}",
      "gists_url": "https://api.github.com/users/soulmachine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/soulmachine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/soulmachine/subscriptions",
      "organizations_url": "https://api.github.com/users/soulmachine/orgs",
      "repos_url": "https://api.github.com/users/soulmachine/repos",
      "events_url": "https://api.github.com/users/soulmachine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/soulmachine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-29T14:17:43Z",
    "updated_at": "2022-01-29T14:17:43Z",
    "author_association": "NONE",
    "body": "> AusIV\r\n\r\nHi @AusIV , Can you share your script? Thanks a lot, I'm having the same issue recently",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1024920417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
