{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20602",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20602/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20602/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20602/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/20602",
  "id": 555993994,
  "node_id": "MDU6SXNzdWU1NTU5OTM5OTQ=",
  "number": 20602,
  "title": "RPC method debug_traceTransaction crashed: runtime error: invalid memory address or nil pointer dereference",
  "user": {
    "login": "bianchi2",
    "id": 52448429,
    "node_id": "MDQ6VXNlcjUyNDQ4NDI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/52448429?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bianchi2",
    "html_url": "https://github.com/bianchi2",
    "followers_url": "https://api.github.com/users/bianchi2/followers",
    "following_url": "https://api.github.com/users/bianchi2/following{/other_user}",
    "gists_url": "https://api.github.com/users/bianchi2/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bianchi2/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bianchi2/subscriptions",
    "organizations_url": "https://api.github.com/users/bianchi2/orgs",
    "repos_url": "https://api.github.com/users/bianchi2/repos",
    "events_url": "https://api.github.com/users/bianchi2/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bianchi2/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1132754722,
      "node_id": "MDU6TGFiZWwxMTMyNzU0NzIy",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/need:more-information",
      "name": "need:more-information",
      "color": "db6fa3",
      "default": false,
      "description": ""
    },
    {
      "id": 1817214928,
      "node_id": "MDU6TGFiZWwxODE3MjE0OTI4",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:tracer",
      "name": "area:tracer",
      "color": "2111b2",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-01-28T05:34:49Z",
  "updated_at": "2020-02-29T10:08:43Z",
  "closed_at": "2020-02-29T10:08:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am using blockscout that connects to geth, and there're lots of method handler crashes on geth side.\r\n\r\nGet is started with the following arguments:\r\n\r\n```\r\n--datadir=/root/datadir --rpcvhosts=* --rpccorsdomain='*' --networkid=245234 --rpc --rpcaddr=\"0.0.0.0\" --mine --etherbase=$ETHER_BASE --rpcapi db,eth,net,web3,personal,admin,miner,txpool,debug --allow-insecure-unlock --syncmode full --gcmode archive --ws --wsaddr 0.0.0.0 --wsport 8546 --debug\r\n```\r\n\r\nGeth version: latest Docker image\r\nOS & Version: Linux\r\nCommit hash : (if `develop`)\r\n\r\n#### Backtrace\r\n\r\nLots of those in geth logs:\r\n\r\n````\r\nWARN [01-28|05:33:02.020|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:37269 reqid=1 t=15.81813ms  err=\"method handler crashed\"\r\nWARN [01-28|05:33:02.024|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:37269 reqid=0 t=1.148323ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.030|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:37269 reqid=0 t=1.153855ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.035|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:37269 reqid=0 t=1.352857ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.036|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:59373 reqid=0 t=1.159611ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.040|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:59373 reqid=0 t=1.176443ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.045|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:59373 reqid=0 t=1.133153ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.046|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:37269 reqid=0 t=1.145265ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.047|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:45907 reqid=0 t=1.150089ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.054|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:59373 reqid=0 t=1.149096ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.054|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:45907 reqid=0 t=1.189126ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.056|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:37269 reqid=0 t=1.282066ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.062|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:45907 reqid=0 t=1.166712ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.065|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:59373 reqid=0 t=1.138595ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.068|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:59373 reqid=0 t=1.164136ms  err=\"required historical state unavailable (reexec=128)\"\r\nWARN [01-28|05:33:02.073|rpc/handler.go:300]             Served debug_traceTransaction            conn=172.25.0.4:59373 reqid=0 t=1.108834ms  err=\"required historical state unavailable (reexec=128)\"\r\nERROR[01-28|05:33:02.074|rpc/service.go:201]             RPC method debug_traceTransaction crashed: runtime error: invalid memory address or nil pointer dereference\r\ngoroutine 25952 [running]:\r\ngithub.com/ethereum/go-ethereum/rpc.(*callback).call.func1(0xc006a36400, 0x16, 0xc008069d28)\r\n\t/go-ethereum/rpc/service.go:200 +0xb5\r\npanic(0x10491c0, 0x1c0afc0)\r\n\t/usr/local/go/src/runtime/panic.go:679 +0x1b2\r\ngithub.com/ethereum/go-ethereum/eth/tracers.(*dbWrapper).pushObject.func3(0xc006d4f550, 0x112efc80)\r\n\t/go-ethereum/eth/tracers/tracer.go:204 +0xf6\r\ngopkg.in/olebedev/go-duktape%2ev3.goFunctionCall(0x39a70de0, 0x1297d18)\r\n\t/go/pkg/mod/gopkg.in/olebedev/go-duktape.v3@v3.0.0-20190213234257-ec84240a7772/duktape.go:156 +0xb7\r\ngopkg.in/olebedev/go-duktape%2ev3._cgoexpwrap_062d6de2de8d_goFunctionCall(0x39a70de0, 0x1)\r\n\t_cgo_gotypes.go:3512 +0x2b\r\ngopkg.in/olebedev/go-duktape%2ev3._Cfunc_duk_pcall_prop(0x39a70de0, 0x200000000, 0x0)\r\n\t_cgo_gotypes.go:2311 +0x4d\r\ngopkg.in/olebedev/go-duktape%2ev3.(*Context).PcallProp.func1(0xc006bb8a10, 0x0, 0x2, 0x113156a0)\r\n\t/go/pkg/mod/gopkg.in/olebedev/go-duktape.v3@v3.0.0-20190213234257-ec84240a7772/api.go:786 +0x76\r\ngopkg.in/olebedev/go-duktape%2ev3.(*Context).PcallProp(0xc006bb8a10, 0x0, 0x2, 0x2)\r\n\t/go/pkg/mod/gopkg.in/olebedev/go-duktape.v3@v3.0.0-20190213234257-ec84240a7772/api.go:786 +0x3f\r\ngithub.com/ethereum/go-ethereum/eth/tracers.(*Tracer).call(0xc01094be40, 0x11c48b7, 0x6, 0xc008062430, 0x2, 0x2, 0x0, 0x0, 0x0, 0x0, ...)\r\n\t/go-ethereum/eth/tracers/tracer.go:504 +0x120\r\ngithub.com/ethereum/go-ethereum/eth/tracers.(*Tracer).GetResult(0xc01094be40, 0x145cf20, 0xc001642c60, 0xc00737b608, 0x0, 0x0)\r\n\t/go-ethereum/eth/tracers/tracer.go:632 +0x4d5\r\ngithub.com/ethereum/go-ethereum/eth.(*PrivateDebugAPI).traceTx(0xc000011f70, 0x14517c0, 0xc007e31d40, 0x145cf20, 0xc001642c60, 0x12957b8, 0x12957c0, 0xc00828e090, 0xfc64b430e018b662, 0x51aa280e72e719c0, ...)\r\n\t/go-ethereum/eth/api_tracer.go:776 +0x47d\r\ngithub.com/ethereum/go-ethereum/eth.(*PrivateDebugAPI).TraceTransaction(0xc000011f70, 0x14517c0, 0xc007e31d40, 0x32bb8c168cf42a4e, 0xbe66c2c66c5a7767, 0x91502fdebdc343d2, 0xe9c027e220f56298, 0xc0082822a0, 0x0, 0x0, ...)\r\n\t/go-ethereum/eth/api_tracer.go:719 +0x20e\r\nreflect.Value.call(0xc0004e4700, 0xc0001d5a68, 0x13, 0x11c1d4a, 0x4, 0xc001642b40, 0x4, 0x4, 0xc008069ba0, 0x4601dc, ...)\r\n\t/usr/local/go/src/reflect/value.go:460 +0x5f6\r\nreflect.Value.Call(0xc0004e4700, 0xc0001d5a68, 0x13, 0xc001642b40, 0x4, 0x4, 0x2, 0x2, 0x2)\r\n\t/usr/local/go/src/reflect/value.go:321 +0xb4\r\ngithub.com/ethereum/go-ethereum/rpc.(*callback).call(0xc000e6c780, 0x14517c0, 0xc007e31d40, 0xc006a36400, 0x16, 0xc0081fbe30, 0x2, 0x2, 0x0, 0x0, ...)\r\n\t/go-ethereum/rpc/service.go:206 +0x2b9\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).runMethod(0xc011882900, 0x14517c0, 0xc007e31d40, 0xc0066e19d0, 0xc000e6c780, 0xc0081fbe30, 0x2, 0x2, 0x2)\r\n\t/go-ethereum/rpc/handler.go:369 +0x8a\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleCall(0xc011882900, 0xc007fd8060, 0xc0066e19d0, 0xc008227740)\r\n\t/go-ethereum/rpc/handler.go:331 +0x22c\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg(0xc011882900, 0xc007fd8060, 0xc0066e19d0, 0xc0064c0540)\r\n\t/go-ethereum/rpc/handler.go:298 +0x1f3\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleBatch.func2(0xc007fd8060)\r\n\t/go-ethereum/rpc/handler.go:119 +0xf3\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1(0xc011882900, 0xc007e31d00)\r\n\t/go-ethereum/rpc/handler.go:226 +0x119\r\ncreated by github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc\r\n\t/go-ethereum/rpc/handler.go:222 +0x66\r\n\r\n````\r\nBlackscout is making requests and fails:\r\n\r\n```\r\n2020-01-28T05:32:28.848 application=indexer fetcher=internal_transaction count=10 error_count=10 [error] failed to fetch internal transactions for blocks: [%{code: -32000, data: %{block_number: 401, transaction_hash: \"0xea37d0135e2a5a54ce5cc1d2cf67c6baf9b615c49119953b3e438e75a85ff605\", transaction_index: 0}, message: \"required historical state unavailable (reexec=128)\"}]\r\n```\r\nAny suggestions on how I can fix it?\r\n",
  "closed_by": {
    "login": "no-response[bot]",
    "id": 32965360,
    "node_id": "MDM6Qm90MzI5NjUzNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/26350515?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/no-response%5Bbot%5D",
    "html_url": "https://github.com/apps/no-response",
    "followers_url": "https://api.github.com/users/no-response%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/no-response%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/no-response%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/no-response%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/no-response%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/no-response%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/no-response%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/no-response%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/no-response%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20602/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20602/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/580167191",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20602#issuecomment-580167191",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20602",
    "id": 580167191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDE2NzE5MQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-30T09:36:50Z",
    "updated_at": "2020-01-30T09:36:50Z",
    "author_association": "MEMBER",
    "body": "The `db` is set in `CaptureState`, so if a tx does not execute any operation (e.g. a plain value transfer), the `db` is unset, and it panics on line 204, when trying to access the result. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/580167191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/580167261",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20602#issuecomment-580167261",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20602",
    "id": 580167261,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDE2NzI2MQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-30T09:36:59Z",
    "updated_at": "2020-01-30T09:36:59Z",
    "author_association": "MEMBER",
    "body": "Could you share the tracing code? We have a hunch of what might happen (you're accessing the state in `result` or `fault`, which I didn't expect). ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/580167261/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/592928735",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20602#issuecomment-592928735",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20602",
    "id": 592928735,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MjkyODczNQ==",
    "user": {
      "login": "no-response[bot]",
      "id": 32965360,
      "node_id": "MDM6Qm90MzI5NjUzNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/26350515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/no-response%5Bbot%5D",
      "html_url": "https://github.com/apps/no-response",
      "followers_url": "https://api.github.com/users/no-response%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/no-response%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/no-response%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/no-response%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/no-response%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/no-response%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/no-response%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/no-response%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/no-response%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2020-02-29T10:08:42Z",
    "updated_at": "2020-02-29T10:08:42Z",
    "author_association": "NONE",
    "body": "This issue has been automatically closed because there has been no response to our request for more information from the original author. With only the information that is currently in the issue, we don't have enough information to take action. Please reach out if you have more relevant information or answers to our questions so that we can investigate further.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/592928735/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
