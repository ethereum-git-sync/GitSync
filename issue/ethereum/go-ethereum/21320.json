{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21320",
  "id": 654735314,
  "node_id": "MDU6SXNzdWU2NTQ3MzUzMTQ=",
  "number": 21320,
  "title": "Txpool not receiving any new pending transactions",
  "user": {
    "login": "revofever",
    "id": 8880715,
    "node_id": "MDQ6VXNlcjg4ODA3MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8880715?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/revofever",
    "html_url": "https://github.com/revofever",
    "followers_url": "https://api.github.com/users/revofever/followers",
    "following_url": "https://api.github.com/users/revofever/following{/other_user}",
    "gists_url": "https://api.github.com/users/revofever/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/revofever/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/revofever/subscriptions",
    "organizations_url": "https://api.github.com/users/revofever/orgs",
    "repos_url": "https://api.github.com/users/revofever/repos",
    "events_url": "https://api.github.com/users/revofever/events{/privacy}",
    "received_events_url": "https://api.github.com/users/revofever/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1132687333,
      "node_id": "MDU6TGFiZWwxMTMyNjg3MzMz",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/need:check-with-current-version",
      "name": "need:check-with-current-version",
      "color": "d3b300",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-07-10T12:08:23Z",
  "updated_at": "2021-10-13T14:29:24Z",
  "closed_at": "2020-08-05T18:36:02Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Originally posted on stackexchange: https://ethereum.stackexchange.com/questions/84815/txpool-not-receiving-any-new-pending-transactions\r\n\r\n\r\n#### System information\r\n\r\nGeth version: `1.9.15-stable`\r\nOS & Version: Ubuntu 18.04.3 LTS\r\nDigital Ocean Droplet\r\n6 vCPUs\r\n16 GB RAM\r\n#### Expected behaviour\r\n\r\nTransactions being added to the txpool at all times, including when there is an influx of new transactions and when the txpool count gets large.\r\n\r\nThe following subscription should stay operational and stable:\r\n\r\n```\r\nweb3.eth.subscribe('pendingTransactions', function(error, result){\r\n    if (!error)\r\n        console.log(result);\r\n})\r\n.on(\"data\", function(transaction){\r\n    console.log(transaction);\r\n    let promise = web3.eth.getTransaction(transaction);\r\n    promise.then((data) => {\r\n\t    if(data){\r\n\t\t    console.log(data);\r\n\t    }\r\n    });\r\n});\r\n```\r\n\r\n#### Actual behaviour\r\n\r\nIt seems the node will stop receiving new transactions into the txpool at times of high activity, or even randomly.\r\n\r\nCalling txpool.status\r\n`{\r\n  pending: 144598,\r\n  queued: 7244\r\n}`\r\n\r\n5 mins later: `{\r\n  pending: 144598,\r\n  queued: 7747\r\n}\r\n`\r\n\r\nThe pending number is not increasing, while transactions are still being added to queued. Transactions are not received from the web3 subscription at this time.\r\n\r\nEverything will return to normal after a period of time (15 mins - x hours).\r\n\r\nMemory usage is normal and stable (60%), CPU usage nowhere near maxed out.\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nRun a node with high txpool limits, and the web3 subscription listed above. Test to see when the txpool pending count stalls.\r\n`--txpool.globalslots 1000000 --txpool.accountslots 128 --txpool.accountqueue 512 --txpool.globalqueue 500000 --txpool.lifetime 24h0m0s`\r\n\r\n",
  "closed_by": {
    "login": "revofever",
    "id": 8880715,
    "node_id": "MDQ6VXNlcjg4ODA3MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8880715?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/revofever",
    "html_url": "https://github.com/revofever",
    "followers_url": "https://api.github.com/users/revofever/followers",
    "following_url": "https://api.github.com/users/revofever/following{/other_user}",
    "gists_url": "https://api.github.com/users/revofever/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/revofever/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/revofever/subscriptions",
    "organizations_url": "https://api.github.com/users/revofever/orgs",
    "repos_url": "https://api.github.com/users/revofever/repos",
    "events_url": "https://api.github.com/users/revofever/events{/privacy}",
    "received_events_url": "https://api.github.com/users/revofever/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320/reactions",
    "total_count": 2,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/657520772",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21320#issuecomment-657520772",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320",
    "id": 657520772,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NzUyMDc3Mg==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-13T12:05:00Z",
    "updated_at": "2020-07-13T12:05:00Z",
    "author_association": "MEMBER",
    "body": "Can you try the latest release? We have a fix for txpool which may or may not solve this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/657520772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/658149920",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21320#issuecomment-658149920",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320",
    "id": 658149920,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODE0OTkyMA==",
    "user": {
      "login": "revofever",
      "id": 8880715,
      "node_id": "MDQ6VXNlcjg4ODA3MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8880715?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/revofever",
      "html_url": "https://github.com/revofever",
      "followers_url": "https://api.github.com/users/revofever/followers",
      "following_url": "https://api.github.com/users/revofever/following{/other_user}",
      "gists_url": "https://api.github.com/users/revofever/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/revofever/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/revofever/subscriptions",
      "organizations_url": "https://api.github.com/users/revofever/orgs",
      "repos_url": "https://api.github.com/users/revofever/repos",
      "events_url": "https://api.github.com/users/revofever/events{/privacy}",
      "received_events_url": "https://api.github.com/users/revofever/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-14T12:25:58Z",
    "updated_at": "2020-07-14T12:25:58Z",
    "author_association": "NONE",
    "body": "I will update if the issue continues on the latest release. It is rare so it could take some time.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/658149920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/659567559",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21320#issuecomment-659567559",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320",
    "id": 659567559,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1OTU2NzU1OQ==",
    "user": {
      "login": "pyggie",
      "id": 56756534,
      "node_id": "MDQ6VXNlcjU2NzU2NTM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/56756534?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pyggie",
      "html_url": "https://github.com/pyggie",
      "followers_url": "https://api.github.com/users/pyggie/followers",
      "following_url": "https://api.github.com/users/pyggie/following{/other_user}",
      "gists_url": "https://api.github.com/users/pyggie/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pyggie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pyggie/subscriptions",
      "organizations_url": "https://api.github.com/users/pyggie/orgs",
      "repos_url": "https://api.github.com/users/pyggie/repos",
      "events_url": "https://api.github.com/users/pyggie/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pyggie/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-16T17:44:30Z",
    "updated_at": "2020-07-16T17:52:29Z",
    "author_association": "NONE",
    "body": "I have also seen this issue. I first saw it happen on Apr 21 after upgrading to v1.9.13. I have also seen it happen frequently with v1.9.15. It is common enough (once every 2-5 days) that I have written a monitoring tool to detect the problem and restart geth when it happens. There is no indication in the log that something is wrong.\r\n\r\nHere is an example incident using v1.9.15. Last pending tx seen at 2020-06-15 14:23:41, then sudden stop. At this time CPU load went ~75% idle. Nothing relevant in geth.log:\r\n```\r\nINFO [06-15|14:22:06.540] Deep froze chain segment                 blocks=6  elapsed=45.360ms  number=10180816     hash=\"677f19…d560d5\"\r\nINFO [06-15|14:23:17.214] Imported new chain segment               blocks=1  txs=26  mgas=9.953  elapsed=85.522ms  mgasps=116.381 number=10270818     hash=\"cad66a…907f68\" age=1m20s dirty=773.99MiB\r\nINFO [06-15|14:23:30.283] Imported new chain segment               blocks=1  txs=183 mgas=9.962  elapsed=2.534s    mgasps=3.930   number=10270819     hash=\"47f44d…676a68\" dirty=774.22MiB\r\nINFO [06-15|14:23:35.630] Imported new chain segment               blocks=1  txs=184 mgas=9.963  elapsed=153.273ms mgasps=65.005  number=10270820     hash=\"62110b…6f43ce\" dirty=774.14MiB\r\nINFO [06-15|14:23:59.715] Imported new chain segment               blocks=1  txs=199 mgas=9.968  elapsed=171.976ms mgasps=57.964  number=10270821     hash=\"107aa1…4a9b51\" dirty=774.73MiB\r\nWARN [06-15|14:24:04.409] Checkpoint challenge timed out, dropping id=e46f5a16aa5428ec conn=dyndial addr=47.57.94.254:30303    type=Geth/v1.9.14-stable-6d74d1e5/linux-amd64/go1.14.2\r\nINFO [06-15|14:24:06.609] Deep froze chain segment                 blocks=4  elapsed=65.874ms  number=10180820     hash=\"bf0f1e…d4c81e\"\r\nINFO [06-15|14:24:08.160] Imported new chain segment               blocks=1  txs=129 mgas=9.964  elapsed=367.989ms mgasps=27.077  number=10270822     hash=\"ab60b2…abb481\" dirty=775.25MiB\r\n```\r\n\r\nCPU activity during this time period declines. From output of sar:\r\n```\r\nCPU (last column is idle%):\r\n14:17:59        all     56.01      0.00      3.17      1.41      0.23     39.17\r\n14:18:59        all     52.11      0.00      2.96      1.22      0.23     43.48\r\n14:19:59        all     44.20      0.00      2.76      0.40      0.25     52.39\r\n14:20:59        all     44.14      0.00      2.44      0.43      0.24     52.75\r\n14:21:59        all     51.44      0.00      2.89      1.00      0.19     44.48\r\n14:22:59        all     36.46      0.00      2.33      1.24      0.27     59.70\r\n14:23:59        all     38.50      0.00      2.25      1.07      0.23     57.95\r\n14:24:59        all     19.46      0.00      2.43      1.68      0.33     76.10\r\n14:25:59        all     18.60      0.00      2.23      1.39      0.31     77.47\r\n14:26:59        all     16.53      0.00      1.86      0.91      0.29     80.42\r\n14:27:59        all     10.17      0.00      1.58      0.86      0.29     87.10\r\n```\r\nUpon sending the INT signal, geth begins shutdown but then hangs (as reported in #21273):\r\n```\r\nINFO [06-15|18:01:19.308] Got interrupt, shutting down...\r\nINFO [06-15|18:01:19.317] WebSocket endpoint closed                url=ws://127.0.0.1:8546\r\nINFO [06-15|18:01:19.317] HTTP endpoint closed                     url=http://127.0.0.1:8545/\r\nINFO [06-15|18:01:19.318] IPC endpoint closed                      url=/mnt/data/geth/geth.ipc\r\n```\r\nForce stopped. Upon restart, full sync from 15h20m in the past.\r\n\r\nIn config.toml I have:\r\n```\r\n[Eth.TxPool]\r\nLocals = []\r\nNoLocals = false\r\nJournal = \"transactions.rlp\"\r\nRejournal = 3600000000000\r\nPriceLimit = 1\r\nPriceBump = 10\r\nAccountSlots = 16\r\nGlobalSlots = 100000\r\nAccountQueue = 64\r\nGlobalQueue = 1024\r\nLifetime = 10800000000000\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/659567559/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/669384392",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21320#issuecomment-669384392",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320",
    "id": 669384392,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2OTM4NDM5Mg==",
    "user": {
      "login": "revofever",
      "id": 8880715,
      "node_id": "MDQ6VXNlcjg4ODA3MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8880715?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/revofever",
      "html_url": "https://github.com/revofever",
      "followers_url": "https://api.github.com/users/revofever/followers",
      "following_url": "https://api.github.com/users/revofever/following{/other_user}",
      "gists_url": "https://api.github.com/users/revofever/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/revofever/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/revofever/subscriptions",
      "organizations_url": "https://api.github.com/users/revofever/orgs",
      "repos_url": "https://api.github.com/users/revofever/repos",
      "events_url": "https://api.github.com/users/revofever/events{/privacy}",
      "received_events_url": "https://api.github.com/users/revofever/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-05T18:36:02Z",
    "updated_at": "2020-08-05T18:36:02Z",
    "author_association": "NONE",
    "body": "The issue disappeared after I did a few things. First updated to the latest version and set a lower txpool limit. Now I am using 75000 max `globalslots`.\r\n\r\nNext I wrote a script that will run every minute. It drops nodes that are way behind in syncing. I did see a small improvement doing this, but I'm not sure if it was the main cause of the issue. I wouldn't recommend doing this unless you are using the node as a service provider. In my case, I need as close to 100% uptime as I can get.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/669384392/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/942365399",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21320#issuecomment-942365399",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21320",
    "id": 942365399,
    "node_id": "IC_kwDOAOvK9844K1rX",
    "user": {
      "login": "ethermachine",
      "id": 75843061,
      "node_id": "MDQ6VXNlcjc1ODQzMDYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/75843061?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ethermachine",
      "html_url": "https://github.com/ethermachine",
      "followers_url": "https://api.github.com/users/ethermachine/followers",
      "following_url": "https://api.github.com/users/ethermachine/following{/other_user}",
      "gists_url": "https://api.github.com/users/ethermachine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ethermachine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ethermachine/subscriptions",
      "organizations_url": "https://api.github.com/users/ethermachine/orgs",
      "repos_url": "https://api.github.com/users/ethermachine/repos",
      "events_url": "https://api.github.com/users/ethermachine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ethermachine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-13T14:29:23Z",
    "updated_at": "2021-10-13T14:29:23Z",
    "author_association": "NONE",
    "body": "hey @revofever I would love to know more about that \"purge dead peers script\".\r\nMind to share more details?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/942365399/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
