{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21454",
  "id": 679808851,
  "node_id": "MDU6SXNzdWU2Nzk4MDg4NTE=",
  "number": 21454,
  "title": "Wrong DNS configuration for ethdisco.net domain causes a lot of background errors during DNS queries",
  "user": {
    "login": "Neurone",
    "id": 562943,
    "node_id": "MDQ6VXNlcjU2Mjk0Mw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/562943?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Neurone",
    "html_url": "https://github.com/Neurone",
    "followers_url": "https://api.github.com/users/Neurone/followers",
    "following_url": "https://api.github.com/users/Neurone/following{/other_user}",
    "gists_url": "https://api.github.com/users/Neurone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Neurone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Neurone/subscriptions",
    "organizations_url": "https://api.github.com/users/Neurone/orgs",
    "repos_url": "https://api.github.com/users/Neurone/repos",
    "events_url": "https://api.github.com/users/Neurone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Neurone/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2020-08-16T19:10:47Z",
  "updated_at": "2020-08-25T20:54:22Z",
  "closed_at": "2020-08-25T20:54:21Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.9.19`\r\nOS & Version: Ubuntu 18.04\r\n\r\n#### Expected behaviour\r\n\r\nDNS server should always send messages compliant to [RFC 1035](https://tools.ietf.org/html/rfc1035). In particular, DNS should not send messages greater then **512 bytes** over UDP.\r\n\r\n#### Actual behaviour\r\n\r\nGeth **truncates DNS packets** while discovering new peers. This causes in the background a loop of DNS queries, all doomed to fail.\r\n\r\n```bash\r\nDEBUG[08-16|20:19:10.158] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\n```\r\n\r\nThis issue was also previously reported (#20713) but it seemed to be a pi-hole related issue so it was closed without a solution. \r\n\r\nThe problem is actually in the **DNS server configuration**:\r\n1. DNS server sends 526 bytes when responding to queries like this YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net.\r\n2. go DNS client follows [RFC 1035](https://tools.ietf.org/html/rfc1035) and [it truncates the message](https://github.com/golang/go/blob/8c39bbf9c93f773ab351bbddb4c3dd93e4fddc76/src/net/dnsclient_unix.go#L85) to 512 bytes and then [it goes in error while parsing](https://github.com/golang/go/blob/release-branch.go1.14/src/vendor/golang.org/x/net/dns/dnsmessage/message.go#L600-L603)\r\n3. go DNS client [reports the error](https://github.com/ethereum/go-ethereum/blob/54add4255064f722b33fe1c13e46db0b875fe325/p2p/dnsdisc/client.go#L179-L183) to geth\r\n\r\nThe first query for the root is always fine because message size is **497 bytes** (check the last line **MSG SIZE rcvd**):\r\n\r\n```bash\r\n$ dig TXT all.mainnet.ethdisco.net                           \r\n\r\n; <<>> DiG 9.11.3-1ubuntu1.12-Ubuntu <<>> TXT all.mainnet.ethdisco.net\r\n;; global options: +cmd\r\n;; Got answer:\r\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 49427\r\n;; flags: qr rd ad; QUERY: 1, ANSWER: 7, AUTHORITY: 0, ADDITIONAL: 0\r\n;; WARNING: recursion requested but not available\r\n\r\n;; QUESTION SECTION:\r\n;all.mainnet.ethdisco.net.      IN      TXT\r\n\r\n;; ANSWER SECTION:\r\nall.mainnet.ethdisco.net. 0     IN      TXT     \"enrtree-root:v1 e=YT2KPIIE637MN76A2UTCOCZPFU l=FDXN3SN67NA5DKA4J2GOK7BVQI seq=1320 sig=frVtmMBzg6wg4Ddhv6Fx1MJaUlWOG7YwskBUcAL7dFNbwo7gMzTeumaJLpPenKH_CFkDkTWs5H6aKOTGSwZFjAE\"\r\nns-224.awsdns-28.com.   0       IN      A       205.251.192.224\r\nns-706.awsdns-24.net.   0       IN      A       205.251.194.194\r\nns-1441.awsdns-52.org.  0       IN      A       205.251.197.161\r\nns-1818.awsdns-35.co.uk. 0      IN      A       205.251.199.26\r\nns-224.awsdns-28.com.   0       IN      AAAA    2600:9000:5300:e000::1\r\nns-706.awsdns-24.net.   0       IN      AAAA    2600:9000:5302:c200::1\r\n\r\n;; Query time: 0 msec\r\n;; SERVER: 172.27.112.1#53(172.27.112.1)\r\n;; WHEN: Sun Aug 16 19:21:34 CEST 2020\r\n;; MSG SIZE  rcvd: 497\r\n```\r\nThe second query to the actual ENR tree instead raises the issue:\r\n\r\n```bash\r\n$ dig TXT YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net \r\n\r\n; <<>> DiG 9.11.3-1ubuntu1.12-Ubuntu <<>> TXT YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net\r\n;; global options: +cmd\r\n;; Got answer:\r\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 37600\r\n;; flags: qr rd ad; QUERY: 1, ANSWER: 7, AUTHORITY: 0, ADDITIONAL: 0\r\n;; WARNING: recursion requested but not available\r\n\r\n;; QUESTION SECTION:\r\n;YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net. IN        TXT\r\n\r\n;; ANSWER SECTION:\r\nYT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net. 0 IN TXT \"enrtree-branch:EIJJYR2Y7HKP7GTBNSTTFDKISM,ZGIF73FX4IUMCY7SIF6AZ673EA,TE4PG4BD5CKZTCSQBCE45CMS2E,JZFQSASGA7S6GWOCXIEHNNY4NU,VT6KSVN7W3K4UF433DW2W6AVAU\"\r\nns-224.awsdns-28.com.   0       IN      A       205.251.192.224\r\nns-706.awsdns-24.net.   0       IN      A       205.251.194.194\r\nns-1441.awsdns-52.org.  0       IN      A       205.251.197.161\r\nns-1818.awsdns-35.co.uk. 0      IN      A       205.251.199.26\r\nns-224.awsdns-28.com.   0       IN      AAAA    2600:9000:5300:e000::1\r\nns-706.awsdns-24.net.   0       IN      AAAA    2600:9000:5302:c200::1\r\n\r\n;; Query time: 0 msec\r\n;; SERVER: 172.27.112.1#53(172.27.112.1)\r\n;; WHEN: Sun Aug 16 19:22:15 CEST 2020\r\n;; MSG SIZE  rcvd: 526\r\n```\r\n\r\n#### How to solve the issue\r\n\r\nRemove other records from the DNS response aside by `TXT`, in particular those not used like all `A`s and `AAAA`s.\r\n\r\nI didn't check all other networks, but Ropsten for example is already configured in a correct way:\r\n\r\n```bash\r\n$ dig TXT 3EAZQHDTFVH6TTYVLEGGHUT5TM.all.ropsten.ethdisco.net\r\n\r\n; <<>> DiG 9.11.3-1ubuntu1.12-Ubuntu <<>> TXT 3EAZQHDTFVH6TTYVLEGGHUT5TM.all.ropsten.ethdisco.net\r\n;; global options: +cmd\r\n;; Got answer:\r\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 1631\r\n;; flags: qr rd ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0\r\n;; WARNING: recursion requested but not available\r\n\r\n;; QUESTION SECTION:\r\n;3EAZQHDTFVH6TTYVLEGGHUT5TM.all.ropsten.ethdisco.net. IN        TXT\r\n\r\n;; ANSWER SECTION:\r\n3EAZQHDTFVH6TTYVLEGGHUT5TM.all.ropsten.ethdisco.net. 0 IN TXT \"enrtree-branch:XX4U4ZKXUCOWBHPUOGISEAIDJE,4ZR6DWAKZTWUEMTCN47N3KY7YE,NHRHUEAR5OY4K4O6TCL5LUTCLM,PDPBUM23QXC32GCRPCWBZBA2NU,N7NYW2XJCJZE22MXJMGI4HVJO4,I6VIAEOHT4RJC54AA2HFP6QJSI,M7YILXPTHZ7PUJZERM5T72PABA,TC22I752VVE6Y4DYYWG2VOV6PY,OGDOAVH7BVKLSNWTCM42WP\" \"4IEA,CYV3DOHCVAL43SK5RYQCDIK6EI\"\r\n\r\n;; Query time: 23 msec\r\n;; SERVER: 172.27.112.1#53(172.27.112.1)\r\n;; WHEN: Sun Aug 16 19:21:11 CEST 2020\r\n;; MSG SIZE  rcvd: 418\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nStart geth from scratch with verbosity level 4\r\n\r\n#### Backtrace\r\n\r\n````\r\n$ geth --verbosity 4\r\nINFO [08-16|20:19:09.860] Starting Geth on Ethereum mainnet... \r\nINFO [08-16|20:19:09.860] Bumping default cache on mainnet         provided=1024 updated=4096\r\nDEBUG[08-16|20:19:09.860] Sanitizing Go's GC trigger               percent=25\r\nINFO [08-16|20:19:09.862] Maximum peer count                       ETH=50 LES=0 total=50\r\nINFO [08-16|20:19:09.862] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nDEBUG[08-16|20:19:09.862] FS scan times                            list=\"28.5µs\" set=700ns diff=800ns\r\nINFO [08-16|20:19:09.862] Set global gas cap                       cap=25000000\r\nINFO [08-16|20:19:09.862] Allocated trie memory caches             clean=1023.00MiB dirty=1024.00MiB\r\n[...]\r\nDEBUG[08-16|20:19:10.158] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:10.159] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:10.160] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:10.161] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:10.162] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:10.163] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:10.165] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:10.490] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:10.823] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:11.157] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:11.490] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:11.823] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:12.490] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:12.823] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:13.156] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:13.490] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:13.823] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:14.157] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:14.823] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:15.156] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:15.490] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:15.823] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:16.156] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:16.490] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\nDEBUG[08-16|20:19:17.156] Error in DNS random node sync            tree=all.mainnet.ethdisco.net err=\"lookup YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net on 172.27.112.1:53: cannot unmarshal DNS message\"\r\n[...]\r\n````\r\n",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/674825356",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-674825356",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 674825356,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NDgyNTM1Ng==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-17T11:27:00Z",
    "updated_at": "2020-08-17T11:27:00Z",
    "author_association": "MEMBER",
    "body": "Thanks for debugging this! We'll see how to disable this behavior on the server side.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/674825356/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/675934862",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-675934862",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 675934862,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NTkzNDg2Mg==",
    "user": {
      "login": "Aldekein",
      "id": 671454,
      "node_id": "MDQ6VXNlcjY3MTQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/671454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aldekein",
      "html_url": "https://github.com/Aldekein",
      "followers_url": "https://api.github.com/users/Aldekein/followers",
      "following_url": "https://api.github.com/users/Aldekein/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aldekein/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aldekein/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aldekein/subscriptions",
      "organizations_url": "https://api.github.com/users/Aldekein/orgs",
      "repos_url": "https://api.github.com/users/Aldekein/repos",
      "events_url": "https://api.github.com/users/Aldekein/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aldekein/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-19T08:25:39Z",
    "updated_at": "2020-08-19T08:27:19Z",
    "author_association": "MEMBER",
    "body": "Just tried to run the `dig` from an AWS EC2 machine, and getting the following results:\r\n\r\n```\r\n$ dig TXT YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net\r\n\r\n; <<>> DiG 9.11.3-1ubuntu1.12-Ubuntu <<>> TXT YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net\r\n;; global options: +cmd\r\n;; Got answer:\r\n;; ->>HEADER<<- opcode: QUERY, status: NXDOMAIN, id: 17019\r\n;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1\r\n\r\n;; OPT PSEUDOSECTION:\r\n; EDNS: version: 0, flags:; udp: 65494\r\n;; QUESTION SECTION:\r\n;YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net. IN\tTXT\r\n\r\n;; Query time: 11 msec\r\n;; SERVER: 127.0.0.53#53(127.0.0.53)\r\n;; WHEN: Wed Aug 19 08:21:20 UTC 2020\r\n;; MSG SIZE  rcvd: 80\r\n```\r\n\r\nand: \r\n```\r\n$ dig TXT all.mainnet.ethdisco.net\r\n\r\n; <<>> DiG 9.11.3-1ubuntu1.12-Ubuntu <<>> TXT all.mainnet.ethdisco.net\r\n;; global options: +cmd\r\n;; Got answer:\r\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 4896\r\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\r\n\r\n;; OPT PSEUDOSECTION:\r\n; EDNS: version: 0, flags:; udp: 65494\r\n;; QUESTION SECTION:\r\n;all.mainnet.ethdisco.net.\tIN\tTXT\r\n\r\n;; ANSWER SECTION:\r\nall.mainnet.ethdisco.net. 1347\tIN\tTXT\t\"enrtree-root:v1 e=WDF2TUTUUA2Y3QWK337W54HMWA l=FDXN3SN67NA5DKA4J2GOK7BVQI seq=1329 sig=2bMfIuiDld1MoyqZKl63YD0msEixMlEs02mwE46z0d8ojeUbfUTKLGRpqsfDwhelcq2yqqx51tkfbH44xc9M9gE\"\r\n\r\n;; Query time: 1 msec\r\n;; SERVER: 127.0.0.53#53(127.0.0.53)\r\n;; WHEN: Wed Aug 19 08:22:17 UTC 2020\r\n;; MSG SIZE  rcvd: 240\r\n```\r\nThere's no extra AAAA and A records in response, and the `YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net` domain isn't resolved at all.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/675934862/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/675942481",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-675942481",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 675942481,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NTk0MjQ4MQ==",
    "user": {
      "login": "Neurone",
      "id": 562943,
      "node_id": "MDQ6VXNlcjU2Mjk0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/562943?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Neurone",
      "html_url": "https://github.com/Neurone",
      "followers_url": "https://api.github.com/users/Neurone/followers",
      "following_url": "https://api.github.com/users/Neurone/following{/other_user}",
      "gists_url": "https://api.github.com/users/Neurone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Neurone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Neurone/subscriptions",
      "organizations_url": "https://api.github.com/users/Neurone/orgs",
      "repos_url": "https://api.github.com/users/Neurone/repos",
      "events_url": "https://api.github.com/users/Neurone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Neurone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-19T08:30:59Z",
    "updated_at": "2020-08-19T08:30:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Second query ID (i.e. YT2KPIIE637MN76A2UTCOCZPFU.all.mainnet.ethdisco.net) is dynamic, it changes about every 10 minutes, you will get the correct ID from the first query, in your case WDF2TUTUUA2Y3QWK337W54HMWA",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/675942481/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/676039294",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-676039294",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 676039294,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NjAzOTI5NA==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-19T09:37:55Z",
    "updated_at": "2020-08-19T09:37:55Z",
    "author_association": "MEMBER",
    "body": "ethdisco.net is hosted on Amazon Route53. We've done some checks on our configuration there and these extra records are not configured on the server in any way. This issue could also be a problem with a misbehaving intermediate resolver.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/676039294/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/676044122",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-676044122",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 676044122,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NjA0NDEyMg==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-19T09:41:23Z",
    "updated_at": "2020-08-19T09:44:45Z",
    "author_association": "MEMBER",
    "body": "A stable command to check for this issue is\r\n\r\n```\r\ngo build ./cmd/devp2p\r\n./devp2p --verbosity 5 dns sync enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.mainnet.ethdisco.net\r\n```\r\n\r\nThis will download all available nodes at the given name in the same way geth does. I can run this command without any issue here, so looks like this doesn't trigger for everyone.\r\n\r\n@Neurone please check your DNS resolver configuration. Maybe we can narrow this down to a specific public resolver and report the issue there.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/676044122/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/676298048",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-676298048",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 676298048,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NjI5ODA0OA==",
    "user": {
      "login": "Neurone",
      "id": 562943,
      "node_id": "MDQ6VXNlcjU2Mjk0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/562943?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Neurone",
      "html_url": "https://github.com/Neurone",
      "followers_url": "https://api.github.com/users/Neurone/followers",
      "following_url": "https://api.github.com/users/Neurone/following{/other_user}",
      "gists_url": "https://api.github.com/users/Neurone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Neurone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Neurone/subscriptions",
      "organizations_url": "https://api.github.com/users/Neurone/orgs",
      "repos_url": "https://api.github.com/users/Neurone/repos",
      "events_url": "https://api.github.com/users/Neurone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Neurone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-19T12:48:12Z",
    "updated_at": "2020-08-19T12:48:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "@fjl I'll try as soon as possible. Have you tried to query the DNS also from a client outside EC2?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/676298048/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/676349492",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-676349492",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 676349492,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NjM0OTQ5Mg==",
    "user": {
      "login": "Neurone",
      "id": 562943,
      "node_id": "MDQ6VXNlcjU2Mjk0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/562943?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Neurone",
      "html_url": "https://github.com/Neurone",
      "followers_url": "https://api.github.com/users/Neurone/followers",
      "following_url": "https://api.github.com/users/Neurone/following{/other_user}",
      "gists_url": "https://api.github.com/users/Neurone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Neurone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Neurone/subscriptions",
      "organizations_url": "https://api.github.com/users/Neurone/orgs",
      "repos_url": "https://api.github.com/users/Neurone/repos",
      "events_url": "https://api.github.com/users/Neurone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Neurone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-19T13:22:43Z",
    "updated_at": "2020-08-19T14:08:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Tested on mobile phone via termux and DNS actually resolves TXT correctly without problems. Wierd. I'll be again at home in few days, I'll try again from there. Maybe some cached result from specific ISPs or regions? I experienced the problem connecting from Rome, Italy using Fastweb ISP.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/676349492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/677612199",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-677612199",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 677612199,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzYxMjE5OQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-20T12:08:49Z",
    "updated_at": "2020-08-20T12:08:49Z",
    "author_association": "MEMBER",
    "body": "I tested outside of EC2 (don't have anything on EC2) and it works for me. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/677612199/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/678175879",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-678175879",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 678175879,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODE3NTg3OQ==",
    "user": {
      "login": "Neurone",
      "id": 562943,
      "node_id": "MDQ6VXNlcjU2Mjk0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/562943?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Neurone",
      "html_url": "https://github.com/Neurone",
      "followers_url": "https://api.github.com/users/Neurone/followers",
      "following_url": "https://api.github.com/users/Neurone/following{/other_user}",
      "gists_url": "https://api.github.com/users/Neurone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Neurone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Neurone/subscriptions",
      "organizations_url": "https://api.github.com/users/Neurone/orgs",
      "repos_url": "https://api.github.com/users/Neurone/repos",
      "events_url": "https://api.github.com/users/Neurone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Neurone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-21T10:10:57Z",
    "updated_at": "2020-08-21T10:10:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "Tested again from home, same result:\r\n\r\n```bash\r\n➜  go-ethereum git:(master)  ./devp2p --verbosity 5 dns sync enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.mainnet.ethdisco.net\r\nTRACE[08-21|12:08:36.985] Updating DNS discovery root              tree=all.mainnet.ethdisco.net err=nil\r\nTRACE[08-21|12:08:36.986] DNS discovery lookup                     name=FDXN3SN67NA5DKA4J2GOK7BVQI.all.mainnet.ethdisco.net err=nil\r\nTRACE[08-21|12:08:36.986] DNS discovery lookup                     name=JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net err=\"lookup JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net on 172.23.240.1:53: cannot unmarshal DNS message\"\r\nlookup JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net on 172.23.240.1:53: cannot unmarshal DNS message\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/678175879/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/678236715",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-678236715",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 678236715,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODIzNjcxNQ==",
    "user": {
      "login": "Neurone",
      "id": 562943,
      "node_id": "MDQ6VXNlcjU2Mjk0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/562943?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Neurone",
      "html_url": "https://github.com/Neurone",
      "followers_url": "https://api.github.com/users/Neurone/followers",
      "following_url": "https://api.github.com/users/Neurone/following{/other_user}",
      "gists_url": "https://api.github.com/users/Neurone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Neurone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Neurone/subscriptions",
      "organizations_url": "https://api.github.com/users/Neurone/orgs",
      "repos_url": "https://api.github.com/users/Neurone/repos",
      "events_url": "https://api.github.com/users/Neurone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Neurone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-21T11:09:35Z",
    "updated_at": "2020-08-21T11:12:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "I found the answer: it's a client side issue with DNS resolver inside VM (or container).\r\n\r\nBecause my ISP use the authoritative DNS to resolve the address, the clean response is like this:\r\n\r\n```bash\r\n➜  go-ethereum git:(master) ✗ dig txt JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net                                                             \r\n\r\n; <<>> DiG 9.11.3-1ubuntu1.12-Ubuntu <<>> txt JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net\r\n;; global options: +cmd\r\n;; Got answer:\r\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 6142\r\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 9\r\n\r\n;; OPT PSEUDOSECTION:\r\n; EDNS: version: 0, flags:; udp: 4096\r\n; COOKIE: 6783a699d7b88358b60f8ad15f3fa9874b4676dd03cbba40 (good)\r\n;; QUESTION SECTION:\r\n;JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net. IN        TXT\r\n\r\n;; ANSWER SECTION:\r\nJFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net. 602097 IN TXT \"enrtree-branch:ZLPOJ25FUOLQSO2WY55OVXSYCU,VI6DY45ZYDCWWGASUK6IQMYLCI,GUNYPUBCAC7TTTEISGRQCJZE2U,XBYYAXQOC4I5MRA6FIO6YZX5YQ,HCGUSFIAF77SNR5M63OUYPTVLY\"\r\n\r\n;; AUTHORITY SECTION:\r\nethdisco.net.           123598  IN      NS      ns-224.awsdns-28.com.\r\nethdisco.net.           123598  IN      NS      ns-1818.awsdns-35.co.uk.\r\nethdisco.net.           123598  IN      NS      ns-1441.awsdns-52.org.\r\nethdisco.net.           123598  IN      NS      ns-706.awsdns-24.net.\r\n\r\n;; ADDITIONAL SECTION:\r\nns-224.awsdns-28.com.   97906   IN      A       205.251.192.224\r\nns-706.awsdns-24.net.   72637   IN      A       205.251.194.194\r\nns-1441.awsdns-52.org.  72612   IN      A       205.251.197.161\r\nns-1818.awsdns-35.co.uk. 72603  IN      A       205.251.199.26\r\nns-224.awsdns-28.com.   97906   IN      AAAA    2600:9000:5300:e000::1\r\nns-706.awsdns-24.net.   72637   IN      AAAA    2600:9000:5302:c200::1\r\nns-1441.awsdns-52.org.  72612   IN      AAAA    2600:9000:5305:a100::1\r\nns-1818.awsdns-35.co.uk. 72603  IN      AAAA    2600:9000:5307:1a00::1\r\n\r\n;; Query time: 7 msec\r\n;; SERVER: 192.168.1.254#53(192.168.1.254)\r\n;; WHEN: Fri Aug 21 13:01:26 CEST 2020\r\n;; MSG SIZE  rcvd: 583\r\n```\r\n\r\nEven if the message is larger then 512 bytes, the client stop parsing after `ANSWER` section is finished and all works good.\r\n\r\nWhen I'm on the same machine but inside a virtual network, the resolver mixes the `ANSWER` section with the `AUTORITY` section:\r\n\r\n```bash\r\n➜  go-ethereum git:(master) ✗ dig txt JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net\r\n\r\n; <<>> DiG 9.11.3-1ubuntu1.12-Ubuntu <<>> txt JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net\r\n;; global options: +cmd\r\n;; Got answer:\r\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 41396\r\n;; flags: qr rd ad; QUERY: 1, ANSWER: 7, AUTHORITY: 0, ADDITIONAL: 0\r\n;; WARNING: recursion requested but not available\r\n\r\n;; QUESTION SECTION:\r\n;JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net. IN        TXT\r\n\r\n;; ANSWER SECTION:\r\nJFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net. 0 IN TXT \"enrtree-branch:ZLPOJ25FUOLQSO2WY55OVXSYCU,VI6DY45ZYDCWWGASUK6IQMYLCI,GUNYPUBCAC7TTTEISGRQCJZE2U,XBYYAXQOC4I5MRA6FIO6YZX5YQ,HCGUSFIAF77SNR5M63OUYPTVLY\"\r\nns-224.awsdns-28.com.   0       IN      A       205.251.192.224\r\nns-706.awsdns-24.net.   0       IN      A       205.251.194.194\r\nns-1441.awsdns-52.org.  0       IN      A       205.251.197.161\r\nns-1818.awsdns-35.co.uk. 0      IN      A       205.251.199.26\r\nns-224.awsdns-28.com.   0       IN      AAAA    2600:9000:5300:e000::1\r\nns-706.awsdns-24.net.   0       IN      AAAA    2600:9000:5302:c200::1\r\n\r\n;; Query time: 0 msec\r\n;; SERVER: 172.23.240.1#53(172.23.240.1)\r\n;; WHEN: Fri Aug 21 13:03:34 CEST 2020\r\n;; MSG SIZE  rcvd: 526\r\n```\r\nThis time the client continue parsing the ANSWER and get the error \"cannot unmarshal DNS message\" because the message is too long.\r\n\r\nUsing explicitly a non authoritative DNS server (I don't suggest this though) solves the issue in any case because AUTHORITY section is not present at all:\r\n\r\n```bash\r\n  go-ethereum git:(master) ✗ dig txt JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net\r\n\r\n; <<>> DiG 9.11.3-1ubuntu1.12-Ubuntu <<>> txt JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net\r\n;; global options: +cmd\r\n;; Got answer:\r\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 45520\r\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\r\n\r\n;; OPT PSEUDOSECTION:\r\n; EDNS: version: 0, flags:; udp: 512\r\n;; QUESTION SECTION:\r\n;JFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net. IN        TXT\r\n\r\n;; ANSWER SECTION:\r\nJFUFNF3G5436CEITKZS3INWAQE.all.mainnet.ethdisco.net. 21599 IN TXT \"enrtree-branch:ZLPOJ25FUOLQSO2WY55OVXSYCU,VI6DY45ZYDCWWGASUK6IQMYLCI,GUNYPUBCAC7TTTEISGRQCJZE2U,XBYYAXQOC4I5MRA6FIO6YZX5YQ,HCGUSFIAF77SNR5M63OUYPTVLY\"\r\n\r\n;; Query time: 29 msec\r\n;; SERVER: 8.8.8.8#53(8.8.8.8)\r\n;; WHEN: Fri Aug 21 13:06:32 CEST 2020\r\n;; MSG SIZE  rcvd: 242\r\n```\r\n\r\nSuggestion: maybe this discovery feature can be replaced with a more decentralized and less \"client configuration dependent\"? Maybe client can look at a specific address and tx, or to a smart contract, get hash of ENR tree from there and then download the client list from Swarm/IPFS?\r\n\r\nMaybe something using [EIP-2848](https://eips.ethereum.org/EIPS/eip-2848)? :)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/678236715/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/678815819",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-678815819",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 678815819,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODgxNTgxOQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-23T19:41:40Z",
    "updated_at": "2020-08-23T19:41:40Z",
    "author_association": "MEMBER",
    "body": "Which resolver software are you using in your VM? It sounds like there is a bug there, would like to confirm this.\r\n\r\n> Suggestion: maybe this discovery feature can be replaced with a more decentralized and less \"client configuration dependent\"? Maybe client can look at a specific address and tx, or to a smart contract, get hash of ENR tree from there and then download the client list from Swarm/IPFS?\r\n\r\nThe DNS-based discovery is the fallback option for the DHT, which is always enabled and is decentralized. We actually had the DHT first, the DNS-based discovery was added because not everyone can use the DHT.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/678815819/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/678861222",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-678861222",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 678861222,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODg2MTIyMg==",
    "user": {
      "login": "Neurone",
      "id": 562943,
      "node_id": "MDQ6VXNlcjU2Mjk0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/562943?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Neurone",
      "html_url": "https://github.com/Neurone",
      "followers_url": "https://api.github.com/users/Neurone/followers",
      "following_url": "https://api.github.com/users/Neurone/following{/other_user}",
      "gists_url": "https://api.github.com/users/Neurone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Neurone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Neurone/subscriptions",
      "organizations_url": "https://api.github.com/users/Neurone/orgs",
      "repos_url": "https://api.github.com/users/Neurone/repos",
      "events_url": "https://api.github.com/users/Neurone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Neurone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-24T01:40:09Z",
    "updated_at": "2020-08-24T01:40:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm using an Ubuntu 18.04.5 distro under Windows 10 via WSL. The virtual NIC is an _Hyper-V Virtual Ethernet Adapter_\r\n\r\n```bash\r\nEthernet adapter vEthernet (WSL):\r\n\r\n   Connection-specific DNS Suffix  . :\r\n   Description . . . . . . . . . . . : Hyper-V Virtual Ethernet Adapter\r\n   Physical Address. . . . . . . . . : 00-15-5D-E5-A9-47\r\n   DHCP Enabled. . . . . . . . . . . : No\r\n   Autoconfiguration Enabled . . . . : Yes\r\n   Link-local IPv6 Address . . . . . : fe80::5d92:dde2:14c1:abf4%24(Preferred)\r\n   IPv4 Address. . . . . . . . . . . : 172.28.176.1(Preferred)\r\n   Subnet Mask . . . . . . . . . . . : 255.255.240.0\r\n   Default Gateway . . . . . . . . . :\r\n   DHCPv6 IAID . . . . . . . . . . . : 402658653\r\n   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-24-90-8D-94-C8-60-00-CA-E9-ED\r\n   DNS Servers . . . . . . . . . . . : fec0:0:0:ffff::1%1\r\n                                       fec0:0:0:ffff::2%1\r\n                                       fec0:0:0:ffff::3%1\r\n   NetBIOS over Tcpip. . . . . . . . : Enabled\r\n```\r\n\r\nIt seems there are many unsolved DNS issues (i.e. https://github.com/microsoft/WSL/issues/4285, https://github.com/microsoft/WSL/issues/3268) for this configuration. I did other tests but the only way I can make geth works without problems is to set a _static_ DNS using this suggestion [Fix DNS resolution in WSL2](https://gist.github.com/coltenkrauter/608cfe02319ce60facd76373249b8ca6).\r\n\r\nI don't think this is an easy issue to solve, but maybe this workaround can be helpful for others.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/678861222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/678987689",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-678987689",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 678987689,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODk4NzY4OQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-24T08:31:34Z",
    "updated_at": "2020-08-24T08:31:34Z",
    "author_association": "MEMBER",
    "body": "Thank you. Maybe we should create an issue in the WSL repo then.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/678987689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/679447405",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-679447405",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 679447405,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3OTQ0NzQwNQ==",
    "user": {
      "login": "Neurone",
      "id": 562943,
      "node_id": "MDQ6VXNlcjU2Mjk0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/562943?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Neurone",
      "html_url": "https://github.com/Neurone",
      "followers_url": "https://api.github.com/users/Neurone/followers",
      "following_url": "https://api.github.com/users/Neurone/following{/other_user}",
      "gists_url": "https://api.github.com/users/Neurone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Neurone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Neurone/subscriptions",
      "organizations_url": "https://api.github.com/users/Neurone/orgs",
      "repos_url": "https://api.github.com/users/Neurone/repos",
      "events_url": "https://api.github.com/users/Neurone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Neurone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-25T01:22:11Z",
    "updated_at": "2020-08-25T01:22:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Thank you. Maybe we should create an issue in the WSL repo then.\r\n\r\nDone :) I hope they can do something about it even if I fear it can be a problem with Windows ICS (netsvcs). I think Hyper-V Virtual Adapter redirects queries to that under the hood, but if this is the case we are in the field of closed source so I cannot easily investigate any further.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/679447405/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/680264717",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21454#issuecomment-680264717",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21454",
    "id": 680264717,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MDI2NDcxNw==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-25T20:54:21Z",
    "updated_at": "2020-08-25T20:54:21Z",
    "author_association": "MEMBER",
    "body": "Very very cool. Thanks again for the detailed debugging, it was very helpful to isolate the issue. I'll close this one because it looks like this reproduces also with other domains.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/680264717/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
