{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21770",
  "id": 733563012,
  "node_id": "MDU6SXNzdWU3MzM1NjMwMTI=",
  "number": 21770,
  "title": "eth_getLogs returns wrong number of logs on goerli",
  "user": {
    "login": "pawanjay176",
    "id": 9890508,
    "node_id": "MDQ6VXNlcjk4OTA1MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pawanjay176",
    "html_url": "https://github.com/pawanjay176",
    "followers_url": "https://api.github.com/users/pawanjay176/followers",
    "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
    "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
    "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
    "repos_url": "https://api.github.com/users/pawanjay176/repos",
    "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1479386843,
      "node_id": "MDU6TGFiZWwxNDc5Mzg2ODQz",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/priority:1",
      "name": "priority:1",
      "color": "49babc",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2020-10-30T22:59:30Z",
  "updated_at": "2021-01-14T11:05:55Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `Geth/v1.9.23-stable-8c2f2715/linux-arm64/go1.15.3`\r\nOS & Version: Ubuntu 20.04\r\n\r\n#### Expected behaviour\r\n\r\nThe latest stable version is giving different number of logs for an `eth_getLogs` http request compared to the previous versions.\r\nFound this issue while trying to query the eth2 medalla testnet deposit contract logs on goerli. Following are the params for the rpc request:\r\n\r\n```\r\n[\r\n  {\r\n    \"address\": \"0x07b39F4fDE4A38bACe212b546dAc87C58DfE3fDC\",\r\n    \"topics\": [\r\n      \"0x649bbc62d0e31342afea4e5cd82d4049e7e1ee912fc0889aa790803be39038c5\"\r\n    ],\r\n    \"fromBlock\": \"0x35FC08\",\r\n    \"toBlock\": \"0x35FFF0\"\r\n  }\r\n]\r\n``` \r\nThe `eth_getLogs` request with the above params returned 120 logs in the latest version (Geth/v1.9.23-stable-8c2f2715/linux-arm64/go1.15.3) and 125 logs in an earlier version (Geth/v1.9.22-stable-c71a7e26/linux-amd64/go1.15.2). Both nodes are fast synced.\r\n\r\nPlease note that deleting the datadir and resyncing the geth node seems to fix the issue (gives correct number of logs for the above query)\r\n\r\n#### Actual behaviour\r\n\r\nShould always return correct number of logs.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nNon deterministic issue. Happening on a specific 1.9.23 goerli node. Other nodes of the same version return correct number of logs. \r\n\r\nI think this could be an issue with changes to the bloom filter in the latest version. Had a similar type of issue on nethermind a few months back https://github.com/NethermindEth/nethermind/issues/1980 which was an issue with bloom filters.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/725959626",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21770#issuecomment-725959626",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
    "id": 725959626,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNTk1OTYyNg==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-12T09:32:48Z",
    "updated_at": "2020-11-12T09:32:48Z",
    "author_association": "MEMBER",
    "body": "can you provide both sets of logs (the one with 120 and the one with 125)?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/725959626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/726029805",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21770#issuecomment-726029805",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
    "id": 726029805,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNjAyOTgwNQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-12T11:48:41Z",
    "updated_at": "2020-11-12T11:48:41Z",
    "author_association": "MEMBER",
    "body": "Tried to repro this, \r\n```\r\n$ cat getlogs.json\r\n{\r\n  \"method\": \"eth_getLogs\",\r\n  \"params\": [\r\n    {\r\n      \"address\": \"0x07b39F4fDE4A38bACe212b546dAc87C58DfE3fDC\",\r\n      \"topics\": [\r\n        \"0x649bbc62d0e31342afea4e5cd82d4049e7e1ee912fc0889aa790803be39038c5\"\r\n      ],\r\n      \"fromBlock\": \"0x35FC08\",\r\n      \"toBlock\": \"0x35FFF0\"\r\n    }\r\n  ],\r\n  \"id\": 1,\r\n  \"jsonrpc\": \"2.0\"\r\n}\r\n[user@work go-ethereum]$ curl --data @getlogs.json  -H \"Content-Type: application/json\" -X POST localhost:8545 2>/dev/null  | jq \".result | length\" \r\n125\r\n```\r\nIt produces the same `125` every time. \r\n\r\nMy theory is that the root cause may be that the bloom indexing is not finished (`eth/filters/filter.go`): \r\n```go\r\n\tif indexed := sections * size; indexed > uint64(f.begin) {\r\n\t\tif indexed > end {\r\n\t\t\tlogs, err = f.indexedLogs(ctx, end)\r\n\t\t} else {\r\n\t\t\tlogs, err = f.indexedLogs(ctx, indexed-1)\r\n```\r\n\r\nIt's a bit odd, API-wise, that we just silently truncate the range without any form of notification - one might have expected a server log message at least. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/726029805/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/726034011",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21770#issuecomment-726034011",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
    "id": 726034011,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNjAzNDAxMQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-12T11:58:06Z",
    "updated_at": "2020-11-12T11:58:06Z",
    "author_association": "MEMBER",
    "body": "Actually, my explanation doesn't fit. If the `to` is `0x35FFD8`, then the number of logs are `118`, but if one more block is included, (`0x35FFD9`), then the number of logs are `124`. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/726034011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/726046381",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21770#issuecomment-726046381",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
    "id": 726046381,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNjA0NjM4MQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-12T12:25:08Z",
    "updated_at": "2020-11-12T12:25:08Z",
    "author_association": "MEMBER",
    "body": "If the range is changed to       \r\n```\r\n\"fromBlock\": \"0x35FC13\",\r\n      \"toBlock\": \"0x35FFF0\"\r\n```\r\nThen it produces `120` logs. So it's almost like it's missing the logs for a few blocks in the beginning of the range. Very odd. \r\nIf you manage to repro this, and save the logs, so we can cross-check which ones are missing, it might be easier to figure out what's happening. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/726046381/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/726074872",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21770#issuecomment-726074872",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
    "id": 726074872,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNjA3NDg3Mg==",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-12T13:24:06Z",
    "updated_at": "2020-11-12T13:24:06Z",
    "author_association": "NONE",
    "body": "@holiman Sorry, but I don't have the full logs, just the counts. The issue was observed in a Lighthouse user's geth node. I asked him to run a script to get the log counts in a certain range in increments of 1000 and highlighted the one with the mismatch in the issue. I'll try to chase him up again to get the full logs from his node.\r\n\r\nHere are the log counts for his node vs my node if it's useful in any way. https://gist.github.com/pawanjay176/b7f2deab6af05e4bdd2c67651790e072\r\n\r\nLines 5 and 6 are different in data obtained from the two nodes, but everything above and below that are same.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/726074872/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/726078665",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21770#issuecomment-726078665",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
    "id": 726078665,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNjA3ODY2NQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-12T13:30:51Z",
    "updated_at": "2020-11-12T13:30:51Z",
    "author_association": "MEMBER",
    "body": "```\r\n31 logs in range: 3536928..3537928\r\n120 logs in range: 3537928..3538928\r\n```\r\nvs\r\n```\r\n80 logs in range: 3536928..3537928\r\n125 logs in range: 3537928..3538928\r\n```\r\nSo the upper one seems to be missing logs, `49` in one segment, and `5` in the segment after. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/726078665/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/728706548",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21770#issuecomment-728706548",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
    "id": 728706548,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODcwNjU0OA==",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-17T06:02:17Z",
    "updated_at": "2020-11-17T06:02:17Z",
    "author_association": "NONE",
    "body": "Hey @holiman . Unfortunately, the user resynced his node so I'm not able to get the full logs anymore.\r\n\r\nI'll try a few resyncs to see if I can reproduce the error. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/728706548/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/736714969",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21770#issuecomment-736714969",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
    "id": 736714969,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNjcxNDk2OQ==",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-01T17:49:31Z",
    "updated_at": "2020-12-01T17:49:31Z",
    "author_association": "NONE",
    "body": "@holiman \r\nSaw this issue again with an older version (Geth 1.9.16-stable) node on mainnet with one of our users.\r\nGot the logs this time though\r\nhttps://gist.github.com/pawanjay176/8cb38b296346ef56e621dfea29445e55\r\n\r\nUsed this request to get the logs in the range where there seemed to be deviation.\r\n```\r\ncurl --location --request POST 'http://localhost:8545' \\\r\n    --header 'Content-Type: application/json' \\\r\n    --data-raw '{\r\n    \"jsonrpc\":\"2.0\",\r\n    \"method\":\"eth_getLogs\",\r\n    \"params\":[{\"address\": \"0x00000000219ab540356cBB839Cbe05303d7705Fa\", \"topics\": [\"0x649bbc62d0e31342afea4e5cd82d4049e7e1ee912fc0889aa790803be39038c5\"], \"fromBlock\": \"0xAB6CDC\", \"toBlock\": \"0xAB8834\"}],\r\n    \"id\":1\r\n    }' | jq '.'\r\n```\r\nIdeally, this particular range should have 166 logs, the faulty node returns only 12.\r\nIn the gist, the `faulty_logs.json` contains the full logs from the faulty node. \r\n`count_diff.txt` is the diff of the counts between a correct geth node (left) and the faulty node (right). As you can see, it seems that the logs are missing only for a particular range of blocks.\r\n\r\nNot sure if this will help though since it's an older geth version :sweat_smile: \r\nLet me know if you need any other details. AFAIK, the user hasn't resynced his geth node yet.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/736714969/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760105180",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21770#issuecomment-760105180",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
    "id": 760105180,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MDEwNTE4MA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-14T10:26:46Z",
    "updated_at": "2021-01-14T10:26:46Z",
    "author_association": "MEMBER",
    "body": "Interesting. So the faulty one returns logs for these blocks:  \r\n```\r\n\"0xab6d14\"\r\n\"0xab85ee\"\r\n\"0xab8767\"\r\n\"0xab87a1\"\r\n\"0xab87cf\"\r\n\"0xab87d8\"\r\n\"0xab87e3\"\r\n\"0xab87ed\"\r\n\"0xab87fc\"\r\n\"0xab8805\"\r\n\"0xab8818\"\r\n\"0xab8825\"\r\n```\r\nThe correct one returns \r\n```\r\n\"0xab6d14\"\r\n// 153 omitted for brevity\r\n\"0xab85ee\"\r\n\"0xab8767\"\r\n\"0xab87a1\"\r\n\"0xab87cf\"\r\n\"0xab87d8\"\r\n\"0xab87e3\"\r\n\"0xab87ed\"\r\n\"0xab87fc\"\r\n\"0xab8805\"\r\n\"0xab8818\"\r\n\"0xab8825\"\r\n```\r\nSo `11234580` was included, `11235267 - 11240833` were skipped over, and `11240942` and onwards were included. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760105180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760125891",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21770#issuecomment-760125891",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21770",
    "id": 760125891,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MDEyNTg5MQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-14T11:05:54Z",
    "updated_at": "2021-01-14T11:05:54Z",
    "author_association": "MEMBER",
    "body": "Still, it doesn't seem to be the case that a particular segment is skipped: \r\n```\r\nBlock 11234580, segment: 2742 (start: 11231232 end 11235327)\r\nBlock 11235267, segment: 2742 (start: 11231232 end 11235327)\r\nBlock 11240833, segment: 2744 (start: 11239424 end 11243519)\r\nBlock 11240942, segment: 2744 (start: 11239424 end 11243519)\r\n```\r\nSome parts of segment `2742` was included, some parts of `2744`, nothing of `2743`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760125891/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
