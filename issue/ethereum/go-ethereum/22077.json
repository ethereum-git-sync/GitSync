{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22077",
  "id": 774910855,
  "node_id": "MDU6SXNzdWU3NzQ5MTA4NTU=",
  "number": 22077,
  "title": "Failing to unregister sync peer (which not registered)",
  "user": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    },
    {
      "id": 1380070748,
      "node_id": "MDU6TGFiZWwxMzgwMDcwNzQ4",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:p2p",
      "name": "area:p2p",
      "color": "ea9adb",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2020-12-26T17:54:12Z",
  "updated_at": "2021-06-03T03:52:39Z",
  "closed_at": "2021-02-02T08:44:36Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "version `instance=Geth/v1.9.26-unstable-b9012a03-20201223/linux-amd64/go1.15.3`\r\n\r\nIt's running latest develop, `--syncmode=snap --snapshot`. I just restarted it after having done a pruning. It keeps saying complaining about failing to unregister a peer that it for some reason thinks it's connected to, while it apparently is not. \r\n\r\n\r\n```\r\nINFO [12-26|18:50:25.988] Loaded most recent local fast block      number=11463108 hash=\"89843c…4d8041\" td=19437194618159153682305 age=1w3d9h\r\nINFO [12-26|18:50:25.989] Loaded last fast-sync pivot marker       number=11418122\r\nINFO [12-26|18:50:25.996] Loaded local transaction journal         transactions=0 dropped=0\r\nINFO [12-26|18:50:25.996] Regenerated local transaction journal    transactions=0 accounts=0\r\nWARN [12-26|18:50:25.996] Switch sync mode from fast sync to full sync \r\nINFO [12-26|18:50:25.997] Starting peer-to-peer node               instance=Geth/v1.9.26-unstable-b9012a03-20201223/linux-amd64/go1.15.3\r\nINFO [12-26|18:50:26.028] New local node record                    seq=8 id=61673c8231752e60 ip=127.0.0.1 udp=30303 tcp=30303\r\nINFO [12-26|18:50:26.028] Started P2P networking                   self=enode://cc44695159f742595bf2fd9a9da13535733836c71cd5ca1179d76c11b95565f37c8014db177e90c9d7907b3a17439b3f51949c2144adbe4fef0e615d11900ca8@127.0.0.1:30303\r\nINFO [12-26|18:50:26.029] IPC endpoint opened                      url=/home/martin/.ethereum/geth.ipc\r\nERROR[12-26|18:50:26.961] Failed to unregister sync peer           peer=8d1da4c5bc682f8f err=\"peer is not registered\"\r\nERROR[12-26|18:50:26.961] Peer removal failed                      peer=8d1da4c5bc682f8f8ad141f60d2889fa4232144c7d2b29b88f81ca33e586ef9d err=\"peer not registered\"\r\nINFO [12-26|18:50:28.747] Mapped network port                      proto=tcp extport=30303 intport=30303 interface=\"UPNP IGDv2-IP1\"\r\nINFO [12-26|18:50:28.969] New local node record                    seq=9 id=61673c8231752e60 ip=<nil>     udp=30303 tcp=30303\r\nINFO [12-26|18:50:29.158] Mapped network port                      proto=udp extport=30303 intport=30303 interface=\"UPNP IGDv2-IP1\"\r\nINFO [12-26|18:50:36.190] Looking for peers                        peercount=1 tried=26 static=0\r\nINFO [12-26|18:50:46.191] Looking for peers                        peercount=0 tried=44 static=0\r\nINFO [12-26|18:50:56.256] Looking for peers                        peercount=0 tried=48 static=0\r\nINFO [12-26|18:51:03.609] Block synchronisation started \r\nWARN [12-26|18:51:03.609] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nERROR[12-26|18:51:03.609] Failed to unregister sync peer           peer=8d1da4c5bc682f8f err=\"peer is not registered\"\r\nERROR[12-26|18:51:03.609] Peer removal failed                      peer=8d1da4c5bc682f8f8ad141f60d2889fa4232144c7d2b29b88f81ca33e586ef9d err=\"peer not registered\"\r\nINFO [12-26|18:51:06.258] Looking for peers                        peercount=0 tried=46 static=0\r\nINFO [12-26|18:51:16.283] Looking for peers                        peercount=1 tried=51 static=0\r\nINFO [12-26|18:51:26.297] Looking for peers                        peercount=2 tried=27 static=0\r\nINFO [12-26|18:51:36.302] Looking for peers                        peercount=2 tried=73 static=0\r\nERROR[12-26|18:51:41.178] Failed to unregister sync peer           peer=8d1da4c5bc682f8f err=\"peer is not registered\"\r\nERROR[12-26|18:51:41.178] Peer removal failed                      peer=8d1da4c5bc682f8f8ad141f60d2889fa4232144c7d2b29b88f81ca33e586ef9d err=\"peer not registered\"\r\n```\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/751713658",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-751713658",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 751713658,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MTcxMzY1OA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-28T13:32:29Z",
    "updated_at": "2020-12-28T13:32:29Z",
    "author_association": "MEMBER",
    "body": "This is funky! I restarted a totally different machine, `bench03`, and it's complaining about the _exact same peer_ `8d1da4c5bc682f8f`:\r\n```\r\n Dec 28 14:23:33 bench03.ethdevops.io geth INFO [12-28|13:23:33.834] HTTP server started endpoint=[::]:8545 cors=* vhosts=*\r\nDec 28 14:23:33 bench03.ethdevops.io geth INFO [12-28|13:23:33.834] Stats daemon started\r\nDec 28 14:23:40 bench03.ethdevops.io geth INFO [12-28|13:23:40.121] Block synchronisation started\r\nDec 28 14:23:43 bench03.ethdevops.io geth INFO [12-28|13:23:43.868] Looking for peers peercount=10 tried=49 static=0\r\nDec 28 14:23:53 bench03.ethdevops.io geth INFO [12-28|13:23:53.880] Looking for peers peercount=13 tried=51 static=0\r\nDec 28 14:24:04 bench03.ethdevops.io geth INFO [12-28|13:24:03.971] Looking for peers peercount=19 tried=48 static=0\r\nDec 28 14:24:10 bench03.ethdevops.io geth ERROR[12-28|13:24:10.492] Snap peer not registered id=8d1da4c5bc682f8f8ad141f60d2889fa4232144c7d2b29b88f81ca33e586ef9d\r\nDec 28 14:24:10 bench03.ethdevops.io geth ERROR[12-28|13:24:10.493] Peer removal failed peer=8d1da4c5bc682f8f8ad141f60d2889fa4232144c7d2b29b88f81ca33e586ef9d err=\"peer not registered\"\r\nDec 28 14:24:14 bench03.ethdevops.io geth INFO [12-28|13:24:14.144] Looking for peers peercount=23 tried=32 static=0\r\nDec 28 14:24:18 bench03.ethdevops.io geth WARN [12-28|13:24:18.199] Header broke chain ordering number=11542707 hash=\"2573a0…4e06e5\" expected=11542699\r\nDec 28 14:24:18 bench03.ethdevops.io geth INFO [12-28|13:24:18.199] Downloader queue stats receiptTasks=0 blockTasks=0 itemSize=0.00B throttle=8192\r\nDec 28 14:24:18 bench03.ethdevops.io geth WARN [12-28|13:24:18.200] Synchronisation failed, dropping peer peer=a00ddd1b3c27c131f855373f2154939ee27326ca13ec062d696e3caebd49db28 err=\"action from bad peer ignored: stale headers\"\r\nDec 28 14:24:24 bench03.ethdevops.io geth INFO [12-28|13:24:24.290] Looking for peers peercount=27 tried=54 static=0\r\nDec 28 14:24:34 bench03.ethdevops.io geth WARN [12-28|13:24:34.290] Checkpoint challenge timed out, dropping id=45dabcff84b0bdb2 conn=inbound addr=47.242.166.155:53518 type=Geth/v1.9.24-stable-...\r\nDec 28 14:24:34 bench03.ethdevops.io geth INFO [12-28|13:24:34.290] Looking for peers peercount=30 tried=52 static=0\r\nDec 28 14:24:44 bench03.ethdevops.io geth INFO [12-28|13:24:44.476] Looking for peers peercount=35 tried=49 static=0\r\nDec 28 14:24:54 bench03.ethdevops.io geth INFO [12-28|13:24:54.652] Looking for peers peercount=36 tried=43 static=0\r\nDec 28 14:25:04 bench03.ethdevops.io geth INFO [12-28|13:25:04.654] Looking for peers peercount=36 tried=53 static=0\r\nDec 28 14:25:23 bench03.ethdevops.io geth ERROR[12-28|13:25:23.023] Failed to unregister sync peer peer=8d1da4c5bc682f8f err=\"peer is not registered\"\r\nDec 28 14:25:23 bench03.ethdevops.io geth ERROR[12-28|13:25:23.023] Peer removal failed peer=8d1da4c5bc682f8f8ad141f60d2889fa4232144c7d2b29b88f81ca33e586ef9d err=\"peer not registered\"\r\nDec 28 14:26:38 bench03.ethdevops.io geth ERROR[12-28|13:26:37.944] Failed to unregister sync peer peer=8d1da4c5bc682f8f err=\"peer is not registered\"\r\nDec 28 14:26:38 bench03.ethdevops.io geth ERROR[12-28|13:26:37.944] Peer removal failed peer=8d1da4c5bc682f8f8ad141f60d2889fa4232144c7d2b29b88f81ca33e586ef9d err=\"peer not registered\" \r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/751713658/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/751724785",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-751724785",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 751724785,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MTcyNDc4NQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-28T14:10:24Z",
    "updated_at": "2020-12-28T14:10:24Z",
    "author_association": "MEMBER",
    "body": "A third machine is flipping between \"is it registered or not?\"\r\n```\r\n Dec 28 15:03:28 bench04.ethdevops.io geth INFO [12-28|14:03:28.007] Imported new chain segment blocks=1 txs=206 mgas=12.253 elapsed=107.732ms mgasps=113.732 number=11542877 hash=\"2199ff…9f43b5\" dirty=36.82MiB\r\nDec 28 15:03:35 bench04.ethdevops.io geth INFO [12-28|14:03:34.964] Imported new chain segment blocks=1 txs=212 mgas=12.480 elapsed=213.800ms mgasps=58.373 number=11542878 hash=\"d7ed89…ee3c72\" dirty=38.48MiB\r\nDec 28 15:03:38 bench04.ethdevops.io geth ERROR[12-28|14:03:38.567] Failed to unregister sync peer peer=8d1da4c5bc682f8f err=\"peer is not registered\"\r\nDec 28 15:03:49 bench04.ethdevops.io geth INFO [12-28|14:03:49.940] Imported new chain segment blocks=1 txs=242 mgas=12.505 elapsed=121.610ms mgasps=102.832 number=11542879 hash=\"c0aa0d…edbd97\" dirty=40.27MiB\r\nDec 28 15:04:19 bench04.ethdevops.io geth INFO [12-28|14:04:19.403] Deep froze chain segment blocks=4 elapsed=5.049ms number=11452879 hash=\"804cce…533236\"\r\nDec 28 15:04:20 bench04.ethdevops.io geth ERROR[12-28|14:04:20.047] Failed to register sync peer peer=8d1da4c5bc682f8f err=\"peer is already registered\"\r\nDec 28 15:04:35 bench04.ethdevops.io geth INFO [12-28|14:04:35.100] Imported new chain segment blocks=1 txs=221 mgas=12.491 elapsed=121.899ms mgasps=102.468 nu\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/751724785/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/756124310",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-756124310",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 756124310,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjEyNDMxMA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-07T13:43:25Z",
    "updated_at": "2021-01-07T13:43:37Z",
    "author_association": "MEMBER",
    "body": "The `eth/downloader/peer.go` has a `peerSet` like this:\r\n\r\n```golang\r\ntype peerSet struct {\r\n\tpeers        map[string]*peerConnection\r\n\tnewPeerFeed  event.Feed\r\n\tpeerDropFeed event.Feed\r\n\tlock         sync.RWMutex\r\n}\r\n```\r\nWhereas teh `eth/peerset.go` has it a bit differently, where the two are\r\nsplit up into two different types of peers:\r\n```golang\r\ntype peerSet struct {\r\n\tethPeers  map[string]*ethPeer  // Peers connected on the `eth` protocol\r\n\tsnapPeers map[string]*snapPeer // Peers connected on the `snap` protocol\r\n```\r\n\r\nThe method in the `eth/handler` to remove a peer does this,\r\n1. Check if it's an `eth` peer, if so, tells the downloader to remove it.\r\n2. Checks if it's a `snap` peers, if so, tells the downloader.SnapSyncer to remove it\r\n\r\n```golang\r\nfunc (h *handler) removePeer(id string) {\r\n\t// Remove the eth peer if it exists\r\n\teth := h.peers.ethPeer(id)\r\n\tif eth != nil {\r\n\t\tlog.Debug(\"Removing Ethereum peer\", \"peer\", id)\r\n\t\th.downloader.UnregisterPeer(id)\r\n\t\th.txFetcher.Drop(id)\r\n\r\n\t\tif err := h.peers.unregisterEthPeer(id); err != nil {\r\n\t\t\tlog.Error(\"Peer removal failed\", \"peer\", id, \"err\", err)\r\n\t\t}\r\n\t}\r\n\t// Remove the snap peer if it exists\r\n\tsnap := h.peers.snapPeer(id)\r\n\tif snap != nil {\r\n\t\tlog.Debug(\"Removing Snapshot peer\", \"peer\", id)\r\n\t\th.downloader.SnapSyncer.Unregister(id)\r\n\t\tif err := h.peers.unregisterSnapPeer(id); err != nil {\r\n\t\t\tlog.Error(\"Peer removal failed\", \"peer\", id, \"err\", err)\r\n\t\t}\r\n\t}\r\n\r\n```\r\nSomething isn't quite right with the accounting of peers here, and the special\r\nsnowflake `8d1da4c5bc682f8f` is triggering something wonky",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/756124310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/757859996",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-757859996",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 757859996,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1Nzg1OTk5Ng==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-11T10:28:54Z",
    "updated_at": "2021-01-11T10:28:54Z",
    "author_association": "MEMBER",
    "body": "Interesting.. From https://github.com/ethereum/go-ethereum/issues/22151 : \r\n```\r\nWARN [01-10|19:19:35.325] Synchronisation failed, dropping peer    peer=8d1da4c5bc682f8f8ad141f60d2889fa4232144c7d2b29b88f81ca33e586ef9d err=timeout\r\n```\r\nWhat's with that `8d1da4c5bc682f8f8ad141f60d2889fa4232144c7d2b29b88f81ca33e586ef9d` node ? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/757859996/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760085799",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-760085799",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 760085799,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MDA4NTc5OQ==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-14T09:51:56Z",
    "updated_at": "2021-01-14T09:51:56Z",
    "author_association": "MEMBER",
    "body": "related #21257",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760085799/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760089333",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-760089333",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 760089333,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MDA4OTMzMw==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-14T09:58:21Z",
    "updated_at": "2021-01-14T09:59:29Z",
    "author_association": "MEMBER",
    "body": "This issue happens because `removePeer` in handler.go is racy:\r\n\r\nIf two goroutines call `removePeer`, they will both check the eth peer set and find the peer. Both goroutines will then call `downloader.UnregisterPeer`, and one of them will print this log message. The actual removal of the peer happens in a different goroutine.\r\n\r\nWe can fix this by refactoring the peer unregistration a bit. At the moment, we pass the `removePeer` method into the downloader as the `dropPeer` callback. The downloader should just call `Disconnect` on the peer instead of `removePeer`.\r\nThe only place that should unregister peers on downloader is the eth handler loop, when it exits. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760089333/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/763807278",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-763807278",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 763807278,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MzgwNzI3OA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-20T17:24:41Z",
    "updated_at": "2021-01-20T17:24:41Z",
    "author_association": "MEMBER",
    "body": "@fjl want to handle this? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/763807278/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/790200212",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-790200212",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 790200212,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDIwMDIxMg==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-04T01:01:39Z",
    "updated_at": "2021-03-04T01:03:10Z",
    "author_association": "NONE",
    "body": "I'm seeing Geth 1.10.0 throw a few similar errors (after upgrading from 1.9.25)\r\n\r\n```\r\nWARN [03-04|00:50:44.955] Checkpoint challenge timed out, dropping id=9993b5647ff6a1c0 conn=dyndial addr=X.X.X.X:30303 type\r\n=Geth/v1.9.23-stable-...\r\nERROR[03-04|00:50:44.956] Ethereum peer removal failed             peer=9993b564 err=\"peer not registered\"\r\n```\r\n\r\n```\r\nWARN [03-04|00:51:29.956] Synchronisation failed, dropping peer    peer=9993b5647ff6a1c00a44118e9030e2339812f58505e906a0d7c3dd7091308158 err=timeout\r\nERROR[03-04|00:51:29.956] Ethereum peer removal failed             peer=9993b564 err=\"peer not registered\"\r\n```\r\n\r\n^For the same peer, a few seconds apart.\r\n\r\nFor a different peer:\r\n\r\n```\r\nWARN [03-04|00:51:06.927] Checkpoint challenge timed out, dropping id=d597cf322d40ad8c conn=dyndial addr=X.X.X.X:30303 typ\r\ne=Geth/v1.9.25-stable-...\r\nERROR[03-04|00:51:06.927] Ethereum peer removal failed             peer=d597cf32 err=\"peer not registered\"\r\n```\r\n\r\nThe only slightly naughty thing I did was run the new `geth db inspect` command before starting properly with 1.10.0, which tried to start constructing a snapshot, so I Ctrl-C'd it (although I suspect that's not related to this issue).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/790200212/reactions",
      "total_count": 10,
      "+1": 4,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 6
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853516727",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-853516727",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 853516727,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzUxNjcyNw==",
    "user": {
      "login": "superbeanmr",
      "id": 32116764,
      "node_id": "MDQ6VXNlcjMyMTE2NzY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/32116764?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/superbeanmr",
      "html_url": "https://github.com/superbeanmr",
      "followers_url": "https://api.github.com/users/superbeanmr/followers",
      "following_url": "https://api.github.com/users/superbeanmr/following{/other_user}",
      "gists_url": "https://api.github.com/users/superbeanmr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/superbeanmr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/superbeanmr/subscriptions",
      "organizations_url": "https://api.github.com/users/superbeanmr/orgs",
      "repos_url": "https://api.github.com/users/superbeanmr/repos",
      "events_url": "https://api.github.com/users/superbeanmr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/superbeanmr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-03T02:38:38Z",
    "updated_at": "2021-06-03T02:38:38Z",
    "author_association": "NONE",
    "body": "\r\n![微信图片_20210603103352](https://user-images.githubusercontent.com/32116764/120577758-58720b80-c457-11eb-870f-8cc3384e211a.png)\r\n\r\nI was synchronizing the ropsten node, and when there were dozens of blocks, I checked the synchronization log and found that it was easy to insert the error in the figure below every few logs. Can someone tell me how to deal with the change?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853516727/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 2
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853517296",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-853517296",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 853517296,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzUxNzI5Ng==",
    "user": {
      "login": "superbeanmr",
      "id": 32116764,
      "node_id": "MDQ6VXNlcjMyMTE2NzY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/32116764?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/superbeanmr",
      "html_url": "https://github.com/superbeanmr",
      "followers_url": "https://api.github.com/users/superbeanmr/followers",
      "following_url": "https://api.github.com/users/superbeanmr/following{/other_user}",
      "gists_url": "https://api.github.com/users/superbeanmr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/superbeanmr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/superbeanmr/subscriptions",
      "organizations_url": "https://api.github.com/users/superbeanmr/orgs",
      "repos_url": "https://api.github.com/users/superbeanmr/repos",
      "events_url": "https://api.github.com/users/superbeanmr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/superbeanmr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-03T02:40:14Z",
    "updated_at": "2021-06-03T02:40:14Z",
    "author_association": "NONE",
    "body": "WARN [06-03|02:38:16.714] Ancestor below allowance                 peer=465c4021 number=10,263,739 hash=000000..000000 allowance=10,263,739\r\nWARN [06-03|02:38:16.714] Synchronisation failed, dropping peer    peer=465c4021eb888a6ef93709761a3a502f6d200cc94e3e810467b5a96f5bb4fa8a err=\"retrieved ancestor is invalid\"\r\nERROR[06-03|02:38:16.715] Ethereum peer removal failed             peer=465c4021 err=\"peer not registered\"",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853517296/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853541419",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22077#issuecomment-853541419",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22077",
    "id": 853541419,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzU0MTQxOQ==",
    "user": {
      "login": "superbeanmr",
      "id": 32116764,
      "node_id": "MDQ6VXNlcjMyMTE2NzY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/32116764?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/superbeanmr",
      "html_url": "https://github.com/superbeanmr",
      "followers_url": "https://api.github.com/users/superbeanmr/followers",
      "following_url": "https://api.github.com/users/superbeanmr/following{/other_user}",
      "gists_url": "https://api.github.com/users/superbeanmr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/superbeanmr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/superbeanmr/subscriptions",
      "organizations_url": "https://api.github.com/users/superbeanmr/orgs",
      "repos_url": "https://api.github.com/users/superbeanmr/repos",
      "events_url": "https://api.github.com/users/superbeanmr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/superbeanmr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-03T03:52:39Z",
    "updated_at": "2021-06-03T03:52:39Z",
    "author_association": "NONE",
    "body": "The above error occurs when Generating state snapshot",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853541419/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  }
]
