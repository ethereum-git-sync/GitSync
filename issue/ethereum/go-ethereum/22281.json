{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22281",
  "id": 803112009,
  "node_id": "MDU6SXNzdWU4MDMxMTIwMDk=",
  "number": 22281,
  "title": "SIGSEGV with $ geth --syncmode \"fast\"",
  "user": {
    "login": "zoltan-fedor",
    "id": 3887295,
    "node_id": "MDQ6VXNlcjM4ODcyOTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3887295?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zoltan-fedor",
    "html_url": "https://github.com/zoltan-fedor",
    "followers_url": "https://api.github.com/users/zoltan-fedor/followers",
    "following_url": "https://api.github.com/users/zoltan-fedor/following{/other_user}",
    "gists_url": "https://api.github.com/users/zoltan-fedor/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zoltan-fedor/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zoltan-fedor/subscriptions",
    "organizations_url": "https://api.github.com/users/zoltan-fedor/orgs",
    "repos_url": "https://api.github.com/users/zoltan-fedor/repos",
    "events_url": "https://api.github.com/users/zoltan-fedor/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zoltan-fedor/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2021-02-08T01:05:36Z",
  "updated_at": "2022-09-16T15:59:12Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth version`\r\nGeth\r\nVersion: 1.9.25-stable\r\nGit Commit: e7872729012a4871397307b12cc3f4772ffcbec6\r\nArchitecture: amd64\r\nProtocol Versions: [65 64 63]\r\nGo Version: go1.15.6\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=go\r\n\r\nOS & Version: Linux\r\nCommit hash : (if `develop`)\r\n\r\n#### Expected behaviour\r\nNot segfaulting.\r\n\r\n#### Actual behaviour\r\nI am running `$ geth --syncmode \"fast\" ` on Linux Mint inside a VirtualBox VM and I repeatedly get a segfault:\r\n```\r\nINFO [02-07|19:29:34.845] Looking for peers                        peercount=1 tried=4 static=0\r\nINFO [02-07|19:29:34.850] Imported new block receipts              count=190  elapsed=44.408ms    number=376235   hash=\"ed4407…7e41a2\" age=5y4mo3w   size=151.17KiB\r\nWARN [02-07|19:29:34.917] Invalid header encountered               number=376479   hash=\"ffbb90…fe947a\" parent=\"1fa79e…2a570b\" err=\"invalid mix digest\"\r\nWARN [02-07|19:29:34.918] Rewinding blockchain                     target=374378\r\nINFO [02-07|19:29:34.972] Imported new state entries               count=768  elapsed=2.313ms     processed=874087 pending=28420 trieretry=0 coderetry=0 duplicate=0 unexpected=0\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x78ec7a]\r\n\r\ngoroutine 833 [running]:\r\ngithub.com/ethereum/go-ethereum/core/types.(*Block).Header(...)\r\n\tgithub.com/ethereum/go-ethereum/core/types/block.go:343\r\ngithub.com/ethereum/go-ethereum/core/rawdb.WriteAncientBlock(0x7f4648ffa6d8, 0xc000174a20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/core/rawdb/accessors_chain.go:660 +0x3a\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).InsertReceiptChain.func2(0xc00b141000, 0xc0, 0x100, 0xc0071c2800, 0xc0, 0x100, 0x0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/core/blockchain.go:1236 +0x4ae\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).InsertReceiptChain(0xc0000a5900, 0xc00b25a000, 0xc0, 0xc0, 0xc000154c00, 0xc0, 0xc0, 0xacffff, 0x0, 0x0, ...)\r\n\tgithub.com/ethereum/go-ethereum/core/blockchain.go:1407 +0x1cca\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).commitFastSyncData(0xc0000c1dc0, 0xc007c93800, 0xc0, 0xc0, 0xc0007ae280, 0xc007c93800, 0xc0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:1880 +0x663\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).processFastSyncContent(0xc0000c1dc0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:1796 +0x785\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).syncWithPeer.func7(0x1, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:554 +0x2a\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync.func1(0xc0000c1dc0, 0xc0007ad440, 0xc0002ec3f0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:568 +0x5b\r\ncreated by github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:568 +0xaf\r\n\r\n```\r\n\r\nMemory test shows everything is okey:\r\n```\r\n$ sudo memtester 6800M 2\r\nmemtester version 4.3.0 (64-bit)\r\nCopyright (C) 2001-2012 Charles Cazabon.\r\nLicensed under the GNU General Public License version 2 (only).\r\n\r\npagesize is 4096\r\npagesizemask is 0xfffffffffffff000\r\nwant 6800MB (7130316800 bytes)\r\ngot  6800MB (7130316800 bytes), trying mlock ...locked.\r\nLoop 1/2:\r\n  Stuck Address       : ok         \r\n  Random Value        : ok\r\n  Compare XOR         : ok\r\n  Compare SUB         : ok\r\n  Compare MUL         : ok\r\n  Compare DIV         : ok\r\n  Compare OR          : ok\r\n  Compare AND         : ok\r\n  Sequential Increment: ok\r\n  Solid Bits          : ok         \r\n  Block Sequential    : ok         \r\n  Checkerboard        : ok         \r\n  Bit Spread          : ok         \r\n  Bit Flip            : ok         \r\n  Walking Ones        : ok         \r\n  Walking Zeroes      : ok         \r\n  8-bit Writes        : ok\r\n```\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\nRun:\r\n`$ geth --syncmode \"fast\" `\r\n\r\n#### Backtrace\r\n\r\n````\r\ngoroutine 833 [running]:\r\ngithub.com/ethereum/go-ethereum/core/types.(*Block).Header(...)\r\n\tgithub.com/ethereum/go-ethereum/core/types/block.go:343\r\ngithub.com/ethereum/go-ethereum/core/rawdb.WriteAncientBlock(0x7f4648ffa6d8, 0xc000174a20, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/core/rawdb/accessors_chain.go:660 +0x3a\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).InsertReceiptChain.func2(0xc00b141000, 0xc0, 0x100, 0xc0071c2800, 0xc0, 0x100, 0x0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/core/blockchain.go:1236 +0x4ae\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).InsertReceiptChain(0xc0000a5900, 0xc00b25a000, 0xc0, 0xc0, 0xc000154c00, 0xc0, 0xc0, 0xacffff, 0x0, 0x0, ...)\r\n\tgithub.com/ethereum/go-ethereum/core/blockchain.go:1407 +0x1cca\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).commitFastSyncData(0xc0000c1dc0, 0xc007c93800, 0xc0, 0xc0, 0xc0007ae280, 0xc007c93800, 0xc0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:1880 +0x663\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).processFastSyncContent(0xc0000c1dc0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:1796 +0x785\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).syncWithPeer.func7(0x1, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:554 +0x2a\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync.func1(0xc0000c1dc0, 0xc0007ad440, 0xc0002ec3f0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:568 +0x5b\r\ncreated by github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawn\r\n````\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/775010491",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22281#issuecomment-775010491",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
    "id": 775010491,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTAxMDQ5MQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-08T09:38:23Z",
    "updated_at": "2021-02-08T09:38:23Z",
    "author_association": "MEMBER",
    "body": "Interesting. The code path which panics is this: \r\n```golang\r\n\t\t\t// Migrate all ancient blocks. This can happen if someone upgrades from Geth\r\n\t\t\t// 1.8.x to 1.9.x mid-fast-sync. Perhaps we can get rid of this path in the\r\n\t\t\t// long term.\r\n\t\t\tfor {\r\n\t\t\t\t// We can ignore the error here since light client won't hit this code path.\r\n\t\t\t\tfrozen, _ := bc.db.Ancients()\r\n\t\t\t\tif frozen >= block.NumberU64() {\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t\t\th := rawdb.ReadCanonicalHash(bc.db, frozen)\r\n\t\t\t\tb := rawdb.ReadBlock(bc.db, h, frozen)\r\n\t\t\t\tsize += rawdb.WriteAncientBlock(bc.db, b, rawdb.ReadReceipts(bc.db, h, frozen, bc.chainConfig), rawdb.ReadTd(bc.db, h, frozen))\r\n\r\n```\r\nAnd just prior to the crash, we have this: \r\n```\r\nWARN [02-07|19:29:34.917] Invalid header encountered               number=376479   hash=\"ffbb90…fe947a\" parent=\"1fa79e…2a570b\" err=\"invalid mix digest\"\r\nWARN [02-07|19:29:34.918] Rewinding blockchain                     target=374378\r\n\r\n```\r\nSo it looks to me like a rollback during the receipt-sync races with the background freezer, on a path which is not really intended to be used in normal mode. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/775010491/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/775504000",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22281#issuecomment-775504000",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
    "id": 775504000,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTUwNDAwMA==",
    "user": {
      "login": "zoltan-fedor",
      "id": 3887295,
      "node_id": "MDQ6VXNlcjM4ODcyOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3887295?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zoltan-fedor",
      "html_url": "https://github.com/zoltan-fedor",
      "followers_url": "https://api.github.com/users/zoltan-fedor/followers",
      "following_url": "https://api.github.com/users/zoltan-fedor/following{/other_user}",
      "gists_url": "https://api.github.com/users/zoltan-fedor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zoltan-fedor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zoltan-fedor/subscriptions",
      "organizations_url": "https://api.github.com/users/zoltan-fedor/orgs",
      "repos_url": "https://api.github.com/users/zoltan-fedor/repos",
      "events_url": "https://api.github.com/users/zoltan-fedor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zoltan-fedor/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-08T22:24:22Z",
    "updated_at": "2021-02-08T22:24:22Z",
    "author_association": "NONE",
    "body": "Yes, and I keep getting this at different points in the sync.\r\nSee the same error below at a later point in the sync compared to the one above.\r\n\r\n```\r\nINFO [02-08|01:26:34.197] Imported new block receipts              count=56   elapsed=140.396ms   number=4647129  hash=\"13999e…8e9155\" age=3y2mo3w   size=1.66MiB\r\nWARN [02-08|01:26:35.198] Invalid header encountered               number=4650064  hash=\"1f5928…4a6a0d\" parent=\"b879e4…273f01\" err=\"invalid mix digest\"\r\nWARN [02-08|01:26:35.199] Rewinding blockchain                     target=4645967\r\nINFO [02-08|01:26:35.848] Imported new state entries               count=768  elapsed=4.232ms     processed=17600224 pending=18943  trieretry=0   coderetry=0 duplicate=741 unexpected=5381\r\nINFO [02-08|01:26:36.372] Rewind ancient data                      number=4646711\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x78ec7a]\r\n\r\ngoroutine 195860 [running]:\r\ngithub.com/ethereum/go-ethereum/core/types.(*Block).Header(...)\r\n\tgithub.com/ethereum/go-ethereum/core/types/block.go:343\r\ngithub.com/ethereum/go-ethereum/core/rawdb.WriteAncientBlock(0x7f8d61f22d80, 0xc0001f6300, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/core/rawdb/accessors_chain.go:660 +0x3a\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).InsertReceiptChain.func2(0xc085177200, 0x39, 0x40, 0xc002bdcc00, 0x39, 0x40, 0x0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/core/blockchain.go:1236 +0x4ae\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).InsertReceiptChain(0xc0000a5900, 0xc0a2ef2000, 0x39, 0x39, 0xc099feb700, 0x39, 0x39, 0xacffff, 0x0, 0x0, ...)\r\n\tgithub.com/ethereum/go-ethereum/core/blockchain.go:1407 +0x1cca\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).commitFastSyncData(0xc0009a61c0, 0xc0a76ede00, 0x39, 0x39, 0xc0886eb0e0, 0xc0a76ede00, 0x39)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:1880 +0x663\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).processFastSyncContent(0xc0009a61c0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:1796 +0x785\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).syncWithPeer.func7(0xc097fec870, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:554 +0x2a\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync.func1(0xc0009a61c0, 0xc088b1d620, 0xc01df5a540)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:568 +0x5b\r\ncreated by github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:568 +0xaf\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/775504000/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/775750668",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22281#issuecomment-775750668",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
    "id": 775750668,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTc1MDY2OA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T08:07:27Z",
    "updated_at": "2021-02-09T08:07:27Z",
    "author_association": "MEMBER",
    "body": "There seems to be two problems here. First of all, \r\n```\r\nnumber=376479   hash=\"ffbb90…fe947a\" parent=\"1fa79e…2a570b\" err=\"invalid mix digest\"\r\n```\r\nThis is a canon block:https://etherscan.io/block/376479 , so something is wrong on your machine. I would assume it's related to disk errors, and that the dag caches are somehow corrupt. I would recommend you to run some disk verification utility. \r\n\r\nThe other problem is that a rollback during fast-sync is causing `panic`. However, it seems to be happening at different codepaths, so might actually be caused by the same root issue, if there are disk errors.  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/775750668/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/775976446",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22281#issuecomment-775976446",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
    "id": 775976446,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTk3NjQ0Ng==",
    "user": {
      "login": "zoltan-fedor",
      "id": 3887295,
      "node_id": "MDQ6VXNlcjM4ODcyOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3887295?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zoltan-fedor",
      "html_url": "https://github.com/zoltan-fedor",
      "followers_url": "https://api.github.com/users/zoltan-fedor/followers",
      "following_url": "https://api.github.com/users/zoltan-fedor/following{/other_user}",
      "gists_url": "https://api.github.com/users/zoltan-fedor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zoltan-fedor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zoltan-fedor/subscriptions",
      "organizations_url": "https://api.github.com/users/zoltan-fedor/orgs",
      "repos_url": "https://api.github.com/users/zoltan-fedor/repos",
      "events_url": "https://api.github.com/users/zoltan-fedor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zoltan-fedor/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T14:23:33Z",
    "updated_at": "2021-02-09T14:23:33Z",
    "author_association": "NONE",
    "body": "I just run fsck and no issue was found.\r\nBut it is true, that this a a VirtualBox VM where the disk is hosted on a LUKS-encrypted volume. Maybe that's why the occasional errors?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/775976446/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/775989404",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22281#issuecomment-775989404",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
    "id": 775989404,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTk4OTQwNA==",
    "user": {
      "login": "zoltan-fedor",
      "id": 3887295,
      "node_id": "MDQ6VXNlcjM4ODcyOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3887295?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zoltan-fedor",
      "html_url": "https://github.com/zoltan-fedor",
      "followers_url": "https://api.github.com/users/zoltan-fedor/followers",
      "following_url": "https://api.github.com/users/zoltan-fedor/following{/other_user}",
      "gists_url": "https://api.github.com/users/zoltan-fedor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zoltan-fedor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zoltan-fedor/subscriptions",
      "organizations_url": "https://api.github.com/users/zoltan-fedor/orgs",
      "repos_url": "https://api.github.com/users/zoltan-fedor/repos",
      "events_url": "https://api.github.com/users/zoltan-fedor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zoltan-fedor/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-09T14:41:16Z",
    "updated_at": "2021-02-09T14:41:50Z",
    "author_association": "NONE",
    "body": "Unfortunately it is still happening.\r\n\r\n```\r\nINFO [02-09|09:40:24.896] Looking for peers                        peercount=1 tried=5 static=0\r\nINFO [02-09|09:40:26.325] Imported new state entries               count=768  elapsed=3.753ms    processed=17711203 pending=7656  trieretry=0   coderetry=0 duplicate=0 unexpected=0\r\nWARN [02-09|09:40:28.099] Invalid header encountered               number=4650125  hash=\"3e83c2…c6e984\" parent=\"bb3f80…c1f88e\" err=\"invalid mix digest\"\r\nWARN [02-09|09:40:28.100] Rewinding blockchain                     target=4647383\r\nWARN [02-09|09:40:28.199] Truncating freezer table                 database=/home/user/.ethereum/geth/chaindata/ancient table=hashes items=4648706  limit=4648697\r\nWARN [02-09|09:40:28.199] Truncating freezer table                 database=/home/user/.ethereum/geth/chaindata/ancient table=bodies items=4648706  limit=4648697\r\nWARN [02-09|09:40:28.199] Truncating freezer table                 database=/home/user/.ethereum/geth/chaindata/ancient table=receipts items=4648706  limit=4648697\r\nWARN [02-09|09:40:28.200] Truncating freezer table                 database=/home/user/.ethereum/geth/chaindata/ancient table=diffs    items=4648706  limit=4648697\r\nWARN [02-09|09:40:28.200] Truncating freezer table                 database=/home/user/.ethereum/geth/chaindata/ancient table=headers  items=4648706  limit=4648697\r\nINFO [02-09|09:40:28.201] Rewind ancient data                      number=4648696\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x78ec7a]\r\n\r\ngoroutine 4816 [running]:\r\ngithub.com/ethereum/go-ethereum/core/types.(*Block).Header(...)\r\n\tgithub.com/ethereum/go-ethereum/core/types/block.go:343\r\ngithub.com/ethereum/go-ethereum/core/rawdb.WriteAncientBlock(0x7f9c36ef6e70, 0xc000406980, 0x0, 0x0, 0x0, 0x0, 0xc04884ebe0, 0xc04884ebe0)\r\n\tgithub.com/ethereum/go-ethereum/core/rawdb/accessors_chain.go:660 +0x3a\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).InsertReceiptChain.func2(0xc01316ec00, 0x2e, 0x40, 0xc047918600, 0x2e, 0x40, 0x0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/core/blockchain.go:1236 +0x4ae\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).InsertReceiptChain(0xc0000a6580, 0xc002420900, 0x2e, 0x2e, 0xc0133c8900, 0x2e, 0x2e, 0xacffff, 0x0, 0x0, ...)\r\n\tgithub.com/ethereum/go-ethereum/core/blockchain.go:1407 +0x1cca\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).commitFastSyncData(0xc0002f01c0, 0xc002420780, 0x2e, 0x2e, 0xc0001b3900, 0xc002420780, 0x2e)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:1880 +0x663\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).processFastSyncContent(0xc0002f01c0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:1796 +0x785\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).syncWithPeer.func7(0xc05c57ad80, 0xc0020d6420)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:554 +0x2a\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync.func1(0xc0002f01c0, 0xc0020a6480, 0xc066f4df50)\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:568 +0x5b\r\ncreated by github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync\r\n\tgithub.com/ethereum/go-ethereum/eth/downloader/downloader.go:568 +0xaf\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/775989404/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/777343511",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22281#issuecomment-777343511",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
    "id": 777343511,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NzM0MzUxMQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-11T10:25:35Z",
    "updated_at": "2021-02-11T10:25:52Z",
    "author_association": "MEMBER",
    "body": "This loop needs to be deleted or protected by the chain insert lock at least: https://github.com/ethereum/go-ethereum/blob/1bbc8a1944312b91ca72a298c2438133906e9503/core/blockchain.go#L1225",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/777343511/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/777359862",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22281#issuecomment-777359862",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
    "id": 777359862,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NzM1OTg2Mg==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-11T10:52:09Z",
    "updated_at": "2021-02-11T10:52:09Z",
    "author_association": "MEMBER",
    "body": "This seems to be caused by a race between the rewinding of the chain (because of invalid mix digest error) and the writing of ancient data during sync. These two things try to manipulate the database at the same time, which may invalidate some assumptions that the code is making.\r\n\r\nWe should figure out why this invalid mix digest error is happening, and also remove the loop or protect it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/777359862/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/777442173",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22281#issuecomment-777442173",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
    "id": 777442173,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NzQ0MjE3Mw==",
    "user": {
      "login": "zoltan-fedor",
      "id": 3887295,
      "node_id": "MDQ6VXNlcjM4ODcyOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3887295?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zoltan-fedor",
      "html_url": "https://github.com/zoltan-fedor",
      "followers_url": "https://api.github.com/users/zoltan-fedor/followers",
      "following_url": "https://api.github.com/users/zoltan-fedor/following{/other_user}",
      "gists_url": "https://api.github.com/users/zoltan-fedor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zoltan-fedor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zoltan-fedor/subscriptions",
      "organizations_url": "https://api.github.com/users/zoltan-fedor/orgs",
      "repos_url": "https://api.github.com/users/zoltan-fedor/repos",
      "events_url": "https://api.github.com/users/zoltan-fedor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zoltan-fedor/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-11T13:06:03Z",
    "updated_at": "2021-02-11T13:06:03Z",
    "author_association": "NONE",
    "body": "I kept repeatedly running into this after resetting the data from geth and restarting the syncing and loaded about the first 25 Gb of the chain.\r\nI have ended up completely deleting the .ethereum folder and starting the syncing again and then the error went away.\r\n\r\nIn summary it seems there is a problem - the race condition mentioned by @fjl, which probably would need to be addressed in general, even if my particular issue is no longer reproducible now.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/777442173/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/783794579",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22281#issuecomment-783794579",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
    "id": 783794579,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4Mzc5NDU3OQ==",
    "user": {
      "login": "h6dworker",
      "id": 18023168,
      "node_id": "MDQ6VXNlcjE4MDIzMTY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/18023168?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/h6dworker",
      "html_url": "https://github.com/h6dworker",
      "followers_url": "https://api.github.com/users/h6dworker/followers",
      "following_url": "https://api.github.com/users/h6dworker/following{/other_user}",
      "gists_url": "https://api.github.com/users/h6dworker/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/h6dworker/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/h6dworker/subscriptions",
      "organizations_url": "https://api.github.com/users/h6dworker/orgs",
      "repos_url": "https://api.github.com/users/h6dworker/repos",
      "events_url": "https://api.github.com/users/h6dworker/events{/privacy}",
      "received_events_url": "https://api.github.com/users/h6dworker/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-23T01:14:05Z",
    "updated_at": "2021-02-23T01:14:05Z",
    "author_association": "NONE",
    "body": "It happens weekly on my terminal.\r\nIt also happens if you delete the .ethereum folder.\r\n\r\nI am running the latest version (version: 1.9.25-stable) on Ubuntu 16.04.7 LTS\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/783794579/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1249534407",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22281#issuecomment-1249534407",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22281",
    "id": 1249534407,
    "node_id": "IC_kwDOAOvK985KemHH",
    "user": {
      "login": "victorelec14",
      "id": 543450,
      "node_id": "MDQ6VXNlcjU0MzQ1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/543450?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/victorelec14",
      "html_url": "https://github.com/victorelec14",
      "followers_url": "https://api.github.com/users/victorelec14/followers",
      "following_url": "https://api.github.com/users/victorelec14/following{/other_user}",
      "gists_url": "https://api.github.com/users/victorelec14/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/victorelec14/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/victorelec14/subscriptions",
      "organizations_url": "https://api.github.com/users/victorelec14/orgs",
      "repos_url": "https://api.github.com/users/victorelec14/repos",
      "events_url": "https://api.github.com/users/victorelec14/events{/privacy}",
      "received_events_url": "https://api.github.com/users/victorelec14/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-16T15:59:12Z",
    "updated_at": "2022-09-16T15:59:12Z",
    "author_association": "NONE",
    "body": "i have something like this  :S \r\n\r\n```\r\ngeth_1                | WARN [09-16|15:53:04.065] Invalid header encountered               number=15,547,189 hash=4a80de..4e285a parent=1409da..843cd6 err=\"unknown ancestor\"\r\ngeth_1                | WARN [09-16|15:53:04.138] Rewinding blockchain                     target=15,545,139\r\ngeth_1                | INFO [09-16|15:53:07.345] State heal in progress                   accounts=211,048@9.86MiB  slots=430,358@33.01MiB codes=3982@29.93MiB nodes=15,935,431@4.09GiB pending=27538\r\ngeth_1                | INFO [09-16|15:53:08.665] Loaded most recent local header          number=15,545,139 hash=92d170..f73065 td=58,750,003,716,598,352,816,469 age=6h55m45s\r\ngeth_1                | INFO [09-16|15:53:08.667] Loaded most recent local full block      number=0          hash=d4e567..cb8fa3 td=17,179,869,184                 age=53y5mo3w\r\ngeth_1                | INFO [09-16|15:53:08.667] Loaded most recent local fast block      number=15,545,139 hash=92d170..f73065 td=58,750,003,716,598,352,816,469 age=6h55m45s\r\ngeth_1                | INFO [09-16|15:53:08.668] Loaded last fast-sync pivot marker       number=15,547,120\r\ngeth_1                | WARN [09-16|15:53:08.668] Rolled back chain segment                header=15547188->15545139 snap=15547119->15545139 block=0->0 reason=\"unknown ancestor\"\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1249534407/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
