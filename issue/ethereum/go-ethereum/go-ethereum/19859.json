{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19859",
  "id": 469792748,
  "node_id": "MDU6SXNzdWU0Njk3OTI3NDg=",
  "number": 19859,
  "title": "1.9.0 fails to sync Rinkeby",
  "user": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-07-18T14:11:09Z",
  "updated_at": "2019-07-19T14:53:23Z",
  "closed_at": "2019-07-19T14:53:23Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.9.0-stable-52f24617`\r\nOS & Version: `Ubuntu 18.04.2 LTS`\r\n\r\n#### Expected behaviour\r\n\r\nA miner syncs and starts mining.\r\n\r\n#### Actual behaviour\r\n\r\nThe node syncs some blocks, then drops to `0` or almost `0` and starts again after logging this:\r\n```\r\nTruncating freezer table     database=/data/geth/chaindata/ancient table=bodies items=315496 limit=55\r\nTruncating freezer table     database=/data/geth/chaindata/ancient table=receipts items=315496 limit=55\r\nTruncating freezer table     database=/data/geth/chaindata/ancient table=diffs    items=315496 limit=55\r\nTruncating freezer table     database=/data/geth/chaindata/ancient table=headers  items=315496 limit=55\r\nTruncating freezer table     database=/data/geth/chaindata/ancient table=hashes   items=315496 limit=55\r\n```\r\nThis seems to be the source:\r\nhttps://github.com/ethereum/go-ethereum/blob/3d3e83ecff5e830f6256b20d81f304febc39aeb2/core/rawdb/freezer_table.go#L339-L343\r\nBut no idea what that means.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nHere are the flags I use for the `ethereum/client-go:v1.9.0` docker image:\r\n```\r\nadmin@miner-01.gc-us-central1-a.faucet.rinkeby:~ % d inspect geth-miner | jq '.[].Config.Cmd'\r\n[\r\n  \"--rinkeby\",\r\n  \"--v5disc\",\r\n  \"--syncmode=full\",\r\n  \"--lightserv=90\",\r\n  \"--mine\",\r\n  \"--miner.threads=2\",\r\n  \"--miner.etherbase=0xMY_ETHER_BASE\",\r\n  \"--metrics\",\r\n  \"--extradata=miner-01.gc-us-central1-a.faucet.rinkeby\",\r\n  \"--verbosity=3\",\r\n  \"--cache=5604\",\r\n  \"--maxpeers=50\",\r\n  \"--maxpendpeers=30\",\r\n  \"--port=30303\",\r\n  \"--nat=extip:1.2.3.4\",\r\n  \"--unlock=0xSUPER_SECRET\",\r\n  \"--allow-insecure-unlock\",\r\n  \"--datadir=/data\",\r\n  \"--password=/keys/account.pass\",\r\n  \"--keystore=/keys\",\r\n  \"--rpc\",\r\n  \"--rpcaddr=0.0.0.0\",\r\n  \"--rpcport=8545\",\r\n  \"--rpcvhosts=localhost,miner,miner-01.gc-us-central1-a.faucet.rinkeby,miner-01.gc-us-central1-a.faucet.rinkeby.tinc\",\r\n  \"--rpcapi=eth,net,web3,personal,shh,admin\",\r\n  \"--ipcpath=/data/geth.ipc\"\r\n]\r\n```\r\n\r\n#### Context\r\n\r\nI've been graphing the progress based on the `eth_syncing` RPC call and it looks like this:\r\n![190_rinkeby_sync_fail](https://user-images.githubusercontent.com/2212681/61464299-0c417f00-a944-11e9-8ef2-9bc9c5070cfe.png)\r\n\r\nSometimes it also jut gets stuck somewhere in the low 100k's and stays there forever.",
  "closed_by": {
    "login": "jakubgs",
    "id": 2212681,
    "node_id": "MDQ6VXNlcjIyMTI2ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jakubgs",
    "html_url": "https://github.com/jakubgs",
    "followers_url": "https://api.github.com/users/jakubgs/followers",
    "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
    "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
    "organizations_url": "https://api.github.com/users/jakubgs/orgs",
    "repos_url": "https://api.github.com/users/jakubgs/repos",
    "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jakubgs/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/512838314",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19859#issuecomment-512838314",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859",
    "id": 512838314,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMjgzODMxNA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-18T14:24:42Z",
    "updated_at": "2019-07-18T14:24:42Z",
    "author_association": "MEMBER",
    "body": "Could you provide more logs? All that you have? This seems really weird.\r\n\r\nBtw, you won't be able to mine on Rinkeby, it's a PoA (Clique) network where only authorized signers can seal blocks.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/512838314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/512967288",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19859#issuecomment-512967288",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859",
    "id": 512967288,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMjk2NzI4OA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-18T20:05:38Z",
    "updated_at": "2019-07-18T20:09:07Z",
    "author_association": "NONE",
    "body": "Sure, here's an hour-slice of logs.\r\nhttps://gist.github.com/jakubgs/a5e19cca64e836cab0f000ca50e313cc\r\nI'll get your `DEBUG` logs in a minute.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/512967288/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/512979432",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19859#issuecomment-512979432",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859",
    "id": 512979432,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMjk3OTQzMg==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-18T20:42:17Z",
    "updated_at": "2019-07-18T20:42:17Z",
    "author_association": "NONE",
    "body": "Here's a ~22 minute slice of `DEBUG` logs from start with cleaned `geth` direcotry, til a bit after the time when the `Truncating freezer table` show up in the logs and the sync level drops: [geth.log.tar.gz](https://github.com/ethereum/go-ethereum/files/3408360/geth.log.tar.gz)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/512979432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/513114115",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19859#issuecomment-513114115",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859",
    "id": 513114115,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMzExNDExNQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-19T06:50:05Z",
    "updated_at": "2019-07-19T06:50:05Z",
    "author_association": "MEMBER",
    "body": "In your first dump, there's something very odd:\r\n\r\n```\r\nINFO [07-18|19:52:59.442] Imported new chain segment               blocks=82    txs=148   mgas=534.603  elapsed=8.000s    mgasps=66.825  number=405413 hash=da5158â€¦a65b6d age=2y1mo6d  dirty=109.26MiB\r\n\r\nWARN [07-18|19:53:05.249] Sanitizing cache to Go's GC limits       provided=5604 updated=2491\r\n```\r\n\r\nI.e. Here Geth was murdered and restarted. Could you check why docker would be terminating the container forcefully? Geth didn't log any error, any warning, any clean shutdown. It looks as if it was just silently murdered.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/513114115/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/513249758",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19859#issuecomment-513249758",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859",
    "id": 513249758,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMzI0OTc1OA==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-19T14:26:44Z",
    "updated_at": "2019-07-19T14:26:44Z",
    "author_association": "NONE",
    "body": "So I disabled the `--restart-policy=always` from my docker container and tried again.\r\nHere is what I got:\r\n```json\r\n{\r\n  \"Status\": \"exited\",\r\n  \"Running\": false,\r\n  \"Paused\": false,\r\n  \"Restarting\": false,\r\n  \"OOMKilled\": true,\r\n  \"Dead\": false,\r\n  \"Pid\": 0,\r\n  \"ExitCode\": 137,\r\n  \"Error\": \"\",\r\n  \"StartedAt\": \"2019-07-19T14:04:59.188477944Z\",\r\n  \"FinishedAt\": \"2019-07-19T14:15:35.214579829Z\"\r\n}\r\n```\r\nThe `OOMKilled` being set to `true` indicates that the container was killed due to lack of memory.\r\nIt must be my docker memory limit:\r\n```bash\r\n $ docker inspect geth-miner | jq '.[].HostConfig.Memory'\r\n5485101056\r\n```\r\nSo about `5485 MB` of limit, which is actually lower than my setting of `--cache` of `5604 MB`\r\nMemory graph from last sync attempt:\r\n![geth_miner_memory](https://user-images.githubusercontent.com/2212681/61542285-33b14e00-aa0f-11e9-94b8-c4c0e40c12f0.png)\r\n![geth_miner_memory_cont](https://user-images.githubusercontent.com/2212681/61542438-9276c780-aa0f-11e9-9f8e-bf8bdf7c73e9.png)\r\n\r\nAnd the container itself reached 3.958 GB of memory, so it didn't seem to me like it should be killed, but apparently it was.\r\n\r\nIt seems to me the issue is `--cache` setting being high than my docker container memory limit.\r\nI will try to change that and get back to you.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/513249758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/513260021",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19859#issuecomment-513260021",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19859",
    "id": 513260021,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMzI2MDAyMQ==",
    "user": {
      "login": "jakubgs",
      "id": 2212681,
      "node_id": "MDQ6VXNlcjIyMTI2ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jakubgs",
      "html_url": "https://github.com/jakubgs",
      "followers_url": "https://api.github.com/users/jakubgs/followers",
      "following_url": "https://api.github.com/users/jakubgs/following{/other_user}",
      "gists_url": "https://api.github.com/users/jakubgs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jakubgs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jakubgs/subscriptions",
      "organizations_url": "https://api.github.com/users/jakubgs/orgs",
      "repos_url": "https://api.github.com/users/jakubgs/repos",
      "events_url": "https://api.github.com/users/jakubgs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jakubgs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-19T14:53:10Z",
    "updated_at": "2019-07-19T14:53:10Z",
    "author_association": "NONE",
    "body": "Yep, it seems to be syncing now beyond the previous limit:\r\n![geth_syncing_progress](https://user-images.githubusercontent.com/2212681/61544379-53e30c00-aa13-11e9-833d-02ee7617ca81.png)\r\n\r\nAdded a memory check so this doesn't happen in my role again: https://github.com/status-im/infra-role-geth/commit/b78e128d91e2463537aac517dd6c978339e3717d\r\n\r\nRemember boys and girls, pay attention to your memory limits.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/513260021/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
