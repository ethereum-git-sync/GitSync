{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21006",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21006/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21006/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21006/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21006",
  "id": 609766475,
  "node_id": "MDU6SXNzdWU2MDk3NjY0NzU=",
  "number": 21006,
  "title": "\"Head state missing, repairing chain\" I lost many blocks",
  "user": {
    "login": "MANOJKUMARCH",
    "id": 33849651,
    "node_id": "MDQ6VXNlcjMzODQ5NjUx",
    "avatar_url": "https://avatars.githubusercontent.com/u/33849651?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MANOJKUMARCH",
    "html_url": "https://github.com/MANOJKUMARCH",
    "followers_url": "https://api.github.com/users/MANOJKUMARCH/followers",
    "following_url": "https://api.github.com/users/MANOJKUMARCH/following{/other_user}",
    "gists_url": "https://api.github.com/users/MANOJKUMARCH/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MANOJKUMARCH/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MANOJKUMARCH/subscriptions",
    "organizations_url": "https://api.github.com/users/MANOJKUMARCH/orgs",
    "repos_url": "https://api.github.com/users/MANOJKUMARCH/repos",
    "events_url": "https://api.github.com/users/MANOJKUMARCH/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MANOJKUMARCH/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-04-30T09:43:50Z",
  "updated_at": "2020-11-09T17:36:36Z",
  "closed_at": "2020-05-11T12:58:08Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi there,\r\n\r\nI have run geth as private chain. We were doing a load test and injected 10K transactions into the chain. The chain was able to handle the load for 3 times, but fourth time the chain is crashed. And when I restarted the chain, it is rewound to old state that is 2 months old state. As a result I lost close to 600000+ blocks.\r\n\r\nIs there a way I can get the blocks back.\r\n\r\n#### System information\r\n\r\nGeth version: 1.9.9-stable\r\nOS & Version: Linux - Ubuntu 18.0.4\r\nCommit hash : (if `develop`)\r\n\r\n#### Expected behaviour\r\nGeth to repair the chain and start from the latest state\r\n\r\n#### Actual behaviour\r\nGeth has rewound the chain to old state with is 2 months old\r\n\r\n```\r\nWARN [04-30|08:52:03.578] Head state missing, repairing chain      number=3231085 hash=143d04â€¦20a4e5\r\nINFO [04-30|08:52:47.776] Rewound blockchain to past state         number=2687939 hash=f07aeeâ€¦c540c6\r\nINFO [04-30|08:52:47.778] Loaded most recent local header          number=3231085 hash=143d04â€¦20a4e5 td=2132445952434 age=1h8m43s\r\nINFO [04-30|08:52:47.778] Loaded most recent local full block      number=2687939 hash=f07aeeâ€¦c540c6 td=1676807286165 age=2mo2w5d\r\nINFO [04-30|08:52:47.778] Loaded most recent local fast block      number=3231085 hash=143d04â€¦20a4e5 td=2132445952434 age=1h8m43s\r\n\r\nWARN [04-30|08:53:24.246] Truncating freezer table                 database=/home/ctadmindev/CT91_Dev/geth/chaindata/ancient table=headers items=3141085 limit=2687940\r\nWARN [04-30|08:53:24.261] Truncating freezer table                 database=/home/ctadmindev/CT91_Dev/geth/chaindata/ancient table=hashes  items=3141085 limit=2687940\r\nWARN [04-30|08:53:24.263] Truncating freezer table                 database=/home/ctadmindev/CT91_Dev/geth/chaindata/ancient table=bodies  items=3141085 limit=2687940\r\nWARN [04-30|08:53:24.264] Truncating freezer table                 database=/home/ctadmindev/CT91_Dev/geth/chaindata/ancient table=receipts items=3141085 limit=2687940\r\nWARN [04-30|08:53:24.265] Truncating freezer table                 database=/home/ctadmindev/CT91_Dev/geth/chaindata/ancient table=diffs    items=3141085 limit=2687940\r\nINFO [04-30|08:53:24.265] Rewind ancient data                      number=2687939\r\n**WARN [04-30|08:53:24.265] Truncate ancient chain                   from=3231085 to=2687939**\r\n```\r\n\r\nI have looked into issue # 19124, and tried to export the chain. But it did not work, as the export failed at block number 2687940 saying it is not found.\r\n\r\nAny chance or way to get the blocks? Also would like mention that this is a private cchain with no other nodes in network.\r\n\r\nIs this a bug or expected behaviour?\r\n\r\nPlease help if there is a way to get the lost blocks.\r\n\r\n\r\nRegards,\r\nManoj",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21006/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21006/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/626685418",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21006#issuecomment-626685418",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21006",
    "id": 626685418,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjY4NTQxOA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-11T12:58:08Z",
    "updated_at": "2020-05-11T12:58:08Z",
    "author_association": "MEMBER",
    "body": "It's obviously not an \"expceted behaviour\" for geth to crash, but when geth _does_ crash, it is expected behaviour that a roll-back can occur. Geth does in-memory pruning of state, and only writes out data every once in a while. If geth crashes, it may well have to discard a whole lot of blocks to go back to that point in time where it most recently stored the state to disk. \r\n\r\nShort answer: no, you cannot get the blocks back.\r\nIf you want more reliability in the future, consider running more nodes, and/or disable pruning -- a.k.a run `archive` mode. \r\n\r\nHope I've answered your questions, and since I don't see anything more actionable about this particular ticket, I'll close it. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/626685418/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/724091395",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21006#issuecomment-724091395",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21006",
    "id": 724091395,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNDA5MTM5NQ==",
    "user": {
      "login": "jasper22",
      "id": 2697004,
      "node_id": "MDQ6VXNlcjI2OTcwMDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2697004?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jasper22",
      "html_url": "https://github.com/jasper22",
      "followers_url": "https://api.github.com/users/jasper22/followers",
      "following_url": "https://api.github.com/users/jasper22/following{/other_user}",
      "gists_url": "https://api.github.com/users/jasper22/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jasper22/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jasper22/subscriptions",
      "organizations_url": "https://api.github.com/users/jasper22/orgs",
      "repos_url": "https://api.github.com/users/jasper22/repos",
      "events_url": "https://api.github.com/users/jasper22/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jasper22/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-09T15:38:48Z",
    "updated_at": "2020-11-09T15:40:45Z",
    "author_association": "NONE",
    "body": "Is there any option to save state more frequently ?? \r\n\r\nI guess I crash into similar issue with official Geth client: [Geth keep truncating ancient chain + rewind blockchain ? Why ? ðŸ˜¥](https://ethereum.stackexchange.com/questions/90003/geth-keep-truncating-ancient-chain-rewind-blockchain-why ) in \"didn't touch anything\" scenario.\r\n\r\n10 hours of syncing is out of window because of unknown error :( it always come back to first block. I'm really frustrated here.....",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/724091395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/724163547",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21006#issuecomment-724163547",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21006",
    "id": 724163547,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNDE2MzU0Nw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-09T17:36:35Z",
    "updated_at": "2020-11-09T17:36:35Z",
    "author_association": "MEMBER",
    "body": "> Is there any option to save state more frequently ??\r\n\r\nYes. `gcmode=archive` means 'save state at every block'. As I remember it, there was a way to set the flush-time to an arbitrary time, however, \r\n```\r\nTrieTimeLimit       time.Duration // Time limit after which to flush the current in-memory trie to disk\r\n```\r\nAfaict this is not configurable via CLI or toml. @karalabe am I misremembering? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/724163547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
