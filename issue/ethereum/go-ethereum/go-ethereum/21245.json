{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21245",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21245/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21245/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21245/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21245",
  "id": 641836538,
  "node_id": "MDU6SXNzdWU2NDE4MzY1Mzg=",
  "number": 21245,
  "title": "sync is corrupted",
  "user": {
    "login": "past2017",
    "id": 25541244,
    "node_id": "MDQ6VXNlcjI1NTQxMjQ0",
    "avatar_url": "https://avatars.githubusercontent.com/u/25541244?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/past2017",
    "html_url": "https://github.com/past2017",
    "followers_url": "https://api.github.com/users/past2017/followers",
    "following_url": "https://api.github.com/users/past2017/following{/other_user}",
    "gists_url": "https://api.github.com/users/past2017/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/past2017/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/past2017/subscriptions",
    "organizations_url": "https://api.github.com/users/past2017/orgs",
    "repos_url": "https://api.github.com/users/past2017/repos",
    "events_url": "https://api.github.com/users/past2017/events{/privacy}",
    "received_events_url": "https://api.github.com/users/past2017/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1486629004,
      "node_id": "MDU6TGFiZWwxNDg2NjI5MDA0",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/priority:2",
      "name": "priority:2",
      "color": "f76ac8",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-06-19T09:30:47Z",
  "updated_at": "2020-09-18T12:40:22Z",
  "closed_at": "2020-09-18T12:40:22Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi there,\r\n\r\n#### System information\r\n\r\nGeth\r\nVersion: 1.9.15-stable\r\nGit Commit: 0f77f34bb67b640bd8af22b215f3d279a1e21170\r\nArchitecture: amd64\r\nProtocol Versions: [65 64 63]\r\nGo Version: go1.13.4\r\nOperating System: linux\r\nGOPATH=/root/projects\r\nGOROOT=/root/go\r\n\r\n\r\n#### Expected behaviour\r\nsync well\r\n\r\n#### Actual behaviour\r\nsync is corrupted\r\n```\r\nINFO [06-19|07:40:31.742] Imported new block receipts              count=28   elapsed=87.212ms    number=4952970 hash=\"ebf289…90a060\" age=2y5mo1w   size=1.38MiB\r\nINFO [06-19|07:40:31.837] Imported new state entries               count=0    elapsed=\"8.354µs\"   processed=15765722 pending=22692 retry=2   duplicate=29920 unexpected=116538\r\nINFO [06-19|07:40:32.712] Imported new state entries               count=1616 elapsed=8.992ms     processed=15767338 pending=21849 retry=0   duplicate=29920 unexpected=116538\r\nINFO [06-19|07:40:33.386] Imported new state entries               count=0    elapsed=\"9.094µs\"   processed=15767338 pending=20905 retry=2   duplicate=29920 unexpected=116540\r\nWARN [06-19|07:40:33.386] Header broke chain ancestry              peer=4a061fc05506a9e6 number=5053475 hash=\"5b8afe…854fed\"\r\nINFO [06-19|07:40:33.505] Imported new state entries               count=1936 elapsed=10.987ms    processed=15769274 pending=20900 retry=67  duplicate=29920 unexpected=116540\r\nINFO [06-19|07:40:33.622] Imported new state entries               count=0    elapsed=\"12.639µs\"  processed=15769274 pending=20647 retry=2   duplicate=29920 unexpected=116542\r\nINFO [06-19|07:40:34.413] Imported new state entries               count=0    elapsed=\"9.515µs\"   processed=15769274 pending=19946 retry=2   duplicate=29920 unexpected=116544\r\nINFO [06-19|07:40:34.879] Imported new state entries               count=2145 elapsed=14.848ms    processed=15771419 pending=18882 retry=0   duplicate=29920 unexpected=116544\r\nINFO [06-19|07:40:35.129] Imported new state entries               count=0    elapsed=\"9.334µs\"   processed=15771419 pending=18476 retry=2   duplicate=29920 unexpected=116546\r\nINFO [06-19|07:40:35.280] Imported new state entries               count=1129 elapsed=6.556ms     processed=15772548 pending=18294 retry=76  duplicate=29920 unexpected=116546\r\nINFO [06-19|07:40:36.123] Imported new state entries               count=1235 elapsed=8.880ms     processed=15773783 pending=17534 retry=0   duplicate=29920 unexpected=116546\r\nINFO [06-19|07:40:36.611] Imported new state entries               count=0    elapsed=\"8.733µs\"   processed=15773783 pending=17083 retry=2   duplicate=29920 unexpected=116548\r\nWARN [06-19|07:40:36.612] Header broke chain ancestry              peer=4a061fc05506a9e6 number=5058265 hash=\"8fb9ab…9f8a69\"\r\nINFO [06-19|07:40:36.813] Imported new state entries               count=1146 elapsed=7.177ms     processed=15774929 pending=16794 retry=418 duplicate=29920 unexpected=116548\r\nINFO [06-19|07:40:36.847] Imported new state entries               count=0    elapsed=\"8.287µs\"   processed=15774929 pending=16794 retry=118 duplicate=29920 unexpected=116550\r\nINFO [06-19|07:40:37.125] Imported new state entries               count=505  elapsed=4.584ms     processed=15775434 pending=16431 retry=0   duplicate=29920 unexpected=116550\r\nWARN [06-19|07:40:37.155] Rolled back headers                      count=2048 header=4988877->4986829 fast=4952970->4952970 block=0->0\r\nWARN [06-19|07:40:37.155] Synchronisation failed, dropping peer    peer=f30f3f3047d4055c err=\"retrieved hash chain is invalid: timeout\"\r\nWARN [06-19|07:40:37.403] Synchronisation failed, dropping peer    peer=e39a68a7c610584c err=\"action from bad peer ignored\"\r\nWARN [06-19|07:40:40.653] Dropping unsynced node during fast sync  id=dfe9f6ba9289d185 conn=dyndial addr=66.42.91.122:30303    type=Geth/v1.9.13-stable-cbc4ac26/linux-amd64/go1.13\r\nWARN [06-19|07:40:45.628] Dropping unsynced node during fast sync  id=de5bf65ed5ab5c11 conn=dyndial addr=120.152.146.87:30303  type=Geth/v1.9.15-stable-0f77f34b/linux-arm/go1.13.1\r\nINFO [06-19|07:40:46.145] Imported new state entries               count=423  elapsed=\"2.138µs\"   processed=15775857 pending=6692  retry=4   duplicate=29920 unexpected=116550\r\nINFO [06-19|07:40:46.482] Imported new state entries               count=0    elapsed=\"9.219µs\"   processed=15775857 pending=8588  retry=2   duplicate=29920 unexpected=116552\r\nINFO [06-19|07:40:46.717] Imported new state entries               count=0    elapsed=\"9.114µs\"   processed=15775857 pending=9379  retry=2   duplicate=29920 unexpected=116554\r\nINFO [06-19|07:40:46.723] Imported new state entries               count=446  elapsed=\"666.808µs\" processed=15776303 pending=9727  retry=0   duplicate=29920 unexpected=116554\r\nWARN [06-19|07:40:46.834] Dropping unsynced node during fast sync  id=f5526e478af35bbe conn=dyndial addr=185.154.159.152:30303 type=Geth/v1.9.8-stable-d62e9b28/linux-amd64/go1.13.4\r\nINFO [06-19|07:40:47.082] Imported new block headers               count=0    elapsed=10.757ms    number=4950878 hash=\"abe424…e402e8\" age=2y5mo1w   ignored=384\r\nINFO [06-19|07:40:47.127] Imported new state entries               count=630  elapsed=1.847ms     processed=15776933 pending=15691 retry=0   duplicate=29920 unexpected=116554\r\nINFO [06-19|07:40:47.564] Imported new block headers               count=0    elapsed=11.907ms    number=4951454 hash=\"1de524…be823b\" age=2y5mo1w   ignored=576\r\nINFO [06-19|07:40:48.154] Imported new state entries               count=932  elapsed=4.052ms     processed=15777865 pending=16433 retry=0   duplicate=29920 unexpected=116554\r\nWARN [06-19|07:40:48.180] Header broke chain ancestry              peer=4a061fc05506a9e6 number=4952416 hash=\"f52017…94559e\"\r\nINFO [06-19|07:40:48.181] Imported new state entries               count=0    elapsed=\"8.155µs\"   processed=15777865 pending=16433 retry=2   duplicate=29920 unexpected=116556\r\nINFO [06-19|07:40:48.843] Imported new state entries               count=1148 elapsed=7.135ms     processed=15779013 pending=15733 retry=0   duplicate=29920 unexpected=116556\r\nINFO [06-19|07:40:49.473] Imported new state entries               count=874  elapsed=5.595ms     processed=15779887 pending=18541 retry=0   duplicate=29920 unexpected=116556\r\nINFO [06-19|07:40:49.632] Imported new state entries               count=0    elapsed=\"36.575µs\"  processed=15779887 pending=18465 retry=9   duplicate=29920 unexpected=116558\r\nWARN [06-19|07:40:49.632] Header broke chain ancestry              peer=4a061fc05506a9e6 number=4957223 hash=\"b95f3a…ae85cb\"\r\nINFO [06-19|07:40:49.867] Imported new state entries               count=0    elapsed=\"10.406µs\"  processed=15779887 pending=18465 retry=7   duplicate=29920 unexpected=116560\r\nINFO [06-19|07:40:50.088] Imported new state entries               count=615  elapsed=2.091ms     processed=15780502 pending=20664 retry=2   duplicate=29920 unexpected=116560\r\nINFO [06-19|07:40:50.586] Imported new state entries               count=922  elapsed=5.563ms     processed=15781424 pending=21393 retry=0   duplicate=29920 unexpected=116560\r\nINFO [06-19|07:40:50.918] Imported new state entries               count=0    elapsed=\"7.927µs\"   processed=15781424 pending=21343 retry=2   duplicate=29920 unexpected=116562\r\nWARN [06-19|07:40:50.918] Header broke chain ancestry              peer=4a061fc05506a9e6 number=4960729 hash=\"da274b…3c6345\"\r\nINFO [06-19|07:40:51.025] Imported new state entries               count=974  elapsed=5.749ms     processed=15782398 pending=20794 retry=51  duplicate=29920 unexpected=116562\r\nINFO [06-19|07:40:51.153] Imported new state entries               count=0    elapsed=\"8.503µs\"   processed=15782398 pending=22480 retry=2   duplicate=29920 unexpected=116564\r\nINFO [06-19|07:40:51.420] Imported new state entries               count=768  elapsed=3.836ms     processed=15783166 pending=22177 retry=0   duplicate=29920 unexpected=116564\r\nWARN [06-19|07:40:51.904] Stalling state sync, dropping peer       peer=d76bbc91099749eb\r\nWARN [06-19|07:40:51.904] Stalling state sync, dropping peer       peer=7d2368f2817b7427\r\nINFO [06-19|07:40:51.944] Imported new state entries               count=1083 elapsed=7.295ms     processed=15784249 pending=21254 retry=77  duplicate=29920 unexpected=116564\r\nINFO [06-19|07:40:52.223] Imported new state entries               count=0    elapsed=\"11.618µs\"  processed=15784249 pending=20928 retry=2   duplicate=29920 unexpected=116566\r\nCRIT [06-19|07:40:52.230] Failed to write block data to ancient store err=\"the append operation is out-order\"\r\nWARN [06-19|07:40:52.230] Header broke chain ancestry              peer=4a061fc05506a9e6 number=4963071 hash=\"3f90e5…b2ed64\"\r\n\r\n```\r\n\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\n` ./geth   --rpc --rpcaddr 0.0.0.0 --rpcport 11001 --rpcapi web3,eth,net,personal`\r\n\r\n#### Backtrace\r\n\r\n````\r\n[backtrace]\r\n````\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21245/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21245/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/646546382",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21245#issuecomment-646546382",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21245",
    "id": 646546382,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NjU0NjM4Mg==",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-19T09:52:22Z",
    "updated_at": "2020-06-19T09:52:22Z",
    "author_association": "MEMBER",
    "body": "Are you on 32 bit linux? Did you just sync for the first time or was your node running before? \r\nIf so maybe your node was not shutdown correctly which might fry the database. Did the node run out of memory or was the harddisk full?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/646546382/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/647062321",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21245#issuecomment-647062321",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21245",
    "id": 647062321,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NzA2MjMyMQ==",
    "user": {
      "login": "past2017",
      "id": 25541244,
      "node_id": "MDQ6VXNlcjI1NTQxMjQ0",
      "avatar_url": "https://avatars.githubusercontent.com/u/25541244?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/past2017",
      "html_url": "https://github.com/past2017",
      "followers_url": "https://api.github.com/users/past2017/followers",
      "following_url": "https://api.github.com/users/past2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/past2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/past2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/past2017/subscriptions",
      "organizations_url": "https://api.github.com/users/past2017/orgs",
      "repos_url": "https://api.github.com/users/past2017/repos",
      "events_url": "https://api.github.com/users/past2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/past2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-21T00:40:42Z",
    "updated_at": "2020-06-21T00:40:53Z",
    "author_association": "NONE",
    "body": "> Are you on 32 bit linux? Did you just sync for the first time or was your node running before?\r\n> If so maybe your node was not shutdown correctly which might fry the database. Did the node run out of memory or was the harddisk full?\r\n\r\n**my os:** \r\nUbuntu 18.04.2 LTS \\n \\l   \r\n#getconf LONG_BIT\r\n64\r\n\r\nI sync for fist time\r\n\r\nmemory is enough, i have 96G memory to use and hard disk is not full\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/647062321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/694843663",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21245#issuecomment-694843663",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21245",
    "id": 694843663,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NDg0MzY2Mw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-18T12:40:22Z",
    "updated_at": "2020-09-18T12:40:22Z",
    "author_association": "MEMBER",
    "body": "Sorry there hasn't been a lot of action on this. I can't really figure out the specifics needed to trigger this, but I suspect it has something to do with the background freezer using a threshold, and the threshold is modified by the downloader. So while the downloader resets the threshold to a smaller value (due to the failed syncs), the freezer does not immediately read the new value. \r\n\r\nAnd that leads to a `errOutOrderInsertion`. \r\n\r\nSince we've had no other similar reports, I'll close this and hope that it's fixed with the changes in the downloader since 1.9.15. Please reopen if it happens again. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/694843663/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
