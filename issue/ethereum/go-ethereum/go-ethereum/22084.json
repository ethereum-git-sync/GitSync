{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22084",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22084/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22084/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22084/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22084",
  "id": 775398634,
  "node_id": "MDU6SXNzdWU3NzUzOTg2MzQ=",
  "number": 22084,
  "title": "UPNP Problem",
  "user": {
    "login": "ligi",
    "id": 111600,
    "node_id": "MDQ6VXNlcjExMTYwMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ligi",
    "html_url": "https://github.com/ligi",
    "followers_url": "https://api.github.com/users/ligi/followers",
    "following_url": "https://api.github.com/users/ligi/following{/other_user}",
    "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
    "organizations_url": "https://api.github.com/users/ligi/orgs",
    "repos_url": "https://api.github.com/users/ligi/repos",
    "events_url": "https://api.github.com/users/ligi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ligi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    },
    {
      "id": 1380070748,
      "node_id": "MDU6TGFiZWwxMzgwMDcwNzQ4",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:p2p",
      "name": "area:p2p",
      "color": "ea9adb",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-12-28T13:24:12Z",
  "updated_at": "2020-12-30T11:39:21Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.9.25\r\nOS & Version: Linux\r\nrouter: AC1750 Wireless Dual Band Gigabit Router Model No. Archer C7 - Firmware Version: | 3.15.3 Build 180305 Rel.51282n - System Up Time: | 25 days\r\n\r\n\r\n#### Expected behaviour\r\n\r\nNode should keep syncing and connected to peers\r\n\r\n#### Actual behaviour\r\n\r\nI saw the following:\r\n`err=\"retrieved hash chain is invalid: no peers to keep download active\"`\r\n\r\nthen there was no syncing for hours\r\na restart of the node could start the sync again.\r\n\r\nAlso saw those in the log:\r\n\r\n```\r\nDEBUG[12-28|12:24:07.076] Couldn't add port mapping                proto=tcp extport=30303 intport=30303 interface=\"UPNP IGDv1-IP1\" err=\"goupnp: SOAP request got HTTP 500 Internal Server Error\"\r\nDEBUG[12-28|12:24:07.482] Couldn't add port mapping                proto=udp extport=30303 intport=30303 interface=\"UPNP IGDv1-IP1\" err=\"goupnp: SOAP request got HTTP 500 Internal Server Error\"\r\n```\r\n\r\nAlso it does not seem that after a 500 here there is a retry attempt which I think should be in place.\r\n\r\nmaybe related #21370\r\n\r\nI only see DAppNode entries (another machine) in the routers UPNP list:\r\n\r\n![Selection_340](https://user-images.githubusercontent.com/111600/103219591-6eb2f300-491e-11eb-9e78-5a677a5e24c8.png)\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22084/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22084/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/752451213",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22084#issuecomment-752451213",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22084",
    "id": 752451213,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MjQ1MTIxMw==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-30T11:39:21Z",
    "updated_at": "2020-12-30T11:39:21Z",
    "author_association": "MEMBER",
    "body": "now the node is in the state again - for hours not syncing - I see some of the 500 error parts in this log - but may not be the root cause.  It seems stuck at revalidating nodes:\r\n\r\n```\r\nDEBUG[12-30|11:04:19.247] Recalculated downloader QoS values       rtt=19.999999997s confidence=1.000 ttl=59.999999991s\r\nDEBUG[12-30|11:04:20.537] Revalidated node                         b=14 id=74e62eb72c2f8284 checks=36\r\nDEBUG[12-30|11:04:20.756] Revalidated node                         b=11 id=4853b30328564b02 checks=7\r\nDEBUG[12-30|11:04:28.449] Revalidated node                         b=7  id=4ce8d41951554e23 checks=34\r\nDEBUG[12-30|11:04:34.299] Revalidated node                         b=5  id=4cb1f1f33b531842 checks=14\r\nDEBUG[12-30|11:04:36.701] Couldn't add port mapping                proto=udp extport=30303 intport=30303 interface=\"UPNP IGDv1-IP1\" err=\"goupnp: SOAP request got HTTP 500 Internal Server Error\"\r\nDEBUG[12-30|11:04:37.403] Couldn't add port mapping                proto=tcp extport=30303 intport=30303 interface=\"UPNP IGDv1-IP1\" err=\"goupnp: SOAP request got HTTP 500 Internal Server Error\"\r\nDEBUG[12-30|11:04:39.248] Recalculated downloader QoS values       rtt=19.999999997s confidence=1.000 ttl=59.999999991s\r\nDEBUG[12-30|11:04:39.769] Removed dead node                        b=7  id=4ce797574a8acd43 ip=178.128.58.179  checks=0\r\nDEBUG[12-30|11:04:49.161] Revalidated node                         b=7  id=4cef90e3326fba2a checks=1\r\nDEBUG[12-30|11:04:51.584] Revalidated node                         b=4  id=4ca48781dd9b5fef checks=39\r\nDEBUG[12-30|11:04:59.249] Recalculated downloader QoS values       rtt=19.999999997s confidence=1.000 ttl=59.999999991s\r\nDEBUG[12-30|11:05:00.317] Revalidated node                         b=12 id=45f067e03fb5a709 checks=141\r\nDEBUG[12-30|11:05:03.982] Revalidated node                         b=4  id=4ca6387bc70b225b checks=2\r\nDEBUG[12-30|11:05:10.168] Revalidated node                         b=4  id=4ca48781dd9b5fef checks=40\r\nDEBUG[12-30|11:05:12.961] Ancient blocks frozen already            number=11072499 hash=\"e0c9ce…6e81c9\" frozen=10982500\r\nDEBUG[12-30|11:05:16.908] Revalidated node                         b=15 id=002b534bd64f897d checks=55\r\nDEBUG[12-30|11:05:18.455] Revalidated node                         b=4  id=4ca6387bc70b225b checks=3\r\nDEBUG[12-30|11:05:19.249] Recalculated downloader QoS values       rtt=19.999999997s confidence=1.000 ttl=59.999999991s\r\nDEBUG[12-30|11:05:25.025] Revalidated node                         b=14 id=616f707368edce89 checks=9\r\nDEBUG[12-30|11:05:32.954] Revalidated node                         b=12 id=442ad2b606aa6eb8 checks=66\r\nDEBUG[12-30|11:05:37.297] Revalidated node                         b=16 id=aed6f3f345346e1b checks=156\r\nDEBUG[12-30|11:05:39.251] Recalculated downloader QoS values       rtt=19.999999997s confidence=1.000 ttl=59.999999991s\r\nDEBUG[12-30|11:05:39.760] Revalidated node                         b=3  id=4cad0816ee17f46e checks=5\r\nDEBUG[12-30|11:05:46.901] Revalidated node                         b=4  id=4ca48781dd9b5fef checks=41\r\nDEBUG[12-30|11:05:51.293] Revalidated node                         b=11 id=4b88273302a7f39b checks=36\r\nDEBUG[12-30|11:05:58.879] Revalidated node                         b=7  id=4cf12c2ff8bd5e4d checks=2\r\nDEBUG[12-30|11:05:59.251] Recalculated downloader QoS values       rtt=19.999999997s confidence=1.000 ttl=59.999999991s\r\nDEBUG[12-30|11:06:04.265] Revalidated node                         b=5  id=4cb324175fd33da2 checks=12\r\nDEBUG[12-30|11:06:06.329] Revalidated node                         b=3  id=4caff580a67dec31 checks=1\r\nDEBUG[12-30|11:06:10.450] Revalidated node                         b=10 id=4ed6105bfc0f8942 checks=50\r\nDEBUG[12-30|11:06:12.962] Ancient blocks frozen already            number=11072499 hash=\"e0c9ce…6e81c9\" frozen=10982500\r\nDEBUG[12-30|11:06:18.661] Revalidated node                         b=6  id=4c83f1c03f6fcec3 checks=3\r\nDEBUG[12-30|11:06:19.252] Recalculated downloader QoS values       rtt=19.999999997s confidence=1.000 ttl=59.999999991s\r\nDEBUG[12-30|11:06:19.799] Revalidated node                         b=3  id=4cad0816ee17f46e checks=6\r\nDEBUG[12-30|11:06:24.409] Revalidated node                         b=13 id=517dfdf3e379254b checks=9\r\nDEBUG[12-30|11:06:29.233] Revalidated node                         b=8  id=4c4f6be393d01852 checks=12\r\nDEBUG[12-30|11:06:36.122] Revalidated node                         b=11 id=4a7a76564354e536 checks=64\r\nDEBUG[12-30|11:06:39.253] Recalculated downloader QoS values       rtt=19.999999997s confidence=1.000 ttl=59.999999991s\r\nDEBUG[12-30|11:06:45.452] Revalidated node                         b=15 id=0c6253589a8d244d checks=4\r\nDEBUG[12-30|11:06:51.694] Revalidated node                         b=16 id=a28eff924f80abb4 checks=81\r\nDEBUG[12-30|11:06:53.260] Revalidated node                         b=14 id=639f897e7a023468 checks=66\r\nDEBUG[12-30|11:06:58.557] Revalidated node                         b=4  id=4ca6387bc70b225b checks=4\r\nDEBUG[12-30|11:06:59.254] Recalculated downloader QoS values       rtt=19.999999997s confidence=1.000 ttl=59.999999991s\r\nDEBUG[12-30|11:07:07.657] Revalidated node                         b=5  id=4cb1f1f33b531842 checks=15\r\nDEBUG[12-30|11:07:12.963] Ancient blocks frozen already            number=11072499 hash=\"e0c9ce…6e81c9\" frozen=10982500\r\nDEBUG[12-30|11:07:16.166] Revalidated node                         b=10 id=4e796f80887e988b checks=67\r\nDEBUG[12-30|11:07:17.018] Revalidated node                         b=10 id=4e59eb459b8e3fa3 checks=143\r\n```\r\n\r\nwonder if `--maxpeers 5` plays a role here.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/752451213/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
