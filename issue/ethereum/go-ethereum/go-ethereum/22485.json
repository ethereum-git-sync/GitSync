{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22485",
  "id": 829097082,
  "node_id": "MDU6SXNzdWU4MjkwOTcwODI=",
  "number": 22485,
  "title": "debug_traceCall returns error after update",
  "user": {
    "login": "fernandezpaco",
    "id": 6205118,
    "node_id": "MDQ6VXNlcjYyMDUxMTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6205118?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fernandezpaco",
    "html_url": "https://github.com/fernandezpaco",
    "followers_url": "https://api.github.com/users/fernandezpaco/followers",
    "following_url": "https://api.github.com/users/fernandezpaco/following{/other_user}",
    "gists_url": "https://api.github.com/users/fernandezpaco/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fernandezpaco/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fernandezpaco/subscriptions",
    "organizations_url": "https://api.github.com/users/fernandezpaco/orgs",
    "repos_url": "https://api.github.com/users/fernandezpaco/repos",
    "events_url": "https://api.github.com/users/fernandezpaco/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fernandezpaco/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    },
    {
      "id": 1157707837,
      "node_id": "MDU6TGFiZWwxMTU3NzA3ODM3",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:rpc",
      "name": "area:rpc",
      "color": "d4c5f9",
      "default": false,
      "description": ""
    },
    {
      "id": 1817214928,
      "node_id": "MDU6TGFiZWwxODE3MjE0OTI4",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:tracer",
      "name": "area:tracer",
      "color": "2111b2",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-03-11T12:15:54Z",
  "updated_at": "2021-06-14T14:45:49Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "On the previous version was working fine but after upgrade it is returning an error\r\n\r\n\r\n#### System information\r\n\r\nGeth version: `v1.10.1`\r\nOS & Version: OSX\r\n\r\n#### Expected behaviour\r\nReturns trace data\r\n\r\n\r\n\r\n#### Actual behaviour\r\nReturns {code: -32000, message: 'required historical state unavailable (reexec=128)'}\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nCall debug_traceCall\r\n\r\n#### Backtrace\r\n\r\n````\r\nWARN [03-11|12:59:17.640] Served debug_traceCall                   conn=127.0.0.1:61534 reqid=0x6abebb6bba01c4a5414bea640b196737385c1d251637a0cabf2d5773eb8e30e8 t=36.822322ms  err=\"required historical state unavailable (reexec=128)\"\r\n````\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/796973465",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22485#issuecomment-796973465",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485",
    "id": 796973465,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5Njk3MzQ2NQ==",
    "user": {
      "login": "fernandezpaco",
      "id": 6205118,
      "node_id": "MDQ6VXNlcjYyMDUxMTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6205118?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fernandezpaco",
      "html_url": "https://github.com/fernandezpaco",
      "followers_url": "https://api.github.com/users/fernandezpaco/followers",
      "following_url": "https://api.github.com/users/fernandezpaco/following{/other_user}",
      "gists_url": "https://api.github.com/users/fernandezpaco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fernandezpaco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fernandezpaco/subscriptions",
      "organizations_url": "https://api.github.com/users/fernandezpaco/orgs",
      "repos_url": "https://api.github.com/users/fernandezpaco/repos",
      "events_url": "https://api.github.com/users/fernandezpaco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fernandezpaco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-11T19:08:21Z",
    "updated_at": "2021-03-11T19:08:21Z",
    "author_association": "NONE",
    "body": "Update:\r\n\r\nIf i start the node with --snapshot=false then tracing works for a while and then stops working again\r\n\r\nim using debug_traceCall to trace pending transactions so no historical data should be needed\r\n\r\nThis was working fine on 1.9.25",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/796973465/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/796981882",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22485#issuecomment-796981882",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485",
    "id": 796981882,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5Njk4MTg4Mg==",
    "user": {
      "login": "fernandezpaco",
      "id": 6205118,
      "node_id": "MDQ6VXNlcjYyMDUxMTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6205118?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fernandezpaco",
      "html_url": "https://github.com/fernandezpaco",
      "followers_url": "https://api.github.com/users/fernandezpaco/followers",
      "following_url": "https://api.github.com/users/fernandezpaco/following{/other_user}",
      "gists_url": "https://api.github.com/users/fernandezpaco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fernandezpaco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fernandezpaco/subscriptions",
      "organizations_url": "https://api.github.com/users/fernandezpaco/orgs",
      "repos_url": "https://api.github.com/users/fernandezpaco/repos",
      "events_url": "https://api.github.com/users/fernandezpaco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fernandezpaco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-11T19:22:50Z",
    "updated_at": "2021-03-12T07:18:21Z",
    "author_association": "NONE",
    "body": "Update:\r\n\r\nif i run it with preimage (--cache.preimages) then crashes\r\n```\r\nERROR[03-11|20:21:07.508] RPC method debug_traceCall crashed: runtime error: invalid memory address or nil pointer dereference\r\ngoroutine 105565 [running]:\r\ngithub.com/ethereum/go-ethereum/rpc.(*callback).call.func1(0xc0e58d1d30, 0xf, 0xc01527fd58)\r\n\tgithub.com/ethereum/go-ethereum/rpc/service.go:200 +0xbd\r\npanic(0x4e5e500, 0x5ac2a90)\r\n\truntime/panic.go:965 +0x1b9\r\ngithub.com/ethereum/go-ethereum/core/types.(*Block).NumberU64(...)\r\n\tgithub.com/ethereum/go-ethereum/core/types/block.go:312\r\ngithub.com/ethereum/go-ethereum/eth.(*Ethereum).stateAtBlock(0xc00a125950, 0xc00016a120, 0x80, 0xc02f7be9c0, 0x0, 0x0, 0x0)\r\n\tgithub.com/ethereum/go-ethereum/eth/state_accessor.go:88 +0x10bd\r\ngithub.com/ethereum/go-ethereum/eth.(*EthAPIBackend).StateAtBlock(0xc00173f860, 0x520d978, 0xc0c077ed00, 0xc012c14090, 0x80, 0x0, 0x0, 0x4dfc240, 0xc04838a8e0)\r\n\tgithub.com/ethereum/go-ethereum/eth/api_backend.go:336 +0x45\r\ngithub.com/ethereum/go-ethereum/eth/tracers.(*API).TraceCall(0xc0010cb060, 0x520d978, 0xc0c077ed00, 0xc10c843d58, 0xc10c843d70, 0x0, 0x0, 0xc11b9b8620, 0xc0dd3e21b0, 0x0, ...)\r\n\tgithub.com/ethereum/go-ethereum/eth/tracers/api.go:707 +0x151\r\nreflect.Value.call(0xc01382f500, 0xc01383e538, 0x13, 0x4fe1485, 0x4, 0xc0c37e5e00, 0x5, 0x5, 0xc0c37e5e30, 0xc0d8a57090, ...)\r\n\treflect/value.go:476 +0x8e7\r\nreflect.Value.Call(0xc01382f500, 0xc01383e538, 0x13, 0xc0c37e5e00, 0x5, 0x5, 0x0, 0x0, 0xc041354c80)\r\n\treflect/value.go:337 +0xb9\r\ngithub.com/ethereum/go-ethereum/rpc.(*callback).call(0xc0138530e0, 0x520d978, 0xc0c077ed00, 0xc0e58d1d30, 0xf, 0xc0d8a57090, 0x3, 0x3, 0x0, 0x0, ...)\r\n\tgithub.com/ethereum/go-ethereum/rpc/service.go:206 +0x2c5\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).runMethod(0xc04fb595f0, 0x520d978, 0xc0c077ed00, 0xc1072af2d0, 0xc0138530e0, 0xc0d8a57090, 0x3, 0x3, 0x3)\r\n\tgithub.com/ethereum/go-ethereum/rpc/handler.go:389 +0x8a\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleCall(0xc04fb595f0, 0xc0cea31bc0, 0xc1072af2d0, 0x203033)\r\n\tgithub.com/ethereum/go-ethereum/rpc/handler.go:337 +0x265\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg(0xc04fb595f0, 0xc0cea31bc0, 0xc1072af2d0, 0x51ffe01)\r\n\tgithub.com/ethereum/go-ethereum/rpc/handler.go:298 +0x1be\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1(0xc0cea31bc0)\r\n\tgithub.com/ethereum/go-ethereum/rpc/handler.go:139 +0x46\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1(0xc04fb595f0, 0xc0dd3e2198)\r\n\tgithub.com/ethereum/go-ethereum/rpc/handler.go:226 +0xd2\r\ncreated by github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc\r\n\tgithub.com/ethereum/go-ethereum/rpc/handler.go:222 +0x66\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/796981882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/797291295",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22485#issuecomment-797291295",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485",
    "id": 797291295,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5NzI5MTI5NQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-12T07:22:06Z",
    "updated_at": "2021-03-12T07:22:06Z",
    "author_association": "MEMBER",
    "body": "Yeah, funky condition here: \r\n```golang\r\n\t\tif block = eth.blockchain.GetBlockByNumber(block.NumberU64() + 1); block == nil {\r\n\t\t\treturn nil, nil, fmt.Errorf(\"block #%d not found\", block.NumberU64()+1)\r\n\t\t}\r\n\r\n```\r\nI.e, if `block == nil`, then print out `block.NumberU64()+1`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/797291295/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/860726316",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22485#issuecomment-860726316",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485",
    "id": 860726316,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MDcyNjMxNg==",
    "user": {
      "login": "huahuayu",
      "id": 1725060,
      "node_id": "MDQ6VXNlcjE3MjUwNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1725060?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huahuayu",
      "html_url": "https://github.com/huahuayu",
      "followers_url": "https://api.github.com/users/huahuayu/followers",
      "following_url": "https://api.github.com/users/huahuayu/following{/other_user}",
      "gists_url": "https://api.github.com/users/huahuayu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huahuayu/subscriptions",
      "organizations_url": "https://api.github.com/users/huahuayu/orgs",
      "repos_url": "https://api.github.com/users/huahuayu/repos",
      "events_url": "https://api.github.com/users/huahuayu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huahuayu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-14T14:23:26Z",
    "updated_at": "2021-06-14T14:41:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "> im using debug_traceCall to trace pending transactions\r\n\r\nhi @fernandezpaco I am looking for a working example for this function just exactly as you described.\r\n\r\nI read all the testcases about `traceCall` in the code base, one is `func TestTraceCall(t *testing.T)` and another is `func TestOverridenTraceCall(t *testing.T)` , also read a [document](https://geth.ethereum.org/docs/dapp/tracing), but still don't know how to do it in practice. Could you kindly share an example?\r\n\r\nHope your problem been solved!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/860726316/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/860743555",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22485#issuecomment-860743555",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22485",
    "id": 860743555,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MDc0MzU1NQ==",
    "user": {
      "login": "huahuayu",
      "id": 1725060,
      "node_id": "MDQ6VXNlcjE3MjUwNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1725060?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huahuayu",
      "html_url": "https://github.com/huahuayu",
      "followers_url": "https://api.github.com/users/huahuayu/followers",
      "following_url": "https://api.github.com/users/huahuayu/following{/other_user}",
      "gists_url": "https://api.github.com/users/huahuayu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huahuayu/subscriptions",
      "organizations_url": "https://api.github.com/users/huahuayu/orgs",
      "repos_url": "https://api.github.com/users/huahuayu/repos",
      "events_url": "https://api.github.com/users/huahuayu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huahuayu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-14T14:45:49Z",
    "updated_at": "2021-06-14T14:45:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "hey, I found [this](https://geth.ethereum.org/docs/rpc/ns-debug#example-3) document and example really helps!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/860743555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
