{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23559",
  "id": 992504570,
  "node_id": "MDU6SXNzdWU5OTI1MDQ1NzA=",
  "number": 23559,
  "title": "inconsistent JS tracer fails",
  "user": {
    "login": "tanmaster",
    "id": 3981445,
    "node_id": "MDQ6VXNlcjM5ODE0NDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3981445?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tanmaster",
    "html_url": "https://github.com/tanmaster",
    "followers_url": "https://api.github.com/users/tanmaster/followers",
    "following_url": "https://api.github.com/users/tanmaster/following{/other_user}",
    "gists_url": "https://api.github.com/users/tanmaster/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tanmaster/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tanmaster/subscriptions",
    "organizations_url": "https://api.github.com/users/tanmaster/orgs",
    "repos_url": "https://api.github.com/users/tanmaster/repos",
    "events_url": "https://api.github.com/users/tanmaster/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tanmaster/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2021-09-09T18:18:27Z",
  "updated_at": "2021-09-28T19:50:23Z",
  "closed_at": "2021-09-28T11:06:19Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.10.6-stable`, `1.10.9-unstable`\r\nOS & Version: Linux\r\nCommit hash : `576681f29b895dd39e559b7ba17fcd89b42e4833`, `90987db7334c1d10eb866ca550efedb66dea8a20`\r\n\r\n#### Expected behaviour\r\nI am trying to do chain tracing from block 0 until now using a custom JS tracer. We want to extract data which otherwise would be difficult to obtain. \r\n\r\n#### Actual behaviour\r\nHowever we are experiencing seemingly _random_ aborts of the tracings. At first I thought it was due to my js code, but after further experimenting I found that using even the `noop_tracer.js` can produce these random aborts. Here are some of the error logs when the abort happens: \r\n\r\n```\r\n- WARN [09-09|15:54:50.297] Chain tracing failed                     start=0          end=12,300,000 transactions=1,127,999 elapsed=10m16.166119292s err=\"missing trie node fe7d23a257f7528f27cb8d821f9212cdb4ce1835eca729e16464be6423ad1ae2 (path 03)\"\r\n- WARN [09-09|16:01:39.373] Tracing failed                           hash=9fe770..825038 block=531,280 err=\"tracing failed: insufficient funds for gas * price + value: address 0xa6BDc31c431B8F97848c9D60cbbe9660dc450eB7 have 5159916608128893981 want 5165818380000000000\"\r\n- WARN [09-09|16:01:39.984] Chain tracing failed                     start=0          end=12,300,000 transactions=566,584   elapsed=4m59.667592415s  err=\"processing block 531280 failed: could not apply tx 6 [0x9fe77018a2ecc3a011c74dc95b040c86050f67aa84e4f3f82bfc5c9837825038]: insufficient funds for gas * price + value: address 0xa6BDc31c431B8F97848c9D60cbbe9660dc450eB7 have 5159916608128893981 want 5165818380000000000\"\r\n- WARN [09-09|16:06:47.806] Chain tracing failed                     start=0          end=12,300,000 transactions=305,093 elapsed=2m31.62350779s  err=\"can't create storage trie: missing trie node ba59fa34a843ee0ac546128f5f1e9f4c889d38bf060948ecca48a0412b7107c0 (path )\"\r\n- WARN [09-09|16:11:57.855] Chain tracing failed                     start=0          end=12,300,000 transactions=207,006 elapsed=1m51.909702218s err=\"missing trie node 7f0767d73909ad822e4e811db203e6e6781cffdd46d082644ab4262bd6fb7c72 (path 0d0008)\"\r\n- WARN [09-09|19:29:08.723] Chain tracing failed                     start=0          end=13,000,000 transactions=542,976 elapsed=4m18.446828689s err=\"processing block 519064 failed: could not apply tx 1 [0x0c7706562bab01109373b69db37530eb3acd1ae711b709a5395ca23c1f31bef3]: gas limit reached\"\r\n```\r\n\r\nWhats even more frustrating is that these happen inconsistently and I can't reproduce the failures at the same transaction between different runs. For what it's worth, I could confirm this behavior on two different machines on two different versions of geth. The logs also make me think that the fails are due to different causes, which would make this even more annoying.\r\n\r\nThe furthest I was able to trace was up to block ~2M\r\n#### Steps to reproduce the behaviour (it eventually happens...)\r\nGeth is started with:\r\n\r\n```\r\ngeth \\\r\n--datadir='/mnt/7F050DA422DCAB55/.ethereum' \\\r\n--txlookuplimit=0 \\\r\n--verbosity=3 \\\r\n--vmdebug \\\r\n--maxpeers=0 \r\n```\r\n\r\nIPC socket tracer command (using `nc -U geth.ipc`): \r\n```\r\n{\"id\": 1, \"method\": \"debug_subscribe\", \"params\": [\"traceChain\", \"0x0\", \"0xc65d40\", {\"tracer\": \"{step: function(log, db) { }, fault: function(log, db) { }, result: function(ctx, db) { return {}; }}\", \"timeout\": \"10000s\"}]}\r\n```\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/924137134",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-924137134",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 924137134,
    "node_id": "IC_kwDOAOvK9843FTau",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-21T16:10:34Z",
    "updated_at": "2021-09-22T08:09:51Z",
    "author_association": "MEMBER",
    "body": "I was able to reproduce this. Funnily enough my error contains the same address:\r\n\r\n```\r\nWARN [09-21|15:13:41.060] Tracing failed                           hash=746e11..0532bc block=532,825 err=\"tracing failed: insufficient funds for gas * price + value: address 0xa6BDc31c431B8F97848c9D60cbbe9660dc450eB7 have 5011163958128893981 want 5014107070000000000\"\r\nWARN [09-21|15:13:41.352] Chain tracing failed                     start=0 end=13,000,000 transactions=568,482 elapsed=33m56.98872039s  err=\"processing block 532825 failed: could not apply tx 3 [0x746e11c653adc14484ef9ab3cd7ef47c926a0e13d88474d9e798ac6d660532bc]: insufficient funds for gas * price + value: address 0xa6BDc31c431B8F97848c9D60cbbe9660dc450eB7 have 5011163958128893981 want 5014107070000000000\"\r\n```\r\n\r\nEdit: on a second run:\r\n\r\n```\r\nWARN [09-21|16:44:17.073] Chain tracing failed                     start=0 end=13,000,000 transactions=551,324 elapsed=32m48.451866988s err=\"commit aborted due to earlier\r\nerror: getDeleteStateObject (22d7957d81497cc48c1020de201b07fc526a0c59) error: missing trie node 33591eee04145bdd97b9d824b81d4852772e2adc3e8790bdfa5dc71a276a14d0 (path 0d00\r\n)\"\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/924137134/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/924742235",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-924742235",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 924742235,
    "node_id": "IC_kwDOAOvK9843HnJb",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T09:19:14Z",
    "updated_at": "2021-09-22T09:19:14Z",
    "author_association": "MEMBER",
    "body": "Hm, `5,014,107,078,128,893,981` is the true value of that account right then. The cost is indeed `5,014,107,070,000,000,000`. \r\n\r\nWhat's odd about this, IMO, is that if we had an underlying trie error, I'd expect the value-lookup to return `0` balance. Not a \"nearly but not quite correct\" value.  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/924742235/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/925051042",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-925051042",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 925051042,
    "node_id": "IC_kwDOAOvK9843Iyii",
    "user": {
      "login": "evertonfraga",
      "id": 47108,
      "node_id": "MDQ6VXNlcjQ3MTA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/47108?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/evertonfraga",
      "html_url": "https://github.com/evertonfraga",
      "followers_url": "https://api.github.com/users/evertonfraga/followers",
      "following_url": "https://api.github.com/users/evertonfraga/following{/other_user}",
      "gists_url": "https://api.github.com/users/evertonfraga/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/evertonfraga/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/evertonfraga/subscriptions",
      "organizations_url": "https://api.github.com/users/evertonfraga/orgs",
      "repos_url": "https://api.github.com/users/evertonfraga/repos",
      "events_url": "https://api.github.com/users/evertonfraga/events{/privacy}",
      "received_events_url": "https://api.github.com/users/evertonfraga/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T15:42:28Z",
    "updated_at": "2021-09-22T15:43:06Z",
    "author_association": "MEMBER",
    "body": "The address `0xa6BDc31c431B8F97848c9D60cbbe9660dc450eB7` had mined several blocks prior to the transaction mentioned above. The closest block was mined only 9 blocks before it.\r\n\r\n- transaction with failed trace: https://etherscan.io/tx/0x746e11c653adc14484ef9ab3cd7ef47c926a0e13d88474d9e798ac6d660532bc\r\n- block mined by the sender of failed trace, nine blocks before the transaction above https://etherscan.io/block/532816\r\n\r\nIs it possible the account balance wasn't fetched/updated correctly in the context of tracing?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/925051042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/925099520",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-925099520",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 925099520,
    "node_id": "IC_kwDOAOvK9843I-YA",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T16:41:43Z",
    "updated_at": "2021-09-22T16:41:43Z",
    "author_association": "MEMBER",
    "body": ">      Is it possible the account balance wasn't fetched/updated correctly in the context of tracing?\r\n\r\nYes I had the same idea, but it's not as straight-forward as that. On the upside, I am now able to somewhat reliably reproduce it, so I'm throwing various debug code at it to narrow it down further.  \r\n\r\nWhat makes it a bit hard is that \"reliably repro\" still means it takes ~4 minutes of tracing for it to hit, and it doesn't happen on the same place each time -- even rerunning the tracing without restarting the node doesn't make it hit on the same place. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/925099520/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/925105017",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-925105017",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 925105017,
    "node_id": "IC_kwDOAOvK9843I_t5",
    "user": {
      "login": "evertonfraga",
      "id": 47108,
      "node_id": "MDQ6VXNlcjQ3MTA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/47108?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/evertonfraga",
      "html_url": "https://github.com/evertonfraga",
      "followers_url": "https://api.github.com/users/evertonfraga/followers",
      "following_url": "https://api.github.com/users/evertonfraga/following{/other_user}",
      "gists_url": "https://api.github.com/users/evertonfraga/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/evertonfraga/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/evertonfraga/subscriptions",
      "organizations_url": "https://api.github.com/users/evertonfraga/orgs",
      "repos_url": "https://api.github.com/users/evertonfraga/repos",
      "events_url": "https://api.github.com/users/evertonfraga/events{/privacy}",
      "received_events_url": "https://api.github.com/users/evertonfraga/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T16:49:45Z",
    "updated_at": "2021-09-22T16:49:45Z",
    "author_association": "MEMBER",
    "body": "FWIW, I also found that the OP report also had the same account producing a block just 10 blocks before. \r\n\r\n- address: 0xa6BDc31c431B8F97848c9D60cbbe9660dc450eB7\r\n- tx: 0x9fe77018a2ecc3a011c74dc95b040c86050f67aa84e4f3f82bfc5c9837825038 (block 531280)\r\n- mined block: https://etherscan.io/block/531270\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/925105017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/926715575",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-926715575",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 926715575,
    "node_id": "IC_kwDOAOvK9843PI63",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-24T15:25:14Z",
    "updated_at": "2021-09-24T15:25:14Z",
    "author_association": "MEMBER",
    "body": "I'm fairly certain that the root cause has been identified, and it's fixed by https://github.com/ethereum/go-ethereum/pull/23632 . Please give it a test and report back if it seems to work. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/926715575/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927091639",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-927091639",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 927091639,
    "node_id": "IC_kwDOAOvK9843Qku3",
    "user": {
      "login": "tanmaster",
      "id": 3981445,
      "node_id": "MDQ6VXNlcjM5ODE0NDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3981445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tanmaster",
      "html_url": "https://github.com/tanmaster",
      "followers_url": "https://api.github.com/users/tanmaster/followers",
      "following_url": "https://api.github.com/users/tanmaster/following{/other_user}",
      "gists_url": "https://api.github.com/users/tanmaster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tanmaster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tanmaster/subscriptions",
      "organizations_url": "https://api.github.com/users/tanmaster/orgs",
      "repos_url": "https://api.github.com/users/tanmaster/repos",
      "events_url": "https://api.github.com/users/tanmaster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tanmaster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-25T09:02:22Z",
    "updated_at": "2021-09-25T09:02:22Z",
    "author_association": "NONE",
    "body": "> I'm fairly certain that the root cause has been identified, and it's fixed by #23632 . Please give it a test and report back if it seems to work.\r\n\r\nIt sure looks like the fix is working. I let the script run overnight and had no fail so far, whereas before it would almost certainly fail after a couple of hours. \r\n\r\nThank's a lot for your work everyone, it is very much appreciated ðŸ™",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927091639/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927092349",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-927092349",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 927092349,
    "node_id": "IC_kwDOAOvK9843Qk59",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-25T09:07:58Z",
    "updated_at": "2021-09-25T09:07:58Z",
    "author_association": "MEMBER",
    "body": ">  I let the script run overnight and had no fail so far, whereas before it would almost certainly fail after a couple of hours.\r\n\r\nGreat, thanks for reporting back! \r\nJust FYI: if you trace long sequences, with the way it works currently, it's guaranteed to go OOM eventually. The chaintracer never flushes to disk (it does memory garbage collection though). Also, it never \"resets\" the base disk image, which is whatever you started tracing at (so e.g. genesis). \r\n\r\nSo instead of tracing 0-13M blocks, it's better to trace e.g. 0-1M, 1M-2M, etc. We might fix something so it automatically clears out the in-memory data and starts from a new disk trie at certain intervals, but that's how it is right now. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927092349/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927093326",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-927093326",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 927093326,
    "node_id": "IC_kwDOAOvK9843QlJO",
    "user": {
      "login": "tanmaster",
      "id": 3981445,
      "node_id": "MDQ6VXNlcjM5ODE0NDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3981445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tanmaster",
      "html_url": "https://github.com/tanmaster",
      "followers_url": "https://api.github.com/users/tanmaster/followers",
      "following_url": "https://api.github.com/users/tanmaster/following{/other_user}",
      "gists_url": "https://api.github.com/users/tanmaster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tanmaster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tanmaster/subscriptions",
      "organizations_url": "https://api.github.com/users/tanmaster/orgs",
      "repos_url": "https://api.github.com/users/tanmaster/repos",
      "events_url": "https://api.github.com/users/tanmaster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tanmaster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-25T09:17:29Z",
    "updated_at": "2021-09-25T09:18:35Z",
    "author_association": "NONE",
    "body": "> So instead of tracing 0-13M blocks, it's better to trace e.g. 0-1M, 1M-2M, etc. We might fix something so it automatically clears out the in-memory data and starts from a new disk trie at certain intervals, but that's how it is right now.\r\n\r\nThanks for the heads up. That would actually benefit us even more because once we're done with 0-13M, we'd need to trace 13-14M at some point. However we also want to do this while not having to run a full archive node. Is that possible with your suggestion? \r\n\r\nCurrently when I try to continue tracing from a point where I previously had stopped, I get an error like this:\r\n\r\n`WARN [09-25|11:15:26.160] Chain tracing failed                     start=50000     end=100,000    transactions=0          elapsed=133.902753ms        err=\"required historical state unavailable (reexec=128)\"\r\n`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927093326/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927102931",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-927102931",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 927102931,
    "node_id": "IC_kwDOAOvK9843QnfT",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-25T10:46:21Z",
    "updated_at": "2021-09-25T10:46:21Z",
    "author_association": "MEMBER",
    "body": "You can give this a spin - it will work badly on archive nodes, but probably work ok on a normal node. Whenever it finds a disk-root, it will throw away the mem-trie and start fresh. Should handle arbitrary long range of blocks.Â ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927102931/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927103086",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-927103086",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 927103086,
    "node_id": "IC_kwDOAOvK9843Qnhu",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-25T10:47:45Z",
    "updated_at": "2021-09-25T10:47:45Z",
    "author_association": "MEMBER",
    "body": "...and the link:Â https://github.com/holiman/go-ethereum/commit/fcd22b0e2eb8a961dbce0657f27432368675a5d9",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927103086/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/929345312",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-929345312",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 929345312,
    "node_id": "IC_kwDOAOvK9843ZK8g",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-28T15:36:54Z",
    "updated_at": "2021-09-28T15:36:54Z",
    "author_association": "MEMBER",
    "body": "> Whenever it finds a disk-root, it will throw away the mem-trie and start fresh.\r\n\r\nJust wanted to add to what @holiman said: you can use #23646 to find out for which blocks you have the state on disk. It's possible to start the chain tracer from those blocks. But if you did a fast/snap sync then up until the first synced state there'll be no state on disk. So that means it's not right now possible to start the chain tracer from blocks [1, firstSyncedBlock).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/929345312/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/929391839",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-929391839",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 929391839,
    "node_id": "IC_kwDOAOvK9843ZWTf",
    "user": {
      "login": "tanmaster",
      "id": 3981445,
      "node_id": "MDQ6VXNlcjM5ODE0NDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3981445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tanmaster",
      "html_url": "https://github.com/tanmaster",
      "followers_url": "https://api.github.com/users/tanmaster/followers",
      "following_url": "https://api.github.com/users/tanmaster/following{/other_user}",
      "gists_url": "https://api.github.com/users/tanmaster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tanmaster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tanmaster/subscriptions",
      "organizations_url": "https://api.github.com/users/tanmaster/orgs",
      "repos_url": "https://api.github.com/users/tanmaster/repos",
      "events_url": "https://api.github.com/users/tanmaster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tanmaster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-28T16:34:06Z",
    "updated_at": "2021-09-28T16:34:23Z",
    "author_association": "NONE",
    "body": "> Just wanted to add to what @holiman said: you can use #23646 to find out for which blocks you have the state on disk. It's possible to start the chain tracer from those blocks. But if you did a fast/snap sync then up until the first synced state there'll be no state on disk. So that means it's not right now possible to start the chain tracer from blocks [1, firstSyncedBlock).\r\n\r\nThanks for the addition, that's very valuable information for us :pray: \r\nSo if the chain data was synchronized using the syncmode=full flag, there are some states that will permanently stay on my machine which I can use as anchors to start tracing? Is it defined somewhere how regularly the states are flushed? By what are these flushes triggered?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/929391839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/929496208",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-929496208",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 929496208,
    "node_id": "IC_kwDOAOvK9843ZvyQ",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-28T18:01:43Z",
    "updated_at": "2021-09-28T18:02:26Z",
    "author_association": "MEMBER",
    "body": "> there are some states that will permanently stay on my machine which I can use as anchors to start tracing?\r\n\r\nYes\r\n\r\n> By what are these flushes triggered?\r\n\r\nEither memory constraints _or_ ~1h of EVM processing, which usually means every ~10-15K blocks, _or_ node restart",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/929496208/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/929573522",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23559#issuecomment-929573522",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23559",
    "id": 929573522,
    "node_id": "IC_kwDOAOvK9843aCqS",
    "user": {
      "login": "tanmaster",
      "id": 3981445,
      "node_id": "MDQ6VXNlcjM5ODE0NDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3981445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tanmaster",
      "html_url": "https://github.com/tanmaster",
      "followers_url": "https://api.github.com/users/tanmaster/followers",
      "following_url": "https://api.github.com/users/tanmaster/following{/other_user}",
      "gists_url": "https://api.github.com/users/tanmaster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tanmaster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tanmaster/subscriptions",
      "organizations_url": "https://api.github.com/users/tanmaster/orgs",
      "repos_url": "https://api.github.com/users/tanmaster/repos",
      "events_url": "https://api.github.com/users/tanmaster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tanmaster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-28T19:50:23Z",
    "updated_at": "2021-09-28T19:50:23Z",
    "author_association": "NONE",
    "body": "> Either memory constraints _or_ ~1h of EVM processing, which usually means every ~10-15K blocks, _or_ node restart\n\nThat sounds exactly like what I need, thanks a lot everyone ðŸ˜ŒðŸ¤©",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/929573522/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
