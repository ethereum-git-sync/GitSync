{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24125",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24125/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24125/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24125/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/24125",
  "id": 1083412550,
  "node_id": "I_kwDOAOvK985Ak5BG",
  "number": 24125,
  "title": "geth preload option not working?",
  "user": {
    "login": "Paulohvk",
    "id": 62555441,
    "node_id": "MDQ6VXNlcjYyNTU1NDQx",
    "avatar_url": "https://avatars.githubusercontent.com/u/62555441?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Paulohvk",
    "html_url": "https://github.com/Paulohvk",
    "followers_url": "https://api.github.com/users/Paulohvk/followers",
    "following_url": "https://api.github.com/users/Paulohvk/following{/other_user}",
    "gists_url": "https://api.github.com/users/Paulohvk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Paulohvk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Paulohvk/subscriptions",
    "organizations_url": "https://api.github.com/users/Paulohvk/orgs",
    "repos_url": "https://api.github.com/users/Paulohvk/repos",
    "events_url": "https://api.github.com/users/Paulohvk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Paulohvk/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "s1na",
    "id": 1591639,
    "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/s1na",
    "html_url": "https://github.com/s1na",
    "followers_url": "https://api.github.com/users/s1na/followers",
    "following_url": "https://api.github.com/users/s1na/following{/other_user}",
    "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
    "organizations_url": "https://api.github.com/users/s1na/orgs",
    "repos_url": "https://api.github.com/users/s1na/repos",
    "events_url": "https://api.github.com/users/s1na/events{/privacy}",
    "received_events_url": "https://api.github.com/users/s1na/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-12-17T16:14:50Z",
  "updated_at": "2022-01-20T09:55:54Z",
  "closed_at": "2022-01-20T09:54:06Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi,\r\n\r\napologies for cross posting, but I am having the same issue as in [this thread](https://github.com/ethereum/go-ethereum/issues/21190), which hasn't been resolved.\r\n\r\n#### System information\r\n\r\nGeth version: `geth version` 1.10.9\r\nConsensus: Clique PoA\r\nOS & Version: Ubuntu 20.04\r\n\r\n#### Expected behaviour\r\nBasically, I have a private geth network with 2 nodes (only 1 miner) connected to each other. However, recently I noticed that my miner is not mining automatically anymore (I used to use the script provided in [this thread](https://ethereum.stackexchange.com/questions/3151/how-to-make-miner-to-mine-only-when-there-are-pending-transactions/3152#3152) to mine only non-empty blocks) by doing:\r\n\r\n`geth --datadir ./Node1/ --preload './mineWhenNeeded.js'`\r\n\r\nHowever, it seems that geth is not able to load the script, as whenever I perform a transaction through the geth console, the transaction shows up in txpool.status as pending and the eth.blockNumber never goes up.\r\n\r\n(I have also tried different paths to my script, which also do not work...)\r\n\r\n#### Actual behaviour\r\n\r\nHowever, if I attach to the geth console and load the script manually through loadScript then the script works fine and mines the pending block and stops mining afterwards.\r\n\r\nI use the following command in the geth console to load the script:\r\n\r\n`loadScript('./mineWhenNeeded.js')`\r\n\r\n#### Steps to reproduce the behaviour\r\n1 - Download and save the script provided [here](https://ethereum.stackexchange.com/questions/3151/how-to-make-miner-to-mine-only-when-there-are-pending-transactions/3152#3152).\r\n2 - Initialize the geth node by including the preload command trying to load the specified script.\r\n3 - Attach a geth console to the node.\r\n4 - Unlock account and send a transaction.\r\n5 - Verify that the script is not being loaded, as the transaction is eternally pending.\r\n6 - Manually load the script by using loadScript('./mineWhenNeeded.js'), which works as intended or manually start mining with miner.start(1) then miner.stop() to send transaction.\r\n\r\nAny thoughts on this?\r\n\r\nThanks in advance!",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24125/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24125/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1010830222",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24125#issuecomment-1010830222",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24125",
    "id": 1010830222,
    "node_id": "IC_kwDOAOvK9848QAuO",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-12T09:27:00Z",
    "updated_at": "2022-01-12T09:27:00Z",
    "author_association": "MEMBER",
    "body": "So the `--preload` flag is to be used as part of one of these commands: `console`, `attach`, `js`. I.e. you'd need to run:\r\n\r\n```sh\r\ngeth --datadir ./Node1/ --preload './mineWhenNeeded.js' console\r\n```\r\n\r\nThat's because by default running geth doesn't spin up a JS engine.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1010830222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1011155358",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24125#issuecomment-1011155358",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24125",
    "id": 1011155358,
    "node_id": "IC_kwDOAOvK9848RQGe",
    "user": {
      "login": "Paulohvk",
      "id": 62555441,
      "node_id": "MDQ6VXNlcjYyNTU1NDQx",
      "avatar_url": "https://avatars.githubusercontent.com/u/62555441?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Paulohvk",
      "html_url": "https://github.com/Paulohvk",
      "followers_url": "https://api.github.com/users/Paulohvk/followers",
      "following_url": "https://api.github.com/users/Paulohvk/following{/other_user}",
      "gists_url": "https://api.github.com/users/Paulohvk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Paulohvk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Paulohvk/subscriptions",
      "organizations_url": "https://api.github.com/users/Paulohvk/orgs",
      "repos_url": "https://api.github.com/users/Paulohvk/repos",
      "events_url": "https://api.github.com/users/Paulohvk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Paulohvk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-12T15:21:59Z",
    "updated_at": "2022-01-12T15:23:06Z",
    "author_association": "NONE",
    "body": "Hi,\r\n\r\nThank you very much for the feedback!\r\n\r\nUnfortunately by using the preload option followed by the console command, it still does not work, it just opens a console in the node, so I would have to manually load the script by using the loadScript command.\r\n\r\nHowever, by trying your other suggestions I managed to fix the issue, by using the following:\r\n\r\n`geth --datadir ./Node1/ js './mineWhenNeeded.js'`\r\n\r\nThis way, I avoid using the preload command (which still does not work), and use the js command to specify which script to run.\r\n\r\nBy the way, I also tried the preload command in geth versions 1.10.13 and 1.10.15 and the issue still persists.\r\n\r\nMany thanks again!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1011155358/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1017299272",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24125#issuecomment-1017299272",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24125",
    "id": 1017299272,
    "node_id": "IC_kwDOAOvK9848osFI",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-20T09:54:06Z",
    "updated_at": "2022-01-20T09:54:06Z",
    "author_association": "MEMBER",
    "body": "```\r\n$ geth --dev  --preload foo.js console\r\nINFO [01-20|10:52:49.186] Starting Geth in ephemeral dev mode... \r\n...\r\nINFO [01-20|10:52:49.441] Commit new mining work                   number=1 sealhash=b25d27..006aab uncles=0 txs=0 gas=0 fees=0 elapsed=\"109.096Âµs\"\r\nWARN [01-20|10:52:49.441] Block sealing failed                     err=\"sealing paused while waiting for transactions\"\r\ntest\r\nWelcome to the Geth JavaScript console!\r\n\r\ninstance: Geth/v1.10.16-unstable-b1f09596-20220116/linux-amd64/go1.17.3\r\ncoinbase: 0x33afe373bff5ef199d4e6ad1426281723fa4471d\r\nat block: 0 (Thu Jan 01 1970 01:00:00 GMT+0100 (CET))\r\n\r\n```\r\n```\r\n$ cat foo.js\r\nconsole.log(\"test\")\r\n```\r\nWorks fine for me. Please reopen if I've missed something",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1017299272/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1017300869",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24125#issuecomment-1017300869",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24125",
    "id": 1017300869,
    "node_id": "IC_kwDOAOvK9848oseF",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-20T09:55:53Z",
    "updated_at": "2022-01-20T09:55:53Z",
    "author_association": "MEMBER",
    "body": "And with a datadir somewhere else: \r\n```\r\n$ geth --nodiscover --maxpeers 0  --datadir=/tmp/foo --preload ./foo.js console\r\nINFO [01-20|10:55:10.394] Starting Geth on Ethereum mainnet... \r\n...\r\n\r\nINFO [01-20|10:55:10.706] New local node record                    seq=1,642,672,492,100 id=02a31fb57a600e77 ip=127.0.0.1 udp=0 tcp=30303\r\nINFO [01-20|10:55:10.706] Started P2P networking                   self=\"enode://3c2de9d51e8dd4df460eac99e2f7d29eb60ceb680ada88c50e4aebd3e4eb5a278d636bd7231930e8de81f614f5544d99ef969ac83d216da59371732c77349093@127.0.0.1:30303?discport=0\"\r\nINFO [01-20|10:55:10.707] IPC endpoint opened                      url=/tmp/foo/geth.ipc\r\nWARN [01-20|10:55:10.708] Disk space is running low. Geth will shutdown if disk space runs below critical level. available=1009.14MiB critical_level=887.00MiB\r\ntest\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1017300869/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
