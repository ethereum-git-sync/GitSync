{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24962",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24962/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24962/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24962/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/24962",
  "id": 1248320815,
  "node_id": "I_kwDOAOvK985KZ90v",
  "number": 24962,
  "title": "Fatal: Failed to register the Ethereum service: failed to retrieve genesis from ancient EOF",
  "user": {
    "login": "TheUniquePaulSmith",
    "id": 19433370,
    "node_id": "MDQ6VXNlcjE5NDMzMzcw",
    "avatar_url": "https://avatars.githubusercontent.com/u/19433370?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TheUniquePaulSmith",
    "html_url": "https://github.com/TheUniquePaulSmith",
    "followers_url": "https://api.github.com/users/TheUniquePaulSmith/followers",
    "following_url": "https://api.github.com/users/TheUniquePaulSmith/following{/other_user}",
    "gists_url": "https://api.github.com/users/TheUniquePaulSmith/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TheUniquePaulSmith/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TheUniquePaulSmith/subscriptions",
    "organizations_url": "https://api.github.com/users/TheUniquePaulSmith/orgs",
    "repos_url": "https://api.github.com/users/TheUniquePaulSmith/repos",
    "events_url": "https://api.github.com/users/TheUniquePaulSmith/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TheUniquePaulSmith/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-05-25T15:54:23Z",
  "updated_at": "2022-06-21T08:40:49Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n\r\n#### System information\r\nOS: `Ubuntu 20.04.4 LTS (Hyper-V VM)`\r\nRAM: `65536 MB`\r\nCPU: `12 vCPU ([2] Intel Xeon E5-2670)`\r\nOS Drive: `Samsung 960 Pro (Shared 62GB)`\r\nChaindata Drive: `Samsung 970Pro (1TB)`\r\nAncient Chaindata Drive: `Synology NAS 8TB`\r\n\r\nGeth version: `Geth\r\nVersion: 1.10.15-stable\r\nArchitecture: amd64\r\nGo Version: go1.16.4\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=/usr/local/go\r\n`\r\nOS & Version: `Linux`\r\n\r\nGeth Parameters: `/eth1/bin/geth --datadir /eth1/data --datadir.ancient /mnt/nas/data --port 30303 --mainnet --syncmode snap --txlookuplimit=0 --cache.preimages --cache=32768`\r\n\r\n#### Background\r\n\r\n- The server is connected to UPS, however due to length of power outage wasn't able to sustain power and was abruptly turned off on May 7th\r\n- Same applied to Synology storage hosting ancient chaindata\r\n- When the server restarted geth autostarted and failed to operate (presumably because of data corruption?)\r\n- Right before it failed it was \"Truncating dangling head\", what does that mean?\r\n\r\n\r\n#### Expected behaviour\r\n\r\n- Geth is able to restart or repair after unexpected power outage?\r\n- I've had other unexpected reboots that it was able to survive in the past\r\n\r\n#### Actual behaviour\r\n\r\n- Geth is unable to repair\\operate\r\n\r\n\r\n#### Snippet of Geth Log\r\n```\r\n-- Logs begin at Tue 2021-10-12 20:17:24 UTC, end at Wed 2022-05-25 15:15:40 UTC. --\r\nMay 25 15:10:09 ether geth[926]: Fatal: Failed to register the Ethereum service: failed to retrieve genesis from ancient EOF\r\nMay 25 15:10:09 ether geth[926]: INFO [05-25|15:10:09.268] Opened ancient database                  database=/mnt/nas/data             readonly=false\r\nMay 25 15:10:06 ether geth[926]: INFO [05-25|15:10:06.054] Allocated cache and file handles         database=/eth1/data/geth/chaindata cache=10.46GiB handles=262,144\r\nMay 25 15:10:06 ether geth[926]: INFO [05-25|15:10:06.053] Allocated trie memory caches             clean=3.14GiB dirty=5.23GiB\r\nMay 25 15:10:06 ether geth[926]: INFO [05-25|15:10:06.028] Set global gas cap                       cap=50,000,000\r\nMay 25 15:10:06 ether geth[926]: WARN [05-25|15:10:06.027] Sanitizing cache to Go's GC limits       provided=32768 updated=21421\r\nMay 25 15:10:06 ether geth[926]: INFO [05-25|15:10:06.024] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nMay 25 15:10:06 ether geth[926]: INFO [05-25|15:10:06.020] Maximum peer count                       ETH=50 LES=0 total=50\r\nMay 25 15:10:06 ether geth[926]: INFO [05-25|15:10:06.014] Starting Geth on Ethereum mainnet...\r\n-- Reboot --\r\nMay 07 16:22:57 ether geth[961]: Fatal: Failed to register the Ethereum service: failed to retrieve genesis from ancient EOF\r\nMay 07 16:22:57 ether geth[961]: INFO [05-07|16:22:57.573] Opened ancient database                  database=/mnt/nas/data             readonly=false\r\nMay 07 16:22:57 ether geth[961]: WARN [05-07|16:22:57.553] Truncating dangling head                 database=/mnt/nas/data             table=receipts indexed=0.00B stored=1.86GiB\r\nMay 07 16:22:57 ether geth[961]: WARN [05-07|16:22:57.534] Truncating dangling head                 database=/mnt/nas/data             table=bodies  indexed=0.00B stored=1.86GiB\r\nMay 07 16:22:57 ether geth[961]: WARN [05-07|16:22:57.230] Truncating dangling head                 database=/mnt/nas/data             table=hashes  indexed=0.00B stored=446.80MiB\r\nMay 07 16:22:56 ether geth[961]: WARN [05-07|16:22:56.077] Truncating dangling head                 database=/mnt/nas/data             table=headers indexed=0.00B stored=1.86GiB\r\nMay 07 16:22:55 ether geth[961]: WARN [05-07|16:22:55.791] Truncating dangling head                 database=/mnt/nas/data             table=diffs indexed=0.00B stored=146.59MiB\r\nMay 07 16:22:35 ether geth[961]: INFO [05-07|16:22:35.162] Allocated cache and file handles         database=/eth1/data/geth/chaindata cache=10.46GiB handles=262,144\r\nMay 07 16:22:35 ether geth[961]: INFO [05-07|16:22:35.158] Allocated trie memory caches             clean=3.14GiB dirty=5.23GiB\r\nMay 07 16:22:35 ether geth[961]: INFO [05-07|16:22:35.130] Set global gas cap                       cap=50,000,000\r\nMay 07 16:22:35 ether geth[961]: WARN [05-07|16:22:35.127] Sanitizing cache to Go's GC limits       provided=32768 updated=21421\r\nMay 07 16:22:35 ether geth[961]: INFO [05-07|16:22:35.124] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nMay 07 16:22:35 ether geth[961]: INFO [05-07|16:22:35.123] Maximum peer count                       ETH=50 LES=0 total=50\r\nMay 07 16:22:35 ether geth[961]: INFO [05-07|16:22:35.115] Starting Geth on Ethereum mainnet...\r\n-- Reboot --\r\nMay 07 15:57:31 ether geth[935]: INFO [05-07|15:57:31.963] Deep froze chain segment                 blocks=9   elapsed=41.509ms  number=14,640,693 hash=e3f3cf..0f7c8b\r\nMay 07 15:57:30 ether geth[935]: INFO [05-07|15:57:30.738] Imported new chain segment               blocks=1   txs=55    mgas=7.210    elapsed=65.197ms  mgasps=110.587 number=14,730,693 hash=161df7..f9b20f dirty=4.60GiB\r\nMay 07 15:57:22 ether geth[935]: INFO [05-07|15:57:22.164] Imported new chain segment               blocks=1   txs=80    mgas=9.064    elapsed=103.856ms mgasps=87.274  number=14,730,692 hash=24a488..9aea98 dirty=4.60GiB\r\nMay 07 15:57:19 ether geth[935]: INFO [05-07|15:57:19.600] Imported new chain segment               blocks=1   txs=409   mgas=28.139   elapsed=308.498ms mgasps=91.214  number=14,730,691 hash=b79df7..20d48f dirty=4.60GiB\r\nMay 07 15:57:00 ether geth[935]: INFO [05-07|15:57:00.002] Imported new chain segment               blocks=1   txs=51    mgas=5.443    elapsed=65.991ms  mgasps=82.483  number=14,730,690 hash=23ab1d..b2c34a dirty=4.59GiB\r\nMay 07 15:56:57 ether geth[935]: INFO [05-07|15:56:57.279] Imported new chain segment               blocks=1   txs=45    mgas=3.795    elapsed=71.906ms  mgasps=52.776  number=14,730,689 hash=449021..a38889 dirty=4.59GiB\r\nMay 07 15:56:55 ether geth[935]: INFO [05-07|15:56:55.918] Imported new chain segment               blocks=1   txs=121   mgas=14.633   elapsed=168.368ms mgasps=86.909  number=14,730,688 hash=679da2..fe720a dirty=4.59GiB\r\nMay 07 15:56:47 ether geth[935]: INFO [05-07|15:56:47.558] Imported new chain segment               blocks=1   txs=40    mgas=3.846    elapsed=71.131ms  mgasps=54.067  number=14,730,687 hash=8801ed..b7ca78 dirty=4.59GiB\r\nMay 07 15:56:46 ether geth[935]: INFO [05-07|15:56:46.231] Imported new chain segment               blocks=1   txs=53    mgas=3.431    elapsed=54.795ms  mgasps=62.614  number=14,730,686 hash=33985e..9edc05 dirty=4.60GiB\r\nMay 07 15:56:39 ether geth[935]: INFO [05-07|15:56:39.009] Imported new chain segment               blocks=1   txs=200   mgas=15.225   elapsed=165.255ms mgasps=92.129  number=14,730,685 hash=deb566..b9b68f dirty=4.60GiB\r\nMay 07 15:56:31 ether geth[935]: INFO [05-07|15:56:31.921] Deep froze chain segment                 blocks=6   elapsed=33.380ms  number=14,640,684 hash=4c9fcd..c49c53\r\nMay 07 15:56:30 ether geth[935]: INFO [05-07|15:56:30.399] Imported new chain segment               blocks=1   txs=319   mgas=29.862   elapsed=275.190ms mgasps=108.512 number=14,730,684 hash=8b05ad..d7597f dirty=4.60GiB\r\nMay 07 15:55:57 ether geth[935]: INFO [05-07|15:55:57.428] Imported new chain segment               blocks=1   txs=183   mgas=20.417   elapsed=414.546ms mgasps=49.252  number=14,730,683 hash=ced006..30a700 dirty=4.59GiB\r\nMay 07 15:55:42 ether geth[935]: INFO [05-07|15:55:42.678] Imported new chain segment               blocks=1   txs=79    mgas=4.260    elapsed=69.077ms  mgasps=61.675  number=14,730,682 hash=ff8d2b..6e2cf8 dirty=4.59GiB\r\nMay 07 15:55:41 ether geth[935]: INFO [05-07|15:55:41.733] Imported new chain segment               blocks=1   txs=57    mgas=6.170    elapsed=100.990ms mgasps=61.092  number=14,730,681 hash=ca82a7..e8ded4 dirty=4.59GiB\r\nMay 07 15:55:38 ether geth[935]: INFO [05-07|15:55:38.638] Imported new chain segment               blocks=1   txs=36    mgas=5.700    elapsed=96.513ms  mgasps=59.061  number=14,730,680 hash=8924e2..a6c315 dirty=4.59GiB\r\nMay 07 15:55:36 ether geth[935]: INFO [05-07|15:55:36.968] Imported new chain segment               blocks=1   txs=116   mgas=7.185    elapsed=101.196ms mgasps=70.999  number=14,730,679 hash=8f6494..39157c dirty=4.60GiB\r\nMay 07 15:55:31 ether geth[935]: INFO [05-07|15:55:31.887] Deep froze chain segment                 blocks=3   elapsed=25.504ms  number=14,640,678 hash=1980cd..1d506e\r\nMay 07 15:55:26 ether geth[935]: INFO [05-07|15:55:26.314] Imported new chain segment               blocks=1   txs=122   mgas=11.757   elapsed=138.244ms mgasps=85.046  number=14,730,678 hash=ab0ed7..d3a560 dirty=4.60GiB\r\nMay 07 15:55:18 ether geth[935]: INFO [05-07|15:55:18.986] Imported new chain segment               blocks=1   txs=346   mgas=30.041   elapsed=362.516ms mgasps=82.868  number=14,730,677 hash=960d60..4296aa dirty=4.60GiB\r\nMay 07 15:54:44 ether geth[935]: INFO [05-07|15:54:44.508] Imported new chain segment               blocks=1   txs=195   mgas=14.020   elapsed=151.970ms mgasps=92.255  number=14,730,676 hash=bc8bd3..154f64 dirty=4.60GiB\r\nMay 07 15:54:31 ether geth[935]: INFO [05-07|15:54:31.861] Deep froze chain segment                 blocks=4   elapsed=25.960ms  number=14,640,675 hash=c20c51..9be3a9\r\nMay 07 15:54:25 ether geth[935]: INFO [05-07|15:54:25.938] Imported new chain segment               blocks=1   txs=156   mgas=15.123   elapsed=129.569ms mgasps=116.714 number=14,730,675 hash=313ae3..a6f002 dirty=4.59GiB\r\nMay 07 15:54:14 ether geth[935]: INFO [05-07|15:54:14.833] Imported new chain segment               blocks=1   txs=61    mgas=7.268    elapsed=65.513ms  mgasps=110.945 number=14,730,674 hash=5f7268..6ede94 dirty=4.59GiB\r\nMay 07 15:54:13 ether geth[935]: INFO [05-07|15:54:13.421] Imported new chain segment               blocks=1   txs=187   mgas=14.628   elapsed=188.731ms mgasps=77.506  number=14,730,673 hash=1675a0..d4d2c8 dirty=4.59GiB\r\nMay 07 15:53:51 ether geth[935]: INFO [05-07|15:53:51.204] Imported new chain segment               blocks=1   txs=231   mgas=17.595   elapsed=190.289ms mgasps=92.465  number=14,730,672 hash=e3a449..7697b3 dirty=4.59GiB\r\nMay 07 15:53:31 ether geth[935]: INFO [05-07|15:53:31.834] Deep froze chain segment                 blocks=3   elapsed=26.652ms  number=14,640,671 hash=ff4f59..15e909\r\nMay 07 15:53:30 ether geth[935]: INFO [05-07|15:53:30.029] Imported new chain segment               blocks=1   txs=178   mgas=13.142   elapsed=143.725ms mgasps=91.441  number=14,730,671 hash=7e4f34..5b2d86 dirty=4.59GiB\r\nMay 07 15:53:14 ether geth[935]: INFO [05-07|15:53:14.575] Imported new chain segment               blocks=1   txs=264   mgas=23.168   elapsed=276.547ms mgasps=83.776  number=14,730,670 hash=540718..11beda dirty=4.59GiB\r\nMay 07 15:53:11 ether geth[935]: INFO [05-07|15:53:11.144] Imported new chain segment               blocks=1   txs=434   mgas=29.987   elapsed=378.968ms mgasps=79.127  number=14,730,669 hash=f26427..292299 age=1m        dirty=4.59GiB\r\nMay 07 15:52:31 ether geth[935]: INFO [05-07|15:52:31.807] Deep froze chain segment                 blocks=2   elapsed=23.986ms  number=14,640,668 hash=39ea76..5b324c\r\nMay 07 15:52:11 ether geth[935]: INFO [05-07|15:52:11.579] Imported new chain segment               blocks=1   txs=259   mgas=21.157   elapsed=227.819ms mgasps=92.866  number=14,730,668 hash=89ef61..812dfc dirty=4.59GiB\r\nMay 07 15:51:50 ether geth[935]: INFO [05-07|15:51:50.954] Imported new chain segment               blocks=1   txs=243   mgas=27.827   elapsed=312.692ms mgasps=88.991  number=14,730,667 hash=0ae3bc..f71c5c dirty=4.59GiB\r\nMay 07 15:51:31 ether geth[935]: INFO [05-07|15:51:31.782] Deep froze chain segment                 blocks=7   elapsed=34.392ms  number=14,640,666 hash=de7aa3..30df72\r\nMay 07 15:51:27 ether geth[935]: INFO [05-07|15:51:27.770] Imported new chain segment               blocks=1   txs=134   mgas=11.577   elapsed=122.204ms mgasps=94.735  number=14,730,666 hash=fdf71f..fc9934 dirty=4.59GiB\r\nMay 07 15:51:18 ether geth[935]: INFO [05-07|15:51:18.373] Imported new chain segment               blocks=1   txs=249   mgas=29.702   elapsed=290.478ms mgasps=102.250 number=14,730,665 hash=281658..34cee7 dirty=4.59GiB\r\nMay 07 15:51:15 ether geth[935]: INFO [05-07|15:51:15.710] Imported new chain segment               blocks=1   txs=47    mgas=3.095    elapsed=69.068ms  mgasps=44.812  number=14,730,664 hash=b9b7ce..edbb16 dirty=4.59GiB\r\n```\r\n\r\n\r\n#### Ancient folder contents \r\n```\r\nterminal@ether:/mnt/nas/data$ ll\r\ntotal 328224688\r\ndrwxr-xr-x 2 terminal terminal      12288 May  3 11:26 ./\r\ndrwxr-xr-x 4 terminal root           4096 May 20  2021 ../\r\n-rw-r--r-- 1 terminal terminal          0 May  7 16:22 bodies.0000.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997143 Oct 29  2021 bodies.0001.cdat\r\n-rw-r--r-- 1 terminal terminal 1999993986 Oct 29  2021 bodies.0002.cdat\r\n-rw-r--r-- 1 terminal terminal 1999989103 Oct 29  2021 bodies.0003.cdat\r\n-rw-r--r-- 1 terminal terminal 1999993595 Oct 29  2021 bodies.0004.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992801 Oct 29  2021 bodies.0005.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997621 Oct 29  2021 bodies.0006.cdat\r\n-rw-r--r-- 1 terminal terminal 1999994125 Oct 29  2021 bodies.0007.cdat\r\n-rw-r--r-- 1 terminal terminal 1999995785 Oct 29  2021 bodies.0008.cdat\r\n-rw-r--r-- 1 terminal terminal 1999983937 Oct 29  2021 bodies.0009.cdat\r\n-rw-r--r-- 1 terminal terminal 1999987695 Oct 29  2021 bodies.0010.cdat\r\n-rw-r--r-- 1 terminal terminal 1999981894 Oct 29  2021 bodies.0011.cdat\r\n-rw-r--r-- 1 terminal terminal 1999994229 Oct 29  2021 bodies.0012.cdat\r\n-rw-r--r-- 1 terminal terminal 1999991395 Oct 29  2021 bodies.0013.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992321 Oct 29  2021 bodies.0014.cdat\r\n-rw-r--r-- 1 terminal terminal 1999983781 Oct 29  2021 bodies.0015.cdat\r\n-rw-r--r-- 1 terminal terminal 1999994506 Oct 29  2021 bodies.0016.cdat\r\n-rw-r--r-- 1 terminal terminal 1999994478 Oct 29  2021 bodies.0017.cdat\r\n-rw-r--r-- 1 terminal terminal 1999986464 Oct 29  2021 bodies.0018.cdat\r\n-rw-r--r-- 1 terminal terminal 1999991985 Oct 29  2021 bodies.0019.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992097 Oct 29  2021 bodies.0020.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997285 Oct 29  2021 bodies.0021.cdat\r\n-rw-r--r-- 1 terminal terminal 1999995934 Oct 29  2021 bodies.0022.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997155 Oct 29  2021 bodies.0023.cdat\r\n-rw-r--r-- 1 terminal terminal 1999990325 Oct 29  2021 bodies.0024.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999658 Oct 29  2021 bodies.0025.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999893 Oct 29  2021 bodies.0026.cdat\r\n-rw-r--r-- 1 terminal terminal 1999987948 Oct 29  2021 bodies.0027.cdat\r\n-rw-r--r-- 1 terminal terminal 1999978786 Oct 29  2021 bodies.0028.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992359 Oct 29  2021 bodies.0029.cdat\r\n-rw-r--r-- 1 terminal terminal 1999989294 Oct 29  2021 bodies.0030.cdat\r\n-rw-r--r-- 1 terminal terminal 1999989350 Oct 29  2021 bodies.0031.cdat\r\n-rw-r--r-- 1 terminal terminal 1999978431 Oct 29  2021 bodies.0032.cdat\r\n-rw-r--r-- 1 terminal terminal 1999998485 Oct 29  2021 bodies.0033.cdat\r\n-rw-r--r-- 1 terminal terminal 1999996407 Oct 29  2021 bodies.0034.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997726 Oct 29  2021 bodies.0035.cdat\r\n-rw-r--r-- 1 terminal terminal 1999996589 Oct 29  2021 bodies.0036.cdat\r\n-rw-r--r-- 1 terminal terminal 1999987383 Oct 29  2021 bodies.0037.cdat\r\n-rw-r--r-- 1 terminal terminal 1999973369 Oct 29  2021 bodies.0038.cdat\r\n-rw-r--r-- 1 terminal terminal 1999983977 Oct 29  2021 bodies.0039.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997206 Oct 29  2021 bodies.0040.cdat\r\n-rw-r--r-- 1 terminal terminal 1999994706 Oct 29  2021 bodies.0041.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992214 Oct 29  2021 bodies.0042.cdat\r\n-rw-r--r-- 1 terminal terminal 1999998319 Oct 29  2021 bodies.0043.cdat\r\n-rw-r--r-- 1 terminal terminal 1999994851 Oct 29  2021 bodies.0044.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992334 Oct 29  2021 bodies.0045.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997454 Oct 29  2021 bodies.0046.cdat\r\n-rw-r--r-- 1 terminal terminal 1999984759 Oct 29  2021 bodies.0047.cdat\r\n-rw-r--r-- 1 terminal terminal 1999990373 Oct 29  2021 bodies.0048.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997051 Oct 29  2021 bodies.0049.cdat\r\n-rw-r--r-- 1 terminal terminal 1999987151 Oct 29  2021 bodies.0050.cdat\r\n-rw-r--r-- 1 terminal terminal 1999995604 Oct 29  2021 bodies.0051.cdat\r\n-rw-r--r-- 1 terminal terminal 1999995697 Oct 29  2021 bodies.0052.cdat\r\n-rw-r--r-- 1 terminal terminal 1999993194 Oct 29  2021 bodies.0053.cdat\r\n-rw-r--r-- 1 terminal terminal 1999994410 Oct 29  2021 bodies.0054.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992947 Oct 29  2021 bodies.0055.cdat\r\n-rw-r--r-- 1 terminal terminal 1999989751 Oct 29  2021 bodies.0056.cdat\r\n-rw-r--r-- 1 terminal terminal 1999977376 Oct 29  2021 bodies.0057.cdat\r\n-rw-r--r-- 1 terminal terminal 1999977428 Oct 29  2021 bodies.0058.cdat\r\n-rw-r--r-- 1 terminal terminal 1999993499 Oct 29  2021 bodies.0059.cdat\r\n-rw-r--r-- 1 terminal terminal 1999989525 Oct 29  2021 bodies.0060.cdat\r\n-rw-r--r-- 1 terminal terminal 1999967833 Oct 29  2021 bodies.0061.cdat\r\n-rw-r--r-- 1 terminal terminal 1999990186 Oct 29  2021 bodies.0062.cdat\r\n-rw-r--r-- 1 terminal terminal 1999974733 Oct 29  2021 bodies.0063.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992441 Oct 30  2021 bodies.0064.cdat\r\n-rw-r--r-- 1 terminal terminal 1999973743 Oct 30  2021 bodies.0065.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992372 Oct 30  2021 bodies.0066.cdat\r\n-rw-r--r-- 1 terminal terminal 1999995139 Oct 30  2021 bodies.0067.cdat\r\n-rw-r--r-- 1 terminal terminal 1999998413 Oct 30  2021 bodies.0068.cdat\r\n-rw-r--r-- 1 terminal terminal 1999972520 Oct 30  2021 bodies.0069.cdat\r\n-rw-r--r-- 1 terminal terminal 1999993605 Oct 30  2021 bodies.0070.cdat\r\n-rw-r--r-- 1 terminal terminal 1999998218 Oct 30  2021 bodies.0071.cdat\r\n-rw-r--r-- 1 terminal terminal 1999969580 Oct 30  2021 bodies.0072.cdat\r\n-rw-r--r-- 1 terminal terminal 1999987738 Oct 30  2021 bodies.0073.cdat\r\n-rw-r--r-- 1 terminal terminal 1999986135 Oct 30  2021 bodies.0074.cdat\r\n-rw-r--r-- 1 terminal terminal 1999964261 Oct 30  2021 bodies.0075.cdat\r\n-rw-r--r-- 1 terminal terminal 1999976122 Oct 30  2021 bodies.0076.cdat\r\n-rw-r--r-- 1 terminal terminal 1999991881 Oct 30  2021 bodies.0077.cdat\r\n-rw-r--r-- 1 terminal terminal 1999970512 Oct 30  2021 bodies.0078.cdat\r\n-rw-r--r-- 1 terminal terminal 1999978890 Oct 30  2021 bodies.0079.cdat\r\n-rw-r--r-- 1 terminal terminal 1999993054 Oct 30  2021 bodies.0080.cdat\r\n-rw-r--r-- 1 terminal terminal 1999982431 Oct 30  2021 bodies.0081.cdat\r\n-rw-r--r-- 1 terminal terminal 1999957781 Oct 30  2021 bodies.0082.cdat\r\n-rw-r--r-- 1 terminal terminal 1999942642 Oct 30  2021 bodies.0083.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999632 Oct 30  2021 bodies.0084.cdat\r\n-rw-r--r-- 1 terminal terminal 1999970181 Oct 30  2021 bodies.0085.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999144 Oct 30  2021 bodies.0086.cdat\r\n-rw-r--r-- 1 terminal terminal 1999973948 Oct 30  2021 bodies.0087.cdat\r\n-rw-r--r-- 1 terminal terminal 1999959982 Oct 30  2021 bodies.0088.cdat\r\n-rw-r--r-- 1 terminal terminal 1999957757 Oct 30  2021 bodies.0089.cdat\r\n-rw-r--r-- 1 terminal terminal 1999952668 Nov  1  2021 bodies.0090.cdat\r\n-rw-r--r-- 1 terminal terminal 1999996346 Nov 18  2021 bodies.0091.cdat\r\n-rw-r--r-- 1 terminal terminal 1999943577 Nov 19  2021 bodies.0092.cdat\r\n-rw-r--r-- 1 terminal terminal 1999960704 Nov 30 19:17 bodies.0093.cdat\r\n-rw-r--r-- 1 terminal terminal 1999921739 Jan  4 17:27 bodies.0094.cdat\r\n-rw-r--r-- 1 terminal terminal 1999942739 Jan 10 18:40 bodies.0095.cdat\r\n-rw-r--r-- 1 root     root     1999958761 Jan 10 22:51 bodies.0096.cdat\r\n-rw-r--r-- 1 root     root     1999993437 Jan 11 03:19 bodies.0097.cdat\r\n-rw-r--r-- 1 root     root     1999976749 Jan 12 19:03 bodies.0098.cdat\r\n-rw-r--r-- 1 root     root     1999982655 Jan 21 13:13 bodies.0099.cdat\r\n-rw-r--r-- 1 root     root     1999977632 Jan 29 17:05 bodies.0100.cdat\r\n-rw-r--r-- 1 root     root     1999991901 Feb  8 20:01 bodies.0101.cdat\r\n-rw-r--r-- 1 root     root     1999988656 Feb 15 19:14 bodies.0102.cdat\r\n-rw-r--r-- 1 root     root     1999939268 Feb 24 11:27 bodies.0103.cdat\r\n-rw-r--r-- 1 root     root     1999997558 Mar  4 23:09 bodies.0104.cdat\r\n-rw-r--r-- 1 root     root     1999984443 Mar 13 03:40 bodies.0105.cdat\r\n-rw-r--r-- 1 root     root     1999953556 Mar 21 20:53 bodies.0106.cdat\r\n-rw-r--r-- 1 root     root     1999879019 Mar 30 08:11 bodies.0107.cdat\r\n-rw-r--r-- 1 root     root     1999998992 Apr  7 21:14 bodies.0108.cdat\r\n-rw-r--r-- 1 root     root     1999939974 Apr 16 07:20 bodies.0109.cdat\r\n-rw-r--r-- 1 root     root     1999983094 Apr 24 17:21 bodies.0110.cdat\r\n-rw-r--r-- 1 root     root     1999955957 May  3 11:26 bodies.0111.cdat\r\n-rw-r--r-- 1 root     root     1015519951 May  7 15:57 bodies.0112.cdat\r\n-rw-r--r-- 1 terminal terminal   87844170 May  7 15:57 bodies.cidx\r\n-rw-r--r-- 1 terminal terminal          0 May  7 16:22 diffs.0000.rdat\r\n-rw-r--r-- 1 terminal terminal   87844170 May  7 15:57 diffs.ridx\r\n-rw-r--r-- 1 terminal terminal          0 Oct 29  2021 FLOCK\r\n-rw-r--r-- 1 terminal terminal          0 May  7 16:22 hashes.0000.rdat\r\n-rw-r--r-- 1 terminal terminal   87844170 May  7 15:57 hashes.ridx\r\n-rw-r--r-- 1 terminal terminal          0 May  7 16:22 headers.0000.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999640 Oct 29  2021 headers.0001.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999687 Oct 30  2021 headers.0002.cdat\r\n-rw-r--r-- 1 terminal terminal  904143619 May  7 15:57 headers.0003.cdat\r\n-rw-r--r-- 1 terminal terminal   87844170 May  7 15:57 headers.cidx\r\n-rw-r--r-- 1 terminal terminal          0 May  7 16:22 receipts.0000.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992186 Oct 29  2021 receipts.0001.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997920 Oct 29  2021 receipts.0002.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999534 Oct 29  2021 receipts.0003.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992524 Oct 29  2021 receipts.0004.cdat\r\n-rw-r--r-- 1 terminal terminal 1999994266 Oct 29  2021 receipts.0005.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999462 Oct 29  2021 receipts.0006.cdat\r\n-rw-r--r-- 1 terminal terminal 1999996496 Oct 29  2021 receipts.0007.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999008 Oct 29  2021 receipts.0008.cdat\r\n-rw-r--r-- 1 terminal terminal 1999990909 Oct 29  2021 receipts.0009.cdat\r\n-rw-r--r-- 1 terminal terminal 1999996073 Oct 29  2021 receipts.0010.cdat\r\n-rw-r--r-- 1 terminal terminal 1999995017 Oct 29  2021 receipts.0011.cdat\r\n-rw-r--r-- 1 terminal terminal 1999995168 Oct 29  2021 receipts.0012.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999316 Oct 29  2021 receipts.0013.cdat\r\n-rw-r--r-- 1 terminal terminal 1999996879 Oct 29  2021 receipts.0014.cdat\r\n-rw-r--r-- 1 terminal terminal 1999994812 Oct 29  2021 receipts.0015.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992983 Oct 29  2021 receipts.0016.cdat\r\n-rw-r--r-- 1 terminal terminal 1999998903 Oct 29  2021 receipts.0017.cdat\r\n-rw-r--r-- 1 terminal terminal 1999990827 Oct 29  2021 receipts.0018.cdat\r\n-rw-r--r-- 1 terminal terminal 1999995536 Oct 29  2021 receipts.0019.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997018 Oct 29  2021 receipts.0020.cdat\r\n-rw-r--r-- 1 terminal terminal 1999997479 Oct 29  2021 receipts.0021.cdat\r\n-rw-r--r-- 1 terminal terminal 1999993155 Oct 29  2021 receipts.0022.cdat\r\n-rw-r--r-- 1 terminal terminal 1999987576 Oct 29  2021 receipts.0023.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992772 Oct 29  2021 receipts.0024.cdat\r\n-rw-r--r-- 1 terminal terminal 1999990478 Oct 29  2021 receipts.0025.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999655 Oct 29  2021 receipts.0026.cdat\r\n-rw-r--r-- 1 terminal terminal 1999996678 Oct 29  2021 receipts.0027.cdat\r\n-rw-r--r-- 1 terminal terminal 1999993435 Oct 29  2021 receipts.0028.cdat\r\n-rw-r--r-- 1 terminal terminal 1999990429 Oct 29  2021 receipts.0029.cdat\r\n-rw-r--r-- 1 terminal terminal 1999988321 Oct 29  2021 receipts.0030.cdat\r\n-rw-r--r-- 1 terminal terminal 1999985612 Oct 30  2021 receipts.0031.cdat\r\n-rw-r--r-- 1 terminal terminal 1999992254 Oct 30  2021 receipts.0032.cdat\r\n-rw-r--r-- 1 terminal terminal 1999986406 Oct 30  2021 receipts.0033.cdat\r\n-rw-r--r-- 1 terminal terminal 1999995958 Oct 30  2021 receipts.0034.cdat\r\n-rw-r--r-- 1 terminal terminal 1999983719 Oct 30  2021 receipts.0035.cdat\r\n-rw-r--r-- 1 terminal terminal 1999985292 Oct 30  2021 receipts.0036.cdat\r\n-rw-r--r-- 1 terminal terminal 1999990567 Oct 30  2021 receipts.0037.cdat\r\n-rw-r--r-- 1 terminal terminal 1999988000 Oct 30  2021 receipts.0038.cdat\r\n-rw-r--r-- 1 terminal terminal 1999986483 Oct 30  2021 receipts.0039.cdat\r\n-rw-r--r-- 1 terminal terminal 1999984123 Oct 30  2021 receipts.0040.cdat\r\n-rw-r--r-- 1 terminal terminal 1999989600 Oct 30  2021 receipts.0041.cdat\r\n-rw-r--r-- 1 terminal terminal 1999988068 Oct 30  2021 receipts.0042.cdat\r\n-rw-r--r-- 1 terminal terminal 1999999196 Oct 30  2021 receipts.0043.cdat\r\n-rw-r--r-- 1 terminal terminal 1999983390 Oct 30  2021 receipts.0044.cdat\r\n-rw-r--r-- 1 terminal terminal 1999982313 Nov 18  2021 receipts.0045.cdat\r\n-rw-r--r-- 1 terminal terminal 1999989992 Jan  4 17:02 receipts.0046.cdat\r\n-rw-r--r-- 1 terminal terminal 1999995028 Jan 10 22:36 receipts.0047.cdat\r\n-rw-r--r-- 1 root     root     1999987751 Jan 13 10:21 receipts.0048.cdat\r\n-rw-r--r-- 1 root     root     1999986172 Feb  2 03:56 receipts.0049.cdat\r\n-rw-r--r-- 1 root     root     1999995614 Feb 22 01:19 receipts.0050.cdat\r\n-rw-r--r-- 1 root     root     1999984269 Mar 13 13:24 receipts.0051.cdat\r\n-rw-r--r-- 1 root     root     1999984821 Apr  1 21:57 receipts.0052.cdat\r\n-rw-r--r-- 1 root     root     1999992932 Apr 20 17:23 receipts.0053.cdat\r\n-rw-r--r-- 1 root     root     1744409246 May  7 15:57 receipts.0054.cdat\r\n-rw-r--r-- 1 terminal terminal   87844170 May  7 15:57 receipts.cidx\r\n```\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24962/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24962/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1139317746",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24962#issuecomment-1139317746",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24962",
    "id": 1139317746,
    "node_id": "IC_kwDOAOvK985D6Jvy",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T06:17:07Z",
    "updated_at": "2022-05-27T06:17:07Z",
    "author_association": "MEMBER",
    "body": "If I understand your setup correctly, you have 2 machines, one compute and one storage server. The compute holding the main database on an SSD and the storage server holding the ancients on an HDD. Also you're saying that after a simultaneous downtime and restart, Geth had issues with the ancient folder.\r\n\r\nCould it happen that your compute server came back online faster that the storage one and when Geth was started the ancient mount point hasn't yet been made? In that case I could see Geth reading an empty ancient folder and having issues that it's out of sync with the ssd database.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1139317746/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1139739691",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24962#issuecomment-1139739691",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24962",
    "id": 1139739691,
    "node_id": "IC_kwDOAOvK985D7wwr",
    "user": {
      "login": "TheUniquePaulSmith",
      "id": 19433370,
      "node_id": "MDQ6VXNlcjE5NDMzMzcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/19433370?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheUniquePaulSmith",
      "html_url": "https://github.com/TheUniquePaulSmith",
      "followers_url": "https://api.github.com/users/TheUniquePaulSmith/followers",
      "following_url": "https://api.github.com/users/TheUniquePaulSmith/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheUniquePaulSmith/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheUniquePaulSmith/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheUniquePaulSmith/subscriptions",
      "organizations_url": "https://api.github.com/users/TheUniquePaulSmith/orgs",
      "repos_url": "https://api.github.com/users/TheUniquePaulSmith/repos",
      "events_url": "https://api.github.com/users/TheUniquePaulSmith/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheUniquePaulSmith/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T15:47:19Z",
    "updated_at": "2022-05-27T15:48:31Z",
    "author_association": "NONE",
    "body": "> If I understand your setup correctly, you have 2 machines, one compute and one storage server. The compute holding the main database on an SSD and the storage server holding the ancients on an HDD. Also you're saying that after a simultaneous downtime and restart, Geth had issues with the ancient folder.\r\n\r\nThat's correct, the ancient data mount is part of a LUN attached to the compute VM via Hyper-V server and presented as a virtual local disk inside the VM\r\n\r\n> Could it happen that your compute server came back online faster that the storage one and when Geth was started the ancient mount point hasn't yet been made? In that case I could see Geth reading an empty ancient folder and having issues that it's out of sync with the ssd database.\r\n\r\nIt should not. Hyper-v won't start the VM if it detects one of the drives is missing (i.e waiting for iSCSI LUN to re-attach from NAS) . I tested this again today to validate. Therefore, when the VM can back online the LUN containing ancient data would of had to been available and re-attached before geth started.\r\n\r\nI suspect maybe some the ancient files got corrupted from an unclean shutdown due to powerloss? \r\nAnyway to vet this? Seems most of the data is there (ancient folder size is 314G)\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1139739691/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1146204136",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24962#issuecomment-1146204136",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24962",
    "id": 1146204136,
    "node_id": "IC_kwDOAOvK985EUa_o",
    "user": {
      "login": "TheUniquePaulSmith",
      "id": 19433370,
      "node_id": "MDQ6VXNlcjE5NDMzMzcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/19433370?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheUniquePaulSmith",
      "html_url": "https://github.com/TheUniquePaulSmith",
      "followers_url": "https://api.github.com/users/TheUniquePaulSmith/followers",
      "following_url": "https://api.github.com/users/TheUniquePaulSmith/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheUniquePaulSmith/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheUniquePaulSmith/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheUniquePaulSmith/subscriptions",
      "organizations_url": "https://api.github.com/users/TheUniquePaulSmith/orgs",
      "repos_url": "https://api.github.com/users/TheUniquePaulSmith/repos",
      "events_url": "https://api.github.com/users/TheUniquePaulSmith/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheUniquePaulSmith/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-03T17:31:29Z",
    "updated_at": "2022-06-03T17:31:29Z",
    "author_association": "NONE",
    "body": "So I started trying to debug the chaindata and ancient to figure out what's happening. Here is my working theory:\r\n\r\n1. Geth node suffered a power outage May 07 15:57:31 UTC (and the chaindata is considered an unclean shutdown?)\r\n2. Power was restored around May 07 ~16:20:00 and NAS was available as Geth node restarted automatically @ 16:22:35 UTC\r\n3. (Geth detected unclean shutdown?) and began `Truncating dangling head` @ 16:22:55 UTC\r\n3a. I'm assuming it did this because it's trying to align chaindata with ancient from unclean shutdown?\r\n4. The file `hashes.0000.rdat` end-state is 0 bytes and it's modified date is during the `Truncating dangling head` events @ May  7 16:22 UTC\r\n\r\nDuring debugging, I also noticed the hashes table from ancient has an item property count of `14640694` but the file is 0 bytes.\r\n\r\n\r\nThe code I believe is suspect in this event is from `freezer_table.go`\r\n```\r\n// Keep truncating both files until they come in sync\r\n\tcontentExp = int64(lastIndex.offset)\r\n\tfor contentExp != contentSize {\r\n\t\t// Truncate the head file to the last offset pointer\r\n\t\tif contentExp < contentSize {\r\n\t\t\tt.logger.Warn(\"Truncating dangling head\", \"indexed\", common.StorageSize(contentExp), \"stored\", common.StorageSize(contentSize))\r\n\t\t\tif err := truncateFreezerFile(t.head, contentExp); err != nil {\r\n\t\t\t\treturn err\r\n\t\t\t}\r\n\t\t\tcontentSize = contentExp\r\n\t\t}\r\n```\r\nAccording to geth log: `table=hashes  indexed=0.00B stored=446.80MiB`\r\nSo if indexed = 0B then stored would get truncated to 0B? Which might make sense why the hashes.0000.rdat is empty and the genesis hash cannot be found?\r\n\r\nMy question is why did repair() cause this? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1146204136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
