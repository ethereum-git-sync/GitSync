{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/1010",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/1010/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/1010/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/1010/events",
  "html_url": "https://github.com/ethereum/solidity/issues/1010",
  "id": 175097354,
  "node_id": "MDU6SXNzdWUxNzUwOTczNTQ=",
  "number": 1010,
  "title": "Storage references in memory structs",
  "user": {
    "login": "androlo",
    "id": 2809499,
    "node_id": "MDQ6VXNlcjI4MDk0OTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/androlo",
    "html_url": "https://github.com/androlo",
    "followers_url": "https://api.github.com/users/androlo/followers",
    "following_url": "https://api.github.com/users/androlo/following{/other_user}",
    "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
    "organizations_url": "https://api.github.com/users/androlo/orgs",
    "repos_url": "https://api.github.com/users/androlo/repos",
    "events_url": "https://api.github.com/users/androlo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/androlo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/ethereum/solidity/milestones/21",
    "html_url": "https://github.com/ethereum/solidity/milestone/21",
    "labels_url": "https://api.github.com/repos/ethereum/solidity/milestones/21/labels",
    "id": 1925680,
    "node_id": "MDk6TWlsZXN0b25lMTkyNTY4MA==",
    "number": 21,
    "title": "6-usability-features",
    "description": null,
    "creator": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 1,
    "closed_issues": 3,
    "state": "closed",
    "created_at": "2016-08-05T15:02:17Z",
    "updated_at": "2018-08-01T16:31:03Z",
    "due_on": null,
    "closed_at": "2018-07-30T10:43:12Z"
  },
  "comments": 5,
  "created_at": "2016-09-05T15:54:35Z",
  "updated_at": "2022-08-17T13:50:04Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Apologize if this is an issue, or if it has already got a solution. Checked a few pages of backlog but found nothing.\n\nMake it possible not only to specify whether a struct is kept in storage or memory, but also to override each of its fields.\n\n**Story**\n\nI have an iterable, storage-backed collection (a set for example) with O(1) access to each element through a mapping. Data structure and logic is defined in a library contract. For example:\n\n```\nstruct Set {\n    mapping(uint => bool) _values;\n    uint[] _arr;\n}\n\nfunction insert(Set memory self, uint value) internal {\n    ....\n}\n\n...\n```\n\nI want to add an iterator, which takes the reference to the `Set` object as argument.\n\n```\nstruct Iterator {\n    Set _set;\n    int _currentIndex;\n}\n```\n\nAnd in the Set:\n\n```\n...\n\nfunction _iterator(Set storage set) internal constant returns (Iterator memory it) {\n    return Iterator(set, -1);\n} \n```\n\n`it` should be a two-word memory struct if the storage address of `set` is used. When I try to access the mapping in `it._set` it will fail, though, because since `it` is a memory struct, `it._set` is somehow assumed to be stored in memory as well.\n\n```\nUntitled:111:24: Error: Member \"_values\" is not available in struct Set memory outside of storage.\n            var exists = self._set._values[value];\n                       ^-------------^\n```\n\nThe way I work around this is to just store the storage address in the iterator, as is done with contracts and addresses. For example:\n\n```\nstruct Iterator {\n    uint _unsafe_set_sptr;\n    int _currentIndex;\n}\n\nfunction _iterator(Set storage set) internal constant returns (Iterator memory it) {\n    uint sa;\n    assembly {\n        sa := set\n    }\n    it = Iterator(sa, -1);\n} \n\n```\n\nAnd when using:\n\n```\nfunction _hasNext(Iterator memory self) internal constant returns (bool) {\n    Set storage set;\n    assembly {\n        set := mload(self)\n    }\n    return uint(self._currentIndex) < set._keys.length - 1;\n}\n```\n\nAs far as I know, there is no way to specify that `set` should remain a storage reference (in this manner), and I don't know of any better ways of doing things. If I'm not mistaken, the memory structs will copy data and fail to use the storage data (particularly storage-only types like mapping).\n\n```\nstruct Iterator {\n    Set storage _set;\n    int _currentIndex;\n}\n```\n\nBTW the general properties of the iterator is not important here, or whether its safe, or there are more optimized ways of doing things (which of course there is). It's only about how to specify that something is a storage type rather then memory in some advanced cases.\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/1010/reactions",
    "total_count": 4,
    "+1": 4,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/1010/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/244778244",
    "html_url": "https://github.com/ethereum/solidity/issues/1010#issuecomment-244778244",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1010",
    "id": 244778244,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NDc3ODI0NA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-05T16:04:27Z",
    "updated_at": "2016-09-05T16:04:27Z",
    "author_association": "MEMBER",
    "body": "I see where this can be useful. Of course, it can only work in one direction: A storage reference type can be part of a memory type, but no the other way round. At the point where such a struct is converted from storage to memory, its `storage` members are \"sticky\" and only a reference will be assigned as part of the conversion. If a memory struct containing storage references is assigned to storage, its storage references are copied.\n\nThis generalizes features that are currently only available to stack types.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/244778244/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/244792557",
    "html_url": "https://github.com/ethereum/solidity/issues/1010#issuecomment-244792557",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1010",
    "id": 244792557,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0NDc5MjU1Nw==",
    "user": {
      "login": "androlo",
      "id": 2809499,
      "node_id": "MDQ6VXNlcjI4MDk0OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androlo",
      "html_url": "https://github.com/androlo",
      "followers_url": "https://api.github.com/users/androlo/followers",
      "following_url": "https://api.github.com/users/androlo/following{/other_user}",
      "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
      "organizations_url": "https://api.github.com/users/androlo/orgs",
      "repos_url": "https://api.github.com/users/androlo/repos",
      "events_url": "https://api.github.com/users/androlo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androlo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-09-05T17:52:12Z",
    "updated_at": "2016-09-05T17:52:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like it could just be handled automatically then, based on what is provided to the struct? Like in this case, `Iterator._set` would be a storage object (in this `it` instance), since it's a storage object that's being assigned to that field.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/244792557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/319795625",
    "html_url": "https://github.com/ethereum/solidity/issues/1010#issuecomment-319795625",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1010",
    "id": 319795625,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxOTc5NTYyNQ==",
    "user": {
      "login": "illuzen",
      "id": 6833917,
      "node_id": "MDQ6VXNlcjY4MzM5MTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6833917?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/illuzen",
      "html_url": "https://github.com/illuzen",
      "followers_url": "https://api.github.com/users/illuzen/followers",
      "following_url": "https://api.github.com/users/illuzen/following{/other_user}",
      "gists_url": "https://api.github.com/users/illuzen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/illuzen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/illuzen/subscriptions",
      "organizations_url": "https://api.github.com/users/illuzen/orgs",
      "repos_url": "https://api.github.com/users/illuzen/repos",
      "events_url": "https://api.github.com/users/illuzen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/illuzen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-02T20:55:05Z",
    "updated_at": "2017-08-02T20:55:05Z",
    "author_association": "NONE",
    "body": "It also would make the compiler warning\r\n\r\n`Warning: Variable is declared as a storage pointer. Use an explicit \"storage\" keyword to silence this warning. `\r\n\r\nmake more sense, since it appears in structs right now.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/319795625/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/319895920",
    "html_url": "https://github.com/ethereum/solidity/issues/1010#issuecomment-319895920",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1010",
    "id": 319895920,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxOTg5NTkyMA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-03T07:52:14Z",
    "updated_at": "2017-08-03T07:52:14Z",
    "author_association": "MEMBER",
    "body": "@illuzen this is a bug that was fixed with 0.4.14 (hopefully?)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/319895920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/319901409",
    "html_url": "https://github.com/ethereum/solidity/issues/1010#issuecomment-319901409",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1010",
    "id": 319901409,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxOTkwMTQwOQ==",
    "user": {
      "login": "illuzen",
      "id": 6833917,
      "node_id": "MDQ6VXNlcjY4MzM5MTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6833917?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/illuzen",
      "html_url": "https://github.com/illuzen",
      "followers_url": "https://api.github.com/users/illuzen/followers",
      "following_url": "https://api.github.com/users/illuzen/following{/other_user}",
      "gists_url": "https://api.github.com/users/illuzen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/illuzen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/illuzen/subscriptions",
      "organizations_url": "https://api.github.com/users/illuzen/orgs",
      "repos_url": "https://api.github.com/users/illuzen/repos",
      "events_url": "https://api.github.com/users/illuzen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/illuzen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-03T08:17:59Z",
    "updated_at": "2017-08-03T08:17:59Z",
    "author_association": "NONE",
    "body": "@chriseth Ah you are right, sorry I had multiple copies of solc sitting around.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/319901409/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
