{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/10311",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/10311/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/10311/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/10311/events",
  "html_url": "https://github.com/ethereum/solidity/issues/10311",
  "id": 744327028,
  "node_id": "MDU6SXNzdWU3NDQzMjcwMjg=",
  "number": 10311,
  "title": "Try/catch can still error if Solidity's own pre-call or post-call checks fail; should jump to catch block instead",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-11-17T01:17:14Z",
  "updated_at": "2020-11-21T23:36:01Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\n(Note: I rewrote this issue after realizing it's more general than I originally thought.)\r\n\r\nThe `try`/`catch` construction is supposed to allow one to catch errors from external calls and handle them.  But, Solidity also makes various checks of its own both before and after making an external call, and will error if these checks fail.  If the external call in question has an associated `try`/`catch`, and an applicable `catch` block exists, then Solidity should jump to the `catch` block instead of erroring.\r\n\r\nFor post-call checks, which `catch` block to jump to should be determined the normal way, based on the data returned.  (E.g., if no data was returned, you would jump to the `catch (bytes memory x)` block if it exists, and revert if not.)\r\n\r\nFor pre-call checks, you have to go based on what the returned data *would* be, I guess.  Fortunately as best I can tell the only pre-call check Solidity makes is whether the called has any code.  (I'm unclear why, it doesn't seem like this would save on gas when no ether is being transferred?)  So in this case, if the check fails, you can say that the returned data would have been an empty `hex\"\"`.  So this is still handleable.  I suspect if any other pre-call checks are ever added, they will likely also have this property, that if they can fail you can say the returned data would have been `hex\"\"`.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.7.4\r\n- Target EVM version (as per compiler settings): default\r\n- Framework/IDE (e.g. Truffle or Remix): Truffle\r\n- EVM execution environment / backend / blockchain client: Ganache CLI v6.12.0 (ganache-core: 2.13.0)\r\n\r\n## Steps to Reproduce\r\n\r\n### Pre-call example\r\n\r\n```solidity\r\npragma solidity ^0.7.4;\r\n\r\ncontract TryTest {\r\n  function run() public returns (bytes memory) {\r\n    Called called;\r\n    try called.test() returns (uint n) {\r\n      return abi.encode(n);\r\n    } catch (bytes memory x) {\r\n      return x;\r\n    }\r\n  }\r\n}\r\n\r\ncontract Called {\r\n  function test() public returns (uint) {\r\n    return 1;\r\n  }\r\n}\r\n```\r\n\r\nThe `run()` function should return `hex\"\"`, but instead it reverts.\r\n\r\n### Post-call example\r\n\r\n```solidity\r\npragma solidity ^0.7.4;\r\n\r\ncontract TryTest {\r\n  function run() public returns (bytes memory) {\r\n    Called called = new Called();\r\n    try called.boom() returns (uint n) {\r\n      return abi.encode(n);\r\n    } catch (bytes memory x) {\r\n      return x;\r\n    }\r\n  }\r\n}\r\n\r\ncontract Called {\r\n  function boom() public returns (uint) {\r\n    selfdestruct(tx.origin);\r\n  }\r\n}\r\n```\r\n\r\nThe `run()` function should return `hex\"\"`, but instead it reverts.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/10311/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/10311/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/728742338",
    "html_url": "https://github.com/ethereum/solidity/issues/10311#issuecomment-728742338",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10311",
    "id": 728742338,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODc0MjMzOA==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-17T07:30:16Z",
    "updated_at": "2020-11-17T07:30:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note: Significantly rewrote the original issue after determining it was more general than I originally thought.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/728742338/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/728839285",
    "html_url": "https://github.com/ethereum/solidity/issues/10311#issuecomment-728839285",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10311",
    "id": 728839285,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyODgzOTI4NQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-17T10:32:09Z",
    "updated_at": "2020-11-17T10:32:09Z",
    "author_association": "MEMBER",
    "body": "The design choice behind this is that if you reach the catch block, then the call reverted. Other reasons for failure might not lead to the catch block. This is in line with try-catch not being available on internal calls.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/728839285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
