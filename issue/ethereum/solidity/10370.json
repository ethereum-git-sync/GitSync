{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/10370",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/10370/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/10370/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/10370/events",
  "html_url": "https://github.com/ethereum/solidity/issues/10370",
  "id": 748257188,
  "node_id": "MDU6SXNzdWU3NDgyNTcxODg=",
  "number": 10370,
  "title": "What is the purpose of 'ewasm' function of solc？",
  "user": {
    "login": "q871795224",
    "id": 33190881,
    "node_id": "MDQ6VXNlcjMzMTkwODgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/33190881?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/q871795224",
    "html_url": "https://github.com/q871795224",
    "followers_url": "https://api.github.com/users/q871795224/followers",
    "following_url": "https://api.github.com/users/q871795224/following{/other_user}",
    "gists_url": "https://api.github.com/users/q871795224/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/q871795224/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/q871795224/subscriptions",
    "organizations_url": "https://api.github.com/users/q871795224/orgs",
    "repos_url": "https://api.github.com/users/q871795224/repos",
    "events_url": "https://api.github.com/users/q871795224/events{/privacy}",
    "received_events_url": "https://api.github.com/users/q871795224/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2379061831,
      "node_id": "MDU6TGFiZWwyMzc5MDYxODMx",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/wasm",
      "name": "wasm",
      "color": "63ed23",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-11-22T14:40:58Z",
  "updated_at": "2020-11-26T20:28:04Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I currently use solc's --ewasm to process smart contracts, but I found some confusing situations during processing.\r\nWhy did I change the content of the contract, but the wast file did not change significantly？\r\nthe old contract:\r\n```\r\ncontract Caller {\r\n    function callAddress(address a) public {\r\n        a.call(\"\");\r\n    }\r\n}\r\n```\r\nthe new contract:\r\n```\r\ncontract Caller {\r\n    function callAddress(address a) public {\r\n        a.call(\"\");\r\n        a.call(\"\");\r\n    }\r\n    function A(address a) public{\r\n        a.call(\"\");\r\n    }\r\n}\r\n```\r\nThe difference between the them:\r\n![image](https://user-images.githubusercontent.com/33190881/99906699-78d84500-2d13-11eb-9042-366f93b8027b.png)\r\n![image](https://user-images.githubusercontent.com/33190881/99906716-93122300-2d13-11eb-8363-4a23c59e8a2e.png)\r\n\r\nthe wasm files has no difference.\r\nTherefore, I would like to know the purpose of 'ewasm' function of solc？\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/10370/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/10370/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/731838572",
    "html_url": "https://github.com/ethereum/solidity/issues/10370#issuecomment-731838572",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10370",
    "id": 731838572,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMTgzODU3Mg==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-22T20:02:27Z",
    "updated_at": "2020-11-22T20:10:35Z",
    "author_association": "MEMBER",
    "body": "There is a difference but it might not be very apparent in the text form because it's only the runtime code that differs. Note the first difference highlighted in the diff:\r\n\r\n```wasm\r\n    ;; custom section for sub-module\r\n    ;; The Keccak-256 hash of the text representation of \"Caller_13_deployed\": d1813742dfca576723bf11a62e05908eadf19b646e0af2b817f263a605f60b72\r\n    ;; (@custom \"Caller_13_deployed\" \"0061736d0100000001bc032860000060000...\")\r\n```\r\n```wasm\r\n    ;; custom section for sub-module\r\n    ;; The Keccak-256 hash of the text representation of \"Caller_31_deployed\": 1c42535be8454173a7b5cff50f509f979c0d852e8821a1423f46d31bba391ac7\r\n    ;; (@custom \"Caller_31_deployed\" \"0061736d0100000001bc032860000060000...\")\r\n```\r\n\r\nThis is the runtime code. It starts the same way for both but there are differences. And different hashes of the text representation  indicate that it was different too.\r\n\r\nAll the text except that part is just the construction code and since your contract does not have a constructor, immutables or much of anything to do at deployment time, it's just boilerplate with generic utility functions. The optimizer will throw away almost all of it.\r\n\r\nIt's the runtime part that contains the actual logic of your contract and it's what you see in the commented-out `@custom` section. In EVM assembly this would be a separate subassembly and in Yul it would be a subobject. You can see this for yourself by compiling with `--asm` or `--ir` option instead of `-ewasm`.\r\n\r\nIn wasm there's no concept of submodules so we're just storing the bytecode in a custom section. Unfortunately this only works in binary form. In text form custom sections have not been standardized yet. It's actually only in solc 0.7.5 that we're even printing this hash and bytecode (#10219). In earlier versions compiler would omit it completely from the text form.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/731838572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/733483209",
    "html_url": "https://github.com/ethereum/solidity/issues/10370#issuecomment-733483209",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10370",
    "id": 733483209,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzQ4MzIwOQ==",
    "user": {
      "login": "q871795224",
      "id": 33190881,
      "node_id": "MDQ6VXNlcjMzMTkwODgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33190881?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/q871795224",
      "html_url": "https://github.com/q871795224",
      "followers_url": "https://api.github.com/users/q871795224/followers",
      "following_url": "https://api.github.com/users/q871795224/following{/other_user}",
      "gists_url": "https://api.github.com/users/q871795224/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/q871795224/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/q871795224/subscriptions",
      "organizations_url": "https://api.github.com/users/q871795224/orgs",
      "repos_url": "https://api.github.com/users/q871795224/repos",
      "events_url": "https://api.github.com/users/q871795224/events{/privacy}",
      "received_events_url": "https://api.github.com/users/q871795224/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-25T05:53:31Z",
    "updated_at": "2020-11-25T05:53:31Z",
    "author_association": "NONE",
    "body": "Thanks for your help. \r\nI get the code from commented-out @custom section and change it to wasm. I find that the last 125 funcs of the two wasm are the same. Does this correspond to those generic utility functions?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/733483209/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/734468408",
    "html_url": "https://github.com/ethereum/solidity/issues/10370#issuecomment-734468408",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10370",
    "id": 734468408,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNDQ2ODQwOA==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-26T20:28:04Z",
    "updated_at": "2020-11-26T20:28:04Z",
    "author_association": "MEMBER",
    "body": "I'd have to check to be sure but they should generally be the same. Those are the predefined functions you can find in https://github.com/ethereum/solidity/tree/develop/libyul/backends/wasm/polyfill",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/734468408/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
