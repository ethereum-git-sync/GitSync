{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/10649",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/10649/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/10649/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/10649/events",
  "html_url": "https://github.com/ethereum/solidity/issues/10649",
  "id": 770440543,
  "node_id": "MDU6SXNzdWU3NzA0NDA1NDM=",
  "number": 10649,
  "title": "Implicit and \"free\" casting for like-types",
  "user": {
    "login": "deluca-mike",
    "id": 35537333,
    "node_id": "MDQ6VXNlcjM1NTM3MzMz",
    "avatar_url": "https://avatars.githubusercontent.com/u/35537333?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/deluca-mike",
    "html_url": "https://github.com/deluca-mike",
    "followers_url": "https://api.github.com/users/deluca-mike/followers",
    "following_url": "https://api.github.com/users/deluca-mike/following{/other_user}",
    "gists_url": "https://api.github.com/users/deluca-mike/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/deluca-mike/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/deluca-mike/subscriptions",
    "organizations_url": "https://api.github.com/users/deluca-mike/orgs",
    "repos_url": "https://api.github.com/users/deluca-mike/repos",
    "events_url": "https://api.github.com/users/deluca-mike/events{/privacy}",
    "received_events_url": "https://api.github.com/users/deluca-mike/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-12-17T23:07:42Z",
  "updated_at": "2021-11-15T22:21:38Z",
  "closed_at": "2021-11-15T21:18:07Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Abstract\r\n\r\nImplicitly casting of `bytes32` to `uint256`, and vice versa, ~~without the compiler doing any (if currently the case) bitwise operations, like AND-masking against 256 one's.~~ (this was incorrect)\r\n\r\n\r\n## Motivation\r\n\r\nWould be nice to handle and pass around arrays of bytes32 (i.e. for merkle trees and whatnot) but be able to cleanly handle the underlying data as numbers.\r\nConsider a Merkle Tree library that works with `bytes32` elements (i.e. `bytes32[] memory elements`), where all of most elements are actually meant to be (or best) interpreted as numbers by the underlying contract/application.\r\n\r\nAlso, would be nice to reuse `bytes32` and `uint256` values as a mechanism to avoid `STACK TOO DEEP` errors, within a function, without having to cast back and forth. ~~If I am not mistaken, casting between `bytes32` and `uint256` incurs a slight cost, despite it not needing to.~~ (I was incorrect)\r\n\r\n\r\n## Specification\r\n\r\nConsider this, albeit convoluted, example.\r\n\r\nThis:\r\n\r\n```\r\nfunction get_a(uint256) returns (bytes32);\r\nfunction get_b(uint256) returns (uint256);\r\nfunction get_c(bytes32) returns (uint256);\r\nfunction get_d(bytes32) returns (bytes32);\r\n\r\nfunction foo(bytes32[] memory elements) returns (uint256 unique_id) {\r\n    bytes32 a = get_a(elements.length);\r\n    uint256 b = get_b(a);\r\n    bytes32 c = get_c(b);\r\n\r\n    for (uint256 i; i < elements.length; ++i) {\r\n        elements[i] |= (a ** i) | (b * i) ^ (c + i) & (get_d(i) ^ i);\r\n    }\r\n\r\n    return get_merkle_root(elements);\r\n}\r\n```\r\n\r\n\r\nRather than this:\r\n\r\n```\r\nfunction get_a(uint256) returns (bytes32);\r\nfunction get_b(uint256) returns (uint256);\r\nfunction get_c(bytes32) returns (uint256);\r\nfunction get_d(bytes32) returns (bytes32);\r\n\r\nfunction foo(bytes32[] memory elements) returns (uint256 unique_id) {\r\n    uint256 a = uint256(get_a(elements.length));\r\n    uint256 b = get_b(a);\r\n    uint256 c = get_c(bytes32(b));\r\n\r\n    for (uint256 i; i < elements.length; ++i) {\r\n        elements[i] = bytes32(uint256(elements[i]) (a ** i) | (b * i) ^ (c + i) & (uint256(get_d(bytes32(i))) ^ i));\r\n    }\r\n\r\n    return uint256(get_merkle_root(elements));\r\n}\r\n```\r\n\r\n\r\n## Backwards Compatibility\r\n\r\nThis would be backwards compatible as its a relaxation of the rules. Perhaps just a warning of info when implicit casting is detected?",
  "closed_by": {
    "login": "deluca-mike",
    "id": 35537333,
    "node_id": "MDQ6VXNlcjM1NTM3MzMz",
    "avatar_url": "https://avatars.githubusercontent.com/u/35537333?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/deluca-mike",
    "html_url": "https://github.com/deluca-mike",
    "followers_url": "https://api.github.com/users/deluca-mike/followers",
    "following_url": "https://api.github.com/users/deluca-mike/following{/other_user}",
    "gists_url": "https://api.github.com/users/deluca-mike/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/deluca-mike/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/deluca-mike/subscriptions",
    "organizations_url": "https://api.github.com/users/deluca-mike/orgs",
    "repos_url": "https://api.github.com/users/deluca-mike/repos",
    "events_url": "https://api.github.com/users/deluca-mike/events{/privacy}",
    "received_events_url": "https://api.github.com/users/deluca-mike/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/10649/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/10649/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/748083857",
    "html_url": "https://github.com/ethereum/solidity/issues/10649#issuecomment-748083857",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10649",
    "id": 748083857,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODA4Mzg1Nw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-18T13:27:18Z",
    "updated_at": "2020-12-18T13:27:18Z",
    "author_association": "MEMBER",
    "body": "If I understand you correctly, you are saying that `bytes32(x)` (for `x` being of `uint256` type) generates an `and` instruction, even though it is not necessary. Is that correct?\r\n\r\nIs the `and` operation removed when you activate the optimizer?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/748083857/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/749306897",
    "html_url": "https://github.com/ethereum/solidity/issues/10649#issuecomment-749306897",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10649",
    "id": 749306897,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0OTMwNjg5Nw==",
    "user": {
      "login": "deluca-mike",
      "id": 35537333,
      "node_id": "MDQ6VXNlcjM1NTM3MzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/35537333?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/deluca-mike",
      "html_url": "https://github.com/deluca-mike",
      "followers_url": "https://api.github.com/users/deluca-mike/followers",
      "following_url": "https://api.github.com/users/deluca-mike/following{/other_user}",
      "gists_url": "https://api.github.com/users/deluca-mike/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/deluca-mike/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/deluca-mike/subscriptions",
      "organizations_url": "https://api.github.com/users/deluca-mike/orgs",
      "repos_url": "https://api.github.com/users/deluca-mike/repos",
      "events_url": "https://api.github.com/users/deluca-mike/events{/privacy}",
      "received_events_url": "https://api.github.com/users/deluca-mike/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-22T02:48:24Z",
    "updated_at": "2020-12-22T02:51:04Z",
    "author_association": "NONE",
    "body": "Let me do some tests and report back shortly.\r\n\r\nTo be clear, at least half the feature request is about code readability via implicit casting of types that are the exact same size/bits on the stack. This is especially useful in a \"world\" where you can only access the last 16 stack slots, allowing you to reuse like-type variables without ugly casting, as per my above example.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/749306897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/749953284",
    "html_url": "https://github.com/ethereum/solidity/issues/10649#issuecomment-749953284",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10649",
    "id": 749953284,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0OTk1MzI4NA==",
    "user": {
      "login": "deluca-mike",
      "id": 35537333,
      "node_id": "MDQ6VXNlcjM1NTM3MzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/35537333?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/deluca-mike",
      "html_url": "https://github.com/deluca-mike",
      "followers_url": "https://api.github.com/users/deluca-mike/followers",
      "following_url": "https://api.github.com/users/deluca-mike/following{/other_user}",
      "gists_url": "https://api.github.com/users/deluca-mike/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/deluca-mike/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/deluca-mike/subscriptions",
      "organizations_url": "https://api.github.com/users/deluca-mike/orgs",
      "repos_url": "https://api.github.com/users/deluca-mike/repos",
      "events_url": "https://api.github.com/users/deluca-mike/events{/privacy}",
      "received_events_url": "https://api.github.com/users/deluca-mike/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-23T05:59:38Z",
    "updated_at": "2020-12-23T05:59:38Z",
    "author_association": "NONE",
    "body": "Ok, did some tests, and gas differences are not attributed to casting \"like-types\". So I guess this feature request is now just about implicit casting for cleaner code.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/749953284/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/758124608",
    "html_url": "https://github.com/ethereum/solidity/issues/10649#issuecomment-758124608",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10649",
    "id": 758124608,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1ODEyNDYwOA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-11T18:04:31Z",
    "updated_at": "2021-01-11T18:04:31Z",
    "author_association": "MEMBER",
    "body": "Ok, then going back to the other part of the issue: You would like all operators available to uint to also be available to bytes32 and vice-versa? I think this would create too much confusion. `x * 2` for `x` being `bytes32` for example could mean to concatenate `x` with itself. Furthermore, I think your code does quite some unusual things where it is good to add some warning signs in the form of explicit type conversions.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/758124608/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/969330233",
    "html_url": "https://github.com/ethereum/solidity/issues/10649#issuecomment-969330233",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10649",
    "id": 969330233,
    "node_id": "IC_kwDOAm_5kc45xs45",
    "user": {
      "login": "deluca-mike",
      "id": 35537333,
      "node_id": "MDQ6VXNlcjM1NTM3MzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/35537333?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/deluca-mike",
      "html_url": "https://github.com/deluca-mike",
      "followers_url": "https://api.github.com/users/deluca-mike/followers",
      "following_url": "https://api.github.com/users/deluca-mike/following{/other_user}",
      "gists_url": "https://api.github.com/users/deluca-mike/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/deluca-mike/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/deluca-mike/subscriptions",
      "organizations_url": "https://api.github.com/users/deluca-mike/orgs",
      "repos_url": "https://api.github.com/users/deluca-mike/repos",
      "events_url": "https://api.github.com/users/deluca-mike/events{/privacy}",
      "received_events_url": "https://api.github.com/users/deluca-mike/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-15T21:18:07Z",
    "updated_at": "2021-11-15T21:18:07Z",
    "author_association": "NONE",
    "body": "ðŸ‘ ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/969330233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
