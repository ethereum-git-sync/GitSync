{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/10935",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/10935/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/10935/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/10935/events",
  "html_url": "https://github.com/ethereum/solidity/issues/10935",
  "id": 805078099,
  "node_id": "MDU6SXNzdWU4MDUwNzgwOTk=",
  "number": 10935,
  "title": "Unmapped code doesn't end up unmapped when called from a constructor",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1017612679,
      "node_id": "MDU6TGFiZWwxMDE3NjEyNjc5",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/protocol%20design%20:crystal_ball:",
      "name": "protocol design :crystal_ball:",
      "color": "8af77e",
      "default": false,
      "description": "Potential changes to ABI, meta data, standard JSON"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-02-10T01:46:29Z",
  "updated_at": "2022-08-17T13:49:24Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nSome code that, in a deployed context would be unmapped, in a constructor context instead gets mapped to the contract declaration node.\r\n\r\nThis is annoying for debugging because, when trying to track what's happened, it's hard to distinguish such implicit jumps from explicit ones in the code.  In a deployed context we can tell them apart because one goes into unmapped code.  In this context it's a lot harder.\r\n\r\nIdeally, the code would remain unmapped in both the constructor and the deployed contexts.\r\n\r\n## Steps to Reproduce\r\n\r\n```solidity\r\npragma solidity ^0.8.0;\r\n\r\ncontract Main {\r\n  constructor() {\r\n    new Secondary();\r\n  }\r\n}\r\n\r\ncontract Secondary {\r\n}\r\n```\r\n\r\nBefore the `CREATE` for `Secondary`, there's a brief jump into what, if this weren't a constructor, would be unmapped code.  Instead, however, the code is mapped to the `contract Main { ... }` node.\r\n\r\nNote that the bug will still occur if the troublesome segment is inside a different function that's called from the constructor.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.1 (it's in older versions as well; don't know how far back but I tried 0.7.2 and it's in that)\r\n- Target EVM version (as per compiler settings): default\r\n- Framework/IDE (e.g. Truffle or Remix): Truffle",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/10935/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/10935/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/776886762",
    "html_url": "https://github.com/ethereum/solidity/issues/10935#issuecomment-776886762",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10935",
    "id": 776886762,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3Njg4Njc2Mg==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-10T17:37:46Z",
    "updated_at": "2021-02-10T17:37:46Z",
    "author_association": "MEMBER",
    "body": "This seems to be a bit tricky and is related to how the \"current source location\" is set inside the compiler context. The jump target you mention is a \"low level function\" and its location might just be taken oven from the previous code. On the other hand, that low level function is created from the Main contract and this it should be valid to sets its location to the Main contract. This is how far I have got now.\r\n\r\nIf that's easier for you, I can make such utility functions always unmapped, but I still want to find out the cause of the difference between the two cases.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/776886762/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
