{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/11174",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/11174/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/11174/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/11174/events",
  "html_url": "https://github.com/ethereum/solidity/issues/11174",
  "id": 841215802,
  "node_id": "MDU6SXNzdWU4NDEyMTU4MDI=",
  "number": 11174,
  "title": "[Yul] ICE when assembling: `Cannot push and assign immutables in the same assembly subroutine`",
  "user": {
    "login": "agroce",
    "id": 967816,
    "node_id": "MDQ6VXNlcjk2NzgxNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/967816?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/agroce",
    "html_url": "https://github.com/agroce",
    "followers_url": "https://api.github.com/users/agroce/followers",
    "following_url": "https://api.github.com/users/agroce/following{/other_user}",
    "gists_url": "https://api.github.com/users/agroce/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/agroce/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/agroce/subscriptions",
    "organizations_url": "https://api.github.com/users/agroce/orgs",
    "repos_url": "https://api.github.com/users/agroce/repos",
    "events_url": "https://api.github.com/users/agroce/events{/privacy}",
    "received_events_url": "https://api.github.com/users/agroce/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2376148917,
      "node_id": "MDU6TGFiZWwyMzc2MTQ4OTE3",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/should%20report%20better%20error",
      "name": "should report better error",
      "color": "53e0b5",
      "default": false,
      "description": "Error is just badly reported. Should be a proper type error - source is not fine."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-03-25T18:51:27Z",
  "updated_at": "2021-07-31T00:11:15Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nThis Yul file:\r\n\r\n```\r\n{\r\n    setimmutable(0, \"abc\", loadimmutable(\"abc\"))\r\n}\r\n```\r\n\r\n```\r\nroot@ba087edf5361:~/solidity/test# ../build/solc/solc t.yul --strict-assembly --optimize\r\nWarning: Yul is still experimental. Please use the output with care.\r\n\r\n======= t.yul (EVM) =======\r\n\r\nPretty printed source:\r\nobject \"object\" {\r\n    code {\r\n        {\r\n            setimmutable(0, \"abc\", loadimmutable(\"abc\"))\r\n        }\r\n    }\r\n}\r\n\r\nException while assembling: /solidity/libevmasm/Assembly.cpp(585): Throw in function const solidity::evmasm::LinkerObject &solidity::evmasm::Assembly::assemble() const\r\nDynamic exception type: boost::wrapexcept<solidity::evmasm::AssemblyException>\r\nstd::exception::what: Cannot push and assign immutables in the same assembly subroutine.\r\n[solidity::util::tag_comment*] = Cannot push and assign immutables in the same assembly subroutine.\r\n```\r\n\r\nNot sure really relevant, again, since it's an assembly failure, but I'll report all these for triaging.  Doesn't matter if there's an --optimize or not, since this one doesn't optimize away.\r\n\r\nOn master, using AFL fuzzing of yul inputs via '--strict-assembly'.  Another discovery using https://github.com/agroce/afl-compiler-fuzzer.\r\n\r\n## Environment\r\n\r\n- Compiler version:  0.8.4-develop.2021.3.25+commit.d75a132f.Linux.clang\r\n- Target EVM version (as per compiler settings): N/A\r\n- Framework/IDE (e.g. Truffle or Remix): N/A\r\n- EVM execution environment / backend / blockchain client: N/A\r\n- Operating system: Ubuntu 20.04.1 LTS in docker\r\n\r\n## Steps to Reproduce\r\n\r\nAbove shows pretty clearly, I think.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/11174/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/11174/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/843455476",
    "html_url": "https://github.com/ethereum/solidity/issues/11174#issuecomment-843455476",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11174",
    "id": 843455476,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MzQ1NTQ3Ng==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-18T19:02:15Z",
    "updated_at": "2021-05-18T19:03:21Z",
    "author_association": "MEMBER",
    "body": "I guess we need to improve the analyzer to issue a nicer warning. That may be difficult though as we do not maintain yet such contextual information about builtins, i.e. what is used already and any dependencies/exclusions.\r\n\r\nProbably the solution would be having an optional analyzer step exposed by the dialect, which could deal with such complex scenarios.\r\n\r\nThese builtins are only available in the \"yul with objects\", which is not the one exposed in inline assembly, so at least it is less likely anyone is running into this.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/843455476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
