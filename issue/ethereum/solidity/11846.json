{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/11846",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/11846/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/11846/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/11846/events",
  "html_url": "https://github.com/ethereum/solidity/issues/11846",
  "id": 980291736,
  "node_id": "MDU6SXNzdWU5ODAyOTE3MzY=",
  "number": 11846,
  "title": "Simplify and deduplicate CircleCI config",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 437863668,
      "node_id": "MDU6TGFiZWw0Mzc4NjM2Njg=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/build%20system%20:building_construction:",
      "name": "build system :building_construction:",
      "color": "1d76db",
      "default": false,
      "description": ""
    },
    {
      "id": 717596767,
      "node_id": "MDU6TGFiZWw3MTc1OTY3Njc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "006b75",
      "default": true,
      "description": ""
    },
    {
      "id": 1012613901,
      "node_id": "MDU6TGFiZWwxMDEyNjEzOTAx",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/easy%20difficulty",
      "name": "easy difficulty",
      "color": "0b3f89",
      "default": false,
      "description": ""
    },
    {
      "id": 4438006499,
      "node_id": "LA_kwDOAm_5kc8AAAABCIaa4w",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20effort",
      "name": "low effort",
      "color": "ffb1fa",
      "default": false,
      "description": "There is not much implementation work to be done. The task is very easy or tiny."
    },
    {
      "id": 4438157609,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjpKQ",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20impact",
      "name": "low impact",
      "color": "5d71ff",
      "default": false,
      "description": "Changes are not very noticeable or potential benefits are limited."
    },
    {
      "id": 4438492402,
      "node_id": "LA_kwDOAm_5kc8AAAABCI4E8g",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/nice%20to%20have",
      "name": "nice to have",
      "color": "ffdeb3",
      "default": false,
      "description": "We donâ€™t see a good reason not to have it but wonâ€™t go out of our way to implement it."
    },
    {
      "id": 4438780109,
      "node_id": "LA_kwDOAm_5kc8AAAABCJJozQ",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/refactor",
      "name": "refactor",
      "color": "fcff07",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-08-26T14:08:39Z",
  "updated_at": "2022-09-27T23:01:17Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "This came up in #11823.\r\n\r\nOur [.circleci/config.yml](https://github.com/ethereum/solidity/blob/develop/.circleci/config.yml) file is pretty long. I went through the file and here's a bunch of changes that we could do to improve it.\r\n\r\nDeduplication:\r\n- [x] `t_archlinux_soltest`, `t_ubu_soltest_enforce_yul`, `t_ubu_ubsan_clang` and `t_ubu_ubsan_clang_cli` could use `run_soltest_steps`.\r\n    - Note that `run_soltest_steps` cannot be added to an existing list of steps but it you could probably embed inside a step by using a [`when` parameter of a `run` step](https://circleci.com/docs/2.0/configuration-reference/#run).\r\n- Some jobs look very similar. Perhaps they could be replaced by a single job with parameters (see `t_ems_ext` job for an example; also [Reusable Config Reference Guide](https://circleci.com/docs/2.0/reusing-config/)). If not, it might at least be possible to extract reusable steps from them:\r\n    - [ ] `b_ubu_clang`, `b_ubu_asan_clang` and `b_ubu_ubsan_clang`.\r\n    - [ ] `t_osx_soltest` and `t_osx_cli`.\r\n    - [ ] `b_bytecode_ubu`, `b_bytecode_osx` and `b_bytecode_win`. \r\n- [x] Many jobs set the `TERM` variable to `xterm`. I think it would not hurt to just have it set once, globally, so that we do not have to worry about it.\r\n    - EDIT: This probably does not have a good solution (see https://github.com/ethereum/solidity/pull/11868#discussion_r699430288) but I'm leaving it open. Maybe someone will figure out something.\r\n    - EDIT2: I found a good compromise in #12173 - now the variable is defined in the `base_` templates.\r\n- [ ] Jobs that differ only by one or two steps could be simplified by [passing these steps as arguments](https://circleci.com/docs/2.0/reusing-config/#steps).\r\n\r\nRefactors:\r\n- [x] All the `test_` templates (e.g. `test_ubuntu1604_clang` or `t_ubu_soltest`) seem a bit pointless because their steps are almost always overwritten. And when they're not, they're misleading because it's not apparent which steps they run just from their name. For example `test_ubuntu2004` runs `soltest_all` while `test_ubuntu2004_clang` runs only `soltest`. And after https://github.com/ethereum/solidity/pull/11823#discussion_r692403300 it's easy to explicitly specify their steps directly in the job anyway. I think that a better system would be to convert these templates into base dicts that just set the base docker image (maybe also `parallelism` and resource class). I'd remove steps from them (move them to jobs). I'd use `image_` or `base_` prefix instead of `test_` and rename the section. EDIT: Done in #12173.\r\n- [ ] Our `steps_` templates should be rewritten as [reusable commands](https://circleci.com/docs/2.0/reusing-config/#authoring-reusable-commands). This would make their use less verbose because we would no longer need to use the `when` hack I described above to merge them with existing step lists.\r\n    - [ ] Check if steps of some existing jobs could also be converted into commands. One candidate would be for example package installation with `apt-get`. Another might be the stuff we do in bytecode comparison.\r\n\r\n\r\nCleanup:\r\n- [x] I think we do not need to run the nightly workflow on the `develop_060` branch. Do we even still have that branch? We're already at 0.8.x.\r\n- [x] There are some dicts like `run_soltest_all_steps` that actually contain `steps:` key rather than `run:`. They should be renamed to start with `steps_`. E.g. `steps_soltest_all`\r\n- [x] All the `run_` steps should be moved to the `Build Templates` section.\r\n- [x] `b_ubu_asan` should be moved next to `b_ubu_asan_clang`.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/11846/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/11846/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/907297178",
    "html_url": "https://github.com/ethereum/solidity/issues/11846#issuecomment-907297178",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11846",
    "id": 907297178,
    "node_id": "IC_kwDOAm_5kc42FEGa",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-27T15:45:34Z",
    "updated_at": "2021-08-27T15:45:34Z",
    "author_association": "MEMBER",
    "body": "Great! Which one you'd like to try? I think it would be best to do it step by step, with small focused PRs, instead of creating a big one fixing it all in one go. I expect this will require some trial and error and a full CI run takes about 1h.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/907297178/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/909402002",
    "html_url": "https://github.com/ethereum/solidity/issues/11846#issuecomment-909402002",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11846",
    "id": 909402002,
    "node_id": "IC_kwDOAm_5kc42NF-S",
    "user": {
      "login": "mspaansen",
      "id": 41229911,
      "node_id": "MDQ6VXNlcjQxMjI5OTEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/41229911?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mspaansen",
      "html_url": "https://github.com/mspaansen",
      "followers_url": "https://api.github.com/users/mspaansen/followers",
      "following_url": "https://api.github.com/users/mspaansen/following{/other_user}",
      "gists_url": "https://api.github.com/users/mspaansen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mspaansen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mspaansen/subscriptions",
      "organizations_url": "https://api.github.com/users/mspaansen/orgs",
      "repos_url": "https://api.github.com/users/mspaansen/repos",
      "events_url": "https://api.github.com/users/mspaansen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mspaansen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-31T16:40:47Z",
    "updated_at": "2022-04-12T18:38:07Z",
    "author_association": "NONE",
    "body": "ðŸ˜€",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/909402002/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/949820821",
    "html_url": "https://github.com/ethereum/solidity/issues/11846#issuecomment-949820821",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11846",
    "id": 949820821,
    "node_id": "IC_kwDOAm_5kc44nR2V",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-22T17:15:58Z",
    "updated_at": "2021-10-22T17:15:58Z",
    "author_association": "MEMBER",
    "body": "While working on CI tasks today I realized that it's possible to pass step lists as parameters and that step lists can be wrapped into reusable commands. This could be used to further simplify the configuration. I added new items to the list in the description.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/949820821/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1094854222",
    "html_url": "https://github.com/ethereum/solidity/issues/11846#issuecomment-1094854222",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11846",
    "id": 1094854222,
    "node_id": "IC_kwDOAm_5kc5BQiZO",
    "user": {
      "login": "super1ha1",
      "id": 9015360,
      "node_id": "MDQ6VXNlcjkwMTUzNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9015360?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/super1ha1",
      "html_url": "https://github.com/super1ha1",
      "followers_url": "https://api.github.com/users/super1ha1/followers",
      "following_url": "https://api.github.com/users/super1ha1/following{/other_user}",
      "gists_url": "https://api.github.com/users/super1ha1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/super1ha1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/super1ha1/subscriptions",
      "organizations_url": "https://api.github.com/users/super1ha1/orgs",
      "repos_url": "https://api.github.com/users/super1ha1/repos",
      "events_url": "https://api.github.com/users/super1ha1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/super1ha1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-11T10:05:21Z",
    "updated_at": "2022-04-11T10:05:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "@cameel thanks for your suggestion, after reading through the code, \r\nit seem b_bytecode_ubu, b_bytecode_osx can be reused with some common steps.\r\n\r\n\r\nI have created a pull request here\r\n\r\n[12923](https://github.com/ethereum/solidity/pull/12923)\r\n\r\nCan you help to take a look? \r\n\r\nThanks you!\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1094854222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1097065045",
    "html_url": "https://github.com/ethereum/solidity/issues/11846#issuecomment-1097065045",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11846",
    "id": 1097065045,
    "node_id": "IC_kwDOAm_5kc5BY-JV",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-12T18:36:38Z",
    "updated_at": "2022-04-12T18:36:38Z",
    "author_association": "MEMBER",
    "body": "@super1ha1 Sure. See https://github.com/ethereum/solidity/pull/12923#issuecomment-1097060497.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1097065045/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
