{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12654",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12654/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12654/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12654/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12654",
  "id": 1131435611,
  "node_id": "I_kwDOAm_5kc5DcFZb",
  "number": 12654,
  "title": "Rethrowing reverts",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-02-11T01:38:47Z",
  "updated_at": "2022-08-17T13:49:00Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Abstract\r\nThere is currently no way to catch and rethrow the exact same error in a high-level way. This is problematic especially in the `catch(bytes memory)` clause where you can't simply create another instance of the same error type and copy the parameters.\r\n\r\nMany languages have a convenient mechanism for rethrowing exceptions. For example in C++ you can use `throw;` in a `catch` block. Python has `raise`, which does the same thing when used without arguments. In Solidity `revert;` could be used for this purpose.\r\n\r\n## Motivation\r\nA practical use case where this would be useful is suppressing errors conditionally. Consider this example:\r\n\r\n```solidity\r\nfunction processBatch(Data[] calldata data, bool ignoreErrors) public returns (uint) {\r\n    uint successCount = 0;\r\n    for (uint i = 0; i < data.length; ++i) {\r\n        try c.processData(data[i]) {\r\n            ++successCount;\r\n        } catch (bytes memory lowLevelData) {\r\n            if (!ignoreErrors)\r\n                assembly {\r\n                    let start := add(lowLevelData, 0x20)\r\n                    let end := add(lowLevelData, mload(lowLevelData))\r\n                    revert(start, end)\r\n                }\r\n        }\r\n    }\r\n\r\n    return successCount;\r\n}\r\n```\r\n`processBatch()`, depending on the value of `ignoreErrors` parameter, can either revert as soon as an external call fails or suppress all errors and try to process any batches that do not fail. The problem is that the decision must be made inside the `catch` block and there is no high-level way to continue with the same error once we're there.\r\n\r\nIt can be achieved with low-level `revert` in inline assembly but users should not be forced to reach for low-level mechanisms to do this. Especially since the user is likely to do this instead:\r\n```solidity\r\n                assembly {\r\n                    returndatacopy(0, 0, returndatasize())\r\n                    revert(0, returndatasize())\r\n                }\r\n```\r\nwhich writes to arbitrary memory locations and is problematic for our new mechanism for moving extra variables to memory.\r\n\r\n## Specification\r\nIf a `revert` statement without any arguments appears in a `catch` block, the compiler should generate code that reverts with the same error data it received from the external call.\r\n\r\nOutside of `catch`, bare `revert` should be disallowed just as it is now.\r\n\r\nWith the new feature the catch block in the function above would look like this:\r\n```solidity\r\n        } catch (bytes memory lowLevelData) {\r\n            if (!ignoreErrors)\r\n                revert;\r\n        }\r\n```\r\n\r\n## Backwards Compatibility\r\n\r\nThe change is fully backwards-compatible because `revert;` currently causes a compilation error.\r\n\r\n`revert` with an empty message (i.e.  `revert(\"\")`) is a different thing and should not be affected by this change.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12654/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12654/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1035982297",
    "html_url": "https://github.com/ethereum/solidity/issues/12654#issuecomment-1035982297",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12654",
    "id": 1035982297,
    "node_id": "IC_kwDOAm_5kc49v9XZ",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-11T08:38:55Z",
    "updated_at": "2022-02-11T08:38:55Z",
    "author_association": "MEMBER",
    "body": "I came across this problem several times, but I do not think this is the right approach.\r\n\r\nThe simplest solution is just allowing `revert(bytes)` to be a passthrough command (i.e. not padding the `bytes` with anything). In essence we would have three signatures:\r\n- `revert()`\r\n- `revert(bytes)` -- uses the `bytes` buffer as the entire revert content\r\n- `revert(string)` -- uses the `string` as the `Errror` payload\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1035982297/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 1,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1036217792",
    "html_url": "https://github.com/ethereum/solidity/issues/12654#issuecomment-1036217792",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12654",
    "id": 1036217792,
    "node_id": "IC_kwDOAm_5kc49w23A",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-11T13:32:59Z",
    "updated_at": "2022-02-11T13:32:59Z",
    "author_association": "MEMBER",
    "body": "Why do you think it's not the right approach? It's a pretty common way to do this in other languages.\r\n\r\nI would not be against just adding `revert(bytes)` but I think it has a higher potential for mistakes. People have to convert `string` to `bytes` all the time because you cannot do much with `string`. I can image a situation where someone passes in a `bytes` variable thinking it will be used as a message. People make mistakes all the time but the problem here is that this wouldn't be very apparent because it would appear to work.\r\n\r\nAlso, this would not work in the `catch` clause that has no argument.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1036217792/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1082410373",
    "html_url": "https://github.com/ethereum/solidity/issues/12654#issuecomment-1082410373",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12654",
    "id": 1082410373,
    "node_id": "IC_kwDOAm_5kc5AhEWF",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-29T21:56:18Z",
    "updated_at": "2022-03-29T21:56:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "`revert;` for rethrowing doesn't look right to me either. I would've assumed it was equivalent to `revert()`, and would never have expected it to rethrow. I didn't remember C++ did it this way and was not familiar with the Python construct either.\r\n\r\nI also think `revert(bytes)` has potential for mistakes. What about `revert bytes;`, more in line with the revert statement for custom errors? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1082410373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1112656682",
    "html_url": "https://github.com/ethereum/solidity/issues/12654#issuecomment-1112656682",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12654",
    "id": 1112656682,
    "node_id": "IC_kwDOAm_5kc5CUcsq",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-28T21:09:42Z",
    "updated_at": "2022-04-28T21:09:42Z",
    "author_association": "MEMBER",
    "body": "> What about `revert bytes;`, more in line with the revert statement for custom errors? \r\n\r\nIt would not be bad on its own but I'd also expect users to be confused about the difference between `revert(\"\");` and `revert \"\";`.\r\n\r\nPlain `revert;` also has the problem that it could be taken for `revert(\"\")` but it's such a common pattern that I think it might be acceptable. Honestly, I'm shocked to discover that JavaScript (and Java) are the exceptions that do not have this. A lot of very popular languages do. C++, Python, Ruby, C#. Hell, even Object Pascal/Delphi did. It always seemed pretty universal to me.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1112656682/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
