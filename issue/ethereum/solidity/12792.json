{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12792",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12792/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12792/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12792/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12792",
  "id": 1169649285,
  "node_id": "I_kwDOAm_5kc5Ft26F",
  "number": 12792,
  "title": "mapping getters don't return structs with arrays correctly",
  "user": {
    "login": "ramgos",
    "id": 70999332,
    "node_id": "MDQ6VXNlcjcwOTk5MzMy",
    "avatar_url": "https://avatars.githubusercontent.com/u/70999332?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ramgos",
    "html_url": "https://github.com/ramgos",
    "followers_url": "https://api.github.com/users/ramgos/followers",
    "following_url": "https://api.github.com/users/ramgos/following{/other_user}",
    "gists_url": "https://api.github.com/users/ramgos/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ramgos/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ramgos/subscriptions",
    "organizations_url": "https://api.github.com/users/ramgos/orgs",
    "repos_url": "https://api.github.com/users/ramgos/repos",
    "events_url": "https://api.github.com/users/ramgos/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ramgos/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-03-15T13:05:28Z",
  "updated_at": "2022-03-22T14:55:46Z",
  "closed_at": "2022-03-22T14:55:46Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Whenever there is a mapping from some type to a struct, and the struct contains a dynamic array - calling the getter of the mapping doesn't show the array's values\r\n\r\nCompiler version: 0.8.12 (tested also 0.8.7 and 0.8.3)\r\nTarget EVM version: london\r\nFramework/IDE: Remix, also reproduced on hardhat ethers\r\nEVM execution environment: javascript VM\r\nOperating system: Linux\r\n\r\nexample:\r\n\r\n```solidity\r\npragma solidity ^0.8.0;\r\n\r\ncontract Contract {\r\n    struct Struct {\r\n        address sender;\r\n        uint256[] numbers;\r\n    }\r\n\r\n    mapping(uint256 => Struct) public structs;\r\n\r\n    function setValue(uint256 _index, uint256[] memory _array) external {\r\n        structs[_index] = Struct(msg.sender, _array);\r\n    }\r\n\r\n    function getStruct(uint256 _index) external view returns(Struct memory) {\r\n        return structs[_index];\r\n    }\r\n}\r\n```\r\nAfter `setValue(0, [1, 2, 3])`, calling `getStruct(0)` returns both the sender and numbers array, but `strcuts(0)` returns only the sender\r\nThis is also confirmed by the ABI definitions:\r\nstructs:\r\n```\r\n\t\"inputs\": [\r\n\t\t{\r\n\t\t\t\"internalType\": \"uint256\",\r\n\t\t\t\"name\": \"\",\r\n\t\t\t\"type\": \"uint256\"\r\n\t\t}\r\n\t],\r\n\t\"name\": \"structs\",\r\n\t\"outputs\": [\r\n\t\t{\r\n\t\t\t\"internalType\": \"address\",\r\n\t\t\t\"name\": \"sender\",\r\n\t\t\t\"type\": \"address\"\r\n\t\t}\r\n\t],\r\n\t\"stateMutability\": \"view\",\r\n\t\"type\": \"function\"\r\n```\r\n\r\ngetStruct:\r\n```\r\n\t\t\t\"inputs\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"internalType\": \"uint256\",\r\n\t\t\t\t\t\"name\": \"_index\",\r\n\t\t\t\t\t\"type\": \"uint256\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"name\": \"getStruct\",\r\n\t\t\t\"outputs\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"components\": [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"internalType\": \"address\",\r\n\t\t\t\t\t\t\t\"name\": \"sender\",\r\n\t\t\t\t\t\t\t\"type\": \"address\"\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"internalType\": \"uint256[]\",\r\n\t\t\t\t\t\t\t\"name\": \"numbers\",\r\n\t\t\t\t\t\t\t\"type\": \"uint256[]\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\t\"internalType\": \"struct Contract.Struct\",\r\n\t\t\t\t\t\"name\": \"\",\r\n\t\t\t\t\t\"type\": \"tuple\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"stateMutability\": \"view\",\r\n\t\t\t\"type\": \"function\"\r\n```\r\n\r\nfor the meanwhile, how can I bypass this? I tried calculating the mapping storage slot myself based on the docs, with no success. here is my function:\r\n```\r\nconst keySlot = (mappingSlot, key) => {\r\n    return keccak256(concat([zeroPad(key, 32), mappingSlot]));\r\n};\r\n```",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12792/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12792/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1075286538",
    "html_url": "https://github.com/ethereum/solidity/issues/12792#issuecomment-1075286538",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12792",
    "id": 1075286538,
    "node_id": "IC_kwDOAm_5kc5AF5IK",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-22T14:55:46Z",
    "updated_at": "2022-03-22T14:55:46Z",
    "author_association": "MEMBER",
    "body": "This is on purpose. Arrays are not returned by value from getters. Instead index access is provided for them. Since it is not possible for structs, we decided to drop these arrays. Unfortunately, you have to implement your own getter function if you want this functionality.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1075286538/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 1,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
