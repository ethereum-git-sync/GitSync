{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12807",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12807/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12807/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12807/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12807",
  "id": 1171116326,
  "node_id": "I_kwDOAm_5kc5FzdEm",
  "number": 12807,
  "title": "Requesting ability to define modifiers in Solidity libraries and use them in contracts",
  "user": {
    "login": "mudgen",
    "id": 49092,
    "node_id": "MDQ6VXNlcjQ5MDky",
    "avatar_url": "https://avatars.githubusercontent.com/u/49092?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mudgen",
    "html_url": "https://github.com/mudgen",
    "followers_url": "https://api.github.com/users/mudgen/followers",
    "following_url": "https://api.github.com/users/mudgen/following{/other_user}",
    "gists_url": "https://api.github.com/users/mudgen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mudgen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mudgen/subscriptions",
    "organizations_url": "https://api.github.com/users/mudgen/orgs",
    "repos_url": "https://api.github.com/users/mudgen/repos",
    "events_url": "https://api.github.com/users/mudgen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mudgen/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-03-16T14:39:24Z",
  "updated_at": "2022-08-17T13:48:58Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Abstract\r\n\r\nIt would be useful if people could define modifiers in Solidity libraries and be able to import and use them in contracts.\r\n\r\n## Motivation\r\n\r\nIt has been found by myself and others that it is possible to write clean code by writing internal functions in Solidity libraries and then importing those libraries into contracts and using them.\r\n\r\nThis can be a good way to write code because it can make it more clear where internal functions come from because once a library is imported the name of the library can be used when calling the functions in the library.  This makes it clear and explicit what and where internal functions come from when they are called.\r\n\r\nHowever this style does not work with modifiers because it is currently not possible to define modifiers in Solidity libraries.\r\n\r\n## Specification\r\n\r\nIt would be great if it was possible to define modifiers in Solidity libraries so they can be imported and used in contracts.\r\n\r\nNote that with diamond storage people could access the state variables of contracts in modifiers written in Solidity libraries. \r\n\r\nAlso note that a primary developer of OpenZeppelin recently said [that they plan to adopt Diamond Storage in the next major version of OpenZeppelin](https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2964#issuecomment-1068278307).",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12807/reactions",
    "total_count": 3,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 2,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12807/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1070795204",
    "html_url": "https://github.com/ethereum/solidity/issues/12807#issuecomment-1070795204",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12807",
    "id": 1070795204,
    "node_id": "IC_kwDOAm_5kc4_0wnE",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-17T11:04:28Z",
    "updated_at": "2022-03-17T11:04:28Z",
    "author_association": "MEMBER",
    "body": "The main reason I did not yet consider to allow defining modifiers outside the current contract is that I don't see them to be useful because most of the time you would access at least a state variable of the contract. Can you provide some code examples where this is useful?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1070795204/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1070965062",
    "html_url": "https://github.com/ethereum/solidity/issues/12807#issuecomment-1070965062",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12807",
    "id": 1070965062,
    "node_id": "IC_kwDOAm_5kc4_1aFG",
    "user": {
      "login": "mudgen",
      "id": 49092,
      "node_id": "MDQ6VXNlcjQ5MDky",
      "avatar_url": "https://avatars.githubusercontent.com/u/49092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mudgen",
      "html_url": "https://github.com/mudgen",
      "followers_url": "https://api.github.com/users/mudgen/followers",
      "following_url": "https://api.github.com/users/mudgen/following{/other_user}",
      "gists_url": "https://api.github.com/users/mudgen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mudgen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mudgen/subscriptions",
      "organizations_url": "https://api.github.com/users/mudgen/orgs",
      "repos_url": "https://api.github.com/users/mudgen/repos",
      "events_url": "https://api.github.com/users/mudgen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mudgen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-17T14:24:45Z",
    "updated_at": "2022-03-17T14:36:02Z",
    "author_association": "NONE",
    "body": "@chriseth Yes, of course. Currently `storage` parameters can be defined on modifiers and state variables can be passed to modifiers as arguments. I would think the same thing could be done with modifiers defined in libraries.\r\n\r\nBut also, there is a growing use of Solidity libraries using Diamond Storage to access state variables of contracts directly, and modifiers in Solidity libraries could do this as well.\r\n\r\nYou see, Solidity libraries can be created to define state variables and internal functions that modify those state variables. Then it would be good to be able to define modifiers in the same libraries to control access to those state variables.\r\n\r\nHere's an example of a small library that controls access to the ownership of a contract or diamond. A contract or diamond could use this library to easily implement contract ownership functionality.  Currently I can define the `onlyOwner` modifier in the library but I can't use it in a contract.\r\n\r\n```Solidity\r\n// SPDX-License-Identifier: MIT\r\n\r\n\r\npragma solidity 0.8.11;\r\n    \r\nlibrary ContractOwnerLib {\r\n\r\n    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);\r\n\r\n    bytes32 constant DIAMOND_STORAGE_POSITION = keccak256(\"diamond.standard.diamond.storage.myproject.contractowner\");\r\n\r\n    struct DiamondStorage {\r\n        address contractOwner;\r\n    }\r\n\r\n    function diamondStorage() internal pure returns (DiamondStorage storage ds) {\r\n        bytes32 position = DIAMOND_STORAGE_POSITION;\r\n        assembly {\r\n            ds.slot := position\r\n        }\r\n    }\r\n\r\n    function setContractOwner(address _newOwner) internal {\r\n        DiamondStorage storage ds = diamondStorage();\r\n        emit OwnershipTransferred(ds.contractOwner, _newOwner);        \r\n        ds.contractOwner = _newOwner;        \r\n    }\r\n\r\n    function contractOwner() internal view returns (address contractOwner_) {\r\n        contractOwner_ = diamondStorage().contractOwner;\r\n    }\r\n\r\n    function enforceIsContractOwner() internal view {\r\n        require(msg.sender == diamondStorage().contractOwner, \"LibDiamond: Must be contract owner\");\r\n    }\r\n    \r\n    modifier onlyOwner() {\r\n       enforceIsContractOwner();\r\n       _;\r\n   }      \r\n}\r\n```\r\n\r\nI made a work around which is using a `Modifiers` contract that just holds modifiers and contracts inherit that.  But it would be cleaner/nicer to use modifiers from the Solidity libraries that are being used.\r\n\r\nHere are links to the source code from different authors for just a few contracts I found that are using Diamond Storage that would or might benefit from modifiers defined in libraries:\r\n\r\nAn Aavegotchi Facet:\r\nhttps://github.com/aavegotchi/aavegotchi-contracts/blob/master/contracts/Aavegotchi/facets/ItemsFacet.sol\r\n\r\nA BeanStalk Facet:\r\nhttps://github.com/BeanstalkFarms/Beanstalk/blob/master/protocol/contracts/farm/facets/ClaimFacet.sol\r\n\r\nFrom 0xHashstack:\r\nhttps://github.com/0xHashstack/Open-contracts/blob/release-v0.1.2/contracts/Comptroller.sol\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1070965062/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1105430040",
    "html_url": "https://github.com/ethereum/solidity/issues/12807#issuecomment-1105430040",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12807",
    "id": 1105430040,
    "node_id": "IC_kwDOAm_5kc5B44YY",
    "user": {
      "login": "mudgen",
      "id": 49092,
      "node_id": "MDQ6VXNlcjQ5MDky",
      "avatar_url": "https://avatars.githubusercontent.com/u/49092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mudgen",
      "html_url": "https://github.com/mudgen",
      "followers_url": "https://api.github.com/users/mudgen/followers",
      "following_url": "https://api.github.com/users/mudgen/following{/other_user}",
      "gists_url": "https://api.github.com/users/mudgen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mudgen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mudgen/subscriptions",
      "organizations_url": "https://api.github.com/users/mudgen/orgs",
      "repos_url": "https://api.github.com/users/mudgen/repos",
      "events_url": "https://api.github.com/users/mudgen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mudgen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-21T16:14:30Z",
    "updated_at": "2022-04-21T16:14:30Z",
    "author_association": "NONE",
    "body": "@chriseth more projects are using diamond storage in Solidity libraries which makes modifiers defined in Solidity libraries and used in contracts useful.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1105430040/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1114022908",
    "html_url": "https://github.com/ethereum/solidity/issues/12807#issuecomment-1114022908",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12807",
    "id": 1114022908,
    "node_id": "IC_kwDOAm_5kc5CZqP8",
    "user": {
      "login": "kenvogg",
      "id": 86197850,
      "node_id": "MDQ6VXNlcjg2MTk3ODUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/86197850?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kenvogg",
      "html_url": "https://github.com/kenvogg",
      "followers_url": "https://api.github.com/users/kenvogg/followers",
      "following_url": "https://api.github.com/users/kenvogg/following{/other_user}",
      "gists_url": "https://api.github.com/users/kenvogg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kenvogg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kenvogg/subscriptions",
      "organizations_url": "https://api.github.com/users/kenvogg/orgs",
      "repos_url": "https://api.github.com/users/kenvogg/repos",
      "events_url": "https://api.github.com/users/kenvogg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kenvogg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-30T17:19:04Z",
    "updated_at": "2022-04-30T17:19:04Z",
    "author_association": "NONE",
    "body": "Modifiers in Libraries would be super useful and help to tidy up our code, would love to see this functionality supported!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1114022908/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
