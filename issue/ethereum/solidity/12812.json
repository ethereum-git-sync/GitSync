{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12812",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12812/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12812/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12812/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12812",
  "id": 1171947901,
  "node_id": "I_kwDOAm_5kc5F2oF9",
  "number": 12812,
  "title": "`pragma solidity` with partial versions in match expression broken on prerelease builds",
  "user": {
    "login": "YashasSamaga",
    "id": 6652578,
    "node_id": "MDQ6VXNlcjY2NTI1Nzg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6652578?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/YashasSamaga",
    "html_url": "https://github.com/YashasSamaga",
    "followers_url": "https://api.github.com/users/YashasSamaga/followers",
    "following_url": "https://api.github.com/users/YashasSamaga/following{/other_user}",
    "gists_url": "https://api.github.com/users/YashasSamaga/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/YashasSamaga/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/YashasSamaga/subscriptions",
    "organizations_url": "https://api.github.com/users/YashasSamaga/orgs",
    "repos_url": "https://api.github.com/users/YashasSamaga/repos",
    "events_url": "https://api.github.com/users/YashasSamaga/events{/privacy}",
    "received_events_url": "https://api.github.com/users/YashasSamaga/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-03-17T05:25:17Z",
  "updated_at": "2022-05-03T05:52:53Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\n```\r\npragma solidity >= 0.8;\r\n\r\ncontract MyContract { }\r\n```\r\n\r\ngives\r\n\r\n```\r\nError: Source file requires different compiler version (current compiler is 0.8.13-develop.2022.3.14+commit.57e012da.Linux.g++) - note that nightly builds are considered to be strictly less than the released version\r\n --> mvce._version.sol:1:1:\r\n  |\r\n1 | pragma solidity >= 0.8;\r\n  | ^^^^^^^^^^^^^^^^^^^^^^^\r\n```\r\n\r\nbut there shouldn't have been an error as `0.8.13-develop....` is strictly greater than `0.8.12` which in turn is greater than `0.8`.\r\n\r\nThe following test cases work as expected:\r\n\r\n```\r\npragma solidity >= 0.8.13; // error but that's correct since the compiler is the prerelease version\r\npragma solidity >= 0.8.12; // no error; correct\r\npragma solidity >= 0.7; // no error; correct\r\n```\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.13-develop.2022.3.14+commit.57e012da.Linux.g++\r\n- Target EVM version (as per compiler settings):\r\n- Framework/IDE (e.g. Truffle or Remix): Local\r\n- EVM execution environment / backend / blockchain client: N/A\r\n- Operating system: Ubuntu 20.04\r\n\r\n## Steps to Reproduce\r\n\r\n```\r\npragma solidity >= 0.8;\r\n\r\ncontract MyContract { }\r\n```\r\n\r\ncompile with a prerelease build of the compiler whose version is `0.8.x`.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12812/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12812/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1070342652",
    "html_url": "https://github.com/ethereum/solidity/issues/12812#issuecomment-1070342652",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12812",
    "id": 1070342652,
    "node_id": "IC_kwDOAm_5kc4_zCH8",
    "user": {
      "login": "YashasSamaga",
      "id": 6652578,
      "node_id": "MDQ6VXNlcjY2NTI1Nzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6652578?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YashasSamaga",
      "html_url": "https://github.com/YashasSamaga",
      "followers_url": "https://api.github.com/users/YashasSamaga/followers",
      "following_url": "https://api.github.com/users/YashasSamaga/following{/other_user}",
      "gists_url": "https://api.github.com/users/YashasSamaga/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YashasSamaga/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YashasSamaga/subscriptions",
      "organizations_url": "https://api.github.com/users/YashasSamaga/orgs",
      "repos_url": "https://api.github.com/users/YashasSamaga/repos",
      "events_url": "https://api.github.com/users/YashasSamaga/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YashasSamaga/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-17T05:31:40Z",
    "updated_at": "2022-03-17T05:49:21Z",
    "author_association": "NONE",
    "body": "`pragma solidity >= 0.8` results in a disjunction of a single conjunction with a single match component for `>= 0.8`. There are only two levels in `0.8`. `levelsPresent` of `MatchComponent` is set to two. The relevant logic below checks up to two levels only:\r\n\r\nhttps://github.com/ethereum/solidity/blob/10b581b8e8e6e23f8ada8428a0a8b495f54f7333/liblangutil/SemVerHandler.cpp#L110-L137\r\n\r\n`0.8` matches with `0.8.13-develop...` and `cmp` is zero, `didCompare` is `true` and `_version.prerelease.empty()` is true. Therefore, the condition in L119 overall evaluates to `true`. This sets `cmp` to `-1` (which is wrong). \r\n\r\n**Proposed Fix:** Always complete partial versions to all levels by implicitly adding zeros and compare on full versions instead of partial versions.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1070342652/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1070646671",
    "html_url": "https://github.com/ethereum/solidity/issues/12812#issuecomment-1070646671",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12812",
    "id": 1070646671,
    "node_id": "IC_kwDOAm_5kc4_0MWP",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-17T09:38:33Z",
    "updated_at": "2022-03-17T09:38:33Z",
    "author_association": "MEMBER",
    "body": "Do I see it right that this is only a problem for prerelease versions?\r\n\r\nPlease go ahead and create a pull request!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1070646671/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1071939243",
    "html_url": "https://github.com/ethereum/solidity/issues/12812#issuecomment-1071939243",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12812",
    "id": 1071939243,
    "node_id": "IC_kwDOAm_5kc4_5H6r",
    "user": {
      "login": "YashasSamaga",
      "id": 6652578,
      "node_id": "MDQ6VXNlcjY2NTI1Nzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6652578?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YashasSamaga",
      "html_url": "https://github.com/YashasSamaga",
      "followers_url": "https://api.github.com/users/YashasSamaga/followers",
      "following_url": "https://api.github.com/users/YashasSamaga/following{/other_user}",
      "gists_url": "https://api.github.com/users/YashasSamaga/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YashasSamaga/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YashasSamaga/subscriptions",
      "organizations_url": "https://api.github.com/users/YashasSamaga/orgs",
      "repos_url": "https://api.github.com/users/YashasSamaga/repos",
      "events_url": "https://api.github.com/users/YashasSamaga/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YashasSamaga/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-18T01:43:10Z",
    "updated_at": "2022-03-18T01:43:10Z",
    "author_association": "NONE",
    "body": "> Do I see it right that this is only a problem for prerelease versions?\r\n\r\nYes, I think so.\r\n\r\n> Proposed Fix: Always complete partial versions to all levels by implicitly adding zeros and compare on full versions instead of partial versions.\r\n\r\nThis won't work. I think the following shouldn't give an error (which the compiler doesn't as of now but the proposed fix gives an error):\r\n\r\n```\r\npragma solidity 0.8;\r\n```\r\n\r\nwith the latest compiler (0.8.13).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1071939243/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1073723424",
    "html_url": "https://github.com/ethereum/solidity/issues/12812#issuecomment-1073723424",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12812",
    "id": 1073723424,
    "node_id": "IC_kwDOAm_5kc4__7gg",
    "user": {
      "login": "YashasSamaga",
      "id": 6652578,
      "node_id": "MDQ6VXNlcjY2NTI1Nzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6652578?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YashasSamaga",
      "html_url": "https://github.com/YashasSamaga",
      "followers_url": "https://api.github.com/users/YashasSamaga/followers",
      "following_url": "https://api.github.com/users/YashasSamaga/following{/other_user}",
      "gists_url": "https://api.github.com/users/YashasSamaga/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YashasSamaga/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YashasSamaga/subscriptions",
      "organizations_url": "https://api.github.com/users/YashasSamaga/orgs",
      "repos_url": "https://api.github.com/users/YashasSamaga/repos",
      "events_url": "https://api.github.com/users/YashasSamaga/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YashasSamaga/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-21T10:20:13Z",
    "updated_at": "2022-03-21T10:20:13Z",
    "author_association": "NONE",
    "body": "Based on my understanding/interpretation of the [semvar specs item 11](https://semver.org/#spec-item-11), prerelease checks should be performed only when all of major, minor, and patch version identifiers are equal. Otherwise, normal precedence rules apply.\r\n\r\n11.1 says:\r\n\r\n> Precedence MUST be calculated by separating the version into major, minor, patch and pre-release identifiers in that order (Build metadata does not figure into precedence).\r\n\r\nThis is already done in the code.\r\n\r\n11.2 says:\r\n\r\n> Precedence is determined by the first difference when comparing each of these identifiers from left to right as follows: Major, minor, and patch versions are always compared numerically.\r\n> \r\n> Example: 1.0.0 < 2.0.0 < 2.1.0 < 2.1.1.\r\n\r\nThis is already done in the code.\r\n\r\n11.3 says:\r\n\r\n> When major, minor, and patch are equal, a pre-release version has lower precedence than a normal version:\r\n> \r\n> Example: 1.0.0-alpha < 1.0.0.\r\n\r\nThe code does not strictly follow this rule. The prerelease check is supposed to only happen when major, minor, and patch identifiers all match according to this rule. However, prerelease checks are performed when all levels are not present.\r\n\r\n**Fix:** Perform prerelease checks if and only if all three numerical version identifiers match.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1073723424/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1075834923",
    "html_url": "https://github.com/ethereum/solidity/issues/12812#issuecomment-1075834923",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12812",
    "id": 1075834923,
    "node_id": "IC_kwDOAm_5kc5AH_Ar",
    "user": {
      "login": "YashasSamaga",
      "id": 6652578,
      "node_id": "MDQ6VXNlcjY2NTI1Nzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6652578?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YashasSamaga",
      "html_url": "https://github.com/YashasSamaga",
      "followers_url": "https://api.github.com/users/YashasSamaga/followers",
      "following_url": "https://api.github.com/users/YashasSamaga/following{/other_user}",
      "gists_url": "https://api.github.com/users/YashasSamaga/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YashasSamaga/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YashasSamaga/subscriptions",
      "organizations_url": "https://api.github.com/users/YashasSamaga/orgs",
      "repos_url": "https://api.github.com/users/YashasSamaga/repos",
      "events_url": "https://api.github.com/users/YashasSamaga/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YashasSamaga/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-23T02:11:20Z",
    "updated_at": "2022-03-23T02:26:15Z",
    "author_association": "NONE",
    "body": "Another test case that fails (even with the proposed fix):\r\n\r\n```\r\npragma solidity >= 0.8.*;\r\n\r\ncontract MyContract { }\r\n```\r\n\r\n```\r\nError: Source file requires different compiler version (current compiler is 0.8.14-develop.2022.3.21+commit.430ecb6e.mod.Linux.g++) - note that nightly builds are considered to be strictly less than the released version\r\n --> mvce_version.sol:1:1:\r\n  |\r\n1 | pragma solidity >= 0.8.*;\r\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1075834923/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1115761347",
    "html_url": "https://github.com/ethereum/solidity/issues/12812#issuecomment-1115761347",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12812",
    "id": 1115761347,
    "node_id": "IC_kwDOAm_5kc5CgSrD",
    "user": {
      "login": "YashasSamaga",
      "id": 6652578,
      "node_id": "MDQ6VXNlcjY2NTI1Nzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6652578?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YashasSamaga",
      "html_url": "https://github.com/YashasSamaga",
      "followers_url": "https://api.github.com/users/YashasSamaga/followers",
      "following_url": "https://api.github.com/users/YashasSamaga/following{/other_user}",
      "gists_url": "https://api.github.com/users/YashasSamaga/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YashasSamaga/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YashasSamaga/subscriptions",
      "organizations_url": "https://api.github.com/users/YashasSamaga/orgs",
      "repos_url": "https://api.github.com/users/YashasSamaga/repos",
      "events_url": "https://api.github.com/users/YashasSamaga/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YashasSamaga/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-03T05:52:52Z",
    "updated_at": "2022-05-03T05:52:52Z",
    "author_association": "NONE",
    "body": "[Excrept from semver npm package:](https://docs.npmjs.com/cli/v6/using-npm/semver#prerelease-tags)\r\n\r\n> \r\n> If a version has a prerelease tag (for example, 1.2.3-alpha.3) then it will only be allowed to satisfy comparator sets if at least one comparator with the same [major, minor, patch] tuple also has a prerelease tag.\r\n> \r\n> For example, the range >1.2.3-alpha.3 would be allowed to match the version 1.2.3-alpha.7, but it would not be satisfied by 3.4.5-alpha.9, even though 3.4.5-alpha.9 is technically \"greater than\" 1.2.3-alpha.3 according to the SemVer sort rules. The version range only accepts prerelease tags on the 1.2.3 version. The version 3.4.5 would satisfy the range, because it does not have a prerelease flag, and 3.4.5 is greater than 1.2.3-alpha.7.\r\n> \r\n> The purpose for this behavior is twofold. First, prerelease versions frequently are updated very quickly, and contain many breaking changes that are (by the author's design) not yet fit for public consumption. Therefore, by default, they are excluded from range matching semantics.\r\n> \r\n> Second, a user who has opted into using a prerelease version has clearly indicated the intent to use that specific set of alpha/beta/rc versions. By including a prerelease tag in the range, the user is indicating that they are aware of the risk. However, it is still not appropriate to assume that they have opted into taking a similar risk on the next set of prerelease versions.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1115761347/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
