{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13086",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13086/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13086/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13086/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13086",
  "id": 1256105972,
  "node_id": "I_kwDOAm_5kc5K3qf0",
  "number": 13086,
  "title": "Include all emitted events in the contract ABI and userdoc in a non-breaking way by ignoring conflicting Natspec",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1017612679,
      "node_id": "MDU6TGFiZWwxMDE3NjEyNjc5",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/protocol%20design%20:crystal_ball:",
      "name": "protocol design :crystal_ball:",
      "color": "8af77e",
      "default": false,
      "description": "Potential changes to ABI, meta data, standard JSON"
    },
    {
      "id": 4372329032,
      "node_id": "LA_kwDOAm_5kc8AAAABBJxySA",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/roadmap",
      "name": "roadmap",
      "color": "ff8e00",
      "default": false,
      "description": "It's on our short-term roadmap"
    },
    {
      "id": 4438003076,
      "node_id": "LA_kwDOAm_5kc8AAAABCIaNhA",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/medium%20effort",
      "name": "medium effort",
      "color": "ff7df7",
      "default": false,
      "description": "Default level of effort"
    },
    {
      "id": 4438155599,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjhTw",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/medium%20impact",
      "name": "medium impact",
      "color": "314aff",
      "default": false,
      "description": "Default level of impact"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "wechman",
    "id": 37188783,
    "node_id": "MDQ6VXNlcjM3MTg4Nzgz",
    "avatar_url": "https://avatars.githubusercontent.com/u/37188783?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wechman",
    "html_url": "https://github.com/wechman",
    "followers_url": "https://api.github.com/users/wechman/followers",
    "following_url": "https://api.github.com/users/wechman/following{/other_user}",
    "gists_url": "https://api.github.com/users/wechman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wechman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wechman/subscriptions",
    "organizations_url": "https://api.github.com/users/wechman/orgs",
    "repos_url": "https://api.github.com/users/wechman/repos",
    "events_url": "https://api.github.com/users/wechman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wechman/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "wechman",
      "id": 37188783,
      "node_id": "MDQ6VXNlcjM3MTg4Nzgz",
      "avatar_url": "https://avatars.githubusercontent.com/u/37188783?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wechman",
      "html_url": "https://github.com/wechman",
      "followers_url": "https://api.github.com/users/wechman/followers",
      "following_url": "https://api.github.com/users/wechman/following{/other_user}",
      "gists_url": "https://api.github.com/users/wechman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wechman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wechman/subscriptions",
      "organizations_url": "https://api.github.com/users/wechman/orgs",
      "repos_url": "https://api.github.com/users/wechman/repos",
      "events_url": "https://api.github.com/users/wechman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wechman/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-06-01T14:10:13Z",
  "updated_at": "2022-09-12T14:23:11Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Abstract\r\nCurrently the contract ABI lists only events defined in the contract and inherited from other contracts. It does not list events defined in libraries that the contract emits and (after #12921) also events defined in other contracts.\r\n\r\nJust like we do with errors, the ABI should list both defined and emitted events.\r\n\r\n## Motivation\r\nA contract can emit events defined in a variety of places:\r\n\r\n```solidity\r\nlibrary   L { /** A library event */             event EL(uint8); }\r\ninterface I { /** An interface event */          event EI(uint16); }\r\ncontract  C { /** A foreign contract event */    event EC(uint24); }\r\ncontract  D { /** An inherited contract event */ event ED(uint32); }\r\n\r\ncontract E is D {\r\n    /// Own event\r\n    event EE(uint40);\r\n\r\n    function foo() public {\r\n        emit L.EL(1);\r\n        emit I.EI(2);\r\n        emit C.EC(3);\r\n        emit ED(4);\r\n        emit EE(5);\r\n    }\r\n}\r\n```\r\nNot all of them get listed in the ABI:\r\n```json\r\n[\r\n    {\r\n        \"anonymous\": false,\r\n        \"inputs\":\r\n        [{\"indexed\": false, \"internalType\": \"uint32\", \"name\": \"\", \"type\": \"uint32\"}],\r\n        \"name\": \"ED\",\r\n        \"type\": \"event\"\r\n    },\r\n    {\r\n        \"anonymous\": false,\r\n        \"inputs\":\r\n        [{\"indexed\": false, \"internalType\": \"uint40\", \"name\": \"\", \"type\": \"uint40\"}],\r\n        \"name\": \"EE\",\r\n        \"type\": \"event\"\r\n    },\r\n    {\r\n        \"inputs\": [],\r\n        \"name\": \"foo\",\r\n        \"outputs\": [],\r\n        \"stateMutability\": \"nonpayable\",\r\n        \"type\": \"function\"\r\n    }\r\n]\r\n```\r\n\r\nThis poses a problem for tools like Truffle, which use the ABI to determine which events the contract might emit.\r\n\r\nThe `solc --userdoc` output compiled from the Natspec docstrings also only lists this subset of events:\r\n```json\r\n{\r\n    \"events\":\r\n    {\r\n        \"ED(uint32)\": {\"notice\": \"An inherited contract event \"},\r\n        \"EE(uint40)\": {\"notice\": \"Own event\"}\r\n    },\r\n    \"kind\": \"user\",\r\n    \"methods\": {},\r\n    \"version\": 1\r\n}\r\n```\r\n\r\n## Specification\r\nThe only real problem here is the userdoc. The current structure only allows one set of docs for each signature. We are planning to change the structure in Natspec v2 (#11114) bit this will be a breaking change.\r\n\r\nSince not including these events in the ABI is so problematic for tools, we have decided to simply ignore the Natspec problem - for now in case of conflicting signatures we'll include the Natspec docstring only if there is one in the current contract (defined directly in it or inherited). Otherwise we'll ignore the docstring. This is not the correct way to handle this but we expect the impact of this problem to be very low and the problem will disappear once we release Natspec v2 anyway.\r\n\r\n## Backwards Compatibility\r\nUnlike #11114, this is fully backwards compatible in terms of ABI and userdoc structure. It does change the meaning of event list included there but not in a way that should pose problems to tools.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13086/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13086/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1143749058",
    "html_url": "https://github.com/ethereum/solidity/issues/13086#issuecomment-1143749058",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13086",
    "id": 1143749058,
    "node_id": "IC_kwDOAm_5kc5ELDnC",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-01T15:21:31Z",
    "updated_at": "2022-06-01T15:21:31Z",
    "author_association": "MEMBER",
    "body": "One more thing that we discussed on the call today is that this conflict that results in one of the events being ignored should trigger a warning. This was with the assumption that the conflict happens both for ABI and for Natspec. Given that the ABI is fine after all, I think the warning is not necessary.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1143749058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1143763947",
    "html_url": "https://github.com/ethereum/solidity/issues/13086#issuecomment-1143763947",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13086",
    "id": 1143763947,
    "node_id": "IC_kwDOAm_5kc5ELHPr",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-01T15:33:56Z",
    "updated_at": "2022-06-01T15:33:56Z",
    "author_association": "MEMBER",
    "body": "Also, a note to anyone who will be implementing this: we already have a PR for this (#10996) and it's mostly done. It will just need to be split into the part that can go into `develop` without compatibility issues and one that must go to `breaking`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1143763947/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1155003334",
    "html_url": "https://github.com/ethereum/solidity/issues/13086#issuecomment-1155003334",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13086",
    "id": 1155003334,
    "node_id": "IC_kwDOAm_5kc5E1_PG",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-14T10:27:37Z",
    "updated_at": "2022-06-14T10:27:37Z",
    "author_association": "MEMBER",
    "body": "We decided to postpone the change I mentioned above until 0.8.16. For 0.8.15 we'll instead revert the problematic part of #12921. Here's my PR that does this: #13135.\r\n\r\nFor 0.8.16 we should revert the first commit from that PR.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1155003334/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
