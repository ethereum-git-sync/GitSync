{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13125",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13125/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13125/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13125/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13125",
  "id": 1268385617,
  "node_id": "I_kwDOAm_5kc5LmgdR",
  "number": 13125,
  "title": "Add `array.popAndGet()` that returns the last value in array after `pop()`",
  "user": {
    "login": "lukehutch",
    "id": 811305,
    "node_id": "MDQ6VXNlcjgxMTMwNQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/811305?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lukehutch",
    "html_url": "https://github.com/lukehutch",
    "followers_url": "https://api.github.com/users/lukehutch/followers",
    "following_url": "https://api.github.com/users/lukehutch/following{/other_user}",
    "gists_url": "https://api.github.com/users/lukehutch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lukehutch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lukehutch/subscriptions",
    "organizations_url": "https://api.github.com/users/lukehutch/orgs",
    "repos_url": "https://api.github.com/users/lukehutch/repos",
    "events_url": "https://api.github.com/users/lukehutch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lukehutch/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    },
    {
      "id": 4438006499,
      "node_id": "LA_kwDOAm_5kc8AAAABCIaa4w",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20effort",
      "name": "low effort",
      "color": "ffb1fa",
      "default": false,
      "description": "There is not much implementation work to be done. The task is very easy or tiny."
    },
    {
      "id": 4438157609,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjpKQ",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20impact",
      "name": "low impact",
      "color": "5d71ff",
      "default": false,
      "description": "Changes are not very noticeable or potential benefits are limited."
    },
    {
      "id": 4525128519,
      "node_id": "LA_kwDOAm_5kc8AAAABDbf7Rw",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/needs%20design",
      "name": "needs design",
      "color": "18F737",
      "default": false,
      "description": "The proposal is too vague to be implemented right away"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2022-06-11T22:23:45Z",
  "updated_at": "2022-09-26T21:47:03Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Abstract\r\n\r\nCurrently `array.pop()` does not return a value. It should return a memory copy of the last element of the storage array that was popped.\r\n\r\n## Motivation\r\n\r\nCurrently if you want to remove the last element of a storage array, you have to do the following:\r\n\r\n```\r\nItem memory lastItem = array[array.length - 1];\r\narray.pop();\r\n```\r\n\r\nIt would be nice to be able to do simply\r\n\r\n```\r\nItem memory lastItem = array.pop();\r\n```\r\n\r\n## Specification\r\n\r\n`pop()` should return a memory copy of the last element of an array, after removing it from the array, as shown above.\r\n\r\n## Backwards Compatibility\r\n\r\nThe proposal would be fully backwards compatible because currently, there is no return value from `pop()` (so adding a return value cannot break code).\r\n\r\nThe only tricky thing that would need to be taken care of in the compiler is to eliminate the memory copy if the popped item is discarded, e.g. in the case of:\r\n\r\n```\r\narray.pop();\r\n```\r\n\r\nN.B. it would also be nice to have a `peek()` operation that would return the last item in the array, without popping it:\r\n\r\n```\r\nItem memory lastItem = array.peek();    // Same as: = array[array.length - 1];\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13125/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13125/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1153320457",
    "html_url": "https://github.com/ethereum/solidity/issues/13125#issuecomment-1153320457",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13125",
    "id": 1153320457,
    "node_id": "IC_kwDOAm_5kc5EvkYJ",
    "user": {
      "login": "cryptonomicon46",
      "id": 94910274,
      "node_id": "U_kgDOBag3Qg",
      "avatar_url": "https://avatars.githubusercontent.com/u/94910274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cryptonomicon46",
      "html_url": "https://github.com/cryptonomicon46",
      "followers_url": "https://api.github.com/users/cryptonomicon46/followers",
      "following_url": "https://api.github.com/users/cryptonomicon46/following{/other_user}",
      "gists_url": "https://api.github.com/users/cryptonomicon46/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cryptonomicon46/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cryptonomicon46/subscriptions",
      "organizations_url": "https://api.github.com/users/cryptonomicon46/orgs",
      "repos_url": "https://api.github.com/users/cryptonomicon46/repos",
      "events_url": "https://api.github.com/users/cryptonomicon46/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cryptonomicon46/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-12T23:21:20Z",
    "updated_at": "2022-06-12T23:21:20Z",
    "author_association": "NONE",
    "body": " This seems like a useful thing to have. +1",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1153320457/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1157608510",
    "html_url": "https://github.com/ethereum/solidity/issues/13125#issuecomment-1157608510",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13125",
    "id": 1157608510,
    "node_id": "IC_kwDOAm_5kc5E_7Q-",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T12:34:07Z",
    "updated_at": "2022-06-16T12:34:07Z",
    "author_association": "MEMBER",
    "body": "The main problem here, is that the optimizer will have a hard time to remove the read from storage that would result from this (which at least won't be necessary if the array is not packed otherwise), as well as the memory allocation, in case it is not used.\r\n\r\nSo just implementing this naively right now, would probably result in all ``.pop()``s to become significantly more expensive, even without the return value being used.\r\n\r\nThere would be two ways to go about this:\r\n- Have a special code generation path for the case in which the return value is not used (i.e. for ``array.pop();`` only as a statement). However, this is more tricky than it sounds due to corner cases like ``(array.pop());``, etc., and there is little precedent for severe special case handling like this.\r\n- Consider better memory optimization a dependency for this (e.g. https://github.com/ethereum/solidity/issues/12351 or https://github.com/ethereum/solidity/issues/5107).\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1157608510/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1158067590",
    "html_url": "https://github.com/ethereum/solidity/issues/13125#issuecomment-1158067590",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13125",
    "id": 1158067590,
    "node_id": "IC_kwDOAm_5kc5FBrWG",
    "user": {
      "login": "lukehutch",
      "id": 811305,
      "node_id": "MDQ6VXNlcjgxMTMwNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/811305?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lukehutch",
      "html_url": "https://github.com/lukehutch",
      "followers_url": "https://api.github.com/users/lukehutch/followers",
      "following_url": "https://api.github.com/users/lukehutch/following{/other_user}",
      "gists_url": "https://api.github.com/users/lukehutch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lukehutch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lukehutch/subscriptions",
      "organizations_url": "https://api.github.com/users/lukehutch/orgs",
      "repos_url": "https://api.github.com/users/lukehutch/repos",
      "events_url": "https://api.github.com/users/lukehutch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lukehutch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T19:44:36Z",
    "updated_at": "2022-06-16T19:44:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "Optimizing the generated code in this case, and many optimizations like it, could be implemented if Solidity had a dataflow analyzer. Even if very basic dataflow is only implemented within functions (and not across function call boundaries, which is much more complicated), you could do a lot of useful things like check whether the return value of a `pure` or `view` function is not used, and either issue a warning (probably better), or optimize out the call entirely.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1158067590/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1158108747",
    "html_url": "https://github.com/ethereum/solidity/issues/13125#issuecomment-1158108747",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13125",
    "id": 1158108747,
    "node_id": "IC_kwDOAm_5kc5FB1ZL",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T20:39:02Z",
    "updated_at": "2022-06-16T20:39:02Z",
    "author_association": "MEMBER",
    "body": "The current concept of the compiler is to *not* optimize on the Solidity level at all, but have a very simple and foolproof translation to Yul, and then optimize on the Yul representation (for which we have data flow analysis, which is much simpler on Yul, since the language is much more restricted). That's a good strategy most of the time - however, since Yul looses a lot of the type structure and lifetime information, it also makes things trickier, especially for memory optimizations. That's what the issues I linked are about - either transfer sufficiently much information from a Solidity-based analysis to Yul, or to add more structure to Yul to make such optimizations possible on the Yul level. So long story short: this is on the agenda; there are multiple ways to go about it; it may take a while - but eventually we'll have it and then we can be more relaxed about changing the language in ways that currently may still be wasteful lacking such optimizations.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1158108747/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1158126604",
    "html_url": "https://github.com/ethereum/solidity/issues/13125#issuecomment-1158126604",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13125",
    "id": 1158126604,
    "node_id": "IC_kwDOAm_5kc5FB5wM",
    "user": {
      "login": "lukehutch",
      "id": 811305,
      "node_id": "MDQ6VXNlcjgxMTMwNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/811305?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lukehutch",
      "html_url": "https://github.com/lukehutch",
      "followers_url": "https://api.github.com/users/lukehutch/followers",
      "following_url": "https://api.github.com/users/lukehutch/following{/other_user}",
      "gists_url": "https://api.github.com/users/lukehutch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lukehutch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lukehutch/subscriptions",
      "organizations_url": "https://api.github.com/users/lukehutch/orgs",
      "repos_url": "https://api.github.com/users/lukehutch/repos",
      "events_url": "https://api.github.com/users/lukehutch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lukehutch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T21:00:42Z",
    "updated_at": "2022-06-16T21:00:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Got it, thanks for the explanation.\r\n\r\nMeanwhile, adding a `peek()` function would be an awesome task for a first-time contributor (I don't have the bandwidth right now, unfortunately).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1158126604/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1166332741",
    "html_url": "https://github.com/ethereum/solidity/issues/13125#issuecomment-1166332741",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13125",
    "id": 1166332741,
    "node_id": "IC_kwDOAm_5kc5FhNNF",
    "user": {
      "login": "lukehutch",
      "id": 811305,
      "node_id": "MDQ6VXNlcjgxMTMwNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/811305?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lukehutch",
      "html_url": "https://github.com/lukehutch",
      "followers_url": "https://api.github.com/users/lukehutch/followers",
      "following_url": "https://api.github.com/users/lukehutch/following{/other_user}",
      "gists_url": "https://api.github.com/users/lukehutch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lukehutch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lukehutch/subscriptions",
      "organizations_url": "https://api.github.com/users/lukehutch/orgs",
      "repos_url": "https://api.github.com/users/lukehutch/repos",
      "events_url": "https://api.github.com/users/lukehutch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lukehutch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-25T17:45:00Z",
    "updated_at": "2022-06-25T17:45:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ekpyron OK, how about adding a `.popAndGet()` method that always makes and returns a copy, and leaving `.pop()` as-is?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1166332741/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1173144903",
    "html_url": "https://github.com/ethereum/solidity/issues/13125#issuecomment-1173144903",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13125",
    "id": 1173144903,
    "node_id": "IC_kwDOAm_5kc5F7MVH",
    "user": {
      "login": "dev-tom-0108",
      "id": 29230603,
      "node_id": "MDQ6VXNlcjI5MjMwNjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/29230603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dev-tom-0108",
      "html_url": "https://github.com/dev-tom-0108",
      "followers_url": "https://api.github.com/users/dev-tom-0108/followers",
      "following_url": "https://api.github.com/users/dev-tom-0108/following{/other_user}",
      "gists_url": "https://api.github.com/users/dev-tom-0108/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dev-tom-0108/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dev-tom-0108/subscriptions",
      "organizations_url": "https://api.github.com/users/dev-tom-0108/orgs",
      "repos_url": "https://api.github.com/users/dev-tom-0108/repos",
      "events_url": "https://api.github.com/users/dev-tom-0108/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dev-tom-0108/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-03T17:59:01Z",
    "updated_at": "2022-07-03T17:59:01Z",
    "author_association": "NONE",
    "body": "I think both are very useful for programming.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1173144903/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
