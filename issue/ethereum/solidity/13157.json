{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13157",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13157/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13157/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13157/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13157",
  "id": 1272681549,
  "node_id": "I_kwDOAm_5kc5L25RN",
  "number": 13157,
  "title": "Better Debugging Data (in particular for via-IR codegen)",
  "user": {
    "login": "ekpyron",
    "id": 1347491,
    "node_id": "MDQ6VXNlcjEzNDc0OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ekpyron",
    "html_url": "https://github.com/ekpyron",
    "followers_url": "https://api.github.com/users/ekpyron/followers",
    "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
    "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
    "organizations_url": "https://api.github.com/users/ekpyron/orgs",
    "repos_url": "https://api.github.com/users/ekpyron/repos",
    "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ekpyron/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1017612679,
      "node_id": "MDU6TGFiZWwxMDE3NjEyNjc5",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/protocol%20design%20:crystal_ball:",
      "name": "protocol design :crystal_ball:",
      "color": "8af77e",
      "default": false,
      "description": "Potential changes to ABI, meta data, standard JSON"
    },
    {
      "id": 4437999539,
      "node_id": "LA_kwDOAm_5kc8AAAABCIZ_sw",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/high%20effort",
      "name": "high effort",
      "color": "ff54f4",
      "default": false,
      "description": "A lot to implement but still doable by a single person. The task is large or difficult."
    },
    {
      "id": 4438153180,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjX3A",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/high%20impact",
      "name": "high impact",
      "color": "001dff",
      "default": false,
      "description": "Changes are very prominent and affect users or the project in a major way."
    },
    {
      "id": 4438488423,
      "node_id": "LA_kwDOAm_5kc8AAAABCI31Zw",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/must%20have",
      "name": "must have",
      "color": "ffa12a",
      "default": false,
      "description": "Something we consider an essential part of Solidity 1.0."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-06-15T20:04:56Z",
  "updated_at": "2022-09-26T21:42:20Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "We probably already have issues regarding this, but I'm creating a new one after our recent tooling call, since we're hoping to continue the discussion.\r\n\r\nRequests for helpful modifications to the compiler I noted down:\r\n- Easy way to set up the compiler to perform no optimizations other than stack-to-memory.\r\n  - Related idea was to generate code for a ficticious EVM version with unlimited stack access (resp. codegen for https://eips.ethereum.org/EIPS/eip-663)\r\n  - Problematic: stack-to-memory is via-IR-only at the moment.\r\n-  Stack Variable Maps\r\n   - Probably sufficient to emit stack layout on each assignment, the rest can be tracked.\r\n   - Could also emit a map at the same granularity as source maps.\r\n   - The compiler has readily available information about the locations of Yul variables.\r\n      - We can try and resolve them to Solidity variables ourselves.\r\n      - Or have tooling first refer to Yul and resolve from the source location comments in Yul further to Solidity\r\n- Extended Source Maps\r\n   - Multi-source-maps for deduplicated bytecode. Need to specify a format. Could have an index into the continuing source map at each jump. Might get tricky on collapsing already collapsed code further.\r\n   - Control Flow Boundaries / Basic Block Boundaries\r\n      - Again easily available in the compiler referring to Yul;\r\n      - We could again resolve further to Solidity in the compiler or leave that to tooling\r\n\r\nGeneral question for the future of via-IR debugging:\r\nShould debugging data and future source maps relate EVM bytecode directly to Solidity code or first to Yul code only (or both?)? Yul to Solidity should be possible via the source location comments in the Yul code.\r\n\r\nGeneral issue:\r\nWe need to ensure high quality of source maps; it may help to actually emit the utility yul code; might not be an actual issue in the most recent compilers.\r\n\r\nGeneral plan:\r\nKeep the discussion alive; reach out to more participants; meet again; ideally have tooling prepare some draft for the best format for the information above, or have solc emit a prototype version.\r\n\r\nPrevious iteration on this by @alcuadrado: https://nomiclabs.notion.site/Solidity-debugging-symbols-Initial-proposal-b70fedc2c7914498bd7ed8e27db63883\r\nRelated issues (non exhaustive): https://github.com/ethereum/solidity/issues/9332",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13157/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13157/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1156984019",
    "html_url": "https://github.com/ethereum/solidity/issues/13157#issuecomment-1156984019",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13157",
    "id": 1156984019,
    "node_id": "IC_kwDOAm_5kc5E9izT",
    "user": {
      "login": "cd1m0",
      "id": 45853363,
      "node_id": "MDQ6VXNlcjQ1ODUzMzYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/45853363?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cd1m0",
      "html_url": "https://github.com/cd1m0",
      "followers_url": "https://api.github.com/users/cd1m0/followers",
      "following_url": "https://api.github.com/users/cd1m0/following{/other_user}",
      "gists_url": "https://api.github.com/users/cd1m0/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cd1m0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cd1m0/subscriptions",
      "organizations_url": "https://api.github.com/users/cd1m0/orgs",
      "repos_url": "https://api.github.com/users/cd1m0/repos",
      "events_url": "https://api.github.com/users/cd1m0/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cd1m0/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-15T21:54:58Z",
    "updated_at": "2022-06-15T21:54:58Z",
    "author_association": "NONE",
    "body": "One question about the Multi-source-maps proposal. Is it guaranteed that at every jump the index of the called deduplicated function can be determined at compile time?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1156984019/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1157125378",
    "html_url": "https://github.com/ethereum/solidity/issues/13157#issuecomment-1157125378",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13157",
    "id": 1157125378,
    "node_id": "IC_kwDOAm_5kc5E-FUC",
    "user": {
      "login": "cd1m0",
      "id": 45853363,
      "node_id": "MDQ6VXNlcjQ1ODUzMzYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/45853363?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cd1m0",
      "html_url": "https://github.com/cd1m0",
      "followers_url": "https://api.github.com/users/cd1m0/followers",
      "following_url": "https://api.github.com/users/cd1m0/following{/other_user}",
      "gists_url": "https://api.github.com/users/cd1m0/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cd1m0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cd1m0/subscriptions",
      "organizations_url": "https://api.github.com/users/cd1m0/orgs",
      "repos_url": "https://api.github.com/users/cd1m0/repos",
      "events_url": "https://api.github.com/users/cd1m0/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cd1m0/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T01:09:43Z",
    "updated_at": "2022-06-16T01:09:43Z",
    "author_association": "NONE",
    "body": "Also to add to this, there was the concern of not being able to use the source map to figure out the number of instructions. This is used to decode the bytecode. This in itself is a little hacky, as it assumes that the solidity compiler never mixes code and data (i.e. all data is at the end). So perhaps it would be useful if the compiler emitted enough metadata to enable determining what is code and what is data in the bytecode? This way making decoding easy, and untying your guy's hands to mix code and data if you wish in the future?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1157125378/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1157509672",
    "html_url": "https://github.com/ethereum/solidity/issues/13157#issuecomment-1157509672",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13157",
    "id": 1157509672,
    "node_id": "IC_kwDOAm_5kc5E_jIo",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T10:39:51Z",
    "updated_at": "2022-06-16T10:39:51Z",
    "author_association": "MEMBER",
    "body": "> Also to add to this, there was the concern of not being able to use the source map to figure out the number of instructions. This is used to decode the bytecode. This in itself is a little hacky, as it assumes that the solidity compiler never mixes code and data (i.e. all data is at the end). So perhaps it would be useful if the compiler emitted enough metadata to enable determining what is code and what is data in the bytecode? This way making decoding easy, and untying your guy's hands to mix code and data if you wish in the future?\r\n\r\nhttps://github.com/ethereum/solidity/issues/9332 was meant to address that, I'm not entirely sure what stalled it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1157509672/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1157518635",
    "html_url": "https://github.com/ethereum/solidity/issues/13157#issuecomment-1157518635",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13157",
    "id": 1157518635,
    "node_id": "IC_kwDOAm_5kc5E_lUr",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T10:50:25Z",
    "updated_at": "2022-06-16T10:50:25Z",
    "author_association": "MEMBER",
    "body": "> One question about the Multi-source-maps proposal. Is it guaranteed that at every jump the index of the called deduplicated function can be determined at compile time?\r\n\r\nIt'll take some consideration how such source maps would actually have to look like.\r\nIt may be better and more-future proof not to annotate the jumps with an index into source maps, but the pushes of the jump targets. In legacy code generation, currently, most of the time the disambiguation at jumps should work, but it won't for internal function dispatch. That could be solved by annotating the pushed jump target labels instead.\r\nIn via-IR code generation, it should currently be possible to disambiguate everything at the jump itself, but we may want to implement jump tables at some point, then it would get rather tricky (we have a draft PR for that in https://github.com/ethereum/solidity/pull/12978 - even though doing that may complicate analysis and debugging in general). Such jump tables would further complicate things significantly: we may end up with several jump targets packed into a single slot and then use shifts and masks on that before actually jumping... so a universal and future-proof solution for this may indeed be non-trivial to come up with.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1157518635/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
