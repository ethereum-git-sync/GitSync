{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13492",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13492/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13492/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13492/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13492",
  "id": 1363654774,
  "node_id": "I_kwDOAm_5kc5RR7h2",
  "number": 13492,
  "title": "Stylecheck script fails on MacOS",
  "user": {
    "login": "reubenr0d",
    "id": 63185771,
    "node_id": "MDQ6VXNlcjYzMTg1Nzcx",
    "avatar_url": "https://avatars.githubusercontent.com/u/63185771?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/reubenr0d",
    "html_url": "https://github.com/reubenr0d",
    "followers_url": "https://api.github.com/users/reubenr0d/followers",
    "following_url": "https://api.github.com/users/reubenr0d/following{/other_user}",
    "gists_url": "https://api.github.com/users/reubenr0d/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/reubenr0d/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/reubenr0d/subscriptions",
    "organizations_url": "https://api.github.com/users/reubenr0d/orgs",
    "repos_url": "https://api.github.com/users/reubenr0d/repos",
    "events_url": "https://api.github.com/users/reubenr0d/events{/privacy}",
    "received_events_url": "https://api.github.com/users/reubenr0d/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 717596767,
      "node_id": "MDU6TGFiZWw3MTc1OTY3Njc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "006b75",
      "default": true,
      "description": ""
    },
    {
      "id": 1018738457,
      "node_id": "MDU6TGFiZWwxMDE4NzM4NDU3",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/testing%20:hammer:",
      "name": "testing :hammer:",
      "color": "ffc6db",
      "default": false,
      "description": ""
    },
    {
      "id": 4438006499,
      "node_id": "LA_kwDOAm_5kc8AAAABCIaa4w",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20effort",
      "name": "low effort",
      "color": "ffb1fa",
      "default": false,
      "description": "There is not much implementation work to be done. The task is very easy or tiny."
    },
    {
      "id": 4438157609,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjpKQ",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20impact",
      "name": "low impact",
      "color": "5d71ff",
      "default": false,
      "description": "Changes are not very noticeable or potential benefits are limited."
    },
    {
      "id": 4438492402,
      "node_id": "LA_kwDOAm_5kc8AAAABCI4E8g",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/nice%20to%20have",
      "name": "nice to have",
      "color": "ffdeb3",
      "default": false,
      "description": "We don’t see a good reason not to have it but won’t go out of our way to implement it."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-09-06T18:20:08Z",
  "updated_at": "2022-09-07T12:17:15Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "`scripts/check_style.sh` does not work on MacOS:\r\n```\r\n$ scripts/check_style.sh \r\ngrep: repetition-operator operand invalid\r\n\r\n$ sysctl kern.version\r\nkern.version: Darwin Kernel Version 21.2.0: Sun Nov 28 20:28:41 PST 2021; root:xnu-8019.61.5~1/RELEASE_ARM64_T6000\r\n$ grep -V\r\ngrep (BSD grep, GNU compatible) 2.6.0-FreeBSD\r\n```\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13492/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13492/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239126271",
    "html_url": "https://github.com/ethereum/solidity/issues/13492#issuecomment-1239126271",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13492",
    "id": 1239126271,
    "node_id": "IC_kwDOAm_5kc5J25D_",
    "user": {
      "login": "nikola-matic",
      "id": 4415530,
      "node_id": "MDQ6VXNlcjQ0MTU1MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4415530?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikola-matic",
      "html_url": "https://github.com/nikola-matic",
      "followers_url": "https://api.github.com/users/nikola-matic/followers",
      "following_url": "https://api.github.com/users/nikola-matic/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikola-matic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikola-matic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikola-matic/subscriptions",
      "organizations_url": "https://api.github.com/users/nikola-matic/orgs",
      "repos_url": "https://api.github.com/users/nikola-matic/repos",
      "events_url": "https://api.github.com/users/nikola-matic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikola-matic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T09:14:20Z",
    "updated_at": "2022-09-07T09:14:20Z",
    "author_association": "MEMBER",
    "body": "Eh, so it looks like this has been broken on OSX for a long time now; OSX uses FreeBSD grep, whereas Linux used GNU grep, and even though they claim `GNU compatible`, it's really not.\r\n\r\nThe easiest solution would be to require a `brew install grep` prerequisite on Macs, which will install GNU grep, but under the `ggrep` command, and then altering the `check_style.sh` script to check whether it's on Darwin, and use `ggrep` instead of `grep`.\r\n\r\nOr, we can simply let it sit broken until we move to `clang-format` which ought to make the `grep`-ing approach redundant, but that's not likely to happen any time soon.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239126271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239310910",
    "html_url": "https://github.com/ethereum/solidity/issues/13492#issuecomment-1239310910",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13492",
    "id": 1239310910,
    "node_id": "IC_kwDOAm_5kc5J3mI-",
    "user": {
      "login": "reubenr0d",
      "id": 63185771,
      "node_id": "MDQ6VXNlcjYzMTg1Nzcx",
      "avatar_url": "https://avatars.githubusercontent.com/u/63185771?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/reubenr0d",
      "html_url": "https://github.com/reubenr0d",
      "followers_url": "https://api.github.com/users/reubenr0d/followers",
      "following_url": "https://api.github.com/users/reubenr0d/following{/other_user}",
      "gists_url": "https://api.github.com/users/reubenr0d/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/reubenr0d/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/reubenr0d/subscriptions",
      "organizations_url": "https://api.github.com/users/reubenr0d/orgs",
      "repos_url": "https://api.github.com/users/reubenr0d/repos",
      "events_url": "https://api.github.com/users/reubenr0d/events{/privacy}",
      "received_events_url": "https://api.github.com/users/reubenr0d/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T12:14:49Z",
    "updated_at": "2022-09-07T12:17:15Z",
    "author_association": "NONE",
    "body": "I have something that I think works, but still need to test it:\r\n```diff\r\ndiff --git a/scripts/check_style.sh b/scripts/check_style.sh\r\nindex d1ad6bb9e..dbfbecd85 100755\r\n--- a/scripts/check_style.sh\r\n+++ b/scripts/check_style.sh\r\n@@ -4,6 +4,12 @@ set -eu\r\n \r\n ERROR_LOG=\"$(mktemp -t check_style_XXXXXX.log)\"\r\n \r\n+if [ \"$(uname)\" == \"Darwin\" ]; then\r\n+    grepCommand=ggrep\r\n+else\r\n+    grepCommand=grep\r\n+fi\r\n+\r\n EXCLUDE_FILES=(\r\n     \"libsolutil/picosha2.h\"\r\n     \"test/cmdlineTests/strict_asm_only_cr/input.yul\"\r\n@@ -24,7 +30,7 @@ REPO_ROOT=\"$(dirname \"$0\")\"/..\r\n cd \"$REPO_ROOT\" || exit 1\r\n \r\n WHITESPACE=$(git grep -n -I -E \"^.*[[:space:]]+$\" |\r\n-    grep -v \"test/libsolidity/ASTJSON\\|test/libsolidity/ASTRecoveryTests\\|test/compilationTests/zeppelin/LICENSE\\|${EXCLUDE_FILES_JOINED}\" || true\r\n+    ${grepCommand} -v \"test/libsolidity/ASTJSON\\|test/libsolidity/ASTRecoveryTests\\|test/compilationTests/zeppelin/LICENSE\\|${EXCLUDE_FILES_JOINED}\" || true\r\n )\r\n \r\n if [[ \"$WHITESPACE\" != \"\" ]]\r\n@@ -37,13 +43,13 @@ fi\r\n \r\n function preparedGrep\r\n {\r\n-    git grep -nIE \"$1\" -- '*.h' '*.cpp' | grep -v \"${EXCLUDE_FILES_JOINED}\"\r\n+    git grep -nIE \"$1\" -- '*.h' '*.cpp' | ${grepCommand} -v \"${EXCLUDE_FILES_JOINED}\"\r\n     return $?\r\n }\r\n \r\n FORMATERROR=$(\r\n (\r\n-    preparedGrep \"#include \\\"\" | grep -E -v -e \"license.h\" -e \"BuildInfo.h\"  # Use include with <> characters\r\n+    preparedGrep \"#include \\\"\" | ${grepCommand} -E -v -e \"license.h\" -e \"BuildInfo.h\"  # Use include with <> characters\r\n     preparedGrep \"\\<(if|for|while|switch)\\(\" # no space after \"if\", \"for\", \"while\" or \"switch\"\r\n     preparedGrep \"\\<for\\>\\s*\\([^=]*\\>\\s:\\s.*\\)\" # no space before range based for-loop\r\n     preparedGrep \"\\<if\\>\\s*\\(.*\\)\\s*\\{\\s*$\" # \"{\\n\" on same line as \"if\"\r\n@@ -51,12 +57,12 @@ FORMATERROR=$(\r\n     preparedGrep \"[,\\(<]\\s*const \" # const on left side of type\r\n     preparedGrep \"^\\s*(static)?\\s*const \" # const on left side of type (beginning of line)\r\n     preparedGrep \"^ [^*]|[^*] \t|\t [^*]\" # uses spaces for indentation or mixes spaces and tabs\r\n-    preparedGrep \"[a-zA-Z0-9_]\\s*[&][a-zA-Z_]\" | grep -E -v \"return [&]\" # right-aligned reference ampersand (needs to exclude return)\r\n+    preparedGrep \"[a-zA-Z0-9_]\\s*[&][a-zA-Z_]\" | ${grepCommand} -E -v \"return [&]\" # right-aligned reference ampersand (needs to exclude return)\r\n     # right-aligned reference pointer star (needs to exclude return and comments)\r\n-    preparedGrep \"[a-zA-Z0-9_]\\s*[*][a-zA-Z_]\" | grep -E -v -e \"return [*]\" -e \"^* [*]\" -e \"^*//.*\"\r\n+    preparedGrep \"[a-zA-Z0-9_]\\s*[*][a-zA-Z_]\" | ${grepCommand} -E -v -e \"return [*]\" -e \"^* [*]\" -e \"^*//.*\"\r\n     # unqualified move check, i.e. make sure that std::move() is used instead of move()\r\n-    preparedGrep \"move\\(.+\\)\" | grep -v \"std::move\" | grep -E \"[^a-z]move\"\r\n-) | grep -E -v -e \"^[a-zA-Z\\./]*:[0-9]*:\\s*\\/(\\/|\\*)\" -e \"^test/\" || true\r\n+    preparedGrep \"move\\(.+\\)\" | ${grepCommand} -v \"std::move\" | ${grepCommand} -E \"[^a-z]move\"\r\n+) | ${grepCommand} -E -v -e \"^[a-zA-Z\\./]*:[0-9]*:\\s*\\/(\\/|\\*)\" -e \"^test/\" || true\r\n )\r\n \r\n if [[ \"$FORMATERROR\" != \"\" ]]\r\n```\r\n\r\nAlthough I get some warnings when I try to run it now, need to check if they're relevant:\r\n```\r\n$scripts/check_style.sh         \r\nggrep: warning: stray \\ before /\r\nggrep: warning: stray \\ before /\r\nggrep: warning: * at start of expression\r\nggrep: warning: * at start of expression\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239310910/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
