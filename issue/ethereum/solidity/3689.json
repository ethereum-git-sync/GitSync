{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/3689",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/3689/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/3689/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/3689/events",
  "html_url": "https://github.com/ethereum/solidity/issues/3689",
  "id": 303510199,
  "node_id": "MDU6SXNzdWUzMDM1MTAxOTk=",
  "number": 3689,
  "title": "Confusing examples of types used for binary operators",
  "user": {
    "login": "limexp",
    "id": 19608867,
    "node_id": "MDQ6VXNlcjE5NjA4ODY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/19608867?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/limexp",
    "html_url": "https://github.com/limexp",
    "followers_url": "https://api.github.com/users/limexp/followers",
    "following_url": "https://api.github.com/users/limexp/following{/other_user}",
    "gists_url": "https://api.github.com/users/limexp/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/limexp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/limexp/subscriptions",
    "organizations_url": "https://api.github.com/users/limexp/orgs",
    "repos_url": "https://api.github.com/users/limexp/repos",
    "events_url": "https://api.github.com/users/limexp/events{/privacy}",
    "received_events_url": "https://api.github.com/users/limexp/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 275027668,
      "node_id": "MDU6TGFiZWwyNzUwMjc2Njg=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/documentation%20:book:",
      "name": "documentation :book:",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-03-08T15:00:19Z",
  "updated_at": "2018-11-16T15:23:37Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "After operations the compiler implicitly performs type conversions which could lead to information lost.\r\n\r\nIf I sum two uint8 variables the result will be implicitly converted to uint8 despite the required result type.\r\n\r\nTake a look at the [following contract](https://rinkeby.etherscan.io/address/0x6034913e5aed454efddcdefc82ed8148e75ba2c3):\r\n\r\n```\r\npragma solidity ^0.4.16;\r\n\r\ncontract lim {\r\n    function add1(uint8 a, uint8 b) public pure returns (uint ret) {\r\n        return a + b;\r\n    }\r\n    \r\n    function add2(uint8 a, uint8 b) public pure returns (uint ret) {\r\n        uint c = a + b;\r\n        return c;\r\n    }\r\n    \r\n    function add3(uint8 a, uint8 b) public pure returns (uint ret) {\r\n        if (300 < a + b) return 1000;\r\n        uint c = 300;\r\n        if (c < a + b) return 2000;\r\n        return a + b;\r\n    }\r\n  \r\n    function exp1(uint8 a, uint8 b) public pure returns (uint ret) {\r\n        return a ** b;\r\n    }\r\n}\r\n```\r\n\r\nTry to execute exp1(10, 3) or addN(200, 200). \r\n\r\nResult will be \"wrong\" since after ADD and EXP instructions there are AND instructions: \"ADD **PUSH1 0xFF AND**\", \"EXP **PUSH1 0xFF AND**\". So the real result is always implicitly converted to narrower type without any warning. \r\n\r\nI think that such conversions are not obvious and could lead to errors. Unfortunately the [documentation](http://solidity.readthedocs.io/en/latest/types.html#implicit-conversions) also could lead to misunderstanding: \"If an operator is applied to different types, the compiler tries to implicitly convert one of the operands to the type of the other (the same is true for assignments). **In general, an implicit conversion between value-types is possible if it makes sense semantically and no information is lost**\".\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/3689/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/3689/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/371562359",
    "html_url": "https://github.com/ethereum/solidity/issues/3689#issuecomment-371562359",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3689",
    "id": 371562359,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MTU2MjM1OQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-08T17:33:57Z",
    "updated_at": "2018-03-08T17:34:12Z",
    "author_association": "MEMBER",
    "body": "The documentation could be more specific by changing it to:\r\n\r\n\r\nIf an operator is applied to different types, the compiler tries to implicitly convert one of the operands to the type of the other (the same is true for assignments). **This means that operations are always performed in the type of one of the operands.** In general, an implicit conversion between value-types is possible if it makes sense semantically and no information is lost\".\r\n\r\nWould that help?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/371562359/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/371562624",
    "html_url": "https://github.com/ethereum/solidity/issues/3689#issuecomment-371562624",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3689",
    "id": 371562624,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MTU2MjYyNA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-08T17:34:44Z",
    "updated_at": "2018-03-08T17:34:44Z",
    "author_association": "MEMBER",
    "body": "Note that the paragraph says \"an implicit conversion is possible\" and not \"is performed\".",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/371562624/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/371601147",
    "html_url": "https://github.com/ethereum/solidity/issues/3689#issuecomment-371601147",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3689",
    "id": 371601147,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MTYwMTE0Nw==",
    "user": {
      "login": "limexp",
      "id": 19608867,
      "node_id": "MDQ6VXNlcjE5NjA4ODY3",
      "avatar_url": "https://avatars.githubusercontent.com/u/19608867?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/limexp",
      "html_url": "https://github.com/limexp",
      "followers_url": "https://api.github.com/users/limexp/followers",
      "following_url": "https://api.github.com/users/limexp/following{/other_user}",
      "gists_url": "https://api.github.com/users/limexp/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/limexp/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/limexp/subscriptions",
      "organizations_url": "https://api.github.com/users/limexp/orgs",
      "repos_url": "https://api.github.com/users/limexp/repos",
      "events_url": "https://api.github.com/users/limexp/events{/privacy}",
      "received_events_url": "https://api.github.com/users/limexp/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-08T19:43:41Z",
    "updated_at": "2018-03-08T19:43:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "As I understand a bottom up approach is used now for types determination. The ideal solution could be the opposite one - taking the result type and convert all the expression to it. \r\n\r\nDocumentation changes could help a little. But I am afraid that most smart contract developers will never notice this compiler behaviour before they run into the problem.\r\n\r\nHere is [another contract](https://rinkeby.etherscan.io/address/0x9c4b763433354add099039c3b9454dac58a6fac5#readContract) example where associative property is broken for addition.\r\n```\r\npragma solidity ^0.4.16;\r\n\r\ncontract lim {\r\n    function add4() public pure returns (uint ret) {\r\n        uint8 a = 100;\r\n        uint8 b = 200;\r\n        uint16 c = 300;\r\n        return a + b + c;\r\n    }\r\n    \r\n    function add5() public pure returns (uint ret) {\r\n        uint8 a = 100;\r\n        uint8 b = 200;\r\n        uint16 c = 300;\r\n        return a + c + b;\r\n    }\r\n    \r\n    function add6() public pure returns (uint ret) {\r\n        uint8 a = 100;\r\n        uint8 b = 200;\r\n        return 300 + a + b;\r\n    }\r\n    \r\n    function add7() public pure returns (uint ret) {\r\n        uint8 a = 100;\r\n        uint8 b = 200;\r\n        return a + b + 300;\r\n    }\r\n    \r\n    function exp2() public pure returns (uint ret) {\r\n        uint8 b = 3;\r\n        return 10 ** b;\r\n  \r\n    }\r\n    \r\n    function exp3() public pure returns (uint ret) {\r\n        uint8 a = 10;\r\n        uint8 b = 3;\r\n        return a ** b;\r\n    }\r\n}\r\n```\r\n\r\nWhile function exp2 and exp3 are similar there is a warning only for the first one:\r\n\r\n> Warning: Result of exponentiation has type uint8 and thus might overflow. Silence this warning by converting the literal to the expected type.      \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/371601147/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/372301928",
    "html_url": "https://github.com/ethereum/solidity/issues/3689#issuecomment-372301928",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3689",
    "id": 372301928,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MjMwMTkyOA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-12T13:03:23Z",
    "updated_at": "2018-03-12T13:03:23Z",
    "author_association": "MEMBER",
    "body": "Indeed, the current approach is that the type of an expression or the resulting type of an operation can be determined by looking at the types of the operands only.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/372301928/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/372302199",
    "html_url": "https://github.com/ethereum/solidity/issues/3689#issuecomment-372302199",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3689",
    "id": 372302199,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MjMwMjE5OQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-12T13:04:21Z",
    "updated_at": "2018-03-12T13:04:21Z",
    "author_association": "MEMBER",
    "body": "In practice, though, I would say that people do not often use arithmetic types that are not 256 bits wide.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/372302199/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
