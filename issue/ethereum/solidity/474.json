{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/474",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/474/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/474/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/474/events",
  "html_url": "https://github.com/ethereum/solidity/issues/474",
  "id": 145822556,
  "node_id": "MDU6SXNzdWUxNDU4MjI1NTY=",
  "number": 474,
  "title": "Adding `memory allocation` helper to inline assembly",
  "user": {
    "login": "axic",
    "id": 20340,
    "node_id": "MDQ6VXNlcjIwMzQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/axic",
    "html_url": "https://github.com/axic",
    "followers_url": "https://api.github.com/users/axic/followers",
    "following_url": "https://api.github.com/users/axic/following{/other_user}",
    "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
    "organizations_url": "https://api.github.com/users/axic/orgs",
    "repos_url": "https://api.github.com/users/axic/repos",
    "events_url": "https://api.github.com/users/axic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/axic/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/ethereum/solidity/milestones/7",
    "html_url": "https://github.com/ethereum/solidity/milestone/7",
    "labels_url": "https://api.github.com/repos/ethereum/solidity/milestones/7/labels",
    "id": 1925410,
    "node_id": "MDk6TWlsZXN0b25lMTkyNTQxMA==",
    "number": 7,
    "title": "99-nice-but-how",
    "description": "This milestone combines issues which are nice to have, but where we are still searching for a solution of how to actually implement them or where it is not clear what the feature actually means.",
    "creator": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 6,
    "closed_issues": 6,
    "state": "closed",
    "created_at": "2016-08-05T13:22:32Z",
    "updated_at": "2020-07-08T17:22:44Z",
    "due_on": null,
    "closed_at": "2018-07-30T10:25:10Z"
  },
  "comments": 4,
  "created_at": "2016-04-04T22:32:30Z",
  "updated_at": "2022-08-17T13:50:56Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Memory can be allocated using the `new` keyword in Solidity, but in the inline assembly part is has to be done by hand.\n\nThe example code in the docs for doing this:\n\n```\nfunction getcode(address _addr) returns (bytes o_code) {\n                assembly {\n                        // retrieve the size of the code, this needs assembly\n                        let size := extcodesize(_addr)\n                        // allocate output byte array - this could also be done without assembly\n                        // by using o_code = new bytes(size)\n                        o_code := mload(0x40)\n                        // new \"memory end\" including padding\n                        mstore(0x40, add(o_code, and(add(add(size, 0x20), 0x1f), bnot(0x1f))))\n                        // store length in memory\n                        mstore(o_code, size)\n                        // actually retrieve the code, this needs assembly\n                        extcodecopy(_addr, add(o_code, 0x20), 0, size)\n                }\n}\n```\n\nI don't want to duplicate such code, so I rather resort to the following code structure (this is based on the sample code):\n\n```\nfunction getcode(address _addr) returns (bytes o_code) {\n            uint size;\n            assembly {\n                size := extcodesize(_addr)\n            }\n\n            o_code = new bytes(size);\n\n            assembly {\n                extcodecopy(_addr, add(o_code, 0x20), 0, size)\n            }\n        }\n}\n```\n\nI think it would make sense having some shortcut for this accessible from assembly. Such as:\n\n```\no_code := $allocate(size)\n```\n\nor\n\n```\no_code := __allocate(size)\n```\n\nThe prefix is to make a distinction between an opcode and the builtin helper.\n\nMaybe it would make sense having macros? :)\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/474/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/474/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/205717599",
    "html_url": "https://github.com/ethereum/solidity/issues/474#issuecomment-205717599",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/474",
    "id": 205717599,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwNTcxNzU5OQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-04-05T08:28:51Z",
    "updated_at": "2016-04-05T08:28:51Z",
    "author_association": "MEMBER",
    "body": "I think that using inline assembly only for single instructions is perfectly fine.\nIf we come up with more examples that cannot be solved that way and also inline functions won't help, we can reconsider adding some kind of macros.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/205717599/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/207845763",
    "html_url": "https://github.com/ethereum/solidity/issues/474#issuecomment-207845763",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/474",
    "id": 207845763,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwNzg0NTc2Mw==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-04-09T20:03:49Z",
    "updated_at": "2016-04-09T20:06:03Z",
    "author_association": "MEMBER",
    "body": "@chriseth a few more useful macros:\n\n`shl = mul(input, exp(2, bits))`\n`shr = div(input, exp(2, bits))`\n`memcpy` / `mcopy` to copy between two memory storage locations\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/207845763/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/237878225",
    "html_url": "https://github.com/ethereum/solidity/issues/474#issuecomment-237878225",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/474",
    "id": 237878225,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIzNzg3ODIyNQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-05T15:16:53Z",
    "updated_at": "2016-08-05T15:17:38Z",
    "author_association": "MEMBER",
    "body": "Related: declare a contract-local memory management routine\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/237878225/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/400136041",
    "html_url": "https://github.com/ethereum/solidity/issues/474#issuecomment-400136041",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/474",
    "id": 400136041,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDEzNjA0MQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-26T00:20:29Z",
    "updated_at": "2018-06-26T00:20:29Z",
    "author_association": "MEMBER",
    "body": "We could also introduce a version which zeroes out memory: `$allocateclear(size)`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/400136041/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
