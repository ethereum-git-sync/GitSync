{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/4947",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/4947/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/4947/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/4947/events",
  "html_url": "https://github.com/ethereum/solidity/issues/4947",
  "id": 359063645,
  "node_id": "MDU6SXNzdWUzNTkwNjM2NDU=",
  "number": 4947,
  "title": "Yul optimizer: think about which statement reorderings make sense",
  "user": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1282209978,
      "node_id": "MDU6TGFiZWwxMjgyMjA5OTc4",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/optimizer",
      "name": "optimizer",
      "color": "d4c5f9",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2018-09-11T14:05:50Z",
  "updated_at": "2019-05-13T16:57:33Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Once we are in SSA/3AC, the fact whether instructions inside a basic block can be reordered can be determined by just looking at the function calls of the instructions themselves.\r\n\r\nIf we keep track of memory and storage writes, we can rematerialize storage reads (and perhaps also memory reads). After that, subsequent storage writes to the same location can be reduced to just a single write.\r\n\r\nExample:\r\n```\r\nsstore(x, and(y, 0xff))\r\nlet z := sload(x)\r\nsstore(x, or(z, and(t, 0xff00)))\r\n```\r\nSSA / 3AC:\r\n```\r\nlet t1 := and(y, 0xff)\r\nsstore(x, t1)\r\nlet z := sload(x)\r\nlet t2 := and(t, 0xff00)\r\nlet t3 := or(z, t2)\r\nsstore(x, t3)\r\n```\r\nrematerialize storage read:\r\n```\r\nlet t1 := and(y, 0xff)\r\nsstore(x, t1)\r\nlet z := t1\r\nlet t2 := and(t, 0xff00)\r\nlet t3 := or(z, t2)\r\nsstore(x, t3)\r\n```\r\nreorder (put all sstore at the end):\r\n```\r\nlet t1 := and(y, 0xff)\r\nlet z := t1\r\nlet t2 := and(t, 0xff00)\r\nlet t3 := or(z, t2)\r\nsstore(x, t1)\r\nsstore(x, t3)\r\n```\r\neliminate redundant sstores:\r\n```\r\nlet t1 := and(y, 0xff)\r\nlet z := t1\r\nlet t2 := and(t, 0xff00)\r\nlet t3 := or(z, t2)\r\nsstore(x, t3)\r\n```\r\nundo SSA (basically just inline all expressions and remove unused variables):\r\n```\r\nsstore(x, or(and(y, 0xff), and(t, 0xff00)))\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/4947/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/4947/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/491903538",
    "html_url": "https://github.com/ethereum/solidity/issues/4947#issuecomment-491903538",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4947",
    "id": 491903538,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTkwMzUzOA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-13T16:57:32Z",
    "updated_at": "2019-05-13T16:57:32Z",
    "author_association": "MEMBER",
    "body": "Here is an extensive list of which operations can be swapped with which: https://github.com/ethereum/solidity/issues/4756#issuecomment-491863937",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/491903538/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
