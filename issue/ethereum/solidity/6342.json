{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/6342",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/6342/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/6342/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/6342/events",
  "html_url": "https://github.com/ethereum/solidity/issues/6342",
  "id": 423768728,
  "node_id": "MDU6SXNzdWU0MjM3Njg3Mjg=",
  "number": 6342,
  "title": "Feature: Output AST recovering from all parsing errors to support all tooling",
  "user": {
    "login": "juanfranblanco",
    "id": 562371,
    "node_id": "MDQ6VXNlcjU2MjM3MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/562371?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/juanfranblanco",
    "html_url": "https://github.com/juanfranblanco",
    "followers_url": "https://api.github.com/users/juanfranblanco/followers",
    "following_url": "https://api.github.com/users/juanfranblanco/following{/other_user}",
    "gists_url": "https://api.github.com/users/juanfranblanco/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/juanfranblanco/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/juanfranblanco/subscriptions",
    "organizations_url": "https://api.github.com/users/juanfranblanco/orgs",
    "repos_url": "https://api.github.com/users/juanfranblanco/repos",
    "events_url": "https://api.github.com/users/juanfranblanco/events{/privacy}",
    "received_events_url": "https://api.github.com/users/juanfranblanco/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-03-21T14:47:16Z",
  "updated_at": "2019-03-26T02:38:00Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "There has been many attempts to create different solidity language parsing components and /or AST providers to support solidity tools and IDEs. \r\n\r\nThe problem is that all this disparate components are immediately out of date witch each solidity release, which is normally in a weekly basis.\r\n\r\nAlso different users, use different versions of solidity, so there is not a reliable way to inform a user or provide tooling based on their current version of solidity.\r\n\r\nSolc itself provides the AST output after the compilation of a smart contract or contracts, together with any compilation errors. \r\n\r\nIf Solc was able to recover from any parsing errors and output the AST in the same way that is done after compilation, tooling could be built on top without any external dependency and with the knowledge that any errors are inline with the current version of solidity itself.\r\n\r\nExample of usage or tools that could be built on top.\r\n\r\n* Linting (Ethlint / Solium or Solhint) could validate, and fix errors using the same AST parser.\r\n* Language server features\r\n- Auto complete\r\n- Goto definition\r\n- Refactoring (rename function, variable, across smart contracts)\r\n* On the fly smart contract analysis \r\n* Extra addons\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/6342/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/6342/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/475293414",
    "html_url": "https://github.com/ethereum/solidity/issues/6342#issuecomment-475293414",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6342",
    "id": 475293414,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTI5MzQxNA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-21T16:04:39Z",
    "updated_at": "2019-03-21T16:04:39Z",
    "author_association": "MEMBER",
    "body": "Some simple ways to recover:\r\n\r\nInside parenthesized expression, catch the fatal parser error, search for the next closing parenthesis and continue for there, ignoring everything that was skipped over.\r\n\r\nThe same can be done at statement level (search for next `;`) and contract level (search for next `}`).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/475293414/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/476451313",
    "html_url": "https://github.com/ethereum/solidity/issues/6342#issuecomment-476451313",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6342",
    "id": 476451313,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NjQ1MTMxMw==",
    "user": {
      "login": "rocky",
      "id": 8851,
      "node_id": "MDQ6VXNlcjg4NTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8851?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rocky",
      "html_url": "https://github.com/rocky",
      "followers_url": "https://api.github.com/users/rocky/followers",
      "following_url": "https://api.github.com/users/rocky/following{/other_user}",
      "gists_url": "https://api.github.com/users/rocky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rocky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rocky/subscriptions",
      "organizations_url": "https://api.github.com/users/rocky/orgs",
      "repos_url": "https://api.github.com/users/rocky/repos",
      "events_url": "https://api.github.com/users/rocky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rocky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-26T02:36:35Z",
    "updated_at": "2019-03-26T02:38:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Please correct me if I am wrong, but there are a couple of parts to this:\r\n\r\n* Recover when there are parse errors\r\n* Output AST information even if it is incomplete.\r\n\r\nLet me elaborate on these two. \r\n\r\n@chriseth suggests specific examples that I think fall into of the general method described in [Efficient and Comfortable Error Recovery in Recursive Descent Parsers](https://pdfs.semanticscholar.org/8ec1/6b0f5d9fd4ebb3dd5a5d2ce5c85df382c9c5.pdf?_ga=2.66202926.1641430271.1553456907-1338304767.1553456907).\r\n\r\nHere ')' , '}', and ';' are examples of symbols when seen often trigger the completion of a production rule (or production function), such as for an expression, a block statement, or a statement respectively for each of those symbols.\r\n\r\nAnother kind of recovery, not mentioned above but mentioned in the cited paper, is where there is a token that is expected and missing, for example contract name after the word `contract`. Recovery here just adds that token.\r\n\r\nBalancing expediency with a full solution, what I'd propose to do is implement something along the lines of what @chriseth suggests, but doing it more along the lines mentioned in the paper. In doing it this way, some simple errors can be caught and we can see results more quickly, while leaving open the possibility of handling fine-grained or other kinds of situations later. Improving error recovery an be incremental.\r\n\r\nDoing a general solution described in the paper would probably require an automated a way to compute these \"first\" and \"follow\" sets which would need to be done every time the grammar changes.  On the other hand, extending on the simple \"gobble until recovery symbol\" idea, one could generalize that approach a little bit more and compute some these \"first\" and \"follow\" sets by hand. By starting with the higher level productions (contract, function, compound statement) and working down the the lower-level ones (e.g. statement, assert statement, expression),  error recovery can be added incrementally on a grammar production (or recursive procedure)  basis.\r\n\r\nBut even if there were some sort of recovery in place, there is second problem to address: even when there _is_ some sort of failure, solc should still spit out any AST information it has, even if incomplete. \r\n\r\nFor example: suppose there are two functions and only one of them has an error, let's say the 2nd one, and we just can't recover from it, then at least output AST for the first function can be emitted.\r\n\r\nThoughts? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/476451313/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
