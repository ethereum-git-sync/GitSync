{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/6765",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/6765/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/6765/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/6765/events",
  "html_url": "https://github.com/ethereum/solidity/issues/6765",
  "id": 444291678,
  "node_id": "MDU6SXNzdWU0NDQyOTE2Nzg=",
  "number": 6765,
  "title": "[Yul] Re-introduce ``sub`` opcode",
  "user": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1282209978,
      "node_id": "MDU6TGFiZWwxMjgyMjA5OTc4",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/optimizer",
      "name": "optimizer",
      "color": "d4c5f9",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-05-15T08:00:07Z",
  "updated_at": "2022-09-26T22:01:17Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "During CSE, every `sub` by a constant is replaced by an `add` to get uniform expressions. At the end of the optimization phase, after constant-reintroduction, this should be reversed if the cost of the modified constant is better.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/6765/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/6765/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/499855981",
    "html_url": "https://github.com/ethereum/solidity/issues/6765#issuecomment-499855981",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6765",
    "id": 499855981,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5OTg1NTk4MQ==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-07T11:51:08Z",
    "updated_at": "2019-06-07T11:51:08Z",
    "author_association": "MEMBER",
    "body": "This is superceded by the constant optimiser, isn't it?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/499855981/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/502651110",
    "html_url": "https://github.com/ethereum/solidity/issues/6765#issuecomment-502651110",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6765",
    "id": 502651110,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMjY1MTExMA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-17T11:52:44Z",
    "updated_at": "2019-06-17T11:52:44Z",
    "author_association": "MEMBER",
    "body": "No, the constant optimizer only operates on actual numbers. Expressions like `sub(codesize(), 10)` will not be improved by the constant optimizer.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/502651110/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1250100270",
    "html_url": "https://github.com/ethereum/solidity/issues/6765#issuecomment-1250100270",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6765",
    "id": 1250100270,
    "node_id": "IC_kwDOAm_5kc5KgwQu",
    "user": {
      "login": "gumb0",
      "id": 1863135,
      "node_id": "MDQ6VXNlcjE4NjMxMzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1863135?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gumb0",
      "html_url": "https://github.com/gumb0",
      "followers_url": "https://api.github.com/users/gumb0/followers",
      "following_url": "https://api.github.com/users/gumb0/following{/other_user}",
      "gists_url": "https://api.github.com/users/gumb0/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gumb0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gumb0/subscriptions",
      "organizations_url": "https://api.github.com/users/gumb0/orgs",
      "repos_url": "https://api.github.com/users/gumb0/repos",
      "events_url": "https://api.github.com/users/gumb0/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gumb0/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-17T16:29:12Z",
    "updated_at": "2022-09-17T16:31:06Z",
    "author_association": "MEMBER",
    "body": "Could this be more general optimization like \"add(X, A) -> sub(A, -X) in case the cost is better\", so not only for expressions that start like `sub`? \r\nOr would this somehow interfere with the part where we're trying to get rid of all subs for uniformness?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1250100270/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1250122734",
    "html_url": "https://github.com/ethereum/solidity/issues/6765#issuecomment-1250122734",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6765",
    "id": 1250122734,
    "node_id": "IC_kwDOAm_5kc5Kg1vu",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-17T18:47:48Z",
    "updated_at": "2022-09-17T18:47:48Z",
    "author_association": "MEMBER",
    "body": "Yeah, that's how I'd do it. I don't see much point in trying to limit it to just the ones that have been replaced for CSE. This would actually be unnecessarily complicated because we'd have to track them. As long as the step is not executed before the CSE, I think it should not destroy any important property.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1250122734/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1258687946",
    "html_url": "https://github.com/ethereum/solidity/issues/6765#issuecomment-1258687946",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6765",
    "id": 1258687946,
    "node_id": "IC_kwDOAm_5kc5LBg3K",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-26T22:01:16Z",
    "updated_at": "2022-09-26T22:01:16Z",
    "author_association": "MEMBER",
    "body": "Just looking at #13535: I would say adding `add(X, A)` to `sub(A, -X)` is not the right way. One thing we want to avoid in the expression simplifier is infinite loops, as it doesn't really backtrace or understand the history of replacements. So if there is a loop in the simplification rule, hitting it is wasting time.\r\n\r\nI believe Chris is referring to something more specific, which is the constant optimizer. Some expression have shorter bytecode size than others, which is useful when you are optimizing for bytecode. For example, `add(x, 115792089237316195423570985008687907853269984665640564039457584007913129639935)` would have bigger bytecode size than `sub(x, 1)`. \r\n\r\nIMO, this should be done as a separate step or closely related to constant optimizer.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1258687946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
