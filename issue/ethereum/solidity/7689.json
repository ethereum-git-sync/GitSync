{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/7689",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/7689/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/7689/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/7689/events",
  "html_url": "https://github.com/ethereum/solidity/issues/7689",
  "id": 521441330,
  "node_id": "MDU6SXNzdWU1MjE0NDEzMzA=",
  "number": 7689,
  "title": "Better way to organize docker images for testing.",
  "user": {
    "login": "ekpyron",
    "id": 1347491,
    "node_id": "MDQ6VXNlcjEzNDc0OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ekpyron",
    "html_url": "https://github.com/ekpyron",
    "followers_url": "https://api.github.com/users/ekpyron/followers",
    "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
    "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
    "organizations_url": "https://api.github.com/users/ekpyron/orgs",
    "repos_url": "https://api.github.com/users/ekpyron/repos",
    "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ekpyron/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 838064207,
      "node_id": "MDU6TGFiZWw4MzgwNjQyMDc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/annoys%20users%20:cry:",
      "name": "annoys users :cry:",
      "color": "ea2cab",
      "default": false,
      "description": ""
    },
    {
      "id": 1018738457,
      "node_id": "MDU6TGFiZWwxMDE4NzM4NDU3",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/testing%20:hammer:",
      "name": "testing :hammer:",
      "color": "ffc6db",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-11-12T09:51:10Z",
  "updated_at": "2019-11-15T15:36:19Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "We need to:\r\n- decide how to distribute permissions to update the docker images\r\n- consider if and how to switch to source based images, if that helps\r\n- if nothing else works, re-evaluate how much speed-up we gain by using the docker images for the tests anyways in contrast to switching back to stock docker images, updating them and caching, which would ensure better maintainability and updateability.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/7689/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/7689/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/552825189",
    "html_url": "https://github.com/ethereum/solidity/issues/7689#issuecomment-552825189",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7689",
    "id": 552825189,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MjgyNTE4OQ==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-12T10:09:01Z",
    "updated_at": "2019-11-12T10:09:01Z",
    "author_association": "MEMBER",
    "body": "Rationale: the PR updating the clang Dockerfile was merged a day ago and we're still waiting for an updated image, causing test failures on all PRs. And updating the docker images for testing has to be easy and fast and should be done regularly anyways, since we will otherwise likely lock ourselves into testing against outdated dependencies.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/552825189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/552983946",
    "html_url": "https://github.com/ethereum/solidity/issues/7689#issuecomment-552983946",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7689",
    "id": 552983946,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1Mjk4Mzk0Ng==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-12T16:55:25Z",
    "updated_at": "2019-11-12T16:55:25Z",
    "author_association": "MEMBER",
    "body": "@axic on gitter:\r\n\r\nSetting version in the dockerfile: https://github.com/ethereum/aleth/blob/master/scripts/docker/cpp-build-env.dockerfile#L5\r\nUsing versioned images: https://github.com/ewasm/hera/blob/master/circle.yml#L201\r\n\r\nDoing things like that for our docker images might alleviate the pain in updates a lot already, because we can first push the docker updates, while keeping the tests intact and only update to the new docker image later.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/552983946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/552984860",
    "html_url": "https://github.com/ethereum/solidity/issues/7689#issuecomment-552984860",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7689",
    "id": 552984860,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1Mjk4NDg2MA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-12T16:57:19Z",
    "updated_at": "2019-11-12T17:02:44Z",
    "author_association": "MEMBER",
    "body": "Also: problems with the docker images now happened *twice* within the same day, resp. for the most part of two days now, so we really need to take care that this works better IMHO :-)...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/552984860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/553669200",
    "html_url": "https://github.com/ethereum/solidity/issues/7689#issuecomment-553669200",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7689",
    "id": 553669200,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MzY2OTIwMA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-14T00:33:46Z",
    "updated_at": "2019-11-14T00:33:46Z",
    "author_association": "MEMBER",
    "body": "We should look into https://docs.docker.com/docker-hub/builds/advanced/\r\nThat way we can setup autobuilds triggered by git commits with a custom versioned docker tag, for which we could fetch the version from the ``LABEL`` in the Dockerfile using introspection.\r\nThen we could enable autobuilds on all branches, resulting in the following:\r\n\r\nWe can just create PRs that bump the version in a Dockerfile and simultanously bump the version in the CI config. That will autotrigger the build and push of a new versioned docker image without affecting other PRs and CI runs. Once the automatically built docker image is (automatically) pushed, the tests in the PR can be retriggered and the whole thing merged, once the tests pass.\r\n\r\nWithout any local builds, version issues or the requirement of distributing dockerhub push permissions.\r\n\r\nThere are several slight variations of this we can consider (e.g. using docker's autotesting to validate that the docker images can run the build and tests before pushing), but generally I would say such a fully automated setup is feasible and *very* much worth setting up.\r\n\r\nAnd *with* such an automation setup I'd actually very much agree that the docker solution is in fact superior to CI caching. Even though we'll probably still need the latter for osx anyways.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/553669200/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/553707108",
    "html_url": "https://github.com/ethereum/solidity/issues/7689#issuecomment-553707108",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7689",
    "id": 553707108,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MzcwNzEwOA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-14T03:25:05Z",
    "updated_at": "2019-11-14T03:25:05Z",
    "author_association": "MEMBER",
    "body": "Another option to consider: I just played around with github actions and github packages in https://github.com/ekpyron/test\r\n\r\nIt turns out that we could also define a github action to be triggered on every pull request that modifies a docker file, which builds the docker file and publishes it to the \"github package repository\" associated with our repo. And that acts as a fully fledged docker registry, so we can then have CircleCI pull the docker image from there instead of from docker hub...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/553707108/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/554407550",
    "html_url": "https://github.com/ethereum/solidity/issues/7689#issuecomment-554407550",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7689",
    "id": 554407550,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDQwNzU1MA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-15T15:36:18Z",
    "updated_at": "2019-11-15T15:36:18Z",
    "author_association": "MEMBER",
    "body": "Related issue: https://github.com/ethereum/solidity/issues/7685",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/554407550/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
