{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/8186",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/8186/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/8186/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/8186/events",
  "html_url": "https://github.com/ethereum/solidity/issues/8186",
  "id": 554177712,
  "node_id": "MDU6SXNzdWU1NTQxNzc3MTI=",
  "number": 8186,
  "title": "Allow Dev to sort Function Lookups Manually instead of by Ascending Order",
  "user": {
    "login": "PhABC",
    "id": 9306422,
    "node_id": "MDQ6VXNlcjkzMDY0MjI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9306422?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PhABC",
    "html_url": "https://github.com/PhABC",
    "followers_url": "https://api.github.com/users/PhABC/followers",
    "following_url": "https://api.github.com/users/PhABC/following{/other_user}",
    "gists_url": "https://api.github.com/users/PhABC/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PhABC/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PhABC/subscriptions",
    "organizations_url": "https://api.github.com/users/PhABC/orgs",
    "repos_url": "https://api.github.com/users/PhABC/repos",
    "events_url": "https://api.github.com/users/PhABC/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PhABC/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    },
    {
      "id": 4438003076,
      "node_id": "LA_kwDOAm_5kc8AAAABCIaNhA",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/medium%20effort",
      "name": "medium effort",
      "color": "ff7df7",
      "default": false,
      "description": "Default level of effort"
    },
    {
      "id": 4438155599,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjhTw",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/medium%20impact",
      "name": "medium impact",
      "color": "314aff",
      "default": false,
      "description": "Default level of impact"
    },
    {
      "id": 4438490842,
      "node_id": "LA_kwDOAm_5kc8AAAABCI3-2g",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/should%20have",
      "name": "should have",
      "color": "ffbe6c",
      "default": false,
      "description": "We like the idea but itâ€™s not important enough to be a part of the roadmap."
    },
    {
      "id": 4525128519,
      "node_id": "LA_kwDOAm_5kc8AAAABDbf7Rw",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/needs%20design",
      "name": "needs design",
      "color": "18F737",
      "default": false,
      "description": "The proposal is too vague to be implemented right away"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-01-23T14:04:24Z",
  "updated_at": "2022-09-26T23:02:32Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--## Prerequisites\r\n-->\r\n\r\n## Abstract\r\n\r\nCurrently, the function lookup when calling a contract is organized by sorting the function signature in ascending order. This may not be optimal as the most used function could happen to be at the end of the lookup, potentially adding 100-1000 additional gas for every call. Users should have a mean to tell the compiler the order in which functions are expected to be most used, from most used function to less used function.\r\n\r\n<!--\r\nPlease describe by example what problem you see in the current Solidity language\r\nand reason about it.\r\n-->\r\n\r\n## Motivation\r\nSorting function signatures by ascending orders can lead to some significant gas cost increase if the important functions have a high function signature, especially in more complex contracts. Allowing users to specify the lookup order could lead to more efficient contracts.\r\n\r\n<!--\r\nIn this section you describe how you propose to address the problem you described earlier,\r\nincluding by giving one or more exemplary source code snippets for demonstration.\r\n-->\r\n\r\n## Specification\r\nFew options I am aware of:\r\n\r\n1. Should expend the `runs` compiler option to allow to specify the expected # of runs for each function.\r\n\r\n2. New option in the compiler where a user give the order for functions to include at the beginning of the lookup. A user might only add `['f()',  'g()']` in that list, where `f()` would be the first function in the lookup and `g()` would be the second. All remaining functions are sorted in ascending order in the lookup.\r\n\r\n3. Could have special comment section in the contracts where functions are sorted by expected frequency of use.\r\n\r\n<!--\r\nThe technical specification should describe the syntax and semantics of any new feature. The\r\nspecification should be detailed enough to allow any developer to implement the functionality.\r\n-->\r\n\r\n## Backwards Compatibility\r\nThis is backward compatible.\r\n\r\n<!--\r\nAll language changes that introduce backwards incompatibilities must include a section describing\r\nthese incompatibilities and their severity.\r\n\r\nPlease describe how you propose to deal with these incompatibilities.\r\n-->",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/8186/reactions",
    "total_count": 5,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 5,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/8186/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/577707422",
    "html_url": "https://github.com/ethereum/solidity/issues/8186#issuecomment-577707422",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8186",
    "id": 577707422,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NzcwNzQyMg==",
    "user": {
      "login": "leonardoalt",
      "id": 504195,
      "node_id": "MDQ6VXNlcjUwNDE5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/504195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leonardoalt",
      "html_url": "https://github.com/leonardoalt",
      "followers_url": "https://api.github.com/users/leonardoalt/followers",
      "following_url": "https://api.github.com/users/leonardoalt/following{/other_user}",
      "gists_url": "https://api.github.com/users/leonardoalt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leonardoalt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leonardoalt/subscriptions",
      "organizations_url": "https://api.github.com/users/leonardoalt/orgs",
      "repos_url": "https://api.github.com/users/leonardoalt/repos",
      "events_url": "https://api.github.com/users/leonardoalt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leonardoalt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-23T14:34:50Z",
    "updated_at": "2020-01-23T14:34:50Z",
    "author_association": "MEMBER",
    "body": "I think 2. makes sense. Providing a full sorted list of functions would be tough considering large hierarchies.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/577707422/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/577713518",
    "html_url": "https://github.com/ethereum/solidity/issues/8186#issuecomment-577713518",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8186",
    "id": 577713518,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NzcxMzUxOA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-23T14:48:44Z",
    "updated_at": "2020-01-23T14:49:09Z",
    "author_association": "MEMBER",
    "body": "I would actually prefer the \"runs\" option, because it can be used for other optimizer decisions as well.\r\nIt could even be used to decide whether a binary search should be used at all or just for some functions.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/577713518/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/577717190",
    "html_url": "https://github.com/ethereum/solidity/issues/8186#issuecomment-577717190",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8186",
    "id": 577717190,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NzcxNzE5MA==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-23T14:56:55Z",
    "updated_at": "2020-01-23T14:56:55Z",
    "author_association": "MEMBER",
    "body": "A relevant discussion is #4858, #6234 and #1289.\r\n\r\nhttps://github.com/ethereum/solidity/issues/4858#issuecomment-415744724 proposes option 2.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/577717190/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/577775925",
    "html_url": "https://github.com/ethereum/solidity/issues/8186#issuecomment-577775925",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8186",
    "id": 577775925,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3Nzc3NTkyNQ==",
    "user": {
      "login": "recmo",
      "id": 4532328,
      "node_id": "MDQ6VXNlcjQ1MzIzMjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4532328?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/recmo",
      "html_url": "https://github.com/recmo",
      "followers_url": "https://api.github.com/users/recmo/followers",
      "following_url": "https://api.github.com/users/recmo/following{/other_user}",
      "gists_url": "https://api.github.com/users/recmo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/recmo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/recmo/subscriptions",
      "organizations_url": "https://api.github.com/users/recmo/orgs",
      "repos_url": "https://api.github.com/users/recmo/repos",
      "events_url": "https://api.github.com/users/recmo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/recmo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-23T17:05:58Z",
    "updated_at": "2020-01-23T17:26:37Z",
    "author_association": "NONE",
    "body": ">  It could even be used to decide whether a binary search should be used at all or just for some functions.\r\n\r\nNotice that the current behaviour of linear scan and the proposed binary search are both instances of a binary tree. The comparisons are nodes and functions are leaves. The linear scan is completely unbalanced (i.e. every left node is a leaf). The binary search approximates a balanced tree (and is one for power of two number of leafs).\r\n\r\nBut there are many more shapes for binary trees, and a Huffman tree weighted by the number of runs you should be optimal here. It's know from Huffman compression, but it's really just a way to use weights to create an optimal un-balanced binary tree.  [Here is a decent description of the algorithm](https://en.wikipedia.org/wiki/Huffman_coding#Basic_technique).\r\n\r\nIf the weights are appropriate, it will recreate either the linear scan or binary search or come up with something better.\r\n\r\nEdit: It's actually a bit more complicated here since the bytes4 are randomly assigned. Not sure if Huffman's algorithm is good for that. But the idea of an unbalanced tree should still work.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/577775925/reactions",
      "total_count": 5,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 5,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
