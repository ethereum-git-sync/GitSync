{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/9297",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/9297/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/9297/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/9297/events",
  "html_url": "https://github.com/ethereum/solidity/issues/9297",
  "id": 650097066,
  "node_id": "MDU6SXNzdWU2NTAwOTcwNjY=",
  "number": 9297,
  "title": "Investigate node-js performance and delays on exiting",
  "user": {
    "login": "ekpyron",
    "id": 1347491,
    "node_id": "MDQ6VXNlcjEzNDc0OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ekpyron",
    "html_url": "https://github.com/ekpyron",
    "followers_url": "https://api.github.com/users/ekpyron/followers",
    "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
    "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
    "organizations_url": "https://api.github.com/users/ekpyron/orgs",
    "repos_url": "https://api.github.com/users/ekpyron/repos",
    "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ekpyron/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3306843671,
      "node_id": "MDU6TGFiZWwzMzA2ODQzNjcx",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/solc-js",
      "name": "solc-js",
      "color": "C0BF81",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-07-02T17:30:29Z",
  "updated_at": "2022-09-07T18:03:14Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "@frangio first reported that the loading times of soljson.js in node-js increased significantly between 0.6.8 and 0.6.9 (along with the size increase due to adding Z3). This indeed seems to be the case for node 10, which has quite high loading times in general.\r\n\r\nWe probably don't need to care too much about node 10, which is rather old by now - but node > 10 has an even weirder issue.\r\n\r\nSome benchmarks by @frangio https://gist.github.com/frangio/e70e524e3357ea143df77b7d3197c0a7\r\n\r\nApparently neither loading the file, nor compiling it, nor executing it is what actually causes the slow execution. At least I personally would be fine with the increase from 200ms to 600ms there, because it's still \"fast enough\" - but apparently *exiting* the node-js process causes a significant delay and 2.5 vs 7.3 seconds is really not nice, especially if it looks like it *could* just be ~200ms and the rest is wasted process shutdown time.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/9297/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/9297/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/653243409",
    "html_url": "https://github.com/ethereum/solidity/issues/9297#issuecomment-653243409",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9297",
    "id": 653243409,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MzI0MzQwOQ==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-02T22:21:23Z",
    "updated_at": "2020-07-02T22:21:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "An interesting point is that manually calling `process.exit()` will exit node without delay.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/653243409/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/653264418",
    "html_url": "https://github.com/ethereum/solidity/issues/9297#issuecomment-653264418",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9297",
    "id": 653264418,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MzI2NDQxOA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-02T23:53:02Z",
    "updated_at": "2020-07-02T23:53:02Z",
    "author_association": "MEMBER",
    "body": "Oh, wow, interesting! I did use ``abort()`` and saw that that makes it exit fast, but expected that to only work in such a \"disgraceful\" way of exiting - I hadn't even considered that ``process.exit()`` might also have that effect :-)!\r\nI'm starting to get the feeling that this might actually primarily be an issue in node itself and we should actually ask them to look into it or at least explain it...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/653264418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/653485042",
    "html_url": "https://github.com/ethereum/solidity/issues/9297#issuecomment-653485042",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9297",
    "id": 653485042,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MzQ4NTA0Mg==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-03T10:50:22Z",
    "updated_at": "2020-07-03T10:50:37Z",
    "author_association": "MEMBER",
    "body": "Pinging @cameel here since he seems to be looking into this as well.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/653485042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1014386055",
    "html_url": "https://github.com/ethereum/solidity/issues/9297#issuecomment-1014386055",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9297",
    "id": 1014386055,
    "node_id": "IC_kwDOAm_5kc48dk2H",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-17T10:51:59Z",
    "updated_at": "2022-01-17T10:51:59Z",
    "author_association": "MEMBER",
    "body": "Looking at this again superficially, I think https://github.com/nodejs/node/issues/36616#issuecomment-757929741 may be responsible for this. The issue is open and active, so we can hope that this will finally be resolved on the node end eventually...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1014386055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1014396149",
    "html_url": "https://github.com/ethereum/solidity/issues/9297#issuecomment-1014396149",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9297",
    "id": 1014396149,
    "node_id": "IC_kwDOAm_5kc48dnT1",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-17T11:04:18Z",
    "updated_at": "2022-01-17T11:04:30Z",
    "author_association": "MEMBER",
    "body": "Actually, these days I do see this issue even *with* explicit ``abort()`` or ``process.exit(0)``...\r\nBut I just tried https://github.com/nodejs/node/issues/36616#issuecomment-1014216889 and that does seem to help, i.e.\r\nrunning with ``node --wasm-dynamic-tiering`` solves the issue for me...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1014396149/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
