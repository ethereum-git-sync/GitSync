{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/9926",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/9926/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/9926/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/9926/events",
  "html_url": "https://github.com/ethereum/solidity/issues/9926",
  "id": 711284861,
  "node_id": "MDU6SXNzdWU3MTEyODQ4NjE=",
  "number": 9926,
  "title": "ICE's formattedMessage field is truncated",
  "user": {
    "login": "alcuadrado",
    "id": 176499,
    "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alcuadrado",
    "html_url": "https://github.com/alcuadrado",
    "followers_url": "https://api.github.com/users/alcuadrado/followers",
    "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
    "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
    "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
    "repos_url": "https://api.github.com/users/alcuadrado/repos",
    "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 717596767,
      "node_id": "MDU6TGFiZWw3MTc1OTY3Njc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "006b75",
      "default": true,
      "description": ""
    },
    {
      "id": 1012613901,
      "node_id": "MDU6TGFiZWwxMDEyNjEzOTAx",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/easy%20difficulty",
      "name": "easy difficulty",
      "color": "0b3f89",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2020-09-29T16:42:59Z",
  "updated_at": "2022-08-17T13:48:48Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nWhen the compiler emits an ICE in the standard json output, the ICE's `formattedMessage` field is truncated. For example:\r\n\r\n```\r\n{ \r\n     component: 'general',\r\n     formattedMessage: 'InternalCompilerError: \\n',\r\n     message:\r\n      'Internal compiler error (/solidity/libsolidity/codegen/CompilerUtils.cpp:1440):',\r\n     severity: 'error',\r\n     type: 'InternalCompilerError'\r\n}\r\n```\r\n\r\nI believe it should be something like: `\"InternalCompilerError: (/solidity/libsolidity/codegen/CompilerUtils.cpp:1440)\"`.\r\n\r\nWhile the proposed version is not very human friendly, it would make googling for errors much much easier.\r\n\r\n\r\n## Environment\r\n\r\n- Compiler version: I tried in 0.7.2, but I'm pretty confident that th\r\n- Target EVM version (as per compiler settings): default\r\n- Framework/IDE (e.g. Truffle or Remix): buidler\r\n- EVM execution environment / backend / blockchain client: nonce\r\n- Operating system: macos catalina\r\n\r\n## Steps to Reproduce\r\n\r\nCompile a file that doesn't use abi encoder v2, and imports one that does.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/9926/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/9926/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1134118814",
    "html_url": "https://github.com/ethereum/solidity/issues/9926#issuecomment-1134118814",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9926",
    "id": 1134118814,
    "node_id": "IC_kwDOAm_5kc5DmUee",
    "user": {
      "login": "Ruko97",
      "id": 24402767,
      "node_id": "MDQ6VXNlcjI0NDAyNzY3",
      "avatar_url": "https://avatars.githubusercontent.com/u/24402767?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ruko97",
      "html_url": "https://github.com/Ruko97",
      "followers_url": "https://api.github.com/users/Ruko97/followers",
      "following_url": "https://api.github.com/users/Ruko97/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ruko97/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ruko97/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ruko97/subscriptions",
      "organizations_url": "https://api.github.com/users/Ruko97/orgs",
      "repos_url": "https://api.github.com/users/Ruko97/repos",
      "events_url": "https://api.github.com/users/Ruko97/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ruko97/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-23T03:03:23Z",
    "updated_at": "2022-05-23T03:03:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "Has this issue been resolved yet? If not, I am interested to work on it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1134118814/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1137780368",
    "html_url": "https://github.com/ethereum/solidity/issues/9926#issuecomment-1137780368",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9926",
    "id": 1137780368,
    "node_id": "IC_kwDOAm_5kc5D0SaQ",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-25T19:44:08Z",
    "updated_at": "2022-05-25T19:44:08Z",
    "author_association": "MEMBER",
    "body": "@Ruko97 It hasn't and it would be a nice improvement. So if you want to try, go ahead.\r\n\r\nI'd start by looking at [these exception handlers in `StandardCompiler.cpp`](https://github.com/ethereum/solidity/blob/v0.8.14/libsolidity/interface/StandardCompiler.cpp#L1121-L1223), especially the one for `InternalCompilerError`. Then [`formatError()` and related helpers](https://github.com/ethereum/solidity/blob/v0.8.14/libsolidity/interface/StandardCompiler.cpp#L56-L151). I suspect that the problem is somewhere in there. Try to modify the code locally so that the error handler always executes and see why it gets truncated. If it's not the right handler, look for others that might catch `InternalCompilerError`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1137780368/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1140424893",
    "html_url": "https://github.com/ethereum/solidity/issues/9926#issuecomment-1140424893",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9926",
    "id": 1140424893,
    "node_id": "IC_kwDOAm_5kc5D-YC9",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-29T11:01:43Z",
    "updated_at": "2022-05-29T11:01:43Z",
    "author_association": "MEMBER",
    "body": "I do not think there is any bug here, and certainly no truncation.\r\n\r\nThe original finding refers to 0.7.2 and `CompilerUtils.cpp#L1440`, which [is here](https://github.com/ethereum/solidity/blob/v0.7.2/libsolidity/codegen/CompilerUtils.cpp#L1440):\r\n```cpp\r\n\tsolAssert(_type.isValueType(), \"\");\r\n```\r\n\r\nThe sole reason the message is empty, because it is empty in the code.\r\n\r\nThere was #1042 and #5160 about that.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1140424893/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1140426252",
    "html_url": "https://github.com/ethereum/solidity/issues/9926#issuecomment-1140426252",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9926",
    "id": 1140426252,
    "node_id": "IC_kwDOAm_5kc5D-YYM",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-29T11:10:43Z",
    "updated_at": "2022-05-29T11:10:43Z",
    "author_association": "MEMBER",
    "body": "Re-reading @alcuadrado's original suggestion, I think the issue isn't about potentially having truncated `message`s, but that `formattedMessage` should also include the line number. Based on the code snippets in [StandardCompiler](https://github.com/ethereum/solidity/blob/develop/libsolidity/interface/StandardCompiler.cpp#L1161) this applies to every single exception based error:\r\n```cpp\r\n\t\terrors.append(formatErrorWithException(\r\n\t\t\tcompilerStack,\r\n\t\t\t_exception,\r\n\t\t\tError::Severity::Error,\r\n\t\t\t\"InternalCompilerError\",\r\n\t\t\t\"general\",\r\n\t\t\t\"Internal compiler error (\" + _exception.lineInfo() + \")\"\r\n\t\t));\r\n```\r\n\r\nThe problem is that for `formattedMessage` we take in \"error type\" and a message, however the exceptions also have a relevant line number. Probably can modify the special cases [here](https://github.com/ethereum/solidity/blob/develop/libsolidity/interface/StandardCompiler.cpp#L126) and [here](https://github.com/ethereum/solidity/blob/develop/libsolidity/interface/StandardCompiler.cpp#L132).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1140426252/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1140524391",
    "html_url": "https://github.com/ethereum/solidity/issues/9926#issuecomment-1140524391",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9926",
    "id": 1140524391,
    "node_id": "IC_kwDOAm_5kc5D-wVn",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-29T21:05:57Z",
    "updated_at": "2022-05-29T21:07:05Z",
    "author_association": "MEMBER",
    "body": "I thought it was being truncated from something like this (taken from an unrelated issue):\r\n```\r\nInternal compiler error:\r\n/solidity/libsolidity/ast/Types.cpp(2877): Throw in function solidity::frontend::TypePointers solidity::frontend::FunctionType::returnParameterTypesWithoutDynamicTypes() const\r\nDynamic exception type: boost::wrapexcept<solidity::langutil::InternalCompilerError>\r\nstd::exception::what: Solidity assertion failed\r\n[solidity::util::tag_comment*] = Solidity assertion failed\r\n```\r\nEspecially the trailing `\\n` in the single-line message makes it look like it's just a fragment that came from a longer multiline piece of text.\r\n\r\nBut I think you're right. It's not technically truncated. It's just that the `formattedMessage` field only includes the error type and the message and the message used to be empty in most of our assertions. We implemented #12019 some time ago so now these are no longer empty. The default message is just as useless for debugging though (something like \"Solidity assertion failed\") so including either file/line or the function name would be an improvement.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1140524391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1140614269",
    "html_url": "https://github.com/ethereum/solidity/issues/9926#issuecomment-1140614269",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9926",
    "id": 1140614269,
    "node_id": "IC_kwDOAm_5kc5D_GR9",
    "user": {
      "login": "Ruko97",
      "id": 24402767,
      "node_id": "MDQ6VXNlcjI0NDAyNzY3",
      "avatar_url": "https://avatars.githubusercontent.com/u/24402767?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ruko97",
      "html_url": "https://github.com/Ruko97",
      "followers_url": "https://api.github.com/users/Ruko97/followers",
      "following_url": "https://api.github.com/users/Ruko97/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ruko97/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ruko97/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ruko97/subscriptions",
      "organizations_url": "https://api.github.com/users/Ruko97/orgs",
      "repos_url": "https://api.github.com/users/Ruko97/repos",
      "events_url": "https://api.github.com/users/Ruko97/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ruko97/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-30T02:20:00Z",
    "updated_at": "2022-05-30T02:20:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Importing a library that uses ABI Encoder V2 in a file that doesn't use ABI Encoder V1 no longer seems to cause an Internal Compiler Error. Is there any other way to simulate an ICE? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1140614269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1141030084",
    "html_url": "https://github.com/ethereum/solidity/issues/9926#issuecomment-1141030084",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9926",
    "id": 1141030084,
    "node_id": "IC_kwDOAm_5kc5EArzE",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-30T11:16:57Z",
    "updated_at": "2022-05-30T11:16:57Z",
    "author_association": "MEMBER",
    "body": "You'll find lots of ways to cause an ICE under the [`bug` label](https://github.com/ethereum/solidity/issues?q=is%3Aissue+is%3Aopen+label%3A\"bug+%3Abug%3A\").",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1141030084/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
